!function(){function e(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){i(e,t,n[t])})}return e}var a,o,s,l,u,c,h,d,p,f,v,m,g,_,y,x=[],b="ResizeObserver loop completed with undelivered notifications.",w=function(){var e;"function"==typeof ErrorEvent?e=new ErrorEvent("error",{message:b}):((e=document.createEvent("Event")).initEvent("error",!1,!1),e.message=b),window.dispatchEvent(e)};(a=h||(h={})).BORDER_BOX="border-box",a.CONTENT_BOX="content-box",a.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box";var S=function(e){return Object.freeze(e)},M=function(e,t){this.inlineSize=e,this.blockSize=t,S(this)},E=function(){function e(e,t,n,i){return this.x=e,this.y=t,this.width=n,this.height=i,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,S(this)}return e.prototype.toJSON=function(){return{x:this.x,y:this.y,top:this.top,right:this.right,bottom:this.bottom,left:this.left,width:this.width,height:this.height}},e.fromRect=function(t){return new e(t.x,t.y,t.width,t.height)},e}(),T=function(e){return e instanceof SVGElement&&"getBBox"in e},C=function(e){if(T(e)){var t=e.getBBox(),n=t.width,i=t.height;return!n&&!i}var r=e.offsetWidth,a=e.offsetHeight;return!(r||a||e.getClientRects().length)},k=function(e){if(e instanceof Element)return!0;var t,n=null===(t=null==e?void 0:e.ownerDocument)||void 0===t?void 0:t.defaultView;return!!(n&&e instanceof n.Element)},A=function(e){switch(e.tagName){case"INPUT":if("image"!==e.type)break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1},P="undefined"!=typeof window?window:{},R=new WeakMap,U=/auto|scroll/,L=/^tb|vertical/,D=/msie|trident/i.test(P.navigator&&P.navigator.userAgent),I=function(e){return parseFloat(e||"0")},N=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=!1),new M((n?t:e)||0,(n?e:t)||0)},O=S({devicePixelContentBoxSize:N(),borderBoxSize:N(),contentBoxSize:N(),contentRect:new E(0,0,0,0)}),F=function(e,t){if(void 0===t&&(t=!1),R.has(e)&&!t)return R.get(e);if(C(e))return R.set(e,O),O;var n=getComputedStyle(e),i=T(e)&&e.ownerSVGElement&&e.getBBox(),r=!D&&"border-box"===n.boxSizing,a=L.test(n.writingMode||""),o=!i&&U.test(n.overflowY||""),s=!i&&U.test(n.overflowX||""),l=i?0:I(n.paddingTop),u=i?0:I(n.paddingRight),c=i?0:I(n.paddingBottom),h=i?0:I(n.paddingLeft),d=i?0:I(n.borderTopWidth),p=i?0:I(n.borderRightWidth),f=i?0:I(n.borderBottomWidth),v=i?0:I(n.borderLeftWidth),m=h+u,g=l+c,_=v+p,y=d+f,x=s?e.offsetHeight-y-e.clientHeight:0,b=o?e.offsetWidth-_-e.clientWidth:0,w=i?i.width:I(n.width)-(r?m+_:0)-b,M=i?i.height:I(n.height)-(r?g+y:0)-x,k=w+m+b+_,A=M+g+x+y,P=S({devicePixelContentBoxSize:N(Math.round(w*devicePixelRatio),Math.round(M*devicePixelRatio),a),borderBoxSize:N(k,A,a),contentBoxSize:N(w,M,a),contentRect:new E(h,l,w,M)});return R.set(e,P),P},B=function(e,t,n){var i=F(e,n),r=i.borderBoxSize,a=i.contentBoxSize,o=i.devicePixelContentBoxSize;switch(t){case h.DEVICE_PIXEL_CONTENT_BOX:return o;case h.BORDER_BOX:return r;default:return a}},V=function(e){var t=F(e);this.target=e,this.contentRect=t.contentRect,this.borderBoxSize=S([t.borderBoxSize]),this.contentBoxSize=S([t.contentBoxSize]),this.devicePixelContentBoxSize=S([t.devicePixelContentBoxSize])},z=function(e){if(C(e))return 1/0;for(var t=0,n=e.parentNode;n;)t+=1,n=n.parentNode;return t},G=function(){var e=1/0,t=[];x.forEach(function(n){if(0!==n.activeTargets.length){var i=[];n.activeTargets.forEach(function(t){var n=new V(t.target),r=z(t.target);i.push(n),t.lastReportedSize=B(t.target,t.observedBox),r<e&&(e=r)}),t.push(function(){n.callback.call(n.observer,i,n.observer)}),n.activeTargets.splice(0,n.activeTargets.length)}});for(var n=0;n<t.length;n++)(0,t[n])();return e},H=function(e){x.forEach(function(t){t.activeTargets.splice(0,t.activeTargets.length),t.skippedTargets.splice(0,t.skippedTargets.length),t.observationTargets.forEach(function(n){n.isActive()&&(z(n.target)>e?t.activeTargets.push(n):t.skippedTargets.push(n))})})},W=function(){var e=0;for(H(0);x.some(function(e){return e.activeTargets.length>0});)H(e=G());return x.some(function(e){return e.skippedTargets.length>0})&&w(),e>0},j=[],X=function(e){if(!d){var t=0,n=document.createTextNode("");new MutationObserver(function(){return j.splice(0).forEach(function(e){return e()})}).observe(n,{characterData:!0}),d=function(){n.textContent="".concat(t?t--:t++)}}j.push(e),d()},q=function(e){X(function(){requestAnimationFrame(e)})},Y=0,K={attributes:!0,characterData:!0,childList:!0,subtree:!0},Z=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],J=function(e){return void 0===e&&(e=0),Date.now()+e},Q=!1,$=new(function(){function e(){var e=this;this.stopped=!0,this.listener=function(){return e.schedule()}}return e.prototype.run=function(e){var t=this;if(void 0===e&&(e=250),!Q){Q=!0;var n=J(e);q(function(){var i=!1;try{i=W()}finally{if(Q=!1,e=n-J(),!Y)return;i?t.run(1e3):e>0?t.run(e):t.start()}})}},e.prototype.schedule=function(){this.stop(),this.run()},e.prototype.observe=function(){var e=this,t=function(){return e.observer&&e.observer.observe(document.body,K)};document.body?t():P.addEventListener("DOMContentLoaded",t)},e.prototype.start=function(){var e=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),Z.forEach(function(t){return P.addEventListener(t,e.listener,!0)}))},e.prototype.stop=function(){var e=this;this.stopped||(this.observer&&this.observer.disconnect(),Z.forEach(function(t){return P.removeEventListener(t,e.listener,!0)}),this.stopped=!0)},e}()),ee=function(e){!Y&&e>0&&$.start(),(Y+=e)||$.stop()},et=function(){function e(e,t){this.target=e,this.observedBox=t||h.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return e.prototype.isActive=function(){var e,t=B(this.target,this.observedBox,!0);return!T(e=this.target)&&!A(e)&&"inline"===getComputedStyle(e).display&&(this.lastReportedSize=t),this.lastReportedSize.inlineSize!==t.inlineSize||this.lastReportedSize.blockSize!==t.blockSize},e}(),en=function(e,t){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=e,this.callback=t},ei=new WeakMap,er=function(e,t){for(var n=0;n<e.length;n+=1)if(e[n].target===t)return n;return -1},ea=function(){function e(){}return e.connect=function(e,t){var n=new en(e,t);ei.set(e,n)},e.observe=function(e,t,n){var i=ei.get(e),r=0===i.observationTargets.length;0>er(i.observationTargets,t)&&(r&&x.push(i),i.observationTargets.push(new et(t,n&&n.box)),ee(1),$.schedule())},e.unobserve=function(e,t){var n=ei.get(e),i=er(n.observationTargets,t),r=1===n.observationTargets.length;i>=0&&(r&&x.splice(x.indexOf(n),1),n.observationTargets.splice(i,1),ee(-1))},e.disconnect=function(e){var t=this,n=ei.get(e);n.observationTargets.slice().forEach(function(n){return t.unobserve(e,n.target)}),n.activeTargets.splice(0,n.activeTargets.length)},e}(),eo=function(){function e(e){if(0==arguments.length)throw TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if("function"!=typeof e)throw TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");ea.connect(this,e)}return e.prototype.observe=function(e,t){if(0==arguments.length)throw TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!k(e))throw TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");ea.observe(this,e,t)},e.prototype.unobserve=function(e){if(0==arguments.length)throw TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!k(e))throw TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");ea.unobserve(this,e)},e.prototype.disconnect=function(){ea.disconnect(this)},e.toString=function(){return"function ResizeObserver () { [polyfill code] }"},e}();function es(e,t,n,i,r,a,o){try{var s=e[a](o),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(i,r)}function el(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){var a=e.apply(t,n);function o(e){es(a,i,r,o,s,"next",e)}function s(e){es(a,i,r,o,s,"throw",e)}o(void 0)})}}function eu(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function ec(e,t){var n,i,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}function eh(e,t,n){return Math.min(Math.max(e,t),n)}function ed(e,t,n){return 0===(n=eh(n,0,1))?e:1===n?t:e+(t-e)*n}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function ep(e){return(ep=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ef(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ef=function(){return!!e})()}function ev(e,t,n){var i;return t=ep(t),(i=ef()?Reflect.construct(t,n||[],ep(e).constructor):t.apply(e,n))&&("object"===eu(i)||"function"==typeof i)?i:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function em(e,t,n){return(em="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ep(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n||e):r.value}})(e,t,n||e)}function eg(e,t){return(eg=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function e_(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&eg(e,t)}function ey(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function ex(e,t){if(e){if("string"==typeof e)return ey(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ey(e,t)}}function eb(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,i,r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(e,t)||ex(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ew(e){return function(e){if(Array.isArray(e))return ey(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ex(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eS(e,t,n){return(eS=ef()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&eg(r,n.prototype),r}).apply(null,arguments)}function eM(e){var t="function"==typeof Map?new Map:void 0;return(eM=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return eS(e,arguments,ep(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),eg(n,e)})(e)}"function"==typeof SuppressedError&&SuppressedError;var eE="srgb",eT="srgb-linear",eC="linear",ek="srgb",eA="300 es",eP=function(){function t(){e(this,t)}return n(t,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}},{key:"hasEventListener",value:function(e,t){var n=this._listeners;return void 0!==n&&void 0!==n[e]&&-1!==n[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){var n=this._listeners;if(void 0!==n){var i=n[e];if(void 0!==i){var r=i.indexOf(t);-1!==r&&i.splice(r,1)}}}},{key:"dispatchEvent",value:function(e){var t=this._listeners;if(void 0!==t){var n=t[e.type];if(void 0!==n){e.target=this;for(var i=n.slice(0),r=0,a=i.length;r<a;r++)i[r].call(this,e);e.target=null}}}}]),t}(),eR=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],eU=1234567,eL=Math.PI/180,eD=180/Math.PI;function eI(){var e=0xffffffff*Math.random()|0,t=0xffffffff*Math.random()|0,n=0xffffffff*Math.random()|0,i=0xffffffff*Math.random()|0;return(eR[255&e]+eR[e>>8&255]+eR[e>>16&255]+eR[e>>24&255]+"-"+eR[255&t]+eR[t>>8&255]+"-"+eR[t>>16&15|64]+eR[t>>24&255]+"-"+eR[63&n|128]+eR[n>>8&255]+"-"+eR[n>>16&255]+eR[n>>24&255]+eR[255&i]+eR[i>>8&255]+eR[i>>16&255]+eR[i>>24&255]).toLowerCase()}function eN(e,t,n){return Math.max(t,Math.min(n,e))}function eO(e,t){return(e%t+t)%t}function eF(e,t,n){return(1-n)*e+n*t}function eB(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/0xffffffff;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/0x7fffffff,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw Error("Invalid component type.")}}function eV(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(0xffffffff*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(0x7fffffff*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw Error("Invalid component type.")}}var ez=eI,eG=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,t),t.prototype.isVector2=!0,this.x=n,this.y=i}return n(t,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=eN(this.x,e.x,t.x),this.y=eN(this.y,e.y,t.y),this}},{key:"clampScalar",value:function(e,t){return this.x=eN(this.x,e,t),this.y=eN(this.y,e,t),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(eN(n,e,t))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){return Math.atan2(-this.y,-this.x)+Math.PI}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===t?Math.PI/2:Math.acos(eN(this.dot(e)/t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*i+e.x,this.y=r*i+a*n+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:Symbol.iterator,value:function(){return ec(this,function(e){switch(e.label){case 0:return[4,this.x];case 1:return e.sent(),[4,this.y];case 2:return e.sent(),[2]}})}}]),t}(),eH=function(){function t(n,i,r,a,o,s,l,u,c){e(this,t),t.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==n&&this.set(n,i,r,a,o,s,l,u,c)}return n(t,[{key:"set",value:function(e,t,n,i,r,a,o,s,l){var u=this.elements;return u[0]=e,u[1]=i,u[2]=o,u[3]=t,u[4]=r,u[5]=s,u[6]=n,u[7]=a,u[8]=l,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[3],s=n[6],l=n[1],u=n[4],c=n[7],h=n[2],d=n[5],p=n[8],f=i[0],v=i[3],m=i[6],g=i[1],_=i[4],y=i[7],x=i[2],b=i[5],w=i[8];return r[0]=a*f+o*g+s*x,r[3]=a*v+o*_+s*b,r[6]=a*m+o*y+s*w,r[1]=l*f+u*g+c*x,r[4]=l*v+u*_+c*b,r[7]=l*m+u*y+c*w,r[2]=h*f+d*g+p*x,r[5]=h*v+d*_+p*b,r[8]=h*m+d*y+p*w,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8];return t*a*u-t*o*l-n*r*u+n*o*s+i*r*l-i*a*s}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=u*a-o*l,h=o*s-u*r,d=l*r-a*s,p=t*c+n*h+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);var f=1/p;return e[0]=c*f,e[1]=(i*l-u*n)*f,e[2]=(o*n-i*a)*f,e[3]=h*f,e[4]=(u*t-i*s)*f,e[5]=(i*r-o*t)*f,e[6]=d*f,e[7]=(n*s-l*t)*f,e[8]=(a*t-n*r)*f,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,i,r,a,o){var s=Math.cos(r),l=Math.sin(r);return this.set(n*s,n*l,-n*(s*a+l*o)+a+e,-i*l,i*s,-i*(-l*a+s*o)+o+t,0,0,1),this}},{key:"scale",value:function(e,t){return this.premultiply(eW.makeScale(e,t)),this}},{key:"rotate",value:function(e){return this.premultiply(eW.makeRotation(-e)),this}},{key:"translate",value:function(e,t){return this.premultiply(eW.makeTranslation(e,t)),this}},{key:"makeTranslation",value:function(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}},{key:"makeRotation",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}},{key:"makeScale",value:function(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}},{key:"clone",value:function(){return new this.constructor().fromArray(this.elements)}}]),t}(),eW=new eH;function ej(e){for(var t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var eX={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function eq(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}var eY={};function eK(e){e in eY||(eY[e]=!0)}var eZ=new eH().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),eJ=new eH().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715),eQ=(l=[.64,.33,.3,.6,.15,.06],u=[.2126,.7152,.0722],c=[.3127,.329],(s={enabled:!0,workingColorSpace:eT,spaces:{},convert:function(e,t,n){return!1!==this.enabled&&t!==n&&t&&n&&(this.spaces[t].transfer===ek&&(e.r=e$(e.r),e.g=e$(e.g),e.b=e$(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===ek&&(e.r=e0(e.r),e.g=e0(e.g),e.b=e0(e.b))),e},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return""===e?eC:this.spaces[e].transfer},getLuminanceCoefficients:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.workingColorSpace;return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.workingColorSpace;return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}}).define((i(o={},eT,{primaries:l,whitePoint:c,transfer:eC,toXYZ:eZ,fromXYZ:eJ,luminanceCoefficients:u,workingColorSpaceConfig:{unpackColorSpace:eE},outputColorSpaceConfig:{drawingBufferColorSpace:eE}}),i(o,eE,{primaries:l,whitePoint:c,transfer:ek,toXYZ:eZ,fromXYZ:eJ,luminanceCoefficients:u,outputColorSpaceConfig:{drawingBufferColorSpace:eE}}),o)),s);function e$(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function e0(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var e1=function(){function t(){e(this,t)}return n(t,null,[{key:"getDataURL",value:function(e){if(/^data:/i.test(e.src)||"undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===p&&(p=eq("canvas")),p.width=e.width,p.height=e.height;var t,n=p.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=p}return t.toDataURL("image/png")}},{key:"sRGBToLinear",value:function(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var t=eq("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);for(var i=n.getImageData(0,0,e.width,e.height),r=i.data,a=0;a<r.length;a++)r[a]=255*e$(r[a]/255);return n.putImageData(i,0,0),t}if(!e.data)return e;for(var o=e.data.slice(0),s=0;s<o.length;s++)o instanceof Uint8Array||o instanceof Uint8ClampedArray?o[s]=Math.floor(255*e$(o[s]/255)):o[s]=e$(o[s]);return{data:o,width:e.width,height:e.height}}}]),t}(),e2=0,e3=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e(this,t),this.isSource=!0,Object.defineProperty(this,"id",{value:e2++}),this.uuid=eI(),this.data=n,this.dataReady=!0,this.version=0}return n(t,[{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"toJSON",value:function(e){var t,n=void 0===e||"string"==typeof e;if(!n&&void 0!==e.images[this.uuid])return e.images[this.uuid];var i={uuid:this.uuid,url:""},r=this.data;if(null!==r){if(Array.isArray(r)){t=[];for(var a=0,o=r.length;a<o;a++)r[a].isDataTexture?t.push(e4(r[a].image)):t.push(e4(r[a]))}else t=e4(r);i.url=t}return n||(e.images[this.uuid]=i),i}}]),t}();function e4(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?e1.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:{}}var e5=0,e6=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.DEFAULT_IMAGE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.DEFAULT_MAPPING,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1001,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1001,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1006,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1008,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1023,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1009,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:i.DEFAULT_ANISOTROPY,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:"";return e(this,i),(t=ev(this,i)).isTexture=!0,Object.defineProperty(t,"id",{value:e5++}),t.uuid=eI(),t.name="",t.source=new e3(n),t.mipmaps=[],t.mapping=r,t.channel=0,t.wrapS=a,t.wrapT=o,t.magFilter=s,t.minFilter=l,t.anisotropy=h,t.format=u,t.internalFormat=null,t.type=c,t.offset=new eG(0,0),t.repeat=new eG(1,1),t.center=new eG(0,0),t.rotation=0,t.matrixAutoUpdate=!0,t.matrix=new eH,t.generateMipmaps=!0,t.premultiplyAlpha=!1,t.flipY=!0,t.unpackAlignment=4,t.colorSpace=d,t.userData={},t.version=0,t.onUpdate=null,t.renderTarget=null,t.isRenderTargetTexture=!1,t.pmremVersion=0,t}return e_(i,t),n(i,[{key:"image",get:function(){return this.source.data},set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.source.data=e}},{key:"updateMatrix",value:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"copy",value:function(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}},{key:"toJSON",value:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}},{key:"needsUpdate",set:function(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}},{key:"needsPMREMUpdate",set:function(e){!0===e&&this.pmremVersion++}}]),i}(eP);e6.DEFAULT_IMAGE=null,e6.DEFAULT_MAPPING=300,e6.DEFAULT_ANISOTROPY=1;var e8=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e(this,t),t.prototype.isVector4=!0,this.x=n,this.y=i,this.z=r,this.w=a}return n(t,[{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}},{key:"set",value:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,i=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*r,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,n,i,r,a=e.elements,o=a[0],s=a[4],l=a[8],u=a[1],c=a[5],h=a[9],d=a[2],p=a[6],f=a[10];if(.01>Math.abs(s-u)&&.01>Math.abs(l-d)&&.01>Math.abs(h-p)){if(.1>Math.abs(s+u)&&.1>Math.abs(l+d)&&.1>Math.abs(h+p)&&.1>Math.abs(o+c+f-3))return this.set(1,0,0,0),this;t=Math.PI;var v=(o+1)/2,m=(c+1)/2,g=(f+1)/2,_=(s+u)/4,y=(l+d)/4,x=(h+p)/4;return v>m&&v>g?v<.01?(n=0,i=.707106781,r=.707106781):(i=_/(n=Math.sqrt(v)),r=y/n):m>g?m<.01?(n=.707106781,i=0,r=.707106781):(n=_/(i=Math.sqrt(m)),r=x/i):g<.01?(n=.707106781,i=.707106781,r=0):(n=y/(r=Math.sqrt(g)),i=x/r),this.set(n,i,r,t),this}var b=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(u-s)*(u-s));return .001>Math.abs(b)&&(b=1),this.x=(p-h)/b,this.y=(l-d)/b,this.z=(u-s)/b,this.w=Math.acos((o+c+f-1)/2),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=eN(this.x,e.x,t.x),this.y=eN(this.y,e.y,t.y),this.z=eN(this.z,e.z,t.z),this.w=eN(this.w,e.w,t.w),this}},{key:"clampScalar",value:function(e,t){return this.x=eN(this.x,e,t),this.y=eN(this.y,e,t),this.z=eN(this.z,e,t),this.w=eN(this.w,e,t),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(eN(n,e,t))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},{key:Symbol.iterator,value:function(){return ec(this,function(e){switch(e.label){case 0:return[4,this.x];case 1:return e.sent(),[4,this.y];case 2:return e.sent(),[4,this.z];case 3:return e.sent(),[4,this.w];case 4:return e.sent(),[2]}})}}]),t}(),e9=function(t){function n(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e(this,n),(t=ev(this,n,[i,r,a])).isWebGLRenderTarget=!0,t}return e_(n,t),n}(function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e(this,i),(t=ev(this,i)).isRenderTarget=!0,t.width=n,t.height=r,t.depth=1,t.scissor=new e8(0,0,n,r),t.scissorTest=!1,t.viewport=new e8(0,0,n,r);var o=new e6({width:n,height:r,depth:1},(a=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:1006,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},a)).mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.colorSpace);o.flipY=!1,o.generateMipmaps=a.generateMipmaps,o.internalFormat=a.internalFormat,t.textures=[];for(var s=a.count,l=0;l<s;l++)t.textures[l]=o.clone(),t.textures[l].isRenderTargetTexture=!0,t.textures[l].renderTarget=t;return t.depthBuffer=a.depthBuffer,t.stencilBuffer=a.stencilBuffer,t.resolveDepthBuffer=a.resolveDepthBuffer,t.resolveStencilBuffer=a.resolveStencilBuffer,t._depthTexture=null,t.depthTexture=a.depthTexture,t.samples=a.samples,t}return e_(i,t),n(i,[{key:"texture",get:function(){return this.textures[0]},set:function(e){this.textures[0]=e}},{key:"depthTexture",get:function(){return this._depthTexture},set:function(e){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==e&&(e.renderTarget=this),this._depthTexture=e}},{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(var i=0,r=this.textures.length;i<r;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"copy",value:function(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(var t=0,n=e.textures.length;t<n;t++)this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;var i=Object.assign({},e.texture.image);return this.texture.source=new e3(i),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),i}(eP)),e7=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return e(this,i),(t=ev(this,i,[null])).isDataArrayTexture=!0,t.image={data:n,width:r,height:a,depth:o},t.magFilter=1003,t.minFilter=1003,t.wrapR=1001,t.generateMipmaps=!1,t.flipY=!1,t.unpackAlignment=1,t.layerUpdates=new Set,t}return e_(i,t),n(i,[{key:"addLayerUpdate",value:function(e){this.layerUpdates.add(e)}},{key:"clearLayerUpdates",value:function(){this.layerUpdates.clear()}}]),i}(e6),te=function(t){function n(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return e(this,n),(t=ev(this,n,[null])).isData3DTexture=!0,t.image={data:i,width:r,height:a,depth:o},t.magFilter=1003,t.minFilter=1003,t.wrapR=1001,t.generateMipmaps=!1,t.flipY=!1,t.unpackAlignment=1,t}return e_(n,t),n}(e6),tt=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e(this,t),this.isQuaternion=!0,this._x=n,this._y=i,this._z=r,this._w=a}return n(t,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=e._x,i=e._y,r=e._z,a=e._order,o=Math.cos,s=Math.sin,l=o(n/2),u=o(i/2),c=o(r/2),h=s(n/2),d=s(i/2),p=s(r/2);switch(a){case"XYZ":this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p;break;case"YXZ":this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p;break;case"ZXY":this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p;break;case"ZYX":this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p;break;case"YZX":this._x=h*u*c+l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c-h*d*p;break;case"XZY":this._x=h*u*c-l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c+h*d*p}return!0===t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],i=t[4],r=t[8],a=t[1],o=t[5],s=t[9],l=t[2],u=t[6],c=t[10],h=n+o+c;if(h>0){var d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(u-s)*d,this._y=(r-l)*d,this._z=(a-i)*d}else if(n>o&&n>c){var p=2*Math.sqrt(1+n-o-c);this._w=(u-s)/p,this._x=.25*p,this._y=(i+a)/p,this._z=(r+l)/p}else if(o>c){var f=2*Math.sqrt(1+o-n-c);this._w=(r-l)/f,this._x=(i+a)/f,this._y=.25*f,this._z=(s+u)/f}else{var v=2*Math.sqrt(1+c-n-o);this._w=(a-i)/v,this._x=(r+l)/v,this._y=(s+u)/v,this._z=.25*v}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=n,this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(eN(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);if(0===n)return this;var i=Math.min(1,t/n);return this.slerp(e,i),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e){return this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,i=e._y,r=e._z,a=e._w,o=t._x,s=t._y,l=t._z,u=t._w;return this._x=n*u+a*o+i*l-r*s,this._y=i*u+a*s+r*o-n*l,this._z=r*u+a*l+n*s-i*o,this._w=a*u-n*o-i*s-r*l,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,a=this._w,o=a*e._w+n*e._x+i*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-t;return this._w=l*a+t*this._w,this._x=l*n+t*this._x,this._y=l*i+t*this._y,this._z=l*r+t*this._z,this.normalize(),this}var u=Math.sqrt(s),c=Math.atan2(u,o),h=Math.sin((1-t)*c)/u,d=Math.sin(t*c)/u;return this._w=a*h+this._w*d,this._x=n*h+this._x*d,this._y=i*h+this._y*d,this._z=r*h+this._z*d,this._onChangeCallback(),this}},{key:"slerpQuaternions",value:function(e,t,n){return this.copy(e).slerp(t,n)}},{key:"random",value:function(){var e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}},{key:"toJSON",value:function(){return this.toArray()}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:Symbol.iterator,value:function(){return ec(this,function(e){switch(e.label){case 0:return[4,this._x];case 1:return e.sent(),[4,this._y];case 2:return e.sent(),[4,this._z];case 3:return e.sent(),[4,this._w];case 4:return e.sent(),[2]}})}}],[{key:"slerpFlat",value:function(e,t,n,i,r,a,o){var s=n[i+0],l=n[i+1],u=n[i+2],c=n[i+3],h=r[a+0],d=r[a+1],p=r[a+2],f=r[a+3];if(0===o){e[t+0]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c;return}if(1===o){e[t+0]=h,e[t+1]=d,e[t+2]=p,e[t+3]=f;return}if(c!==f||s!==h||l!==d||u!==p){var v=1-o,m=s*h+l*d+u*p+c*f,g=m>=0?1:-1,_=1-m*m;if(_>Number.EPSILON){var y=Math.sqrt(_),x=Math.atan2(y,m*g);v=Math.sin(v*x)/y,o=Math.sin(o*x)/y}var b=o*g;if(s=s*v+h*b,l=l*v+d*b,u=u*v+p*b,c=c*v+f*b,v===1-o){var w=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=w,l*=w,u*=w,c*=w}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"multiplyQuaternionsFlat",value:function(e,t,n,i,r,a){var o=n[i],s=n[i+1],l=n[i+2],u=n[i+3],c=r[a],h=r[a+1],d=r[a+2],p=r[a+3];return e[t]=o*p+u*c+s*d-l*h,e[t+1]=s*p+u*h+l*c-o*d,e[t+2]=l*p+u*d+o*h-s*c,e[t+3]=u*p-o*c-s*h-l*d,e}}]),t}(),tn=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e(this,t),t.prototype.isVector3=!0,this.x=n,this.y=i,this.z=r}return n(t,[{key:"set",value:function(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return this.applyQuaternion(tr.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(tr.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z,s=e.w,l=2*(a*i-o*n),u=2*(o*t-r*i),c=2*(r*n-a*t);return this.x=t+s*l+a*c-o*u,this.y=n+s*u+o*l-r*c,this.z=i+s*c+r*u-a*l,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=eN(this.x,e.x,t.x),this.y=eN(this.y,e.y,t.y),this.z=eN(this.z,e.z,t.z),this}},{key:"clampScalar",value:function(e,t){return this.x=eN(this.x,e,t),this.y=eN(this.y,e,t),this.z=eN(this.z,e,t),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(eN(n,e,t))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}},{key:"cross",value:function(e){return this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var n=e.x,i=e.y,r=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-r*o,this.y=r*a-n*s,this.z=n*o-i*a,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}},{key:"projectOnPlane",value:function(e){return ti.copy(this).projectOnVector(e),this.sub(ti)}},{key:"reflect",value:function(e){return this.sub(ti.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===t?Math.PI/2:Math.acos(eN(this.dot(e)/t,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"setFromEuler",value:function(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}},{key:"setFromColor",value:function(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}},{key:"randomDirection",value:function(){var e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}},{key:Symbol.iterator,value:function(){return ec(this,function(e){switch(e.label){case 0:return[4,this.x];case 1:return e.sent(),[4,this.y];case 2:return e.sent(),[4,this.z];case 3:return e.sent(),[2]}})}}]),t}(),ti=new tn,tr=new tt,ta=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tn(1/0,1/0,1/0),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tn(-1/0,-1/0,-1/0);e(this,t),this.isBox3=!0,this.min=n,this.max=i}return n(t,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t+=3)this.expandByPoint(ts.fromArray(e,t));return this}},{key:"setFromBufferAttribute",value:function(e){this.makeEmpty();for(var t=0,n=e.count;t<n;t++)this.expandByPoint(ts.fromBufferAttribute(e,t));return this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=ts.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);var n=e.geometry;if(void 0!==n){var i=n.getAttribute("position");if(!0===t&&void 0!==i&&!0!==e.isInstancedMesh)for(var r=0,a=i.count;r<a;r++)!0===e.isMesh?e.getVertexPosition(r,ts):ts.fromBufferAttribute(i,r),ts.applyMatrix4(e.matrixWorld),this.expandByPoint(ts);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),tl.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),tl.copy(n.boundingBox)),tl.applyMatrix4(e.matrixWorld),this.union(tl)}for(var o=e.children,s=0,l=o.length;s<l;s++)this.expandByObject(o[s],t);return this}},{key:"containsPoint",value:function(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,ts),ts.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"intersectsTriangle",value:function(e){if(this.isEmpty())return!1;this.getCenter(tv),tm.subVectors(this.max,tv),tu.subVectors(e.a,tv),tc.subVectors(e.b,tv),th.subVectors(e.c,tv),td.subVectors(tc,tu),tp.subVectors(th,tc),tf.subVectors(tu,th);var t=[0,-td.z,td.y,0,-tp.z,tp.y,0,-tf.z,tf.y,td.z,0,-td.x,tp.z,0,-tp.x,tf.z,0,-tf.x,-td.y,td.x,0,-tp.y,tp.x,0,-tf.y,tf.x,0];return!!(ty(t,tu,tc,th,tm)&&ty(t=[1,0,0,0,1,0,0,0,1],tu,tc,th,tm))&&(tg.crossVectors(td,tp),ty(t=[tg.x,tg.y,tg.z],tu,tc,th,tm))}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return this.clampPoint(e,ts).distanceTo(e)}},{key:"getBoundingSphere",value:function(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(ts).length()),e}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){return this.isEmpty()||(to[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),to[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),to[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),to[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),to[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),to[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),to[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),to[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(to)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),t}(),to=[new tn,new tn,new tn,new tn,new tn,new tn,new tn,new tn],ts=new tn,tl=new ta,tu=new tn,tc=new tn,th=new tn,td=new tn,tp=new tn,tf=new tn,tv=new tn,tm=new tn,tg=new tn,t_=new tn;function ty(e,t,n,i,r){for(var a=0,o=e.length-3;a<=o;a+=3){t_.fromArray(e,a);var s=r.x*Math.abs(t_.x)+r.y*Math.abs(t_.y)+r.z*Math.abs(t_.z),l=t.dot(t_),u=n.dot(t_),c=i.dot(t_);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>s)return!1}return!0}var tx=new ta,tb=new tn,tw=new tn,tS=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tn,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;e(this,t),this.isSphere=!0,this.center=n,this.radius=i}return n(t,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"setFromPoints",value:function(e,t){var n=this.center;void 0!==t?n.copy(t):tx.setFromPoints(e).getCenter(n);for(var i=0,r=0,a=e.length;r<a;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(e,t){var n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"getBoundingBox",value:function(e){return this.isEmpty()?e.makeEmpty():(e.set(this.center,this.center),e.expandByScalar(this.radius)),e}},{key:"applyMatrix4",value:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"expandByPoint",value:function(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;tb.subVectors(e,this.center);var t=tb.lengthSq();if(t>this.radius*this.radius){var n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.addScaledVector(tb,i/n),this.radius+=i}return this}},{key:"union",value:function(e){return e.isEmpty()||(this.isEmpty()?this.copy(e):!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(tw.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(tb.copy(e.center).add(tw)),this.expandByPoint(tb.copy(e.center).sub(tw)))),this}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),t}(),tM=new tn,tE=new tn,tT=new tn,tC=new tn,tk=new tn,tA=new tn,tP=new tn,tR=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tn,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tn(0,0,-1);e(this,t),this.origin=n,this.direction=i}return n(t,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"at",value:function(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,tM)),this}},{key:"closestPointToPoint",value:function(e,t){t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}},{key:"distanceToPoint",value:function(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function(e){var t=tM.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(tM.copy(this.origin).addScaledVector(this.direction,t),tM.distanceToSquared(e))}},{key:"distanceSqToSegment",value:function(e,t,n,i){tE.copy(e).add(t).multiplyScalar(.5),tT.copy(t).sub(e).normalize(),tC.copy(this.origin).sub(tE);var r,a,o,s,l=.5*e.distanceTo(t),u=-this.direction.dot(tT),c=tC.dot(this.direction),h=-tC.dot(tT),d=tC.lengthSq(),p=Math.abs(1-u*u);if(p>0){if(r=u*h-c,a=u*c-h,s=l*p,r>=0){if(a>=-s){if(a<=s){var f=1/p;r*=f,a*=f,o=r*(r+u*a+2*c)+a*(u*r+a+2*h)+d}else o=-(r=Math.max(0,-(u*(a=l)+c)))*r+a*(a+2*h)+d}else o=-(r=Math.max(0,-(u*(a=-l)+c)))*r+a*(a+2*h)+d}else a<=-s?(a=(r=Math.max(0,-(-u*l+c)))>0?-l:Math.min(Math.max(-l,-h),l),o=-r*r+a*(a+2*h)+d):a<=s?(r=0,o=(a=Math.min(Math.max(-l,-h),l))*(a+2*h)+d):(a=(r=Math.max(0,-(u*l+c)))>0?l:Math.min(Math.max(-l,-h),l),o=-r*r+a*(a+2*h)+d)}else a=u>0?-l:l,o=-(r=Math.max(0,-(u*a+c)))*r+a*(a+2*h)+d;return n&&n.copy(this.origin).addScaledVector(this.direction,r),i&&i.copy(tE).addScaledVector(tT,a),o}},{key:"intersectSphere",value:function(e,t){tM.subVectors(e.center,this.origin);var n=tM.dot(this.direction),i=tM.dot(tM)-n*n,r=e.radius*e.radius;if(i>r)return null;var a=Math.sqrt(r-i),o=n-a,s=n+a;return s<0?null:o<0?this.at(s,t):this.at(o,t)}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}},{key:"intersectPlane",value:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return!!(0===t||e.normal.dot(this.direction)*t<0)}},{key:"intersectBox",value:function(e,t){var n,i,r,a,o,s,l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return(l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),u>=0?(r=(e.min.y-h.y)*u,a=(e.max.y-h.y)*u):(r=(e.max.y-h.y)*u,a=(e.min.y-h.y)*u),n>a||r>i)?null:((r>n||isNaN(n))&&(n=r),(a<i||isNaN(i))&&(i=a),c>=0?(o=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(o=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),n>s||o>i)?null:((o>n||n!=n)&&(n=o),(s<i||i!=i)&&(i=s),i<0)?null:this.at(n>=0?n:i,t)}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,tM)}},{key:"intersectTriangle",value:function(e,t,n,i,r){tk.subVectors(t,e),tA.subVectors(n,e),tP.crossVectors(tk,tA);var a,o=this.direction.dot(tP);if(o>0){if(i)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}tC.subVectors(this.origin,e);var s=a*this.direction.dot(tA.crossVectors(tC,tA));if(s<0)return null;var l=a*this.direction.dot(tk.cross(tC));if(l<0||s+l>o)return null;var u=-a*tC.dot(tP);return u<0?null:this.at(u/o,r)}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),t}(),tU=function(){function t(n,i,r,a,o,s,l,u,c,h,d,p,f,v,m,g){e(this,t),t.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==n&&this.set(n,i,r,a,o,s,l,u,c,h,d,p,f,v,m,g)}return n(t,[{key:"set",value:function(e,t,n,i,r,a,o,s,l,u,c,h,d,p,f,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=i,m[1]=r,m[5]=a,m[9]=o,m[13]=s,m[2]=l,m[6]=u,m[10]=c,m[14]=h,m[3]=d,m[7]=p,m[11]=f,m[15]=v,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return new t().fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setFromMatrix3",value:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,i=1/tL.setFromMatrixColumn(e,0).length(),r=1/tL.setFromMatrixColumn(e,1).length(),a=1/tL.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(i),l=Math.sin(i),u=Math.cos(r),c=Math.sin(r);if("XYZ"===e.order){var h=a*u,d=a*c,p=o*u,f=o*c;t[0]=s*u,t[4]=-s*c,t[8]=l,t[1]=d+p*l,t[5]=h-f*l,t[9]=-o*s,t[2]=f-h*l,t[6]=p+d*l,t[10]=a*s}else if("YXZ"===e.order){var v=s*u,m=s*c,g=l*u,_=l*c;t[0]=v+_*o,t[4]=g*o-m,t[8]=a*l,t[1]=a*c,t[5]=a*u,t[9]=-o,t[2]=m*o-g,t[6]=_+v*o,t[10]=a*s}else if("ZXY"===e.order){var y=s*u,x=s*c,b=l*u,w=l*c;t[0]=y-w*o,t[4]=-a*c,t[8]=b+x*o,t[1]=x+b*o,t[5]=a*u,t[9]=w-y*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var S=a*u,M=a*c,E=o*u,T=o*c;t[0]=s*u,t[4]=E*l-M,t[8]=S*l+T,t[1]=s*c,t[5]=T*l+S,t[9]=M*l-E,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var C=a*s,k=a*l,A=o*s,P=o*l;t[0]=s*u,t[4]=P-C*c,t[8]=A*c+k,t[1]=c,t[5]=a*u,t[9]=-o*u,t[2]=-l*u,t[6]=k*c+A,t[10]=C-P*c}else if("XZY"===e.order){var R=a*s,U=a*l,L=o*s,D=o*l;t[0]=s*u,t[4]=-c,t[8]=l*u,t[1]=R*c+D,t[5]=a*u,t[9]=U*c-L,t[2]=L*c-U,t[6]=o*u,t[10]=D*c+R}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(tI,e,tN)}},{key:"lookAt",value:function(e,t,n){var i=this.elements;return tB.subVectors(e,t),0===tB.lengthSq()&&(tB.z=1),tB.normalize(),tO.crossVectors(n,tB),0===tO.lengthSq()&&(1===Math.abs(n.z)?tB.x+=1e-4:tB.z+=1e-4,tB.normalize(),tO.crossVectors(n,tB)),tO.normalize(),tF.crossVectors(tB,tO),i[0]=tO.x,i[4]=tF.x,i[8]=tB.x,i[1]=tO.y,i[5]=tF.y,i[9]=tB.y,i[2]=tO.z,i[6]=tF.z,i[10]=tB.z,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],u=n[1],c=n[5],h=n[9],d=n[13],p=n[2],f=n[6],v=n[10],m=n[14],g=n[3],_=n[7],y=n[11],x=n[15],b=i[0],w=i[4],S=i[8],M=i[12],E=i[1],T=i[5],C=i[9],k=i[13],A=i[2],P=i[6],R=i[10],U=i[14],L=i[3],D=i[7],I=i[11],N=i[15];return r[0]=a*b+o*E+s*A+l*L,r[4]=a*w+o*T+s*P+l*D,r[8]=a*S+o*C+s*R+l*I,r[12]=a*M+o*k+s*U+l*N,r[1]=u*b+c*E+h*A+d*L,r[5]=u*w+c*T+h*P+d*D,r[9]=u*S+c*C+h*R+d*I,r[13]=u*M+c*k+h*U+d*N,r[2]=p*b+f*E+v*A+m*L,r[6]=p*w+f*T+v*P+m*D,r[10]=p*S+f*C+v*R+m*I,r[14]=p*M+f*k+v*U+m*N,r[3]=g*b+_*E+y*A+x*L,r[7]=g*w+_*T+y*P+x*D,r[11]=g*S+_*C+y*R+x*I,r[15]=g*M+_*k+y*U+x*N,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],o=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],d=e[14];return e[3]*(+r*s*c-i*l*c-r*o*h+n*l*h+i*o*d-n*s*d)+e[7]*(+t*s*d-t*l*h+r*a*h-i*a*d+i*l*u-r*s*u)+e[11]*(+t*l*c-t*o*d-r*a*c+n*a*d+r*o*u-n*l*u)+e[15]*(-i*o*u-t*s*c+t*o*h+i*a*c-n*a*h+n*s*u)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,n){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],p=e[12],f=e[13],v=e[14],m=e[15],g=c*v*l-f*h*l+f*s*d-o*v*d-c*s*m+o*h*m,_=p*h*l-u*v*l-p*s*d+a*v*d+u*s*m-a*h*m,y=u*f*l-p*c*l+p*o*d-a*f*d-u*o*m+a*c*m,x=p*c*s-u*f*s-p*o*h+a*f*h+u*o*v-a*c*v,b=t*g+n*_+i*y+r*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var w=1/b;return e[0]=g*w,e[1]=(f*h*r-c*v*r-f*i*d+n*v*d+c*i*m-n*h*m)*w,e[2]=(o*v*r-f*s*r+f*i*l-n*v*l-o*i*m+n*s*m)*w,e[3]=(c*s*r-o*h*r-c*i*l+n*h*l+o*i*d-n*s*d)*w,e[4]=_*w,e[5]=(u*v*r-p*h*r+p*i*d-t*v*d-u*i*m+t*h*m)*w,e[6]=(p*s*r-a*v*r-p*i*l+t*v*l+a*i*m-t*s*m)*w,e[7]=(a*h*r-u*s*r+u*i*l-t*h*l-a*i*d+t*s*d)*w,e[8]=y*w,e[9]=(p*c*r-u*f*r-p*n*d+t*f*d+u*n*m-t*c*m)*w,e[10]=(a*f*r-p*o*r+p*n*l-t*f*l-a*n*m+t*o*m)*w,e[11]=(u*o*r-a*c*r-u*n*l+t*c*l+a*n*d-t*o*d)*w,e[12]=x*w,e[13]=(u*f*i-p*c*i+p*n*h-t*f*h-u*n*v+t*c*v)*w,e[14]=(p*o*i-a*f*i-p*n*s+t*f*s+a*n*v-t*o*v)*w,e[15]=(a*c*i-u*o*i+u*n*s-t*c*s-a*n*h+t*o*h)*w,this}},{key:"scale",value:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}},{key:"makeTranslation",value:function(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,a=e.x,o=e.y,s=e.z,l=r*a,u=r*o;return this.set(l*a+n,l*o-i*s,l*s+i*o,0,l*o+i*s,u*o+n,u*s-i*a,0,l*s-i*o,u*s+i*a,r*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n,i,r,a){return this.set(1,n,r,0,e,1,a,0,t,i,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var i=this.elements,r=t._x,a=t._y,o=t._z,s=t._w,l=r+r,u=a+a,c=o+o,h=r*l,d=r*u,p=r*c,f=a*u,v=a*c,m=o*c,g=s*l,_=s*u,y=s*c,x=n.x,b=n.y,w=n.z;return i[0]=(1-(f+m))*x,i[1]=(d+y)*x,i[2]=(p-_)*x,i[3]=0,i[4]=(d-y)*b,i[5]=(1-(h+m))*b,i[6]=(v+g)*b,i[7]=0,i[8]=(p+_)*w,i[9]=(v-g)*w,i[10]=(1-(h+f))*w,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}},{key:"decompose",value:function(e,t,n){var i=this.elements,r=tL.set(i[0],i[1],i[2]).length(),a=tL.set(i[4],i[5],i[6]).length(),o=tL.set(i[8],i[9],i[10]).length();0>this.determinant()&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],tD.copy(this);var s=1/r,l=1/a,u=1/o;return tD.elements[0]*=s,tD.elements[1]*=s,tD.elements[2]*=s,tD.elements[4]*=l,tD.elements[5]*=l,tD.elements[6]*=l,tD.elements[8]*=u,tD.elements[9]*=u,tD.elements[10]*=u,t.setFromRotationMatrix(tD),n.x=r,n.y=a,n.z=o,this}},{key:"makePerspective",value:function(e,t,n,i,r,a){var o,s,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2e3,u=this.elements;if(2e3===l)o=-(a+r)/(a-r),s=-2*a*r/(a-r);else if(2001===l)o=-a/(a-r),s=-a*r/(a-r);else throw Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);return u[0]=2*r/(t-e),u[4]=0,u[8]=(t+e)/(t-e),u[12]=0,u[1]=0,u[5]=2*r/(n-i),u[9]=(n+i)/(n-i),u[13]=0,u[2]=0,u[6]=0,u[10]=o,u[14]=s,u[3]=0,u[7]=0,u[11]=-1,u[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,i,r,a){var o,s,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2e3,u=this.elements,c=1/(t-e),h=1/(n-i),d=1/(a-r);if(2e3===l)o=(a+r)*d,s=-2*d;else if(2001===l)o=r*d,s=-1*d;else throw Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return u[0]=2*c,u[4]=0,u[8]=0,u[12]=-((t+e)*c),u[1]=0,u[5]=2*h,u[9]=0,u[13]=-((n+i)*h),u[2]=0,u[6]=0,u[10]=s,u[14]=-o,u[3]=0,u[7]=0,u[11]=0,u[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}]),t}(),tL=new tn,tD=new tU,tI=new tn(0,0,0),tN=new tn(1,1,1),tO=new tn,tF=new tn,tB=new tn,tV=new tU,tz=new tt,tG=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DEFAULT_ORDER;e(this,t),this.isEuler=!0,this._x=n,this._y=i,this._z=r,this._order=a}return n(t,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],i=e.elements,r=i[0],a=i[4],o=i[8],s=i[1],l=i[5],u=i[9],c=i[2],h=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(eN(o,-1,1)),.9999999>Math.abs(o)?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-eN(u,-1,1)),.9999999>Math.abs(u)?(this._y=Math.atan2(o,d),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(eN(h,-1,1)),.9999999>Math.abs(h)?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(s,r));break;case"ZYX":this._y=Math.asin(-eN(c,-1,1)),.9999999>Math.abs(c)?(this._x=Math.atan2(h,d),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(eN(s,-1,1)),.9999999>Math.abs(s)?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-eN(a,-1,1)),.9999999>Math.abs(a)?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-u,d),this._y=0)}return this._order=t,!0===n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,n){return tV.makeRotationFromQuaternion(e),this.setFromRotationMatrix(tV,t,n)}},{key:"setFromVector3",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return tz.setFromEuler(this),this.setFromQuaternion(tz,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:Symbol.iterator,value:function(){return ec(this,function(e){switch(e.label){case 0:return[4,this._x];case 1:return e.sent(),[4,this._y];case 2:return e.sent(),[4,this._z];case 3:return e.sent(),[4,this._order];case 4:return e.sent(),[2]}})}}]),t}();tG.DEFAULT_ORDER="XYZ";var tH=function(){function t(){e(this,t),this.mask=1}return n(t,[{key:"set",value:function(e){this.mask=(1<<e|0)>>>0}},{key:"enable",value:function(e){this.mask|=1<<e|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e|0}},{key:"disable",value:function(e){this.mask&=~(1<<e|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return(this.mask&e.mask)!=0}},{key:"isEnabled",value:function(e){return(this.mask&(1<<e|0))!=0}}]),t}(),tW=0,tj=new tn,tX=new tt,tq=new tU,tY=new tn,tK=new tn,tZ=new tn,tJ=new tt,tQ=new tn(1,0,0),t$=new tn(0,1,0),t0=new tn(0,0,1),t1={type:"added"},t2={type:"removed"},t3={type:"childadded",child:null},t4={type:"childremoved",child:null},t5=function(t){function i(){e(this,i),(t=ev(this,i)).isObject3D=!0,Object.defineProperty(t,"id",{value:tW++}),t.uuid=eI(),t.name="",t.type="Object3D",t.parent=null,t.children=[],t.up=i.DEFAULT_UP.clone();var t,n=new tn,r=new tG,a=new tt,o=new tn(1,1,1);return r._onChange(function(){a.setFromEuler(r,!1)}),a._onChange(function(){r.setFromQuaternion(a,void 0,!1)}),Object.defineProperties(t,{position:{configurable:!0,enumerable:!0,value:n},rotation:{configurable:!0,enumerable:!0,value:r},quaternion:{configurable:!0,enumerable:!0,value:a},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new tU},normalMatrix:{value:new eH}}),t.matrix=new tU,t.matrixWorld=new tU,t.matrixAutoUpdate=i.DEFAULT_MATRIX_AUTO_UPDATE,t.matrixWorldAutoUpdate=i.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,t.matrixWorldNeedsUpdate=!1,t.layers=new tH,t.visible=!0,t.castShadow=!1,t.receiveShadow=!1,t.frustumCulled=!0,t.renderOrder=0,t.animations=[],t.userData={},t}return e_(i,t),n(i,[{key:"onBeforeShadow",value:function(){}},{key:"onAfterShadow",value:function(){}},{key:"onBeforeRender",value:function(){}},{key:"onAfterRender",value:function(){}},{key:"applyMatrix4",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function(e){return this.quaternion.premultiply(e),this}},{key:"setRotationFromAxisAngle",value:function(e,t){this.quaternion.setFromAxisAngle(e,t)}},{key:"setRotationFromEuler",value:function(e){this.quaternion.setFromEuler(e,!0)}},{key:"setRotationFromMatrix",value:function(e){this.quaternion.setFromRotationMatrix(e)}},{key:"setRotationFromQuaternion",value:function(e){this.quaternion.copy(e)}},{key:"rotateOnAxis",value:function(e,t){return tX.setFromAxisAngle(e,t),this.quaternion.multiply(tX),this}},{key:"rotateOnWorldAxis",value:function(e,t){return tX.setFromAxisAngle(e,t),this.quaternion.premultiply(tX),this}},{key:"rotateX",value:function(e){return this.rotateOnAxis(tQ,e)}},{key:"rotateY",value:function(e){return this.rotateOnAxis(t$,e)}},{key:"rotateZ",value:function(e){return this.rotateOnAxis(t0,e)}},{key:"translateOnAxis",value:function(e,t){return tj.copy(e).applyQuaternion(this.quaternion),this.position.add(tj.multiplyScalar(t)),this}},{key:"translateX",value:function(e){return this.translateOnAxis(tQ,e)}},{key:"translateY",value:function(e){return this.translateOnAxis(t$,e)}},{key:"translateZ",value:function(e){return this.translateOnAxis(t0,e)}},{key:"localToWorld",value:function(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(tq.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function(e,t,n){e.isVector3?tY.copy(e):tY.set(e,t,n);var i=this.parent;this.updateWorldMatrix(!0,!1),tK.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?tq.lookAt(tK,tY,this.up):tq.lookAt(tY,tK,this.up),this.quaternion.setFromRotationMatrix(tq),i&&(tq.extractRotation(i.matrixWorld),tX.setFromRotationMatrix(tq),this.quaternion.premultiply(tX.invert()))}},{key:"add",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this||e&&e.isObject3D&&(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(t1),t3.child=e,this.dispatchEvent(t3),t3.child=null),this}},{key:"remove",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return -1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(t2),t4.child=e,this.dispatchEvent(t4),t4.child=null),this}},{key:"removeFromParent",value:function(){var e=this.parent;return null!==e&&e.remove(this),this}},{key:"clear",value:function(){return this.remove.apply(this,ew(this.children))}},{key:"attach",value:function(e){return this.updateWorldMatrix(!0,!1),tq.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),tq.multiply(e.parent.matrixWorld)),e.applyMatrix4(tq),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(t1),t3.child=e,this.dispatchEvent(t3),t3.child=null,this}},{key:"getObjectById",value:function(e){return this.getObjectByProperty("id",e)}},{key:"getObjectByName",value:function(e){return this.getObjectByProperty("name",e)}},{key:"getObjectByProperty",value:function(e,t){if(this[e]===t)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}},{key:"getObjectsByProperty",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[e]===t&&n.push(this);for(var i=this.children,r=0,a=i.length;r<a;r++)i[r].getObjectsByProperty(e,t,n);return n}},{key:"getWorldPosition",value:function(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tK,e,tZ),e}},{key:"getWorldScale",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tK,tJ,e),e}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}},{key:"raycast",value:function(){}},{key:"traverse",value:function(e){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverse(e)}},{key:"traverseVisible",value:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}}},{key:"traverseAncestors",value:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}},{key:"updateWorldMatrix",value:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t)for(var i=this.children,r=0,a=i.length;r<a;r++)i[r].updateWorldMatrix(!1,!0)}},{key:"toJSON",value:function(e){var t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});var i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(function(e){return{boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()}}),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,l=o.length;s<l;s++){var u=o[s];r(e.shapes,u)}else r(e.shapes,o)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material){if(Array.isArray(this.material)){for(var c=[],h=0,d=this.material.length;h<d;h++)c.push(r(e.materials,this.material[h]));i.material=c}else i.material=r(e.materials,this.material)}if(this.children.length>0){i.children=[];for(var p=0;p<this.children.length;p++)i.children.push(this.children[p].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(var f=0;f<this.animations.length;f++){var v=this.animations[f];i.animations.push(r(e.animations,v))}}if(t){var m=M(e.geometries),g=M(e.materials),_=M(e.textures),y=M(e.images),x=M(e.shapes),b=M(e.skeletons),w=M(e.animations),S=M(e.nodes);m.length>0&&(n.geometries=m),g.length>0&&(n.materials=g),_.length>0&&(n.textures=_),y.length>0&&(n.images=y),x.length>0&&(n.shapes=x),b.length>0&&(n.skeletons=b),w.length>0&&(n.animations=w),S.length>0&&(n.nodes=S)}return n.object=i,n;function M(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}}},{key:"clone",value:function(e){return new this.constructor().copy(this,e)}},{key:"copy",value:function(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var i=e.children[n];this.add(i.clone())}return this}}]),i}(eP);t5.DEFAULT_UP=new tn(0,1,0),t5.DEFAULT_MATRIX_AUTO_UPDATE=!0,t5.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var t6=new tn,t8=new tn,t9=new tn,t7=new tn,ne=new tn,nt=new tn,nn=new tn,ni=new tn,nr=new tn,na=new tn,no=new e8,ns=new e8,nl=new e8,nu=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tn,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tn,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new tn;e(this,t),this.a=n,this.b=i,this.c=r}return n(t,[{key:"set",value:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}},{key:"setFromAttributeAndIndices",value:function(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"copy",value:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}},{key:"getArea",value:function(){return t6.subVectors(this.c,this.b),t8.subVectors(this.a,this.b),.5*t6.cross(t8).length()}},{key:"getMidpoint",value:function(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(e){return t.getNormal(this.a,this.b,this.c,e)}},{key:"getPlane",value:function(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(e,n){return t.getBarycoord(e,this.a,this.b,this.c,n)}},{key:"getInterpolation",value:function(e,n,i,r,a){return t.getInterpolation(e,this.a,this.b,this.c,n,i,r,a)}},{key:"containsPoint",value:function(e){return t.containsPoint(e,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(e){return t.isFrontFacing(this.a,this.b,this.c,e)}},{key:"intersectsBox",value:function(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(e,t){var n,i,r=this.a,a=this.b,o=this.c;ne.subVectors(a,r),nt.subVectors(o,r),ni.subVectors(e,r);var s=ne.dot(ni),l=nt.dot(ni);if(s<=0&&l<=0)return t.copy(r);nr.subVectors(e,a);var u=ne.dot(nr),c=nt.dot(nr);if(u>=0&&c<=u)return t.copy(a);var h=s*c-u*l;if(h<=0&&s>=0&&u<=0)return n=s/(s-u),t.copy(r).addScaledVector(ne,n);na.subVectors(e,o);var d=ne.dot(na),p=nt.dot(na);if(p>=0&&d<=p)return t.copy(o);var f=d*l-s*p;if(f<=0&&l>=0&&p<=0)return i=l/(l-p),t.copy(r).addScaledVector(nt,i);var v=u*p-d*c;if(v<=0&&c-u>=0&&d-p>=0)return nn.subVectors(o,a),i=(c-u)/(c-u+(d-p)),t.copy(a).addScaledVector(nn,i);var m=1/(v+f+h);return n=f*m,i=h*m,t.copy(r).addScaledVector(ne,n).addScaledVector(nt,i)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function(e,t,n,i){i.subVectors(n,t),t6.subVectors(e,t),i.cross(t6);var r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}},{key:"getBarycoord",value:function(e,t,n,i,r){t6.subVectors(i,t),t8.subVectors(n,t),t9.subVectors(e,t);var a=t6.dot(t6),o=t6.dot(t8),s=t6.dot(t9),l=t8.dot(t8),u=t8.dot(t9),c=a*l-o*o;if(0===c)return r.set(0,0,0),null;var h=1/c,d=(l*s-o*u)*h,p=(a*u-o*s)*h;return r.set(1-d-p,p,d)}},{key:"containsPoint",value:function(e,t,n,i){return null!==this.getBarycoord(e,t,n,i,t7)&&t7.x>=0&&t7.y>=0&&t7.x+t7.y<=1}},{key:"getInterpolation",value:function(e,t,n,i,r,a,o,s){return null===this.getBarycoord(e,t,n,i,t7)?(s.x=0,s.y=0,"z"in s&&(s.z=0),"w"in s&&(s.w=0),null):(s.setScalar(0),s.addScaledVector(r,t7.x),s.addScaledVector(a,t7.y),s.addScaledVector(o,t7.z),s)}},{key:"getInterpolatedAttribute",value:function(e,t,n,i,r,a){return no.setScalar(0),ns.setScalar(0),nl.setScalar(0),no.fromBufferAttribute(e,t),ns.fromBufferAttribute(e,n),nl.fromBufferAttribute(e,i),a.setScalar(0),a.addScaledVector(no,r.x),a.addScaledVector(ns,r.y),a.addScaledVector(nl,r.z),a}},{key:"isFrontFacing",value:function(e,t,n,i){return t6.subVectors(n,t),t8.subVectors(e,t),0>t6.cross(t8).dot(i)}}]),t}(),nc={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32},nh={h:0,s:0,l:0},nd={h:0,s:0,l:0};function np(e,t,n){return(n<0&&(n+=1),n>1&&(n-=1),n<1/6)?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*6*(2/3-n):e}var nf=function(){function t(n,i,r){return e(this,t),this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(n,i,r)}return n(t,[{key:"set",value:function(e,t,n){return void 0===t&&void 0===n?e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e):this.setRGB(e,t,n),this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eE;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,eQ.toWorkingColorSpace(this,t),this}},{key:"setRGB",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:eQ.workingColorSpace;return this.r=e,this.g=t,this.b=n,eQ.toWorkingColorSpace(this,i),this}},{key:"setHSL",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:eQ.workingColorSpace;if(e=eO(e,1),t=eN(t,0,1),n=eN(n,0,1),0===t)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+t):n+t-n*t,a=2*n-r;this.r=np(a,r,e+1/3),this.g=np(a,r,e),this.b=np(a,r,e-1/3)}return eQ.toWorkingColorSpace(this,i),this}},{key:"setStyle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eE;function n(e){void 0!==e&&parseFloat(e)}if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){var i,r,a=i[1],o=i[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){var s=i[1],l=s.length;if(3===l)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(6===l)return this.setHex(parseInt(s,16),t)}else if(e&&e.length>0)return this.setColorName(e,t);return this}},{key:"setColorName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eE,n=nc[e.toLowerCase()];return void 0!==n&&this.setHex(n,t),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copySRGBToLinear",value:function(e){return this.r=e$(e.r),this.g=e$(e.g),this.b=e$(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=e0(e.r),this.g=e0(e.g),this.b=e0(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:eE;return eQ.fromWorkingColorSpace(nv.copy(this),e),65536*Math.round(eN(255*nv.r,0,255))+256*Math.round(eN(255*nv.g,0,255))+Math.round(eN(255*nv.b,0,255))}},{key:"getHexString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:eE;return("000000"+this.getHex(e).toString(16)).slice(-6)}},{key:"getHSL",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eQ.workingColorSpace;eQ.fromWorkingColorSpace(nv.copy(this),i);var r=nv.r,a=nv.g,o=nv.b,s=Math.max(r,a,o),l=Math.min(r,a,o),u=(l+s)/2;if(l===s)t=0,n=0;else{var c=s-l;switch(n=u<=.5?c/(s+l):c/(2-s-l),s){case r:t=(a-o)/c+6*(a<o);break;case a:t=(o-r)/c+2;break;case o:t=(r-a)/c+4}t/=6}return e.h=t,e.s=n,e.l=u,e}},{key:"getRGB",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eQ.workingColorSpace;return eQ.fromWorkingColorSpace(nv.copy(this),t),e.r=nv.r,e.g=nv.g,e.b=nv.b,e}},{key:"getStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:eE;eQ.fromWorkingColorSpace(nv.copy(this),e);var t=nv.r,n=nv.g,i=nv.b;return e!==eE?"color(".concat(e," ").concat(t.toFixed(3)," ").concat(n.toFixed(3)," ").concat(i.toFixed(3),")"):"rgb(".concat(Math.round(255*t),",").concat(Math.round(255*n),",").concat(Math.round(255*i),")")}},{key:"offsetHSL",value:function(e,t,n){return this.getHSL(nh),this.setHSL(nh.h+e,nh.s+t,nh.l+n)}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpColors",value:function(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}},{key:"lerpHSL",value:function(e,t){this.getHSL(nh),e.getHSL(nd);var n=eF(nh.h,nd.h,t),i=eF(nh.s,nd.s,t),r=eF(nh.l,nd.l,t);return this.setHSL(n,i,r),this}},{key:"setFromVector3",value:function(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}},{key:"applyMatrix3",value:function(e){var t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}},{key:"toJSON",value:function(){return this.getHex()}},{key:Symbol.iterator,value:function(){return ec(this,function(e){switch(e.label){case 0:return[4,this.r];case 1:return e.sent(),[4,this.g];case 2:return e.sent(),[4,this.b];case 3:return e.sent(),[2]}})}}]),t}(),nv=new nf;nf.NAMES=nc;var nm=0,ng=function(t){function i(){var t;return e(this,i),(t=ev(this,i)).isMaterial=!0,Object.defineProperty(t,"id",{value:nm++}),t.uuid=eI(),t.name="",t.type="Material",t.blending=1,t.side=0,t.vertexColors=!1,t.opacity=1,t.transparent=!1,t.alphaHash=!1,t.blendSrc=204,t.blendDst=205,t.blendEquation=100,t.blendSrcAlpha=null,t.blendDstAlpha=null,t.blendEquationAlpha=null,t.blendColor=new nf(0,0,0),t.blendAlpha=0,t.depthFunc=3,t.depthTest=!0,t.depthWrite=!0,t.stencilWriteMask=255,t.stencilFunc=519,t.stencilRef=0,t.stencilFuncMask=255,t.stencilFail=7680,t.stencilZFail=7680,t.stencilZPass=7680,t.stencilWrite=!1,t.clippingPlanes=null,t.clipIntersection=!1,t.clipShadows=!1,t.shadowSide=null,t.colorWrite=!0,t.precision=null,t.polygonOffset=!1,t.polygonOffsetFactor=0,t.polygonOffsetUnits=0,t.dithering=!1,t.alphaToCoverage=!1,t.premultipliedAlpha=!1,t.forceSinglePass=!1,t.visible=!0,t.toneMapped=!0,t.userData={},t.version=0,t._alphaTest=0,t}return e_(i,t),n(i,[{key:"alphaTest",get:function(){return this._alphaTest},set:function(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}},{key:"onBeforeRender",value:function(){}},{key:"onBeforeCompile",value:function(){}},{key:"customProgramCacheKey",value:function(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n){var i=this[t];void 0!==i&&(i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n)}}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),100!==this.blendEquation&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),7680!==this.stencilFail&&(n.stencilFail=this.stencilFail),7680!==this.stencilZFail&&(n.stencilZFail=this.stencilZFail),7680!==this.stencilZPass&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){var r=i(e.textures),a=i(e.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"copy",value:function(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var i=t.length;n=Array(i);for(var r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"onBuild",value:function(){}}]),i}(eP),n_=function(t){function i(t){var n;return e(this,i),(n=ev(this,i)).isMeshBasicMaterial=!0,n.type="MeshBasicMaterial",n.color=new nf(0xffffff),n.map=null,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=null,n.aoMapIntensity=1,n.specularMap=null,n.alphaMap=null,n.envMap=null,n.envMapRotation=new tG,n.combine=0,n.reflectivity=1,n.refractionRatio=.98,n.wireframe=!1,n.wireframeLinewidth=1,n.wireframeLinecap="round",n.wireframeLinejoin="round",n.fog=!0,n.setValues(t),n}return e_(i,t),n(i,[{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}]),i}(ng),ny=new tn,nx=new eG,nb=0,nw=function(){function t(n,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e(this,t),Array.isArray(n))throw TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:nb++}),this.name="",this.array=n,this.itemSize=i,this.count=void 0!==n?n.length/i:0,this.normalized=r,this.usage=35044,this.updateRanges=[],this.gpuType=1015,this.version=0}return n(t,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"addUpdateRange",value:function(e,t){this.updateRanges.push({start:e,count:t})}},{key:"clearUpdateRanges",value:function(){this.updateRanges.length=0}},{key:"copy",value:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}},{key:"copyAt",value:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}},{key:"copyArray",value:function(e){return this.array.set(e),this}},{key:"applyMatrix3",value:function(e){if(2===this.itemSize)for(var t=0,n=this.count;t<n;t++)nx.fromBufferAttribute(this,t),nx.applyMatrix3(e),this.setXY(t,nx.x,nx.y);else if(3===this.itemSize)for(var i=0,r=this.count;i<r;i++)ny.fromBufferAttribute(this,i),ny.applyMatrix3(e),this.setXYZ(i,ny.x,ny.y,ny.z);return this}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.count;t<n;t++)ny.fromBufferAttribute(this,t),ny.applyMatrix4(e),this.setXYZ(t,ny.x,ny.y,ny.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)ny.fromBufferAttribute(this,t),ny.applyNormalMatrix(e),this.setXYZ(t,ny.x,ny.y,ny.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)ny.fromBufferAttribute(this,t),ny.transformDirection(e),this.setXYZ(t,ny.x,ny.y,ny.z);return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"getComponent",value:function(e,t){var n=this.array[e*this.itemSize+t];return this.normalized&&(n=eB(n,this.array)),n}},{key:"setComponent",value:function(e,t,n){return this.normalized&&(n=eV(n,this.array)),this.array[e*this.itemSize+t]=n,this}},{key:"getX",value:function(e){var t=this.array[e*this.itemSize];return this.normalized&&(t=eB(t,this.array)),t}},{key:"setX",value:function(e,t){return this.normalized&&(t=eV(t,this.array)),this.array[e*this.itemSize]=t,this}},{key:"getY",value:function(e){var t=this.array[e*this.itemSize+1];return this.normalized&&(t=eB(t,this.array)),t}},{key:"setY",value:function(e,t){return this.normalized&&(t=eV(t,this.array)),this.array[e*this.itemSize+1]=t,this}},{key:"getZ",value:function(e){var t=this.array[e*this.itemSize+2];return this.normalized&&(t=eB(t,this.array)),t}},{key:"setZ",value:function(e,t){return this.normalized&&(t=eV(t,this.array)),this.array[e*this.itemSize+2]=t,this}},{key:"getW",value:function(e){var t=this.array[e*this.itemSize+3];return this.normalized&&(t=eB(t,this.array)),t}},{key:"setW",value:function(e,t){return this.normalized&&(t=eV(t,this.array)),this.array[e*this.itemSize+3]=t,this}},{key:"setXY",value:function(e,t,n){return e*=this.itemSize,this.normalized&&(t=eV(t,this.array),n=eV(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=eV(t,this.array),n=eV(n,this.array),i=eV(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}},{key:"setXYZW",value:function(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=eV(t,this.array),n=eV(n,this.array),i=eV(i,this.array),r=eV(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"clone",value:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),e}}]),t}(),nS=function(t){function n(t,i,r){return e(this,n),ev(this,n,[new Uint16Array(t),i,r])}return e_(n,t),n}(nw),nM=function(t){function n(t,i,r){return e(this,n),ev(this,n,[new Uint32Array(t),i,r])}return e_(n,t),n}(nw),nE=function(t){function n(t,i,r){return e(this,n),ev(this,n,[new Float32Array(t),i,r])}return e_(n,t),n}(nw),nT=0,nC=new tU,nk=new t5,nA=new tn,nP=new ta,nR=new ta,nU=new tn,nL=function(t){function i(){var t;return e(this,i),(t=ev(this,i)).isBufferGeometry=!0,Object.defineProperty(t,"id",{value:nT++}),t.uuid=eI(),t.name="",t.type="BufferGeometry",t.index=null,t.indirect=null,t.attributes={},t.morphAttributes={},t.morphTargetsRelative=!1,t.groups=[],t.boundingBox=null,t.boundingSphere=null,t.drawRange={start:0,count:1/0},t.userData={},t}return e_(i,t),n(i,[{key:"getIndex",value:function(){return this.index}},{key:"setIndex",value:function(e){return Array.isArray(e)?this.index=new(ej(e)?nM:nS)(e,1):this.index=e,this}},{key:"setIndirect",value:function(e){return this.indirect=e,this}},{key:"getIndirect",value:function(){return this.indirect}},{key:"getAttribute",value:function(e){return this.attributes[e]}},{key:"setAttribute",value:function(e,t){return this.attributes[e]=t,this}},{key:"deleteAttribute",value:function(e){return delete this.attributes[e],this}},{key:"hasAttribute",value:function(e){return void 0!==this.attributes[e]}},{key:"addGroup",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}},{key:"clearGroups",value:function(){this.groups=[]}},{key:"setDrawRange",value:function(e,t){this.drawRange.start=e,this.drawRange.count=t}},{key:"applyMatrix4",value:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var i=new eH().getNormalMatrix(e);n.applyNormalMatrix(i),n.needsUpdate=!0}var r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"applyQuaternion",value:function(e){return nC.makeRotationFromQuaternion(e),this.applyMatrix4(nC),this}},{key:"rotateX",value:function(e){return nC.makeRotationX(e),this.applyMatrix4(nC),this}},{key:"rotateY",value:function(e){return nC.makeRotationY(e),this.applyMatrix4(nC),this}},{key:"rotateZ",value:function(e){return nC.makeRotationZ(e),this.applyMatrix4(nC),this}},{key:"translate",value:function(e,t,n){return nC.makeTranslation(e,t,n),this.applyMatrix4(nC),this}},{key:"scale",value:function(e,t,n){return nC.makeScale(e,t,n),this.applyMatrix4(nC),this}},{key:"lookAt",value:function(e){return nk.lookAt(e),nk.updateMatrix(),this.applyMatrix4(nk.matrix),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(nA).negate(),this.translate(nA.x,nA.y,nA.z),this}},{key:"setFromPoints",value:function(e){var t=this.getAttribute("position");if(void 0===t){for(var n=[],i=0,r=e.length;i<r;i++){var a=e[i];n.push(a.x,a.y,a.z||0)}this.setAttribute("position",new nE(n,3))}else{for(var o=Math.min(e.length,t.count),s=0;s<o;s++){var l=e[s];t.setXYZ(s,l.x,l.y,l.z||0)}e.length,t.count,t.needsUpdate=!0}return this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new ta);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){this.boundingBox.set(new tn(-1/0,-1/0,-1/0),new tn(1/0,1/0,1/0));return}if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,i=t.length;n<i;n++){var r=t[n];nP.setFromBufferAttribute(r),this.morphTargetsRelative?(nU.addVectors(this.boundingBox.min,nP.min),this.boundingBox.expandByPoint(nU),nU.addVectors(this.boundingBox.max,nP.max),this.boundingBox.expandByPoint(nU)):(this.boundingBox.expandByPoint(nP.min),this.boundingBox.expandByPoint(nP.max))}}else this.boundingBox.makeEmpty();isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new tS);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){this.boundingSphere.set(new tn,1/0);return}if(e){var n=this.boundingSphere.center;if(nP.setFromBufferAttribute(e),t)for(var i=0,r=t.length;i<r;i++){var a=t[i];nR.setFromBufferAttribute(a),this.morphTargetsRelative?(nU.addVectors(nP.min,nR.min),nP.expandByPoint(nU),nU.addVectors(nP.max,nR.max),nP.expandByPoint(nU)):(nP.expandByPoint(nR.min),nP.expandByPoint(nR.max))}nP.getCenter(n);for(var o=0,s=0,l=e.count;s<l;s++)nU.fromBufferAttribute(e,s),o=Math.max(o,n.distanceToSquared(nU));if(t)for(var u=0,c=t.length;u<c;u++)for(var h=t[u],d=this.morphTargetsRelative,p=0,f=h.count;p<f;p++)nU.fromBufferAttribute(h,p),d&&(nA.fromBufferAttribute(e,p),nU.add(nA)),o=Math.max(o,n.distanceToSquared(nU));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)}}},{key:"computeTangents",value:function(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var n=t.position,i=t.normal,r=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new nw(new Float32Array(4*n.count),4));for(var a=this.getAttribute("tangent"),o=[],s=[],l=0;l<n.count;l++)o[l]=new tn,s[l]=new tn;var u=new tn,c=new tn,h=new tn,d=new eG,p=new eG,f=new eG,v=new tn,m=new tn,g=this.groups;0===g.length&&(g=[{start:0,count:e.count}]);for(var _=0,y=g.length;_<y;++_)for(var x=g[_],b=x.start,w=x.count,S=b,M=b+w;S<M;S+=3)!function(e,t,i){u.fromBufferAttribute(n,e),c.fromBufferAttribute(n,t),h.fromBufferAttribute(n,i),d.fromBufferAttribute(r,e),p.fromBufferAttribute(r,t),f.fromBufferAttribute(r,i),c.sub(u),h.sub(u),p.sub(d),f.sub(d);var a=1/(p.x*f.y-f.x*p.y);isFinite(a)&&(v.copy(c).multiplyScalar(f.y).addScaledVector(h,-p.y).multiplyScalar(a),m.copy(h).multiplyScalar(p.x).addScaledVector(c,-f.x).multiplyScalar(a),o[e].add(v),o[t].add(v),o[i].add(v),s[e].add(m),s[t].add(m),s[i].add(m))}(e.getX(S+0),e.getX(S+1),e.getX(S+2));for(var E=new tn,T=new tn,C=new tn,k=new tn,A=0,P=g.length;A<P;++A)for(var R=g[A],U=R.start,L=R.count,D=U,I=U+L;D<I;D+=3)N(e.getX(D+0)),N(e.getX(D+1)),N(e.getX(D+2))}function N(e){C.fromBufferAttribute(i,e),k.copy(C);var t=o[e];E.copy(t),E.sub(C.multiplyScalar(C.dot(t))).normalize(),T.crossVectors(k,t);var n=T.dot(s[e]);a.setXYZW(e,E.x,E.y,E.z,n<0?-1:1)}}},{key:"computeVertexNormals",value:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var n=this.getAttribute("normal");if(void 0===n)n=new nw(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(var i=0,r=n.count;i<r;i++)n.setXYZ(i,0,0,0);var a=new tn,o=new tn,s=new tn,l=new tn,u=new tn,c=new tn,h=new tn,d=new tn;if(e)for(var p=0,f=e.count;p<f;p+=3){var v=e.getX(p+0),m=e.getX(p+1),g=e.getX(p+2);a.fromBufferAttribute(t,v),o.fromBufferAttribute(t,m),s.fromBufferAttribute(t,g),h.subVectors(s,o),d.subVectors(a,o),h.cross(d),l.fromBufferAttribute(n,v),u.fromBufferAttribute(n,m),c.fromBufferAttribute(n,g),l.add(h),u.add(h),c.add(h),n.setXYZ(v,l.x,l.y,l.z),n.setXYZ(m,u.x,u.y,u.z),n.setXYZ(g,c.x,c.y,c.z)}else for(var _=0,y=t.count;_<y;_+=3)a.fromBufferAttribute(t,_+0),o.fromBufferAttribute(t,_+1),s.fromBufferAttribute(t,_+2),h.subVectors(s,o),d.subVectors(a,o),h.cross(d),n.setXYZ(_+0,h.x,h.y,h.z),n.setXYZ(_+1,h.x,h.y,h.z),n.setXYZ(_+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}},{key:"normalizeNormals",value:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)nU.fromBufferAttribute(e,t),nU.normalize(),e.setXYZ(t,nU.x,nU.y,nU.z)}},{key:"toNonIndexed",value:function(){function e(e,t){for(var n=e.array,i=e.itemSize,r=e.normalized,a=new n.constructor(t.length*i),o=0,s=0,l=0,u=t.length;l<u;l++){o=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*i;for(var c=0;c<i;c++)a[s++]=n[o++]}return new nw(a,i,r)}if(null===this.index)return this;var t=new i,n=this.index.array,r=this.attributes;for(var a in r){var o=e(r[a],n);t.setAttribute(a,o)}var s=this.morphAttributes;for(var l in s){for(var u=[],c=s[l],h=0,d=c.length;h<d;h++){var p=e(c[h],n);u.push(p)}t.morphAttributes[l]=u}t.morphTargetsRelative=this.morphTargetsRelative;for(var f=this.groups,v=0,m=f.length;v<m;v++){var g=f[v];t.addGroup(g.start,g.count,g.materialIndex)}return t}},{key:"toJSON",value:function(){var e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var i=this.index;null!==i&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var r=this.attributes;for(var a in r){var o=r[a];e.data.attributes[a]=o.toJSON(e.data)}var s={},l=!1;for(var u in this.morphAttributes){for(var c=this.morphAttributes[u],h=[],d=0,p=c.length;d<p;d++){var f=c[d];h.push(f.toJSON(e.data))}h.length>0&&(s[u]=h,l=!0)}l&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);var v=this.groups;v.length>0&&(e.data.groups=JSON.parse(JSON.stringify(v)));var m=this.boundingSphere;return null!==m&&(e.data.boundingSphere={center:m.center.toArray(),radius:m.radius}),e}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"copy",value:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone(t));var i=e.attributes;for(var r in i){var a=i[r];this.setAttribute(r,a.clone(t))}var o=e.morphAttributes;for(var s in o){for(var l=[],u=o[s],c=0,h=u.length;c<h;c++)l.push(u[c].clone(t));this.morphAttributes[s]=l}this.morphTargetsRelative=e.morphTargetsRelative;for(var d=e.groups,p=0,f=d.length;p<f;p++){var v=d[p];this.addGroup(v.start,v.count,v.materialIndex)}var m=e.boundingBox;null!==m&&(this.boundingBox=m.clone());var g=e.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),i}(eP),nD=new tU,nI=new tR,nN=new tS,nO=new tn,nF=new tn,nB=new tn,nV=new tn,nz=new tn,nG=new tn,nH=new tn,nW=new tn,nj=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new nL,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n_;return e(this,i),(t=ev(this,i)).isMesh=!0,t.type="Mesh",t.geometry=n,t.material=r,t.updateMorphTargets(),t}return e_(i,t),n(i,[{key:"copy",value:function(e,t){return em(ep(i.prototype),"copy",this).call(this,e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,r=n.length;i<r;i++){var a=n[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}},{key:"getVertexPosition",value:function(e,t){var n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(i,e);var o=this.morphTargetInfluences;if(r&&o){nG.set(0,0,0);for(var s=0,l=r.length;s<l;s++){var u=o[s],c=r[s];0!==u&&(nz.fromBufferAttribute(c,e),a?nG.addScaledVector(nz,u):nG.addScaledVector(nz.sub(t),u))}t.add(nG)}return t}},{key:"raycast",value:function(e,t){var n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),nN.copy(n.boundingSphere),nN.applyMatrix4(r),nI.copy(e.ray).recast(e.near),!1===nN.containsPoint(nI.origin)&&(null===nI.intersectSphere(nN,nO)||nI.origin.distanceToSquared(nO)>Math.pow(e.far-e.near,2))||(nD.copy(r).invert(),nI.copy(e.ray).applyMatrix4(nD),null!==n.boundingBox&&!1===nI.intersectsBox(n.boundingBox)))return;this._computeIntersections(e,t,nI)}}},{key:"_computeIntersections",value:function(e,t,n){var i,r=this.geometry,a=this.material,o=r.index,s=r.attributes.position,l=r.attributes.uv,u=r.attributes.uv1,c=r.attributes.normal,h=r.groups,d=r.drawRange;if(null!==o){if(Array.isArray(a))for(var p=0,f=h.length;p<f;p++)for(var v=h[p],m=a[v.materialIndex],g=Math.max(v.start,d.start),_=Math.min(o.count,Math.min(v.start+v.count,d.start+d.count)),y=g;y<_;y+=3)(i=nX(this,m,e,n,l,u,c,o.getX(y),o.getX(y+1),o.getX(y+2)))&&(i.faceIndex=Math.floor(y/3),i.face.materialIndex=v.materialIndex,t.push(i));else for(var x=Math.max(0,d.start),b=Math.min(o.count,d.start+d.count),w=x;w<b;w+=3)(i=nX(this,a,e,n,l,u,c,o.getX(w),o.getX(w+1),o.getX(w+2)))&&(i.faceIndex=Math.floor(w/3),t.push(i))}else if(void 0!==s){if(Array.isArray(a))for(var S=0,M=h.length;S<M;S++)for(var E=h[S],T=a[E.materialIndex],C=Math.max(E.start,d.start),k=Math.min(s.count,Math.min(E.start+E.count,d.start+d.count)),A=C;A<k;A+=3)(i=nX(this,T,e,n,l,u,c,A,A+1,A+2))&&(i.faceIndex=Math.floor(A/3),i.face.materialIndex=E.materialIndex,t.push(i));else for(var P=Math.max(0,d.start),R=Math.min(s.count,d.start+d.count),U=P;U<R;U+=3)(i=nX(this,a,e,n,l,u,c,U,U+1,U+2))&&(i.faceIndex=Math.floor(U/3),t.push(i))}}}]),i}(t5);function nX(e,t,n,i,r,a,o,s,l,u){e.getVertexPosition(s,nF),e.getVertexPosition(l,nB),e.getVertexPosition(u,nV);var c=function(e,t,n,i,r,a,o,s){if(null===(1===t.side?i.intersectTriangle(o,a,r,!0,s):i.intersectTriangle(r,a,o,0===t.side,s)))return null;nW.copy(s),nW.applyMatrix4(e.matrixWorld);var l,u=n.ray.origin.distanceTo(nW);return u<n.near||u>n.far?null:{distance:u,point:nW.clone(),object:e}}(e,t,n,i,nF,nB,nV,nH);if(c){var h=new tn;nu.getBarycoord(nH,nF,nB,nV,h),r&&(c.uv=nu.getInterpolatedAttribute(r,s,l,u,h,new eG)),a&&(c.uv1=nu.getInterpolatedAttribute(a,s,l,u,h,new eG)),o&&(c.normal=nu.getInterpolatedAttribute(o,s,l,u,h,new tn),c.normal.dot(i.direction)>0&&c.normal.multiplyScalar(-1));var d={a:s,b:l,c:u,normal:new tn,materialIndex:0};nu.getNormal(nF,nB,nV,d.normal),c.face=d,c.barycoord=h}return c}var nq=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;e(this,i),(t=ev(this,i)).type="BoxGeometry",t.parameters={width:n,height:r,depth:a,widthSegments:o,heightSegments:s,depthSegments:l},o=Math.floor(o),s=Math.floor(s);var u=[],c=[],h=[],d=[],p=0,f=0;function v(e,n,i,r,a,o,s,l,v,m,g){for(var _=o/v,y=s/m,x=o/2,b=s/2,w=l/2,S=v+1,M=m+1,E=0,T=0,C=new tn,k=0;k<M;k++)for(var A=k*y-b,P=0;P<S;P++){var R=P*_-x;C[e]=R*r,C[n]=A*a,C[i]=w,c.push(C.x,C.y,C.z),C[e]=0,C[n]=0,C[i]=l>0?1:-1,h.push(C.x,C.y,C.z),d.push(P/v),d.push(1-k/m),E+=1}for(var U=0;U<m;U++)for(var L=0;L<v;L++){var D=p+L+S*U,I=p+L+S*(U+1),N=p+(L+1)+S*(U+1),O=p+(L+1)+S*U;u.push(D,I,O),u.push(I,N,O),T+=6}t.addGroup(f,T,g),f+=T,p+=E}return v("z","y","x",-1,-1,a,r,n,l=Math.floor(l),s,0),v("z","y","x",1,-1,a,r,-n,l,s,1),v("x","z","y",1,1,n,a,r,o,l,2),v("x","z","y",1,-1,n,a,-r,o,l,3),v("x","y","z",1,-1,n,r,a,o,s,4),v("x","y","z",-1,-1,n,r,-a,o,s,5),t.setIndex(u),t.setAttribute("position",new nE(c,3)),t.setAttribute("normal",new nE(h,3)),t.setAttribute("uv",new nE(d,2)),t}return e_(i,t),n(i,[{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new i(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}]),i}(nL);function nY(e){var t={};for(var n in e)for(var i in t[n]={},e[n]){var r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?t[n][i]=null:t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}return t}function nK(e){for(var t={},n=0;n<e.length;n++){var i=nY(e[n]);for(var r in i)t[r]=i[r]}return t}function nZ(e){var t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:eQ.workingColorSpace}var nJ={clone:nY},nQ=function(t){function i(t){var n;return e(this,i),(n=ev(this,i)).isShaderMaterial=!0,n.type="ShaderMaterial",n.defines={},n.uniforms={},n.uniformsGroups=[],n.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",n.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",n.linewidth=1,n.wireframe=!1,n.wireframeLinewidth=1,n.fog=!1,n.lights=!1,n.clipping=!1,n.forceSinglePass=!0,n.extensions={clipCullDistance:!1,multiDraw:!1},n.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},n.index0AttributeName=void 0,n.uniformsNeedUpdate=!1,n.glslVersion=null,void 0!==t&&n.setValues(t),n}return e_(i,t),n(i,[{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=nY(e.uniforms),this.uniformsGroups=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}},{key:"toJSON",value:function(e){var t=em(ep(i.prototype),"toJSON",this).call(this,e);for(var n in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;var a={};for(var o in this.extensions)!0===this.extensions[o]&&(a[o]=!0);return Object.keys(a).length>0&&(t.extensions=a),t}}]),i}(ng),n$=function(t){function i(){var t;return e(this,i),(t=ev(this,i)).isCamera=!0,t.type="Camera",t.matrixWorldInverse=new tU,t.projectionMatrix=new tU,t.projectionMatrixInverse=new tU,t.coordinateSystem=2e3,t}return e_(i,t),n(i,[{key:"copy",value:function(e,t){return em(ep(i.prototype),"copy",this).call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}},{key:"getWorldDirection",value:function(e){return em(ep(i.prototype),"getWorldDirection",this).call(this,e).negate()}},{key:"updateMatrixWorld",value:function(e){em(ep(i.prototype),"updateMatrixWorld",this).call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function(e,t){em(ep(i.prototype),"updateWorldMatrix",this).call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),i}(t5),n0=new tn,n1=new eG,n2=new eG,n3=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;return e(this,i),(t=ev(this,i)).isPerspectiveCamera=!0,t.type="PerspectiveCamera",t.fov=n,t.zoom=1,t.near=a,t.far=o,t.focus=10,t.aspect=r,t.view=null,t.filmGauge=35,t.filmOffset=0,t.updateProjectionMatrix(),t}return e_(i,t),n(i,[{key:"copy",value:function(e,t){return em(ep(i.prototype),"copy",this).call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}},{key:"setFocalLength",value:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*eD*Math.atan(t),this.updateProjectionMatrix()}},{key:"getFocalLength",value:function(){var e=Math.tan(.5*eL*this.fov);return .5*this.getFilmHeight()/e}},{key:"getEffectiveFOV",value:function(){return 2*eD*Math.atan(Math.tan(.5*eL*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"getViewBounds",value:function(e,t,n){n0.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(n0.x,n0.y).multiplyScalar(-e/n0.z),n0.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(n0.x,n0.y).multiplyScalar(-e/n0.z)}},{key:"getViewSize",value:function(e,t){return this.getViewBounds(e,n1,n2),t.subVectors(n2,n1)}},{key:"setViewOffset",value:function(e,t,n,i,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=this.near,t=e*Math.tan(.5*eL*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;r+=a.offsetX*i/o,t-=a.offsetY*n/s,i*=a.width/o,n*=a.height/s}var l=this.filmOffset;0!==l&&(r+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=em(ep(i.prototype),"toJSON",this).call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}]),i}(n$),n4=function(t){function i(t,n,r){e(this,i),(a=ev(this,i)).type="CubeCamera",a.renderTarget=r,a.coordinateSystem=null,a.activeMipmapLevel=0;var a,o=new n3(-90,1,t,n);o.layers=a.layers,a.add(o);var s=new n3(-90,1,t,n);s.layers=a.layers,a.add(s);var l=new n3(-90,1,t,n);l.layers=a.layers,a.add(l);var u=new n3(-90,1,t,n);u.layers=a.layers,a.add(u);var c=new n3(-90,1,t,n);c.layers=a.layers,a.add(c);var h=new n3(-90,1,t,n);return h.layers=a.layers,a.add(h),a}return e_(i,t),n(i,[{key:"updateCoordinateSystem",value:function(){var e=this.coordinateSystem,t=this.children.concat(),n=eb(t,6),i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],l=n[5],u=!0,c=!1,h=void 0;try{for(var d,p=t[Symbol.iterator]();!(u=(d=p.next()).done);u=!0){var f=d.value;this.remove(f)}}catch(e){c=!0,h=e}finally{try{u||null==p.return||p.return()}finally{if(c)throw h}}if(2e3===e)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),a.up.set(0,0,-1),a.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(2001===e)i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),a.up.set(0,0,1),a.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);var v=!0,m=!1,g=void 0;try{for(var _,y=t[Symbol.iterator]();!(v=(_=y.next()).done);v=!0){var x=_.value;this.add(x),x.updateMatrixWorld()}}catch(e){m=!0,g=e}finally{try{v||null==y.return||y.return()}finally{if(m)throw g}}}},{key:"update",value:function(e,t){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,i=this.activeMipmapLevel;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());var r=eb(this.children,6),a=r[0],o=r[1],s=r[2],l=r[3],u=r[4],c=r[5],h=e.getRenderTarget(),d=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;var v=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,a),e.setRenderTarget(n,1,i),e.render(t,o),e.setRenderTarget(n,2,i),e.render(t,s),e.setRenderTarget(n,3,i),e.render(t,l),e.setRenderTarget(n,4,i),e.render(t,u),n.texture.generateMipmaps=v,e.setRenderTarget(n,5,i),e.render(t,c),e.setRenderTarget(h,d,p),e.xr.enabled=f,n.texture.needsPMREMUpdate=!0}}]),i}(t5),n5=function(t){function i(t,n,r,a,o,s,l,u,c,h){var d;return e(this,i),(d=ev(this,i,[t=void 0!==t?t:[],n=void 0!==n?n:301,r,a,o,s,l,u,c,h])).isCubeTexture=!0,d.flipY=!1,d}return e_(i,t),n(i,[{key:"images",get:function(){return this.image},set:function(e){this.image=e}}]),i}(e6),n6=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,i),(t=ev(this,i,[n,n,r])).isWebGLCubeRenderTarget=!0;var a={width:n,height:n,depth:1};return t.texture=new n5([a,a,a,a,a,a],r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace),t.texture.isRenderTargetTexture=!0,t.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,t.texture.minFilter=void 0!==r.minFilter?r.minFilter:1006,t}return e_(i,t),n(i,[{key:"fromEquirectangularTexture",value:function(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n=new nq(5,5,5),i=new nQ({name:"CubemapFromEquirect",uniforms:nY({tEquirect:{value:null}}),vertexShader:"\n\n				varying vec3 vWorldDirection;\n\n				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n				}\n\n				void main() {\n\n					vWorldDirection = transformDirection( position, modelMatrix );\n\n					#include <begin_vertex>\n					#include <project_vertex>\n\n				}\n			",fragmentShader:"\n\n				uniform sampler2D tEquirect;\n\n				varying vec3 vWorldDirection;\n\n				#include <common>\n\n				void main() {\n\n					vec3 direction = normalize( vWorldDirection );\n\n					vec2 sampleUV = equirectUv( direction );\n\n					gl_FragColor = texture2D( tEquirect, sampleUV );\n\n				}\n			",side:1,blending:0});i.uniforms.tEquirect.value=t;var r=new nj(n,i),a=t.minFilter;return 1008===t.minFilter&&(t.minFilter=1006),new n4(1,10,this).update(e,r),t.minFilter=a,r.geometry.dispose(),r.material.dispose(),this}},{key:"clear",value:function(e,t,n,i){for(var r=e.getRenderTarget(),a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,i);e.setRenderTarget(r)}}]),i}(e9),n8=function(t){function n(){var t;return e(this,n),(t=ev(this,n)).isGroup=!0,t.type="Group",t}return e_(n,t),n}(t5),n9={type:"move"},n7=function(){function t(){e(this,t),this._targetRay=null,this._grip=null,this._hand=null}return n(t,[{key:"getHandSpace",value:function(){return null===this._hand&&(this._hand=new n8,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}},{key:"getTargetRaySpace",value:function(){return null===this._targetRay&&(this._targetRay=new n8,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new tn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new tn),this._targetRay}},{key:"getGripSpace",value:function(){return null===this._grip&&(this._grip=new n8,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new tn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new tn),this._grip}},{key:"dispatchEvent",value:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}},{key:"connect",value:function(e){if(e&&e.hand){var t=this._hand,n=!0,i=!1,r=void 0;if(t)try{for(var a,o=e.hand.values()[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;this._getHandJoint(t,s)}}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}}return this.dispatchEvent({type:"connected",data:e}),this}},{key:"disconnect",value:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}},{key:"update",value:function(e,t,n){var i=null,r=null,a=null,o=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){a=!0;var u=!0,c=!1,h=void 0;try{for(var d,p=e.hand.values()[Symbol.iterator]();!(u=(d=p.next()).done);u=!0){var f=d.value,v=t.getJointPose(f,n),m=this._getHandJoint(l,f);null!==v&&(m.matrix.fromArray(v.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,m.jointRadius=v.radius),m.visible=null!==v}}catch(e){c=!0,h=e}finally{try{u||null==p.return||p.return()}finally{if(c)throw h}}var g=l.joints["index-finger-tip"],_=l.joints["thumb-tip"],y=g.position.distanceTo(_.position);l.inputState.pinching&&y>.025?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&y<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&null!==(r=t.getPose(e.gripSpace,n))&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1);null!==o&&(null===(i=t.getPose(e.targetRaySpace,n))&&null!==r&&(i=r),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(n9)))}return null!==o&&(o.visible=null!==i),null!==s&&(s.visible=null!==r),null!==l&&(l.visible=null!==a),this}},{key:"_getHandJoint",value:function(e,t){if(void 0===e.joints[t.jointName]){var n=new n8;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}]),t}(),ie=function(t){function i(){var t;return e(this,i),(t=ev(this,i)).isScene=!0,t.type="Scene",t.background=null,t.environment=null,t.fog=null,t.backgroundBlurriness=0,t.backgroundIntensity=1,t.backgroundRotation=new tG,t.environmentIntensity=1,t.environmentRotation=new tG,t.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:t})),t}return e_(i,t),n(i,[{key:"copy",value:function(e,t){return em(ep(i.prototype),"copy",this).call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}},{key:"toJSON",value:function(e){var t=em(ep(i.prototype),"toJSON",this).call(this,e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}]),i}(t5),it=new tn,ii=new eG,ir=new eG,ia=new tU,io=function(t){function i(t,n,r){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return e(this,i),(a=ev(this,i,[t,n,r])).isInstancedBufferAttribute=!0,a.meshPerAttribute=o,a}return e_(i,t),n(i,[{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"toJSON",value:function(){var e=em(ep(i.prototype),"toJSON",this).call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}]),i}(nw),is=new tn,il=new tn,iu=new eH,ic=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tn(1,0,0),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.isPlane=!0,this.normal=n,this.constant=i}return n(t,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var i=is.subVectors(n,t).cross(il.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}},{key:"intersectLine",value:function(e,t){var n=e.delta(is),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;var r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(e,t){var n=t||iu.getNormalMatrix(e),i=this.coplanarPoint(is).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),t}(),ih=new tS,id=new tn,ip=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ic,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ic,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ic,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new ic,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new ic,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new ic;e(this,t),this.planes=[n,i,r,a,o,s]}return n(t,[{key:"set",value:function(e,t,n,i,r,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(a),this}},{key:"copy",value:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,n=this.planes,i=e.elements,r=i[0],a=i[1],o=i[2],s=i[3],l=i[4],u=i[5],c=i[6],h=i[7],d=i[8],p=i[9],f=i[10],v=i[11],m=i[12],g=i[13],_=i[14],y=i[15];if(n[0].setComponents(s-r,h-l,v-d,y-m).normalize(),n[1].setComponents(s+r,h+l,v+d,y+m).normalize(),n[2].setComponents(s+a,h+u,v+p,y+g).normalize(),n[3].setComponents(s-a,h-u,v-p,y-g).normalize(),n[4].setComponents(s-o,h-c,v-f,y-_).normalize(),2e3===t)n[5].setComponents(s+o,h+c,v+f,y+_).normalize();else if(2001===t)n[5].setComponents(o,c,f,_).normalize();else throw Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}},{key:"intersectsObject",value:function(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),ih.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{var t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),ih.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(ih)}},{key:"intersectsSprite",value:function(e){return ih.center.set(0,0,0),ih.radius=.7071067811865476,ih.applyMatrix4(e.matrixWorld),this.intersectsSphere(ih)}},{key:"intersectsSphere",value:function(e){for(var t=this.planes,n=e.center,i=-e.radius,r=0;r<6;r++)if(t[r].distanceToPoint(n)<i)return!1;return!0}},{key:"intersectsBox",value:function(e){for(var t=this.planes,n=0;n<6;n++){var i=t[n];if(id.x=i.normal.x>0?e.max.x:e.min.x,id.y=i.normal.y>0?e.max.y:e.min.y,id.z=i.normal.z>0?e.max.z:e.min.z,0>i.distanceToPoint(id))return!1}return!0}},{key:"containsPoint",value:function(e){for(var t=this.planes,n=0;n<6;n++)if(0>t[n].distanceToPoint(e))return!1;return!0}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),t}(),iv=function(){function t(){e(this,t),this.index=0,this.pool=[],this.list=[]}return n(t,[{key:"push",value:function(e,t,n,i){var r=this.pool,a=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1,index:-1});var o=r[this.index];a.push(o),this.index++,o.start=e,o.count=t,o.z=n,o.index=i}},{key:"reset",value:function(){this.list.length=0,this.index=0}}]),t}(),im=function(t){function i(t){var n;return e(this,i),(n=ev(this,i)).isLineBasicMaterial=!0,n.type="LineBasicMaterial",n.color=new nf(0xffffff),n.map=null,n.linewidth=1,n.linecap="round",n.linejoin="round",n.fog=!0,n.setValues(t),n}return e_(i,t),n(i,[{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}]),i}(ng),ig=new tn,i_=new tn,iy=new tU,ix=new tR,ib=new tS,iw=new tn,iS=new tn,iM=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new nL,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new im;return e(this,i),(t=ev(this,i)).isLine=!0,t.type="Line",t.geometry=n,t.material=r,t.updateMorphTargets(),t}return e_(i,t),n(i,[{key:"copy",value:function(e,t){return em(ep(i.prototype),"copy",this).call(this,e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}},{key:"computeLineDistances",value:function(){var e=this.geometry;if(null===e.index){for(var t=e.attributes.position,n=[0],i=1,r=t.count;i<r;i++)ig.fromBufferAttribute(t,i-1),i_.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=ig.distanceTo(i_);e.setAttribute("lineDistance",new nE(n,1))}return this}},{key:"raycast",value:function(e,t){var n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),ib.copy(n.boundingSphere),ib.applyMatrix4(i),ib.radius+=r,!1!==e.ray.intersectsSphere(ib)){iy.copy(i).invert(),ix.copy(e.ray).applyMatrix4(iy);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=this.isLineSegments?2:1,u=n.index,c=n.attributes.position;if(null!==u){for(var h=Math.max(0,a.start),d=Math.min(u.count,a.start+a.count),p=h,f=d-1;p<f;p+=l){var v=iE(this,e,ix,s,u.getX(p),u.getX(p+1),p);v&&t.push(v)}if(this.isLineLoop){var m=iE(this,e,ix,s,u.getX(d-1),u.getX(h),d-1);m&&t.push(m)}}else{for(var g=Math.max(0,a.start),_=Math.min(c.count,a.start+a.count),y=g,x=_-1;y<x;y+=l){var b=iE(this,e,ix,s,y,y+1,y);b&&t.push(b)}if(this.isLineLoop){var w=iE(this,e,ix,s,_-1,g,_-1);w&&t.push(w)}}}}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,r=n.length;i<r;i++){var a=n[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}}]),i}(t5);function iE(e,t,n,i,r,a,o){var s=e.geometry.attributes.position;if(ig.fromBufferAttribute(s,r),i_.fromBufferAttribute(s,a),!(n.distanceSqToSegment(ig,i_,iw,iS)>i)){iw.applyMatrix4(e.matrixWorld);var l=t.ray.origin.distanceTo(iw);if(!(l<t.near)&&!(l>t.far))return{distance:l,point:iS.clone().applyMatrix4(e.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:e}}}var iT=new tR,iC=function(t){function i(t,n,r,a,o,s,l,u,c){var h;return e(this,i),(h=ev(this,i,[t,n,r,a,o,s,l,u,c])).isVideoTexture=!0,h.minFilter=void 0!==s?s:1006,h.magFilter=void 0!==o?o:1006,h.generateMipmaps=!1,"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(function e(){h.needsUpdate=!0,t.requestVideoFrameCallback(e)}),h}return e_(i,t),n(i,[{key:"clone",value:function(){return new this.constructor(this.image).copy(this)}},{key:"update",value:function(){var e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}]),i}(e6),ik=function(t){function i(t,n,r,a,o,s,l,u,c){var h,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1026;if(e(this,i),1026!==d&&1027!==d)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return void 0===r&&1026===d&&(r=1014),void 0===r&&1027===d&&(r=1020),(h=ev(this,i,[null,a,o,s,l,u,d,r,c])).isDepthTexture=!0,h.image={width:t,height:n},h.magFilter=void 0!==l?l:1003,h.minFilter=void 0!==u?u:1003,h.flipY=!1,h.generateMipmaps=!1,h.compareFunction=null,h}return e_(i,t),n(i,[{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.compareFunction=e.compareFunction,this}},{key:"toJSON",value:function(e){var t=em(ep(i.prototype),"toJSON",this).call(this,e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}]),i}(e6),iA=function(){function t(){e(this,t),this.type="Curve",this.arcLengthDivisions=200}return n(t,[{key:"getPoint",value:function(){return null}},{key:"getPointAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)}},{key:"getPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}},{key:"getLength",value:function(){var e=this.getLengths();return e[e.length-1]}},{key:"getLengths",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n=[],i=this.getPoint(0),r=0;n.push(0);for(var a=1;a<=e;a++)n.push(r+=(t=this.getPoint(a/e)).distanceTo(i)),i=t;return this.cacheArcLengths=n,n}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.getLengths()}},{key:"getUtoTmapping",value:function(e,t){var n=this.getLengths(),i=0,r=n.length;a=t||e*n[r-1];for(var a,o,s=0,l=r-1;s<=l;)if((o=n[i=Math.floor(s+(l-s)/2)]-a)<0)s=i+1;else if(o>0)l=i-1;else{l=i;break}if(n[i=l]===a)return i/(r-1);var u=n[i],c=n[i+1];return(i+(a-u)/(c-u))/(r-1)}},{key:"getTangent",value:function(e,t){var n=e-1e-4,i=e+1e-4;n<0&&(n=0),i>1&&(i=1);var r=this.getPoint(n),a=this.getPoint(i),o=t||(r.isVector2?new eG:new tn);return o.copy(a).sub(r).normalize(),o}},{key:"getTangentAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getTangent(n,t)}},{key:"computeFrenetFrames",value:function(e,t){for(var n=new tn,i=[],r=[],a=[],o=new tn,s=new tU,l=0;l<=e;l++){var u=l/e;i[l]=this.getTangentAt(u,new tn)}r[0]=new tn,a[0]=new tn;var c=Number.MAX_VALUE,h=Math.abs(i[0].x),d=Math.abs(i[0].y),p=Math.abs(i[0].z);h<=c&&(c=h,n.set(1,0,0)),d<=c&&(c=d,n.set(0,1,0)),p<=c&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),a[0].crossVectors(i[0],r[0]);for(var f=1;f<=e;f++){if(r[f]=r[f-1].clone(),a[f]=a[f-1].clone(),o.crossVectors(i[f-1],i[f]),o.length()>Number.EPSILON){o.normalize();var v=Math.acos(eN(i[f-1].dot(i[f]),-1,1));r[f].applyMatrix4(s.makeRotationAxis(o,v))}a[f].crossVectors(i[f],r[f])}if(!0===t){var m=Math.acos(eN(r[0].dot(r[e]),-1,1));m/=e,i[0].dot(o.crossVectors(r[0],r[e]))>0&&(m=-m);for(var g=1;g<=e;g++)r[g].applyMatrix4(s.makeRotationAxis(i[g],m*g)),a[g].crossVectors(i[g],r[g])}return{tangents:i,normals:r,binormals:a}}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"copy",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},{key:"toJSON",value:function(){var e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}},{key:"fromJSON",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}]),t}(),iP=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;return e(this,i),(t=ev(this,i)).isEllipseCurve=!0,t.type="EllipseCurve",t.aX=n,t.aY=r,t.xRadius=a,t.yRadius=o,t.aStartAngle=s,t.aEndAngle=l,t.aClockwise=u,t.aRotation=c,t}return e_(i,t),n(i,[{key:"getPoint",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new eG,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,r=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=r?0:n),!0!==this.aClockwise||r||(i===n?i=-n:i-=n);var a=this.aStartAngle+e*i,o=this.aX+this.xRadius*Math.cos(a),s=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var l=Math.cos(this.aRotation),u=Math.sin(this.aRotation),c=o-this.aX,h=s-this.aY;o=c*l-h*u+this.aX,s=c*u+h*l+this.aY}return t.set(o,s)}},{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},{key:"toJSON",value:function(){var e=em(ep(i.prototype),"toJSON",this).call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}},{key:"fromJSON",value:function(e){return em(ep(i.prototype),"fromJSON",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}]),i}(iA),iR=function(t){function n(t,i,r,a,o,s){var l;return e(this,n),(l=ev(this,n,[t,i,r,r,a,o,s])).isArcCurve=!0,l.type="ArcCurve",l}return e_(n,t),n}(iP);function iU(){var e=0,t=0,n=0,i=0;function r(r,a,o,s){e=r,t=o,n=-3*r+3*a-2*o-s,i=2*r-2*a+o+s}return{initCatmullRom:function(e,t,n,i,a){r(t,n,a*(n-e),a*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,a,o,s){var l=(t-e)/a-(n-e)/(a+o)+(n-t)/o,u=(n-t)/o-(i-t)/(o+s)+(i-n)/s;r(t,n,l*=o,u*=o)},calc:function(r){var a=r*r;return e+t*r+n*a+a*r*i}}}var iL=new tn,iD=new iU,iI=new iU,iN=new iU,iO=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;return e(this,i),(t=ev(this,i)).isCatmullRomCurve3=!0,t.type="CatmullRomCurve3",t.points=n,t.closed=r,t.curveType=a,t.tension=o,t}return e_(i,t),n(i,[{key:"getPoint",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tn,r=this.points,a=r.length,o=(a-+!this.closed)*e,s=Math.floor(o),l=o-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/a)+1)*a:0===l&&s===a-1&&(s=a-2,l=1),this.closed||s>0?t=r[(s-1)%a]:(iL.subVectors(r[0],r[1]).add(r[0]),t=iL);var u=r[s%a],c=r[(s+1)%a];if(this.closed||s+2<a?n=r[(s+2)%a]:(iL.subVectors(r[a-1],r[a-2]).add(r[a-1]),n=iL),"centripetal"===this.curveType||"chordal"===this.curveType){var h="chordal"===this.curveType?.5:.25,d=Math.pow(t.distanceToSquared(u),h),p=Math.pow(u.distanceToSquared(c),h),f=Math.pow(c.distanceToSquared(n),h);p<1e-4&&(p=1),d<1e-4&&(d=p),f<1e-4&&(f=p),iD.initNonuniformCatmullRom(t.x,u.x,c.x,n.x,d,p,f),iI.initNonuniformCatmullRom(t.y,u.y,c.y,n.y,d,p,f),iN.initNonuniformCatmullRom(t.z,u.z,c.z,n.z,d,p,f)}else"catmullrom"===this.curveType&&(iD.initCatmullRom(t.x,u.x,c.x,n.x,this.tension),iI.initCatmullRom(t.y,u.y,c.y,n.y,this.tension),iN.initCatmullRom(t.z,u.z,c.z,n.z,this.tension));return i.set(iD.calc(l),iI.calc(l),iN.calc(l)),i}},{key:"copy",value:function(e){em(ep(i.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},{key:"toJSON",value:function(){var e=em(ep(i.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}},{key:"fromJSON",value:function(e){em(ep(i.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(new tn().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}]),i}(iA);function iF(e,t,n,i,r){var a=(i-t)*.5,o=(r-n)*.5,s=e*e;return e*s*(2*n-2*i+a+o)+(-3*n+3*i-2*a-o)*s+a*e+n}function iB(e,t,n,i){var r;return(r=1-e)*r*t+2*(1-e)*e*n+e*e*i}function iV(e,t,n,i,r){var a,o;return(a=1-e)*a*a*t+3*(o=1-e)*o*e*n+3*(1-e)*e*e*i+e*e*e*r}var iz=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new eG,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new eG,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new eG,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new eG;return e(this,i),(t=ev(this,i)).isCubicBezierCurve=!0,t.type="CubicBezierCurve",t.v0=n,t.v1=r,t.v2=a,t.v3=o,t}return e_(i,t),n(i,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new eG,n=this.v0,i=this.v1,r=this.v2,a=this.v3;return t.set(iV(e,n.x,i.x,r.x,a.x),iV(e,n.y,i.y,r.y,a.y)),t}},{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=em(ep(i.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return em(ep(i.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),i}(iA),iG=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tn,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tn,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new tn,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new tn;return e(this,i),(t=ev(this,i)).isCubicBezierCurve3=!0,t.type="CubicBezierCurve3",t.v0=n,t.v1=r,t.v2=a,t.v3=o,t}return e_(i,t),n(i,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tn,n=this.v0,i=this.v1,r=this.v2,a=this.v3;return t.set(iV(e,n.x,i.x,r.x,a.x),iV(e,n.y,i.y,r.y,a.y),iV(e,n.z,i.z,r.z,a.z)),t}},{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=em(ep(i.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return em(ep(i.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),i}(iA),iH=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new eG,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new eG;return e(this,i),(t=ev(this,i)).isLineCurve=!0,t.type="LineCurve",t.v1=n,t.v2=r,t}return e_(i,t),n(i,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new eG;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new eG;return t.subVectors(this.v2,this.v1).normalize()}},{key:"getTangentAt",value:function(e,t){return this.getTangent(e,t)}},{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=em(ep(i.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return em(ep(i.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),i}(iA),iW=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tn,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tn;return e(this,i),(t=ev(this,i)).isLineCurve3=!0,t.type="LineCurve3",t.v1=n,t.v2=r,t}return e_(i,t),n(i,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tn;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tn;return t.subVectors(this.v2,this.v1).normalize()}},{key:"getTangentAt",value:function(e,t){return this.getTangent(e,t)}},{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=em(ep(i.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return em(ep(i.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),i}(iA),ij=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new eG,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new eG,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new eG;return e(this,i),(t=ev(this,i)).isQuadraticBezierCurve=!0,t.type="QuadraticBezierCurve",t.v0=n,t.v1=r,t.v2=a,t}return e_(i,t),n(i,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new eG,n=this.v0,i=this.v1,r=this.v2;return t.set(iB(e,n.x,i.x,r.x),iB(e,n.y,i.y,r.y)),t}},{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=em(ep(i.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return em(ep(i.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),i}(iA),iX=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tn,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tn,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new tn;return e(this,i),(t=ev(this,i)).isQuadraticBezierCurve3=!0,t.type="QuadraticBezierCurve3",t.v0=n,t.v1=r,t.v2=a,t}return e_(i,t),n(i,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tn,n=this.v0,i=this.v1,r=this.v2;return t.set(iB(e,n.x,i.x,r.x),iB(e,n.y,i.y,r.y),iB(e,n.z,i.z,r.z)),t}},{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=em(ep(i.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return em(ep(i.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),i}(iA),iq=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e(this,i),(t=ev(this,i)).isSplineCurve=!0,t.type="SplineCurve",t.points=n,t}return e_(i,t),n(i,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new eG,n=this.points,i=(n.length-1)*e,r=Math.floor(i),a=i-r,o=n[0===r?r:r-1],s=n[r],l=n[r>n.length-2?n.length-1:r+1],u=n[r>n.length-3?n.length-1:r+2];return t.set(iF(a,o.x,s.x,l.x,u.x),iF(a,o.y,s.y,l.y,u.y)),t}},{key:"copy",value:function(e){em(ep(i.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this}},{key:"toJSON",value:function(){var e=em(ep(i.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e}},{key:"fromJSON",value:function(e){em(ep(i.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(new eG().fromArray(r))}return this}}]),i}(iA),iY=Object.freeze({__proto__:null,ArcCurve:iR,CatmullRomCurve3:iO,CubicBezierCurve:iz,CubicBezierCurve3:iG,EllipseCurve:iP,LineCurve:iH,LineCurve3:iW,QuadraticBezierCurve:ij,QuadraticBezierCurve3:iX,SplineCurve:iq}),iK=function(t){function i(t){var n;return e(this,i),(n=ev(this,i)).type="Path",n.currentPoint=new eG,t&&n.setFromPoints(t),n}return e_(i,t),n(i,[{key:"setFromPoints",value:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}},{key:"moveTo",value:function(e,t){return this.currentPoint.set(e,t),this}},{key:"lineTo",value:function(e,t){var n=new iH(this.currentPoint.clone(),new eG(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,i){var r=new ij(this.currentPoint.clone(),new eG(e,t),new eG(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}},{key:"bezierCurveTo",value:function(e,t,n,i,r,a){var o=new iz(this.currentPoint.clone(),new eG(e,t),new eG(n,i),new eG(r,a));return this.curves.push(o),this.currentPoint.set(r,a),this}},{key:"splineThru",value:function(e){var t=new iq([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this}},{key:"arc",value:function(e,t,n,i,r,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,i,r,a),this}},{key:"absarc",value:function(e,t,n,i,r,a){return this.absellipse(e,t,n,n,i,r,a),this}},{key:"ellipse",value:function(e,t,n,i,r,a,o,s){var l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,n,i,r,a,o,s),this}},{key:"absellipse",value:function(e,t,n,i,r,a,o,s){var l=new iP(e,t,n,i,r,a,o,s);if(this.curves.length>0){var u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);var c=l.getPoint(1);return this.currentPoint.copy(c),this}},{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.currentPoint.copy(e.currentPoint),this}},{key:"toJSON",value:function(){var e=em(ep(i.prototype),"toJSON",this).call(this);return e.currentPoint=this.currentPoint.toArray(),e}},{key:"fromJSON",value:function(e){return em(ep(i.prototype),"fromJSON",this).call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}]),i}(function(t){function i(){var t;return e(this,i),(t=ev(this,i)).type="CurvePath",t.curves=[],t.autoClose=!1,t}return e_(i,t),n(i,[{key:"add",value:function(e){this.curves.push(e)}},{key:"closePath",value:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){var n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new iY[n](t,e))}return this}},{key:"getPoint",value:function(e,t){for(var n=e*this.getLength(),i=this.getCurveLengths(),r=0;r<i.length;){if(i[r]>=n){var a=i[r]-n,o=this.curves[r],s=o.getLength(),l=0===s?0:1-a/s;return o.getPointAt(l,t)}r++}return null}},{key:"getLength",value:function(){var e=this.getCurveLengths();return e[e.length-1]}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}},{key:"getCurveLengths",value:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,i=this.curves.length;n<i;n++)e.push(t+=this.curves[n].getLength());return this.cacheLengths=e,e}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}},{key:"getPoints",value:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],i=0,r=this.curves;i<r.length;i++)for(var a=r[i],o=a.isEllipseCurve?2*t:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,s=a.getPoints(o),l=0;l<s.length;l++){var u=s[l];e&&e.equals(u)||(n.push(u),e=u)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}},{key:"copy",value:function(e){em(ep(i.prototype),"copy",this).call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}},{key:"toJSON",value:function(){var e=em(ep(i.prototype),"toJSON",this).call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e}},{key:"fromJSON",value:function(e){em(ep(i.prototype),"fromJSON",this).call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push(new iY[r.type]().fromJSON(r))}return this}}]),i}(iA)),iZ=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e(this,i),(t=ev(this,i)).type="PolyhedronGeometry",t.parameters={vertices:n,indices:r,radius:a,detail:o};var s=[],l=[];function u(e){s.push(e.x,e.y,e.z)}function c(e,t){var i=3*e;t.x=n[i+0],t.y=n[i+1],t.z=n[i+2]}function h(e,t,n,i){i<0&&1===e.x&&(l[t]=e.x-1),0===n.x&&0===n.z&&(l[t]=i/2/Math.PI+.5)}function d(e){return Math.atan2(e.z,-e.x)}return function(e){for(var t=new tn,n=new tn,i=new tn,a=0;a<r.length;a+=3)c(r[a+0],t),c(r[a+1],n),c(r[a+2],i),function(e,t,n,i){for(var r=i+1,a=[],o=0;o<=r;o++){a[o]=[];for(var s=e.clone().lerp(n,o/r),l=t.clone().lerp(n,o/r),c=r-o,h=0;h<=c;h++)0===h&&o===r?a[o][h]=s:a[o][h]=s.clone().lerp(l,h/c)}for(var d=0;d<r;d++)for(var p=0;p<2*(r-d)-1;p++){var f=Math.floor(p/2);p%2==0?(u(a[d][f+1]),u(a[d+1][f]),u(a[d][f])):(u(a[d][f+1]),u(a[d+1][f+1]),u(a[d+1][f]))}}(t,n,i,e)}(o),function(e){for(var t=new tn,n=0;n<s.length;n+=3)t.x=s[n+0],t.y=s[n+1],t.z=s[n+2],t.normalize().multiplyScalar(e),s[n+0]=t.x,s[n+1]=t.y,s[n+2]=t.z}(a),function(){for(var e=new tn,t=0;t<s.length;t+=3){e.x=s[t+0],e.y=s[t+1],e.z=s[t+2];var n,i=d(e)/2/Math.PI+.5,r=Math.atan2(-(n=e).y,Math.sqrt(n.x*n.x+n.z*n.z))/Math.PI+.5;l.push(i,1-r)}(function(){for(var e=new tn,t=new tn,n=new tn,i=new tn,r=new eG,a=new eG,o=new eG,u=0,c=0;u<s.length;u+=9,c+=6){e.set(s[u+0],s[u+1],s[u+2]),t.set(s[u+3],s[u+4],s[u+5]),n.set(s[u+6],s[u+7],s[u+8]),r.set(l[c+0],l[c+1]),a.set(l[c+2],l[c+3]),o.set(l[c+4],l[c+5]),i.copy(e).add(t).add(n).divideScalar(3);var p=d(i);h(r,c+0,e,p),h(a,c+2,t,p),h(o,c+4,n,p)}})(),function(){for(var e=0;e<l.length;e+=6){var t=l[e+0],n=l[e+2],i=l[e+4],r=Math.max(t,n,i),a=Math.min(t,n,i);r>.9&&a<.1&&(t<.2&&(l[e+0]+=1),n<.2&&(l[e+2]+=1),i<.2&&(l[e+4]+=1))}}()}(),t.setAttribute("position",new nE(s,3)),t.setAttribute("normal",new nE(s.slice(),3)),t.setAttribute("uv",new nE(l,2)),0===o?t.computeVertexNormals():t.normalizeNormals(),t}return e_(i,t),n(i,[{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new i(e.vertices,e.indices,e.radius,e.details)}}]),i}(nL),iJ=new tn,iQ=new tn,i$=new tn,i0=new nu,i1=function(t){function i(t){var n;return e(this,i),(n=ev(this,i,[t])).uuid=eI(),n.type="Shape",n.holes=[],n}return e_(i,t),n(i,[{key:"getPointsHoles",value:function(e){for(var t=[],n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}},{key:"extractPoints",value:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}},{key:"copy",value:function(e){em(ep(i.prototype),"copy",this).call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push(r.clone())}return this}},{key:"toJSON",value:function(){var e=em(ep(i.prototype),"toJSON",this).call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e}},{key:"fromJSON",value:function(e){em(ep(i.prototype),"fromJSON",this).call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push(new iK().fromJSON(r))}return this}}]),i}(iK),i2=function(e,t){var n,i,r,a,o,s,l,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,c=t&&t.length,h=c?t[0]*u:e.length,d=i3(e,0,h,u,!0),p=[];if(!d||d.next===d.prev)return p;if(c&&(d=function(e,t,n,i){var r,a,o,s,l,u=[];for(r=0,a=t.length;r<a;r++)o=t[r]*i,s=r<a-1?t[r+1]*i:e.length,(l=i3(e,o,s,i,!1))===l.next&&(l.steiner=!0),u.push(function(e){var t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e)return n}(l));for(u.sort(i5),r=0;r<u.length;r++)n=function(e,t){var n=function(e,t){var n,i,r,a=t,o=-1/0,s=e.x,l=e.y;do{if(l<=a.y&&l>=a.next.y&&a.next.y!==a.y){var u=a.x+(l-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(u<=s&&u>o&&(o=u,r=a.x<a.next.x?a:a.next,u===s))return r}a=a.next}while(a!==t)if(!r)return null;var c,h=r,d=r.x,p=r.y,f=1/0;a=r;do{s>=a.x&&a.x>=d&&s!==a.x&&i8(l<p?s:o,l,d,p,l<p?o:s,l,a.x,a.y)&&(c=Math.abs(l-a.y)/(s-a.x),ri(a,e)&&(c<f||c===f&&(a.x>r.x||a.x===r.x&&(n=r,i=a,0>i9(n.prev,n,i.prev)&&0>i9(i.next,n,n.next))))&&(r=a,f=c)),a=a.next}while(a!==h)return r}(e,t);if(!n)return t;var i=rr(n,e);return i4(i,i.next),i4(n,n.next)}(u[r],n);return n}(e,t,d,u)),e.length>80*u){n=r=e[0],i=a=e[1];for(var f=u;f<h;f+=u)o=e[f],s=e[f+1],o<n&&(n=o),s<i&&(i=s),o>r&&(r=o),s>a&&(a=s);l=0!==(l=Math.max(r-n,a-i))?32767/l:0}return function e(t,n,i,r,a,o,s){if(t){!s&&o&&function(e,t,n,i){var r=e;do 0===r.z&&(r.z=i6(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e)r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,a,o,s,l,u=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,i=n,s=0,t=0;t<u&&(s++,i=i.nextZ);t++);for(l=u;s>0||l>0&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,l--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;n=i}a.nextZ=null,u*=2}while(o>1)}(r)}(t,r,a,o);for(var l,u,c=t;t.prev!==t.next;){if(l=t.prev,u=t.next,o?function(e,t,n,i){var r=e.prev,a=e.next;if(i9(r,e,a)>=0)return!1;for(var o=r.x,s=e.x,l=a.x,u=r.y,c=e.y,h=a.y,d=o<s?o<l?o:l:s<l?s:l,p=u<c?u<h?u:h:c<h?c:h,f=o>s?o>l?o:l:s>l?s:l,v=u>c?u>h?u:h:c>h?c:h,m=i6(d,p,t,n,i),g=i6(f,v,t,n,i),_=e.prevZ,y=e.nextZ;_&&_.z>=m&&y&&y.z<=g;){if(_.x>=d&&_.x<=f&&_.y>=p&&_.y<=v&&_!==r&&_!==a&&i8(o,u,s,c,l,h,_.x,_.y)&&i9(_.prev,_,_.next)>=0||(_=_.prevZ,y.x>=d&&y.x<=f&&y.y>=p&&y.y<=v&&y!==r&&y!==a&&i8(o,u,s,c,l,h,y.x,y.y)&&i9(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;_&&_.z>=m;){if(_.x>=d&&_.x<=f&&_.y>=p&&_.y<=v&&_!==r&&_!==a&&i8(o,u,s,c,l,h,_.x,_.y)&&i9(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;y&&y.z<=g;){if(y.x>=d&&y.x<=f&&y.y>=p&&y.y<=v&&y!==r&&y!==a&&i8(o,u,s,c,l,h,y.x,y.y)&&i9(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}(t,r,a,o):function(e){var t=e.prev,n=e.next;if(i9(t,e,n)>=0)return!1;for(var i=t.x,r=e.x,a=n.x,o=t.y,s=e.y,l=n.y,u=i<r?i<a?i:a:r<a?r:a,c=o<s?o<l?o:l:s<l?s:l,h=i>r?i>a?i:a:r>a?r:a,d=o>s?o>l?o:l:s>l?s:l,p=n.next;p!==t;){if(p.x>=u&&p.x<=h&&p.y>=c&&p.y<=d&&i8(i,o,r,s,a,l,p.x,p.y)&&i9(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}(t)){n.push(l.i/i|0),n.push(t.i/i|0),n.push(u.i/i|0),ro(t),t=u.next,c=u.next;continue}if((t=u)===c){s?1===s?e(t=function(e,t,n){var i=e;do{var r=i.prev,a=i.next.next;!i7(r,a)&&re(r,i,i.next,a)&&ri(r,a)&&ri(a,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(a.i/n|0),ro(i),ro(i.next),i=e=a),i=i.next}while(i!==e)return i4(i)}(i4(t),n,i),n,i,r,a,o,2):2===s&&function(t,n,i,r,a,o){var s=t;do{for(var l,u,c=s.next.next;c!==s.prev;){if(s.i!==c.i&&(l=s,u=c,l.next.i!==u.i&&l.prev.i!==u.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&re(n,n.next,e,t))return!0;n=n.next}while(n!==e)return!1}(l,u)&&(ri(l,u)&&ri(u,l)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==e)return i}(l,u)&&(i9(l.prev,l,u.prev)||i9(l,u.prev,u))||i7(l,u)&&i9(l.prev,l,l.next)>0&&i9(u.prev,u,u.next)>0))){var h=rr(s,c);s=i4(s,s.next),h=i4(h,h.next),e(s,n,i,r,a,o,0),e(h,n,i,r,a,o,0);return}c=c.next}s=s.next}while(s!==t)}(t,n,i,r,a,o):e(i4(t),n,i,r,a,o,1);break}}}}(d,p,u,n,i,l,0),p};function i3(e,t,n,i,r){var a,o;if(r===function(e,t,n,i){for(var r=0,a=t,o=n-i;a<n;a+=i)r+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return r}(e,t,n,i)>0)for(a=t;a<n;a+=i)o=ra(a,e[a],e[a+1],o);else for(a=n-i;a>=t;a-=i)o=ra(a,e[a],e[a+1],o);return o&&i7(o,o.next)&&(ro(o),o=o.next),o}function i4(e,t){if(!e)return e;t||(t=e);var n,i=e;do if(n=!1,!i.steiner&&(i7(i,i.next)||0===i9(i.prev,i,i.next))){if(ro(i),(i=t=i.prev)===i.next)break;n=!0}else i=i.next;while(n||i!==t)return t}function i5(e,t){return e.x-t.x}function i6(e,t,n,i,r){return(e=((e=((e=((e=((e=(e-n)*r|0)|e<<8)&0xff00ff)|e<<4)&0xf0f0f0f)|e<<2)&0x33333333)|e<<1)&0x55555555)|(t=((t=((t=((t=((t=(t-i)*r|0)|t<<8)&0xff00ff)|t<<4)&0xf0f0f0f)|t<<2)&0x33333333)|t<<1)&0x55555555)<<1}function i8(e,t,n,i,r,a,o,s){return(r-o)*(t-s)>=(e-o)*(a-s)&&(e-o)*(i-s)>=(n-o)*(t-s)&&(n-o)*(a-s)>=(r-o)*(i-s)}function i9(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function i7(e,t){return e.x===t.x&&e.y===t.y}function re(e,t,n,i){var r=rn(i9(e,t,n)),a=rn(i9(e,t,i)),o=rn(i9(n,i,e)),s=rn(i9(n,i,t));return!!(r!==a&&o!==s||0===r&&rt(e,n,t)||0===a&&rt(e,i,t)||0===o&&rt(n,e,i)||0===s&&rt(n,t,i))}function rt(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function rn(e){return e>0?1:e<0?-1:0}function ri(e,t){return 0>i9(e.prev,e,e.next)?i9(e,t,e.next)>=0&&i9(e,e.prev,t)>=0:0>i9(e,t,e.prev)||0>i9(e,e.next,t)}function rr(e,t){var n=new rs(e.i,e.x,e.y),i=new rs(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function ra(e,t,n,i){var r=new rs(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function ro(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function rs(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}var rl=function(){function t(){e(this,t)}return n(t,null,[{key:"area",value:function(e){for(var t=e.length,n=0,i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return .5*n}},{key:"isClockWise",value:function(e){return 0>t.area(e)}},{key:"triangulateShape",value:function(e,t){var n=[],i=[],r=[];ru(e),rc(n,e);var a=e.length;t.forEach(ru);for(var o=0;o<t.length;o++)i.push(a),a+=t[o].length,rc(n,t[o]);for(var s=i2(n,i),l=0;l<s.length;l+=3)r.push(s.slice(l,l+3));return r}}]),t}();function ru(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function rc(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var rh={generateTopUV:function(e,t,n,i,r){var a=t[3*n],o=t[3*n+1],s=t[3*i],l=t[3*i+1],u=t[3*r],c=t[3*r+1];return[new eG(a,o),new eG(s,l),new eG(u,c)]},generateSideWallUV:function(e,t,n,i,r,a){var o=t[3*n],s=t[3*n+1],l=t[3*n+2],u=t[3*i],c=t[3*i+1],h=t[3*i+2],d=t[3*r],p=t[3*r+1],f=t[3*r+2],v=t[3*a],m=t[3*a+1],g=t[3*a+2];return Math.abs(s-c)<Math.abs(o-u)?[new eG(o,1-l),new eG(u,1-h),new eG(d,1-f),new eG(v,1-g)]:[new eG(s,1-l),new eG(c,1-h),new eG(p,1-f),new eG(m,1-g)]}},rd=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e(this,i),(t=ev(this,i)).type="PlaneGeometry",t.parameters={width:n,height:r,widthSegments:a,heightSegments:o};for(var s=n/2,l=r/2,u=Math.floor(a),c=Math.floor(o),h=u+1,d=c+1,p=n/u,f=r/c,v=[],m=[],g=[],_=[],y=0;y<d;y++)for(var x=y*f-l,b=0;b<h;b++){var w=b*p-s;m.push(w,-x,0),g.push(0,0,1),_.push(b/u),_.push(1-y/c)}for(var S=0;S<c;S++)for(var M=0;M<u;M++){var E=M+h*S,T=M+h*(S+1),C=M+1+h*(S+1),k=M+1+h*S;v.push(E,T,k),v.push(T,C,k)}return t.setIndex(v),t.setAttribute("position",new nE(m,3)),t.setAttribute("normal",new nE(g,3)),t.setAttribute("uv",new nE(_,2)),t}return e_(i,t),n(i,[{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.parameters=Object.assign({},e.parameters),this}}],[{key:"fromJSON",value:function(e){return new i(e.width,e.height,e.widthSegments,e.heightSegments)}}]),i}(nL),rp=function(t){function n(t){var i;return e(this,n),(i=ev(this,n,[t])).isRawShaderMaterial=!0,i.type="RawShaderMaterial",i}return e_(n,t),n}(nQ),rf=function(t){function i(t){var n;return e(this,i),(n=ev(this,i)).isMeshDepthMaterial=!0,n.type="MeshDepthMaterial",n.depthPacking=3200,n.map=null,n.alphaMap=null,n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.wireframe=!1,n.wireframeLinewidth=1,n.setValues(t),n}return e_(i,t),n(i,[{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}]),i}(ng),rv=function(t){function i(t){var n;return e(this,i),(n=ev(this,i)).isMeshDistanceMaterial=!0,n.type="MeshDistanceMaterial",n.map=null,n.alphaMap=null,n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.setValues(t),n}return e_(i,t),n(i,[{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}]),i}(ng);function rm(e,t,n){return e&&(n||e.constructor!==t)?"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e}var rg=function(){function t(n,i,r,a){e(this,t),this.parameterPositions=n,this._cachedIndex=0,this.resultBuffer=void 0!==a?a:new i.constructor(r),this.sampleValues=i,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}return n(t,[{key:"evaluate",value:function(e){var t,n=this.parameterPositions,i=this._cachedIndex,r=n[i],a=n[i-1];e:{t:{n:{i:if(!(e<r)){for(var o=i+2;;){if(void 0===r){if(e<a)break i;return i=n.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===o)break;if(a=r,e<(r=n[++i]))break t}t=n.length;break n}if(!(e>=a)){var s=n[1];e<s&&(i=2,a=s);for(var l=i-2;;){if(void 0===a)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(r=a,e>=(a=n[--i-1]))break t}t=i,i=0;break n}break e}for(;i<t;){var u=i+t>>>1;e<n[u]?t=u:i=u+1}if(r=n[i],void 0===(a=n[i-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return i=n.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,a,r)}return this.interpolate_(i,a,e,r)}},{key:"getSettings_",value:function(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i,a=0;a!==i;++a)t[a]=n[r+a];return t}},{key:"interpolate_",value:function(){throw Error("call to abstract method")}},{key:"intervalChanged_",value:function(){}}]),t}(),r_=function(t){function i(t,n,r,a){var o;return e(this,i),(o=ev(this,i,[t,n,r,a]))._weightPrev=-0,o._offsetPrev=-0,o._weightNext=-0,o._offsetNext=-0,o.DefaultSettings_={endingStart:2400,endingEnd:2400},o}return e_(i,t),n(i,[{key:"intervalChanged_",value:function(e,t,n){var i=this.parameterPositions,r=e-2,a=e+1,o=i[r],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:r=e,o=2*t-n;break;case 2402:r=i.length-2,o=t+i[r]-i[r+1];break;default:r=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:a=e,s=2*n-t;break;case 2402:a=1,s=n+i[1]-i[0];break;default:a=e-1,s=t}var l=(n-t)*.5,u=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-n),this._offsetPrev=r*u,this._offsetNext=a*u}},{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),f=p*p,v=f*p,m=-h*v+2*h*f-h*p,g=(1+h)*v+(-1.5-2*h)*f+(-.5+h)*p+1,_=(-1-d)*v+(1.5+d)*f+.5*p,y=d*v-d*f,x=0;x!==o;++x)r[x]=m*a[u+x]+g*a[l+x]+_*a[s+x]+y*a[c+x];return r}}]),i}(rg),ry=function(t){function i(t,n,r,a){return e(this,i),ev(this,i,[t,n,r,a])}return e_(i,t),n(i,[{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=(n-t)/(i-t),c=1-u,h=0;h!==o;++h)r[h]=a[l+h]*c+a[s+h]*u;return r}}]),i}(rg),rx=function(t){function i(t,n,r,a){return e(this,i),ev(this,i,[t,n,r,a])}return e_(i,t),n(i,[{key:"interpolate_",value:function(e){return this.copySampleValue_(e-1)}}]),i}(rg),rb=function(){function t(n,i,r,a){if(e(this,t),void 0===n)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===i||0===i.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+n);this.name=n,this.times=rm(i,this.TimeBufferType),this.values=rm(r,this.ValueBufferType),this.setInterpolation(a||this.DefaultInterpolation)}return n(t,[{key:"InterpolantFactoryMethodDiscrete",value:function(e){return new rx(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodLinear",value:function(e){return new ry(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodSmooth",value:function(e){return new r_(this.times,this.values,this.getValueSize(),e)}},{key:"setInterpolation",value:function(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(n)}return this}return this.createInterpolant=t,this}},{key:"getInterpolation",value:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}},{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"shift",value:function(e){if(0!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]+=e;return this}},{key:"scale",value:function(e){if(1!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]*=e;return this}},{key:"trim",value:function(e,t){for(var n=this.times,i=n.length,r=0,a=i-1;r!==i&&n[r]<e;)++r;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==r||a!==i){r>=a&&(r=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=n.slice(r,a),this.values=this.values.slice(r*o,a*o)}return this}},{key:"validate",value:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(e=!1);var n=this.times,i=this.values,r=n.length;0===r&&(e=!1);for(var a=null,o=0;o!==r;o++){var s=n[o];if("number"==typeof s&&isNaN(s)||null!==a&&a>s){e=!1;break}a=s}if(void 0!==i&&ArrayBuffer.isView(i)&&!(i instanceof DataView)){for(var l=0,u=i.length;l!==u;++l)if(isNaN(i[l])){e=!1;break}}return e}},{key:"optimize",value:function(){for(var e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),i=2302===this.getInterpolation(),r=e.length-1,a=1,o=1;o<r;++o){var s=!1,l=e[o];if(l!==e[o+1]&&(1!==o||l!==e[0])){if(i)s=!0;else for(var u=o*n,c=u-n,h=u+n,d=0;d!==n;++d){var p=t[u+d];if(p!==t[c+d]||p!==t[h+d]){s=!0;break}}}if(s){if(o!==a){e[a]=e[o];for(var f=o*n,v=a*n,m=0;m!==n;++m)t[v+m]=t[f+m]}++a}}if(r>0){e[a]=e[r];for(var g=r*n,_=a*n,y=0;y!==n;++y)t[_+y]=t[g+y];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*n)):(this.times=e,this.values=t),this}},{key:"clone",value:function(){var e=this.times.slice(),t=this.values.slice(),n=new this.constructor(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}],[{key:"toJSON",value:function(e){var t,n=e.constructor;if(n.toJSON!==this.toJSON)t=n.toJSON(e);else{t={name:e.name,times:rm(e.times,Array),values:rm(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}]),t}();rb.prototype.TimeBufferType=Float32Array,rb.prototype.ValueBufferType=Float32Array,rb.prototype.DefaultInterpolation=2301;var rw=function(t){function n(t,i,r){return e(this,n),ev(this,n,[t,i,r])}return e_(n,t),n}(rb);rw.prototype.ValueTypeName="bool",rw.prototype.ValueBufferType=Array,rw.prototype.DefaultInterpolation=2300,rw.prototype.InterpolantFactoryMethodLinear=void 0,rw.prototype.InterpolantFactoryMethodSmooth=void 0,function(t){function n(){return e(this,n),ev(this,n,arguments)}return e_(n,t),n}(rb).prototype.ValueTypeName="color",function(t){function n(){return e(this,n),ev(this,n,arguments)}return e_(n,t),n}(rb).prototype.ValueTypeName="number";var rS=function(t){function i(t,n,r,a){return e(this,i),ev(this,i,[t,n,r,a])}return e_(i,t),n(i,[{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(i-t),l=e*o,u=l+o;l!==u;l+=4)tt.slerpFlat(r,0,a,l-o,a,l,s);return r}}]),i}(rg),rM=function(t){function i(){return e(this,i),ev(this,i,arguments)}return e_(i,t),n(i,[{key:"InterpolantFactoryMethodLinear",value:function(e){return new rS(this.times,this.values,this.getValueSize(),e)}}]),i}(rb);rM.prototype.ValueTypeName="quaternion",rM.prototype.InterpolantFactoryMethodSmooth=void 0;var rE=function(t){function n(t,i,r){return e(this,n),ev(this,n,[t,i,r])}return e_(n,t),n}(rb);rE.prototype.ValueTypeName="string",rE.prototype.ValueBufferType=Array,rE.prototype.DefaultInterpolation=2300,rE.prototype.InterpolantFactoryMethodLinear=void 0,rE.prototype.InterpolantFactoryMethodSmooth=void 0,function(t){function n(){return e(this,n),ev(this,n,arguments)}return e_(n,t),n}(rb).prototype.ValueTypeName="vector";var rT={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},rC=new function t(n,i,r){e(this,t);var a=this,o=!1,s=0,l=0,u=void 0,c=[];this.onStart=void 0,this.onLoad=n,this.onProgress=i,this.onError=r,this.itemStart=function(e){l++,!1===o&&void 0!==a.onStart&&a.onStart(e,s,l),o=!0},this.itemEnd=function(e){s++,void 0!==a.onProgress&&a.onProgress(e,s,l),s===l&&(o=!1,void 0!==a.onLoad&&a.onLoad())},this.itemError=function(e){void 0!==a.onError&&a.onError(e)},this.resolveURL=function(e){return u?u(e):e},this.setURLModifier=function(e){return u=e,this},this.addHandler=function(e,t){return c.push(e,t),this},this.removeHandler=function(e){var t=c.indexOf(e);return -1!==t&&c.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=c.length;t<n;t+=2){var i=c[t],r=c[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return r}return null}},rk=function(){function t(n){e(this,t),this.manager=void 0!==n?n:rC,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}return n(t,[{key:"load",value:function(){}},{key:"loadAsync",value:function(e,t){var n=this;return new Promise(function(i,r){n.load(e,i,t,r)})}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setWithCredentials",value:function(e){return this.withCredentials=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setRequestHeader",value:function(e){return this.requestHeader=e,this}}]),t}();rk.DEFAULT_MATERIAL_NAME="__DEFAULT";var rA={},rP=function(t){function n(t,i){var r;return e(this,n),(r=ev(this,n,[t])).response=i,r}return e_(n,t),n}(eM(Error)),rR=function(t){function i(t){return e(this,i),ev(this,i,[t])}return e_(i,t),n(i,[{key:"load",value:function(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=rT.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a;var o=eq("img");function s(){u(),rT.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){u(),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}function u(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o}}]),i}(rk),rU=function(t){function i(t){return e(this,i),ev(this,i,[t])}return e_(i,t),n(i,[{key:"load",value:function(e,t,n,i){var r=new e6,a=new rR(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)},n,i),r}}]),i}(rk),rL=new tU,rD=new tn,rI=new tn,rN=function(){function t(n){e(this,t),this.camera=n,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new eG(512,512),this.map=null,this.mapPass=null,this.matrix=new tU,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ip,this._frameExtents=new eG(1,1),this._viewportCount=1,this._viewports=[new e8(0,0,1,1)]}return n(t,[{key:"getViewportCount",value:function(){return this._viewportCount}},{key:"getFrustum",value:function(){return this._frustum}},{key:"updateMatrices",value:function(e){var t=this.camera,n=this.matrix;rD.setFromMatrixPosition(e.matrixWorld),t.position.copy(rD),rI.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(rI),t.updateMatrixWorld(),rL.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(rL),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(rL)}},{key:"getViewport",value:function(e){return this._viewports[e]}},{key:"getFrameExtents",value:function(){return this._frameExtents}},{key:"dispose",value:function(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}},{key:"copy",value:function(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"toJSON",value:function(){var e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}]),t}(),rO=new tU,rF=new tn,rB=new tn,rV=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;return e(this,i),(t=ev(this,i)).isOrthographicCamera=!0,t.type="OrthographicCamera",t.zoom=1,t.view=null,t.left=n,t.right=r,t.top=a,t.bottom=o,t.near=s,t.far=l,t.updateProjectionMatrix(),t}return e_(i,t),n(i,[{key:"copy",value:function(e,t){return em(ep(i.prototype),"copy",this).call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}},{key:"setViewOffset",value:function(e,t,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-e,a=n+e,o=i+t,s=i-t;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=l*this.view.offsetX,a=r+l*this.view.width,o-=u*this.view.offsetY,s=o-u*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,s,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=em(ep(i.prototype),"toJSON",this).call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}]),i}(n$),rz=function(t){function i(){var t;return e(this,i),(t=ev(this,i)).isInstancedBufferGeometry=!0,t.type="InstancedBufferGeometry",t.instanceCount=1/0,t}return e_(i,t),n(i,[{key:"copy",value:function(e){return em(ep(i.prototype),"copy",this).call(this,e),this.instanceCount=e.instanceCount,this}},{key:"toJSON",value:function(){var e=em(ep(i.prototype),"toJSON",this).call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}]),i}(nL),rG=function(t){function n(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e(this,n),(t=ev(this,n)).isArrayCamera=!0,t.cameras=i,t.index=0,t}return e_(n,t),n}(n3),rH=function(){function t(){var n=!(arguments.length>0)||void 0===arguments[0]||arguments[0];e(this,t),this.autoStart=n,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return n(t,[{key:"start",value:function(){this.startTime=rW(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=rW();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),t}();function rW(){return performance.now()}var rj=function(t){function i(t){var n;return e(this,i),(n=ev(this,i)).type="Audio",n.listener=t,n.context=t.context,n.gain=n.context.createGain(),n.gain.connect(t.getInput()),n.autoplay=!1,n.buffer=null,n.detune=0,n.loop=!1,n.loopStart=0,n.loopEnd=0,n.offset=0,n.duration=void 0,n.playbackRate=1,n.isPlaying=!1,n.hasPlaybackControl=!0,n.source=null,n.sourceType="empty",n._startedAt=0,n._progress=0,n._connected=!1,n.filters=[],n}return e_(i,t),n(i,[{key:"getOutput",value:function(){return this.gain}},{key:"setNodeSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}},{key:"setMediaElementSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}},{key:"setMediaStreamSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}},{key:"setBuffer",value:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}},{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0!==this.isPlaying&&!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}}},{key:"pause",value:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}},{key:"stop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}},{key:"connect",value:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}},{key:"disconnect",value:function(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}},{key:"getFilters",value:function(){return this.filters}},{key:"setFilters",value:function(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}},{key:"setDetune",value:function(e){return this.detune=e,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}},{key:"getDetune",value:function(){return this.detune}},{key:"getFilter",value:function(){return this.getFilters()[0]}},{key:"setFilter",value:function(e){return this.setFilters(e?[e]:[])}},{key:"setPlaybackRate",value:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"onEnded",value:function(){this.isPlaying=!1,this._progress=0}},{key:"getLoop",value:function(){return!1!==this.hasPlaybackControl&&this.loop}},{key:"setLoop",value:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this}},{key:"setLoopStart",value:function(e){return this.loopStart=e,this}},{key:"setLoopEnd",value:function(e){return this.loopEnd=e,this}},{key:"getVolume",value:function(){return this.gain.gain.value}},{key:"setVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}},{key:"copy",value:function(e,t){return em(ep(i.prototype),"copy",this).call(this,e,t),"buffer"!==e.sourceType||(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice()),this}},{key:"clone",value:function(e){return new this.constructor(this.listener).copy(this,e)}}]),i}(t5);eM(rj);var rX="\\[\\]\\.:\\/",rq=RegExp("["+rX+"]","g"),rY="[^"+rX+"]",rK="[^"+rX.replace("\\.","")+"]",rZ=RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",rY)+/(WCOD+)?/.source.replace("WCOD",rK)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",rY)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",rY)+"$"),rJ=["material","materials","bones","map"],rQ=function(){function t(n,i,r){e(this,t);var a=r||r$.parseTrackName(i);this._targetGroup=n,this._bindings=n.subscribe_(i,a)}return n(t,[{key:"getValue",value:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}},{key:"setValue",value:function(e,t){for(var n=this._bindings,i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}},{key:"bind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}},{key:"unbind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}]),t}(),r$=function(){function t(n,i,r){e(this,t),this.path=i,this.parsedPath=r||t.parseTrackName(i),this.node=t.findNode(n,this.parsedPath.nodeName),this.rootNode=n,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}return n(t,[{key:"_getValue_unavailable",value:function(){}},{key:"_setValue_unavailable",value:function(){}},{key:"_getValue_direct",value:function(e,t){e[t]=this.targetObject[this.propertyName]}},{key:"_getValue_array",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)e[t++]=n[i]}},{key:"_getValue_arrayElement",value:function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function(e,t){this.resolvedProperty.toArray(e,t)}},{key:"_setValue_direct",value:function(e,t){this.targetObject[this.propertyName]=e[t]}},{key:"_setValue_direct_setNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++]}},{key:"_setValue_array_setNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function(e,t){this.resolvedProperty.fromArray(e,t)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function(e,t){this.bind(),this.getValue(e,t)}},{key:"_setValue_unbound",value:function(e,t){this.bind(),this.setValue(e,t)}},{key:"bind",value:function(){var e=this.node,n=this.parsedPath,i=n.objectName,r=n.propertyName,a=n.propertyIndex;if(e||(e=t.findNode(this.rootNode,n.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(i){var o=n.objectIndex;switch(i){case"materials":if(!e.material||!e.material.materials)return;e=e.material.materials;break;case"bones":if(!e.skeleton)return;e=e.skeleton.bones;for(var s=0;s<e.length;s++)if(e[s].name===o){o=s;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material||!e.material.map)return;e=e.material.map;break;default:if(void 0===e[i])return;e=e[i]}if(void 0!==o){if(void 0===e[o])return;e=e[o]}}var l=e[r];if(void 0===l){n.nodeName;return}var u=this.Versioning.None;this.targetObject=e,!0===e.isMaterial?u=this.Versioning.NeedsUpdate:!0===e.isObject3D&&(u=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===r){if(!e.geometry||!e.geometry.morphAttributes)return;void 0!==e.morphTargetDictionary[a]&&(a=e.morphTargetDictionary[a])}c=this.BindingType.ArrayElement,this.resolvedProperty=l,this.propertyIndex=a}else void 0!==l.fromArray&&void 0!==l.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=l):Array.isArray(l)?(c=this.BindingType.EntireArray,this.resolvedProperty=l):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][u]}}},{key:"unbind",value:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}],[{key:"create",value:function(e,n,i){return e&&e.isAnimationObjectGroup?new t.Composite(e,n,i):new t(e,n,i)}},{key:"sanitizeNodeName",value:function(e){return e.replace(/\s/g,"_").replace(rq,"")}},{key:"parseTrackName",value:function(e){var t=rZ.exec(e);if(null===t)throw Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var r=n.nodeName.substring(i+1);-1!==rJ.indexOf(r)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(null===n.propertyName||0===n.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}},{key:"findNode",value:function(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var i=function(e){for(var n=0;n<e.length;n++){var r=e[n];if(r.name===t||r.uuid===t)return r;var a=i(r.children);if(a)return a}return null},r=i(e.children);if(r)return r}return null}}]),t}();function r0(e,t,n,i){var r=function(e){switch(e){case 1009:case 1010:return{byteLength:1,components:1};case 1012:case 1011:case 1016:return{byteLength:2,components:1};case 1017:case 1018:return{byteLength:2,components:4};case 1014:case 1013:case 1015:return{byteLength:4,components:1};case 35902:return{byteLength:4,components:3}}throw Error("Unknown texture type ".concat(e,"."))}(i);switch(n){case 1021:case 1024:return e*t;case 1025:return e*t*2;case 1028:case 1029:return e*t/r.components*r.byteLength;case 1030:case 1031:return e*t*2/r.components*r.byteLength;case 1022:return e*t*3/r.components*r.byteLength;case 1023:case 1033:return e*t*4/r.components*r.byteLength;case 33776:case 33777:case 36196:case 37492:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case 33778:case 33779:case 37496:case 37808:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case 35841:case 35843:return Math.max(e,16)*Math.max(t,8)/4;case 35840:case 35842:return Math.max(e,8)*Math.max(t,8)/2;case 37809:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case 37810:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case 37811:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case 37812:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case 37813:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case 37814:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case 37815:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case 37816:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case 37817:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case 37818:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case 37819:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case 37820:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case 37821:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case 36492:case 36494:case 36495:case 36285:case 36286:return Math.ceil(e/4)*Math.ceil(t/4)*16;case 36283:case 36284:return Math.ceil(e/4)*Math.ceil(t/4)*8}throw Error("Unable to determine texture byte length for ".concat(n," format."))}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function r1(){var e=null,t=!1,n=null,i=null;function r(t,a){n(t,a),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function r2(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);var i=t.get(n);i&&(e.deleteBuffer(i.buffer),t.delete(n))},update:function(n,i){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){var r=t.get(n);(!r||r.version<n.version)&&t.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version});return}var a=t.get(n);if(void 0===a)t.set(n,function(t,n){var i,r=t.array,a=t.usage,o=r.byteLength,s=e.createBuffer();if(e.bindBuffer(n,s),e.bufferData(n,r,a),t.onUploadCallback(),r instanceof Float32Array)i=e.FLOAT;else if(r instanceof Uint16Array)i=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(r instanceof Int16Array)i=e.SHORT;else if(r instanceof Uint32Array)i=e.UNSIGNED_INT;else if(r instanceof Int32Array)i=e.INT;else if(r instanceof Int8Array)i=e.BYTE;else if(r instanceof Uint8Array)i=e.UNSIGNED_BYTE;else if(r instanceof Uint8ClampedArray)i=e.UNSIGNED_BYTE;else throw Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);return{buffer:s,type:i,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version,size:o}}(n,i));else if(a.version<n.version){if(a.size!==n.array.byteLength)throw Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,i){var r=n.array,a=n.updateRanges;if(e.bindBuffer(i,t),0===a.length)e.bufferSubData(i,0,r);else{a.sort(function(e,t){return e.start-t.start});for(var o=0,s=1;s<a.length;s++){var l=a[o],u=a[s];u.start<=l.start+l.count+1?l.count=Math.max(l.count,u.start+u.count-l.start):a[++o]=u}a.length=o+1;for(var c=0,h=a.length;c<h;c++){var d=a[c];e.bufferSubData(i,d.start*r.BYTES_PER_ELEMENT,r,d.start,d.count)}n.clearUpdateRanges()}n.onUploadCallback()}(a.buffer,n,i),a.version=n.version}}}}r$.Composite=rQ,r$.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},r$.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},r$.prototype.GetterByBindingType=[r$.prototype._getValue_direct,r$.prototype._getValue_array,r$.prototype._getValue_arrayElement,r$.prototype._getValue_toArray],r$.prototype.SetterByBindingTypeAndVersioning=[[r$.prototype._setValue_direct,r$.prototype._setValue_direct_setNeedsUpdate,r$.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[r$.prototype._setValue_array,r$.prototype._setValue_array_setNeedsUpdate,r$.prototype._setValue_array_setMatrixWorldNeedsUpdate],[r$.prototype._setValue_arrayElement,r$.prototype._setValue_arrayElement_setNeedsUpdate,r$.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[r$.prototype._setValue_fromArray,r$.prototype._setValue_fromArray_setNeedsUpdate,r$.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1),"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"173"}})),"undefined"!=typeof window&&(window.__THREE__||(window.__THREE__="173"));var r3={alphahash_fragment:"#ifdef USE_ALPHAHASH\n	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n	const float ALPHA_HASH_SCALE = 0.05;\n	float hash2D( vec2 value ) {\n		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n	}\n	float hash3D( vec3 value ) {\n		return hash2D( vec2( hash2D( value.xy ), value.z ) );\n	}\n	float getAlphaHashThreshold( vec3 position ) {\n		float maxDeriv = max(\n			length( dFdx( position.xyz ) ),\n			length( dFdy( position.xyz ) )\n		);\n		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n		vec2 pixScales = vec2(\n			exp2( floor( log2( pixScale ) ) ),\n			exp2( ceil( log2( pixScale ) ) )\n		);\n		vec2 alpha = vec2(\n			hash3D( floor( pixScales.x * position.xyz ) ),\n			hash3D( floor( pixScales.y * position.xyz ) )\n		);\n		float lerpFactor = fract( log2( pixScale ) );\n		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n		float a = min( lerpFactor, 1.0 - lerpFactor );\n		vec3 cases = vec3(\n			x * x / ( 2.0 * a * ( 1.0 - a ) ),\n			( x - 0.5 * a ) / ( 1.0 - a ),\n			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n		);\n		float threshold = ( x < ( 1.0 - a ) )\n			? ( ( x < a ) ? cases.x : cases.y )\n			: cases.z;\n		return clamp( threshold , 1.0e-6, 1.0 );\n	}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n	uniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n	#ifdef ALPHA_TO_COVERAGE\n	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n	if ( diffuseColor.a == 0.0 ) discard;\n	#else\n	if ( diffuseColor.a < alphaTest ) discard;\n	#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n	uniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n	reflectedLight.indirectDiffuse *= ambientOcclusion;\n	#if defined( USE_CLEARCOAT ) \n		clearcoatSpecularIndirect *= ambientOcclusion;\n	#endif\n	#if defined( USE_SHEEN ) \n		sheenSpecularIndirect *= ambientOcclusion;\n	#endif\n	#if defined( USE_ENVMAP ) && defined( STANDARD )\n		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n	#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n	uniform sampler2D aoMap;\n	uniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n	#if ! defined( GL_ANGLE_multi_draw )\n	#define gl_DrawID _gl_DrawID\n	uniform int _gl_DrawID;\n	#endif\n	uniform highp sampler2D batchingTexture;\n	uniform highp usampler2D batchingIdTexture;\n	mat4 getBatchingMatrix( const in float i ) {\n		int size = textureSize( batchingTexture, 0 ).x;\n		int j = int( i ) * 4;\n		int x = j % size;\n		int y = j / size;\n		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n		return mat4( v1, v2, v3, v4 );\n	}\n	float getIndirectIndex( const in int i ) {\n		int size = textureSize( batchingIdTexture, 0 ).x;\n		int x = i % size;\n		int y = i / size;\n		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n	}\n#endif\n#ifdef USE_BATCHING_COLOR\n	uniform sampler2D batchingColorTexture;\n	vec3 getBatchingColor( const in float i ) {\n		int size = textureSize( batchingColorTexture, 0 ).x;\n		int j = int( i );\n		int x = j % size;\n		int y = j / size;\n		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n	}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n	vPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n	vec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n	return 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotVH = saturate( dot( viewDir, halfDir ) );\n	vec3 F = F_Schlick( specularColor, 1.0, dotVH );\n	float G = G_BlinnPhong_Implicit( );\n	float D = D_BlinnPhong( shininess, dotNH );\n	return F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n	const mat3 XYZ_TO_REC709 = mat3(\n		 3.2404542, -0.9692660,  0.0556434,\n		-1.5371385,  1.8760108, -0.2040259,\n		-0.4985314,  0.0415560,  1.0572252\n	);\n	vec3 Fresnel0ToIor( vec3 fresnel0 ) {\n		vec3 sqrtF0 = sqrt( fresnel0 );\n		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n	}\n	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n	}\n	float IorToFresnel0( float transmittedIor, float incidentIor ) {\n		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n	}\n	vec3 evalSensitivity( float OPD, vec3 shift ) {\n		float phase = 2.0 * PI * OPD * 1.0e-9;\n		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n		xyz /= 1.0685e-7;\n		vec3 rgb = XYZ_TO_REC709 * xyz;\n		return rgb;\n	}\n	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n		vec3 I;\n		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n		float cosTheta2Sq = 1.0 - sinTheta2Sq;\n		if ( cosTheta2Sq < 0.0 ) {\n			return vec3( 1.0 );\n		}\n		float cosTheta2 = sqrt( cosTheta2Sq );\n		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n		float R12 = F_Schlick( R0, 1.0, cosTheta1 );\n		float T121 = 1.0 - R12;\n		float phi12 = 0.0;\n		if ( iridescenceIOR < outsideIOR ) phi12 = PI;\n		float phi21 = PI - phi12;\n		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n		vec3 phi23 = vec3( 0.0 );\n		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n		vec3 phi = vec3( phi21 ) + phi23;\n		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n		vec3 r123 = sqrt( R123 );\n		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n		vec3 C0 = R12 + Rs;\n		I = C0;\n		vec3 Cm = Rs - T121;\n		for ( int m = 1; m <= 2; ++ m ) {\n			Cm *= r123;\n			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n			I += Cm * Sm;\n		}\n		return max( I, vec3( 0.0 ) );\n	}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n	vec2 dHdxy_fwd() {\n		vec2 dSTdx = dFdx( vBumpMapUv );\n		vec2 dSTdy = dFdy( vBumpMapUv );\n		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n		return vec2( dBx, dBy );\n	}\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n		vec3 vN = surf_norm;\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n		float fDet = dot( vSigmaX, R1 ) * faceDirection;\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n	}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n	vec4 plane;\n	#ifdef ALPHA_TO_COVERAGE\n		float distanceToPlane, distanceGradient;\n		float clipOpacity = 1.0;\n		#pragma unroll_loop_start\n		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n			plane = clippingPlanes[ i ];\n			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n			distanceGradient = fwidth( distanceToPlane ) / 2.0;\n			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n			if ( clipOpacity == 0.0 ) discard;\n		}\n		#pragma unroll_loop_end\n		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n			float unionClipOpacity = 1.0;\n			#pragma unroll_loop_start\n			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n				plane = clippingPlanes[ i ];\n				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n				distanceGradient = fwidth( distanceToPlane ) / 2.0;\n				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n			}\n			#pragma unroll_loop_end\n			clipOpacity *= 1.0 - unionClipOpacity;\n		#endif\n		diffuseColor.a *= clipOpacity;\n		if ( diffuseColor.a == 0.0 ) discard;\n	#else\n		#pragma unroll_loop_start\n		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n			plane = clippingPlanes[ i ];\n			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n		}\n		#pragma unroll_loop_end\n		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n			bool clipped = true;\n			#pragma unroll_loop_start\n			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n				plane = clippingPlanes[ i ];\n				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n			}\n			#pragma unroll_loop_end\n			if ( clipped ) discard;\n		#endif\n	#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n	varying vec3 vClipPosition;\n	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n	varying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n	vClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n	diffuseColor *= vColor;\n#elif defined( USE_COLOR )\n	diffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n	varying vec4 vColor;\n#elif defined( USE_COLOR )\n	varying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n	varying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n	varying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n	vColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n	vColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n	vColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n	vColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n	vColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n	const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n	return fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n	float precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n	float precisionSafeLength( vec3 v ) {\n		float maxComponent = max3( abs( v ) );\n		return length( v / maxComponent ) * maxComponent;\n	}\n#endif\nstruct IncidentLight {\n	vec3 color;\n	vec3 direction;\n	bool visible;\n};\nstruct ReflectedLight {\n	vec3 directDiffuse;\n	vec3 directSpecular;\n	vec3 indirectDiffuse;\n	vec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n	varying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n	mat3 tmp;\n	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n	return tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n	return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n	return vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n	return RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n	#define cubeUV_minMipLevel 4.0\n	#define cubeUV_minTileSize 16.0\n	float getFace( vec3 direction ) {\n		vec3 absDirection = abs( direction );\n		float face = - 1.0;\n		if ( absDirection.x > absDirection.z ) {\n			if ( absDirection.x > absDirection.y )\n				face = direction.x > 0.0 ? 0.0 : 3.0;\n			else\n				face = direction.y > 0.0 ? 1.0 : 4.0;\n		} else {\n			if ( absDirection.z > absDirection.y )\n				face = direction.z > 0.0 ? 2.0 : 5.0;\n			else\n				face = direction.y > 0.0 ? 1.0 : 4.0;\n		}\n		return face;\n	}\n	vec2 getUV( vec3 direction, float face ) {\n		vec2 uv;\n		if ( face == 0.0 ) {\n			uv = vec2( direction.z, direction.y ) / abs( direction.x );\n		} else if ( face == 1.0 ) {\n			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n		} else if ( face == 2.0 ) {\n			uv = vec2( - direction.x, direction.y ) / abs( direction.z );\n		} else if ( face == 3.0 ) {\n			uv = vec2( - direction.z, direction.y ) / abs( direction.x );\n		} else if ( face == 4.0 ) {\n			uv = vec2( - direction.x, direction.z ) / abs( direction.y );\n		} else {\n			uv = vec2( direction.x, direction.y ) / abs( direction.z );\n		}\n		return 0.5 * ( uv + 1.0 );\n	}\n	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n		float face = getFace( direction );\n		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n		mipInt = max( mipInt, cubeUV_minMipLevel );\n		float faceSize = exp2( mipInt );\n		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n		if ( face > 2.0 ) {\n			uv.y += faceSize;\n			face -= 3.0;\n		}\n		uv.x += face * faceSize;\n		uv.x += filterInt * 3.0 * cubeUV_minTileSize;\n		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n		uv.x *= CUBEUV_TEXEL_WIDTH;\n		uv.y *= CUBEUV_TEXEL_HEIGHT;\n		#ifdef texture2DGradEXT\n			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n		#else\n			return texture2D( envMap, uv ).rgb;\n		#endif\n	}\n	#define cubeUV_r0 1.0\n	#define cubeUV_m0 - 2.0\n	#define cubeUV_r1 0.8\n	#define cubeUV_m1 - 1.0\n	#define cubeUV_r4 0.4\n	#define cubeUV_m4 2.0\n	#define cubeUV_r5 0.305\n	#define cubeUV_m5 3.0\n	#define cubeUV_r6 0.21\n	#define cubeUV_m6 4.0\n	float roughnessToMip( float roughness ) {\n		float mip = 0.0;\n		if ( roughness >= cubeUV_r1 ) {\n			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n		} else if ( roughness >= cubeUV_r4 ) {\n			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n		} else if ( roughness >= cubeUV_r5 ) {\n			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n		} else if ( roughness >= cubeUV_r6 ) {\n			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n		} else {\n			mip = - 2.0 * log2( 1.16 * roughness );		}\n		return mip;\n	}\n	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n		float mipF = fract( mip );\n		float mipInt = floor( mip );\n		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n		if ( mipF == 0.0 ) {\n			return vec4( color0, 1.0 );\n		} else {\n			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n			return vec4( mix( color0, color1, mipF ), 1.0 );\n		}\n	}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n	vec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n	mat3 bm = mat3( batchingMatrix );\n	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n	transformedNormal = bm * transformedNormal;\n	#ifdef USE_TANGENT\n		transformedTangent = bm * transformedTangent;\n	#endif\n#endif\n#ifdef USE_INSTANCING\n	mat3 im = mat3( instanceMatrix );\n	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n	transformedNormal = im * transformedNormal;\n	#ifdef USE_TANGENT\n		transformedTangent = im * transformedTangent;\n	#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n	transformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n	#ifdef FLIP_SIDED\n		transformedTangent = - transformedTangent;\n	#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n	uniform sampler2D displacementMap;\n	uniform float displacementScale;\n	uniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n		emissiveColor = sRGBTransferEOTF( emissiveColor );\n	#endif\n	totalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n	uniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n	return value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n	#ifdef ENV_WORLDPOS\n		vec3 cameraToFrag;\n		if ( isOrthographic ) {\n			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n		} else {\n			cameraToFrag = normalize( vWorldPosition - cameraPosition );\n		}\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n		#ifdef ENVMAP_MODE_REFLECTION\n			vec3 reflectVec = reflect( cameraToFrag, worldNormal );\n		#else\n			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n		#endif\n	#else\n		vec3 reflectVec = vReflect;\n	#endif\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n	#else\n		vec4 envColor = vec4( 0.0 );\n	#endif\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n	#elif defined( ENVMAP_BLENDING_MIX )\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n	#elif defined( ENVMAP_BLENDING_ADD )\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n	#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n	uniform float envMapIntensity;\n	uniform float flipEnvMap;\n	uniform mat3 envMapRotation;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n	uniform float reflectivity;\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n		#define ENV_WORLDPOS\n	#endif\n	#ifdef ENV_WORLDPOS\n		varying vec3 vWorldPosition;\n		uniform float refractionRatio;\n	#else\n		varying vec3 vReflect;\n	#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n		#define ENV_WORLDPOS\n	#endif\n	#ifdef ENV_WORLDPOS\n		\n		varying vec3 vWorldPosition;\n	#else\n		varying vec3 vReflect;\n		uniform float refractionRatio;\n	#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n	vec3 getIBLIrradiance( const in vec3 normal ) {\n		#ifdef ENVMAP_TYPE_CUBE_UV\n			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n			return PI * envMapColor.rgb * envMapIntensity;\n		#else\n			return vec3( 0.0 );\n		#endif\n	}\n	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n		#ifdef ENVMAP_TYPE_CUBE_UV\n			vec3 reflectVec = reflect( - viewDir, normal );\n			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n			return envMapColor.rgb * envMapIntensity;\n		#else\n			return vec3( 0.0 );\n		#endif\n	}\n	#ifdef USE_ANISOTROPY\n		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n			#ifdef ENVMAP_TYPE_CUBE_UV\n				vec3 bentNormal = cross( bitangent, viewDir );\n				bentNormal = normalize( cross( bentNormal, bitangent ) );\n				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n				return getIBLRadiance( viewDir, bentNormal, roughness );\n			#else\n				return vec3( 0.0 );\n			#endif\n		}\n	#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n	#ifdef ENV_WORLDPOS\n		vWorldPosition = worldPosition.xyz;\n	#else\n		vec3 cameraToVertex;\n		if ( isOrthographic ) {\n			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n		} else {\n			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n		}\n		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n		#ifdef ENVMAP_MODE_REFLECTION\n			vReflect = reflect( cameraToVertex, worldNormal );\n		#else\n			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n		#endif\n	#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n	vFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n	varying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n	#ifdef FOG_EXP2\n		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n	#else\n		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n	#endif\n	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n	uniform vec3 fogColor;\n	varying float vFogDepth;\n	#ifdef FOG_EXP2\n		uniform float fogDensity;\n	#else\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n	uniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n	float dotNL = dot( normal, lightDirection );\n	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n	#ifdef USE_GRADIENTMAP\n		return vec3( texture2D( gradientMap, coord ).r );\n	#else\n		vec2 fw = fwidth( coord ) * 0.5;\n		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n	#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n	uniform sampler2D lightMap;\n	uniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n	vec3 diffuseColor;\n	float specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_Lambert\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n	uniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n	float x = normal.x, y = normal.y, z = normal.z;\n	vec3 result = shCoefficients[ 0 ] * 0.886227;\n	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n	return result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n	return irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n	vec3 irradiance = ambientLightColor;\n	return irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n	if ( cutoffDistance > 0.0 ) {\n		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n	}\n	return distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n	return smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n	struct DirectionalLight {\n		vec3 direction;\n		vec3 color;\n	};\n	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n		light.color = directionalLight.color;\n		light.direction = directionalLight.direction;\n		light.visible = true;\n	}\n#endif\n#if NUM_POINT_LIGHTS > 0\n	struct PointLight {\n		vec3 position;\n		vec3 color;\n		float distance;\n		float decay;\n	};\n	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n		vec3 lVector = pointLight.position - geometryPosition;\n		light.direction = normalize( lVector );\n		float lightDistance = length( lVector );\n		light.color = pointLight.color;\n		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n		light.visible = ( light.color != vec3( 0.0 ) );\n	}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n	struct SpotLight {\n		vec3 position;\n		vec3 direction;\n		vec3 color;\n		float distance;\n		float decay;\n		float coneCos;\n		float penumbraCos;\n	};\n	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n		vec3 lVector = spotLight.position - geometryPosition;\n		light.direction = normalize( lVector );\n		float angleCos = dot( light.direction, spotLight.direction );\n		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n		if ( spotAttenuation > 0.0 ) {\n			float lightDistance = length( lVector );\n			light.color = spotLight.color * spotAttenuation;\n			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n			light.visible = ( light.color != vec3( 0.0 ) );\n		} else {\n			light.color = vec3( 0.0 );\n			light.visible = false;\n		}\n	}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n	struct RectAreaLight {\n		vec3 color;\n		vec3 position;\n		vec3 halfWidth;\n		vec3 halfHeight;\n	};\n	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;\n	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n	struct HemisphereLight {\n		vec3 direction;\n		vec3 skyColor;\n		vec3 groundColor;\n	};\n	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n		float dotNL = dot( normal, hemiLight.direction );\n		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n		return irradiance;\n	}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n	vec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_Toon\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n	vec3 diffuseColor;\n	vec3 specularColor;\n	float specularShininess;\n	float specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_BlinnPhong\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n	material.ior = ior;\n	#ifdef USE_SPECULAR\n		float specularIntensityFactor = specularIntensity;\n		vec3 specularColorFactor = specularColor;\n		#ifdef USE_SPECULAR_COLORMAP\n			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n		#endif\n		#ifdef USE_SPECULAR_INTENSITYMAP\n			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n		#endif\n		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n	#else\n		float specularIntensityFactor = 1.0;\n		vec3 specularColorFactor = vec3( 1.0 );\n		material.specularF90 = 1.0;\n	#endif\n	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n	material.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n	material.clearcoat = clearcoat;\n	material.clearcoatRoughness = clearcoatRoughness;\n	material.clearcoatF0 = vec3( 0.04 );\n	material.clearcoatF90 = 1.0;\n	#ifdef USE_CLEARCOATMAP\n		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n	#endif\n	#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n	#endif\n	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n	material.clearcoatRoughness += geometryRoughness;\n	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n	material.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n	material.iridescence = iridescence;\n	material.iridescenceIOR = iridescenceIOR;\n	#ifdef USE_IRIDESCENCEMAP\n		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n	#endif\n	#ifdef USE_IRIDESCENCE_THICKNESSMAP\n		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n	#else\n		material.iridescenceThickness = iridescenceThicknessMaximum;\n	#endif\n#endif\n#ifdef USE_SHEEN\n	material.sheenColor = sheenColor;\n	#ifdef USE_SHEEN_COLORMAP\n		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n	#endif\n	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n	#ifdef USE_SHEEN_ROUGHNESSMAP\n		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n	#endif\n#endif\n#ifdef USE_ANISOTROPY\n	#ifdef USE_ANISOTROPYMAP\n		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n	#else\n		vec2 anisotropyV = anisotropyVector;\n	#endif\n	material.anisotropy = length( anisotropyV );\n	if( material.anisotropy == 0.0 ) {\n		anisotropyV = vec2( 1.0, 0.0 );\n	} else {\n		anisotropyV /= material.anisotropy;\n		material.anisotropy = saturate( material.anisotropy );\n	}\n	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n	vec3 diffuseColor;\n	float roughness;\n	vec3 specularColor;\n	float specularF90;\n	float dispersion;\n	#ifdef USE_CLEARCOAT\n		float clearcoat;\n		float clearcoatRoughness;\n		vec3 clearcoatF0;\n		float clearcoatF90;\n	#endif\n	#ifdef USE_IRIDESCENCE\n		float iridescence;\n		float iridescenceIOR;\n		float iridescenceThickness;\n		vec3 iridescenceFresnel;\n		vec3 iridescenceF0;\n	#endif\n	#ifdef USE_SHEEN\n		vec3 sheenColor;\n		float sheenRoughness;\n	#endif\n	#ifdef IOR\n		float ior;\n	#endif\n	#ifdef USE_TRANSMISSION\n		float transmission;\n		float transmissionAlpha;\n		float thickness;\n		float attenuationDistance;\n		vec3 attenuationColor;\n	#endif\n	#ifdef USE_ANISOTROPY\n		float anisotropy;\n		float alphaT;\n		vec3 anisotropyT;\n		vec3 anisotropyB;\n	#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n	float a2 = pow2( alpha );\n	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n	return 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n	float a2 = pow2( alpha );\n	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n	return RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n		float v = 0.5 / ( gv + gl );\n		return saturate(v);\n	}\n	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n		float a2 = alphaT * alphaB;\n		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n		highp float v2 = dot( v, v );\n		float w2 = a2 / v2;\n		return RECIPROCAL_PI * a2 * pow2 ( w2 );\n	}\n#endif\n#ifdef USE_CLEARCOAT\n	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n		vec3 f0 = material.clearcoatF0;\n		float f90 = material.clearcoatF90;\n		float roughness = material.clearcoatRoughness;\n		float alpha = pow2( roughness );\n		vec3 halfDir = normalize( lightDir + viewDir );\n		float dotNL = saturate( dot( normal, lightDir ) );\n		float dotNV = saturate( dot( normal, viewDir ) );\n		float dotNH = saturate( dot( normal, halfDir ) );\n		float dotVH = saturate( dot( viewDir, halfDir ) );\n		vec3 F = F_Schlick( f0, f90, dotVH );\n		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n		float D = D_GGX( alpha, dotNH );\n		return F * ( V * D );\n	}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n	vec3 f0 = material.specularColor;\n	float f90 = material.specularF90;\n	float roughness = material.roughness;\n	float alpha = pow2( roughness );\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNL = saturate( dot( normal, lightDir ) );\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotVH = saturate( dot( viewDir, halfDir ) );\n	vec3 F = F_Schlick( f0, f90, dotVH );\n	#ifdef USE_IRIDESCENCE\n		F = mix( F, material.iridescenceFresnel, material.iridescence );\n	#endif\n	#ifdef USE_ANISOTROPY\n		float dotTL = dot( material.anisotropyT, lightDir );\n		float dotTV = dot( material.anisotropyT, viewDir );\n		float dotTH = dot( material.anisotropyT, halfDir );\n		float dotBL = dot( material.anisotropyB, lightDir );\n		float dotBV = dot( material.anisotropyB, viewDir );\n		float dotBH = dot( material.anisotropyB, halfDir );\n		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n	#else\n		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n		float D = D_GGX( alpha, dotNH );\n	#endif\n	return F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n	const float LUT_SIZE = 64.0;\n	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n	const float LUT_BIAS = 0.5 / LUT_SIZE;\n	float dotNV = saturate( dot( N, V ) );\n	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n	uv = uv * LUT_SCALE + LUT_BIAS;\n	return uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n	float l = length( f );\n	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n	float x = dot( v1, v2 );\n	float y = abs( x );\n	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n	float b = 3.4175940 + ( 4.1616724 + y ) * y;\n	float v = a / b;\n	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n	return cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n	vec3 lightNormal = cross( v1, v2 );\n	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n	vec3 T1, T2;\n	T1 = normalize( V - N * dot( V, N ) );\n	T2 = - cross( N, T1 );\n	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n	vec3 coords[ 4 ];\n	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n	coords[ 0 ] = normalize( coords[ 0 ] );\n	coords[ 1 ] = normalize( coords[ 1 ] );\n	coords[ 2 ] = normalize( coords[ 2 ] );\n	coords[ 3 ] = normalize( coords[ 3 ] );\n	vec3 vectorFormFactor = vec3( 0.0 );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n	return vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n	float alpha = pow2( roughness );\n	float invAlpha = 1.0 / alpha;\n	float cos2h = dotNH * dotNH;\n	float sin2h = max( 1.0 - cos2h, 0.0078125 );\n	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNL = saturate( dot( normal, lightDir ) );\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float D = D_Charlie( sheenRoughness, dotNH );\n	float V = V_Neubelt( dotNV, dotNL );\n	return sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float r2 = roughness * roughness;\n	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n	return saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n	float dotNV = saturate( dot( normal, viewDir ) );\n	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n	vec4 r = roughness * c0 + c1;\n	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n	return fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n	vec2 fab = DFGApprox( normal, viewDir, roughness );\n	return specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n	vec2 fab = DFGApprox( normal, viewDir, roughness );\n	#ifdef USE_IRIDESCENCE\n		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n	#else\n		vec3 Fr = specularColor;\n	#endif\n	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n	float Ess = fab.x + fab.y;\n	float Ems = 1.0 - Ess;\n	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n	singleScatter += FssEss;\n	multiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n		vec3 normal = geometryNormal;\n		vec3 viewDir = geometryViewDir;\n		vec3 position = geometryPosition;\n		vec3 lightPos = rectAreaLight.position;\n		vec3 halfWidth = rectAreaLight.halfWidth;\n		vec3 halfHeight = rectAreaLight.halfHeight;\n		vec3 lightColor = rectAreaLight.color;\n		float roughness = material.roughness;\n		vec3 rectCoords[ 4 ];\n		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n		vec2 uv = LTC_Uv( normal, viewDir, roughness );\n		vec4 t1 = texture2D( ltc_1, uv );\n		vec4 t2 = texture2D( ltc_2, uv );\n		mat3 mInv = mat3(\n			vec3( t1.x, 0, t1.y ),\n			vec3(    0, 1,    0 ),\n			vec3( t1.z, 0, t1.w )\n		);\n		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n	}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	#ifdef USE_CLEARCOAT\n		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n		vec3 ccIrradiance = dotNLcc * directLight.color;\n		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n	#endif\n	#ifdef USE_SHEEN\n		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n	#endif\n	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n	#ifdef USE_CLEARCOAT\n		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n	#endif\n	#ifdef USE_SHEEN\n		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n	#endif\n	vec3 singleScattering = vec3( 0.0 );\n	vec3 multiScattering = vec3( 0.0 );\n	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n	#ifdef USE_IRIDESCENCE\n		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n	#else\n		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n	#endif\n	vec3 totalScattering = singleScattering + multiScattering;\n	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n	reflectedLight.indirectSpecular += radiance * singleScattering;\n	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct				RE_Direct_Physical\n#define RE_Direct_RectArea		RE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular		RE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n	geometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n	float dotNVi = saturate( dot( normal, geometryViewDir ) );\n	if ( material.iridescenceThickness == 0.0 ) {\n		material.iridescence = 0.0;\n	} else {\n		material.iridescence = saturate( material.iridescence );\n	}\n	if ( material.iridescence > 0.0 ) {\n		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n	}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n	PointLight pointLight;\n	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n	PointLightShadow pointLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n		pointLight = pointLights[ i ];\n		getPointLightInfo( pointLight, geometryPosition, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n		pointLightShadow = pointLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n	SpotLight spotLight;\n	vec4 spotColor;\n	vec3 spotLightCoord;\n	bool inSpotLightMap;\n	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n	SpotLightShadow spotLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n		spotLight = spotLights[ i ];\n		getSpotLightInfo( spotLight, geometryPosition, directLight );\n		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n		#else\n		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n		#endif\n		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n		#endif\n		#undef SPOT_LIGHT_MAP_INDEX\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n		spotLightShadow = spotLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n	DirectionalLight directionalLight;\n	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n	DirectionalLightShadow directionalLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n		directionalLight = directionalLights[ i ];\n		getDirectionalLightInfo( directionalLight, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n		directionalLightShadow = directionalLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n	RectAreaLight rectAreaLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n		rectAreaLight = rectAreaLights[ i ];\n		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n	vec3 iblIrradiance = vec3( 0.0 );\n	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n	#if defined( USE_LIGHT_PROBES )\n		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n	#endif\n	#if ( NUM_HEMI_LIGHTS > 0 )\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n		}\n		#pragma unroll_loop_end\n	#endif\n#endif\n#if defined( RE_IndirectSpecular )\n	vec3 radiance = vec3( 0.0 );\n	vec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n		irradiance += lightMapIrradiance;\n	#endif\n	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n		iblIrradiance += getIBLIrradiance( geometryNormal );\n	#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n	#ifdef USE_ANISOTROPY\n		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n	#else\n		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n	#endif\n	#ifdef USE_CLEARCOAT\n		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n	#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n	uniform float logDepthBufFC;\n	varying float vFragDepth;\n	varying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n	varying float vFragDepth;\n	varying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n	vFragDepth = 1.0 + gl_Position.w;\n	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n	vec4 sampledDiffuseColor = texture2D( map, vMapUv );\n	#ifdef DECODE_VIDEO_TEXTURE\n		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n	#endif\n	diffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n	uniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n	#if defined( USE_POINTS_UV )\n		vec2 uv = vUv;\n	#else\n		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n	#endif\n#endif\n#ifdef USE_MAP\n	diffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n	diffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n	varying vec2 vUv;\n#else\n	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n		uniform mat3 uvTransform;\n	#endif\n#endif\n#ifdef USE_MAP\n	uniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n	uniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n	metalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n	uniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n	float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n	}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n	vColor *= morphTargetBaseInfluence;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		#if defined( USE_COLOR_ALPHA )\n			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n		#elif defined( USE_COLOR )\n			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n		#endif\n	}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n	objectNormal *= morphTargetBaseInfluence;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n	}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n	#ifndef USE_INSTANCING_MORPH\n		uniform float morphTargetBaseInfluence;\n		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n	#endif\n	uniform sampler2DArray morphTargetsTexture;\n	uniform ivec2 morphTargetsTextureSize;\n	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n		int y = texelIndex / morphTargetsTextureSize.x;\n		int x = texelIndex - y * morphTargetsTextureSize.x;\n		ivec3 morphUV = ivec3( x, y, morphTargetIndex );\n		return texelFetch( morphTargetsTexture, morphUV, 0 );\n	}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n	transformed *= morphTargetBaseInfluence;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n	}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n	vec3 fdx = dFdx( vViewPosition );\n	vec3 fdy = dFdy( vViewPosition );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n#else\n	vec3 normal = normalize( vNormal );\n	#ifdef DOUBLE_SIDED\n		normal *= faceDirection;\n	#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n	#ifdef USE_TANGENT\n		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n	#else\n		mat3 tbn = getTangentFrame( - vViewPosition, normal,\n		#if defined( USE_NORMALMAP )\n			vNormalMapUv\n		#elif defined( USE_CLEARCOAT_NORMALMAP )\n			vClearcoatNormalMapUv\n		#else\n			vUv\n		#endif\n		);\n	#endif\n	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n		tbn[0] *= faceDirection;\n		tbn[1] *= faceDirection;\n	#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	#ifdef USE_TANGENT\n		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n	#else\n		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n	#endif\n	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n		tbn2[0] *= faceDirection;\n		tbn2[1] *= faceDirection;\n	#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n	#ifdef FLIP_SIDED\n		normal = - normal;\n	#endif\n	#ifdef DOUBLE_SIDED\n		normal = normal * faceDirection;\n	#endif\n	normal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n	mapN.xy *= normalScale;\n	normal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n	#ifdef USE_TANGENT\n		varying vec3 vTangent;\n		varying vec3 vBitangent;\n	#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n	#ifdef USE_TANGENT\n		varying vec3 vTangent;\n		varying vec3 vBitangent;\n	#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n	vNormal = normalize( transformedNormal );\n	#ifdef USE_TANGENT\n		vTangent = normalize( transformedTangent );\n		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n	#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n	uniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( uv.st );\n		vec2 st1 = dFdy( uv.st );\n		vec3 N = surf_norm;\n		vec3 q1perp = cross( q1, N );\n		vec3 q0perp = cross( N, q0 );\n		vec3 T = q1perp * st0.x + q0perp * st1.x;\n		vec3 B = q1perp * st0.y + q0perp * st1.y;\n		float det = max( dot( T, T ), dot( B, B ) );\n		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n		return mat3( T * scale, B * scale, N );\n	}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n	vec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n	clearcoatMapN.xy *= clearcoatNormalScale;\n	clearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n	uniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	uniform sampler2D clearcoatNormalMap;\n	uniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	uniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n	uniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	uniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n	return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n	return 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n	if( v <= 0.0 )\n		return vec4( 0., 0., 0., 0. );\n	if( v >= 1.0 )\n		return vec4( 1., 1., 1., 1. );\n	float vuf;\n	float af = modf( v * PackFactors.a, vuf );\n	float bf = modf( vuf * ShiftRight8, vuf );\n	float gf = modf( vuf * ShiftRight8, vuf );\n	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n	if( v <= 0.0 )\n		return vec3( 0., 0., 0. );\n	if( v >= 1.0 )\n		return vec3( 1., 1., 1. );\n	float vuf;\n	float bf = modf( v * PackFactors.b, vuf );\n	float gf = modf( vuf * ShiftRight8, vuf );\n	return vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n	if( v <= 0.0 )\n		return vec2( 0., 0. );\n	if( v >= 1.0 )\n		return vec2( 1., 1. );\n	float vuf;\n	float gf = modf( v * 256., vuf );\n	return vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n	return dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n	return dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n	return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n	return depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n	return ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n	gl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n	mvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n	mvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n	gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n	vec3 dithering( vec3 color ) {\n		float grid_position = rand( gl_FragCoord.xy );\n		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n		return color + dither_shift_RGB;\n	}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n	roughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n	uniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n		struct DirectionalLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n		struct SpotLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n		struct PointLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n			float shadowCameraNear;\n			float shadowCameraFar;\n		};\n		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n	#endif\n	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n	}\n	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n		return unpackRGBATo2Half( texture2D( shadow, uv ) );\n	}\n	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n		float occlusion = 1.0;\n		vec2 distribution = texture2DDistribution( shadow, uv );\n		float hard_shadow = step( compare , distribution.x );\n		if (hard_shadow != 1.0 ) {\n			float distance = compare - distribution.x ;\n			float variance = max( 0.00000, distribution.y * distribution.y );\n			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n		}\n		return occlusion;\n	}\n	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n		float shadow = 1.0;\n		shadowCoord.xyz /= shadowCoord.w;\n		shadowCoord.z += shadowBias;\n		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n		if ( frustumTest ) {\n		#if defined( SHADOWMAP_TYPE_PCF )\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n			float dx0 = - texelSize.x * shadowRadius;\n			float dy0 = - texelSize.y * shadowRadius;\n			float dx1 = + texelSize.x * shadowRadius;\n			float dy1 = + texelSize.y * shadowRadius;\n			float dx2 = dx0 / 2.0;\n			float dy2 = dy0 / 2.0;\n			float dx3 = dx1 / 2.0;\n			float dy3 = dy1 / 2.0;\n			shadow = (\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n			) * ( 1.0 / 17.0 );\n		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n			float dx = texelSize.x;\n			float dy = texelSize.y;\n			vec2 uv = shadowCoord.xy;\n			vec2 f = fract( uv * shadowMapSize + 0.5 );\n			uv -= f * texelSize;\n			shadow = (\n				texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n					 f.x ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n					 f.x ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n					 f.y ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n					 f.y ) +\n				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n						  f.x ),\n					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n						  f.x ),\n					 f.y )\n			) * ( 1.0 / 9.0 );\n		#elif defined( SHADOWMAP_TYPE_VSM )\n			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n		#else\n			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n		#endif\n		}\n		return mix( 1.0, shadow, shadowIntensity );\n	}\n	vec2 cubeToUV( vec3 v, float texelSizeY ) {\n		vec3 absV = abs( v );\n		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n		absV *= scaleToCube;\n		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n		vec2 planar = v.xy;\n		float almostATexel = 1.5 * texelSizeY;\n		float almostOne = 1.0 - almostATexel;\n		if ( absV.z >= almostOne ) {\n			if ( v.z > 0.0 )\n				planar.x = 4.0 - v.x;\n		} else if ( absV.x >= almostOne ) {\n			float signX = sign( v.x );\n			planar.x = v.z * signX + 2.0 * signX;\n		} else if ( absV.y >= almostOne ) {\n			float signY = sign( v.y );\n			planar.x = v.x + 2.0 * signY + 2.0;\n			planar.y = v.z * signY - 2.0;\n		}\n		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n	}\n	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n		float shadow = 1.0;\n		vec3 lightToPosition = shadowCoord.xyz;\n		\n		float lightToPositionLength = length( lightToPosition );\n		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;\n			vec3 bd3D = normalize( lightToPosition );\n			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n				shadow = (\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n				) * ( 1.0 / 9.0 );\n			#else\n				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n			#endif\n		}\n		return mix( 1.0, shadow, shadowIntensity );\n	}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n		struct DirectionalLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n		struct SpotLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n		struct PointLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n			float shadowCameraNear;\n			float shadowCameraFar;\n		};\n		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n	#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n	vec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n		}\n		#pragma unroll_loop_end\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n		}\n		#pragma unroll_loop_end\n	#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n		shadowWorldPosition = worldPosition;\n		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n		#endif\n		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n	}\n	#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n	float shadow = 1.0;\n	#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n	DirectionalLightShadow directionalLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n		directionalLight = directionalLightShadows[ i ];\n		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n	SpotLightShadow spotLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n		spotLight = spotLightShadows[ i ];\n		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n	PointLightShadow pointLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n		pointLight = pointLightShadows[ i ];\n		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#endif\n	return shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n	uniform highp sampler2D boneTexture;\n	mat4 getBoneMatrix( const in float i ) {\n		int size = textureSize( boneTexture, 0 ).x;\n		int j = int( i ) * 4;\n		int x = j % size;\n		int y = j / size;\n		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n		return mat4( v1, v2, v3, v4 );\n	}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	transformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n	#ifdef USE_TANGENT\n		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n	#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n	specularStrength = texelSpecular.r;\n#else\n	specularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n	uniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n	return saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n	color *= toneMappingExposure;\n	return saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n	color *= toneMappingExposure;\n	color = max( vec3( 0.0 ), color - 0.004 );\n	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n	return a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n	const mat3 ACESInputMat = mat3(\n		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),\n		vec3( 0.04823, 0.01566, 0.83777 )\n	);\n	const mat3 ACESOutputMat = mat3(\n		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),\n		vec3( -0.07367, -0.00605,  1.07602 )\n	);\n	color *= toneMappingExposure / 0.6;\n	color = ACESInputMat * color;\n	color = RRTAndODTFit( color );\n	color = ACESOutputMat * color;\n	return saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n	vec3( 1.6605, - 0.1246, - 0.0182 ),\n	vec3( - 0.5876, 1.1329, - 0.1006 ),\n	vec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n	vec3( 0.6274, 0.0691, 0.0164 ),\n	vec3( 0.3293, 0.9195, 0.0880 ),\n	vec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n	vec3 x2 = x * x;\n	vec3 x4 = x2 * x2;\n	return + 15.5 * x4 * x2\n		- 40.14 * x4 * x\n		+ 31.96 * x4\n		- 6.868 * x2 * x\n		+ 0.4298 * x2\n		+ 0.1191 * x\n		- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n	const mat3 AgXInsetMatrix = mat3(\n		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n	);\n	const mat3 AgXOutsetMatrix = mat3(\n		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n	);\n	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;\n	color *= toneMappingExposure;\n	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n	color = AgXInsetMatrix * color;\n	color = max( color, 1e-10 );	color = log2( color );\n	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n	color = clamp( color, 0.0, 1.0 );\n	color = agxDefaultContrastApprox( color );\n	color = AgXOutsetMatrix * color;\n	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n	color = clamp( color, 0.0, 1.0 );\n	return color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n	const float StartCompression = 0.8 - 0.04;\n	const float Desaturation = 0.15;\n	color *= toneMappingExposure;\n	float x = min( color.r, min( color.g, color.b ) );\n	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n	color -= offset;\n	float peak = max( color.r, max( color.g, color.b ) );\n	if ( peak < StartCompression ) return color;\n	float d = 1. - StartCompression;\n	float newPeak = 1. - d * d / ( peak + d - StartCompression );\n	color *= newPeak / peak;\n	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n	return mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n	material.transmission = transmission;\n	material.transmissionAlpha = 1.0;\n	material.thickness = thickness;\n	material.attenuationDistance = attenuationDistance;\n	material.attenuationColor = attenuationColor;\n	#ifdef USE_TRANSMISSIONMAP\n		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n	#endif\n	#ifdef USE_THICKNESSMAP\n		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n	#endif\n	vec3 pos = vWorldPosition;\n	vec3 v = normalize( cameraPosition - pos );\n	vec3 n = inverseTransformDirection( normal, viewMatrix );\n	vec4 transmitted = getIBLVolumeRefraction(\n		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n		material.attenuationColor, material.attenuationDistance );\n	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n	uniform float transmission;\n	uniform float thickness;\n	uniform float attenuationDistance;\n	uniform vec3 attenuationColor;\n	#ifdef USE_TRANSMISSIONMAP\n		uniform sampler2D transmissionMap;\n	#endif\n	#ifdef USE_THICKNESSMAP\n		uniform sampler2D thicknessMap;\n	#endif\n	uniform vec2 transmissionSamplerSize;\n	uniform sampler2D transmissionSamplerMap;\n	uniform mat4 modelMatrix;\n	uniform mat4 projectionMatrix;\n	varying vec3 vWorldPosition;\n	float w0( float a ) {\n		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n	}\n	float w1( float a ) {\n		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n	}\n	float w2( float a ){\n		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n	}\n	float w3( float a ) {\n		return ( 1.0 / 6.0 ) * ( a * a * a );\n	}\n	float g0( float a ) {\n		return w0( a ) + w1( a );\n	}\n	float g1( float a ) {\n		return w2( a ) + w3( a );\n	}\n	float h0( float a ) {\n		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n	}\n	float h1( float a ) {\n		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n	}\n	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n		uv = uv * texelSize.zw + 0.5;\n		vec2 iuv = floor( uv );\n		vec2 fuv = fract( uv );\n		float g0x = g0( fuv.x );\n		float g1x = g1( fuv.x );\n		float h0x = h0( fuv.x );\n		float h1x = h1( fuv.x );\n		float h0y = h0( fuv.y );\n		float h1y = h1( fuv.y );\n		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n	}\n	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n		vec2 fLodSizeInv = 1.0 / fLodSize;\n		vec2 cLodSizeInv = 1.0 / cLodSize;\n		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n		return mix( fSample, cSample, fract( lod ) );\n	}\n	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n		vec3 modelScale;\n		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n		return normalize( refractionVector ) * thickness * modelScale;\n	}\n	float applyIorToRoughness( const in float roughness, const in float ior ) {\n		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n	}\n	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n	}\n	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n		if ( isinf( attenuationDistance ) ) {\n			return vec3( 1.0 );\n		} else {\n			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;\n		}\n	}\n	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n		const in vec3 attenuationColor, const in float attenuationDistance ) {\n		vec4 transmittedLight;\n		vec3 transmittance;\n		#ifdef USE_DISPERSION\n			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n			for ( int i = 0; i < 3; i ++ ) {\n				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n				vec3 refractedRayExit = position + transmissionRay;\n				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n				vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n				refractionCoords += 1.0;\n				refractionCoords /= 2.0;\n				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n				transmittedLight[ i ] = transmissionSample[ i ];\n				transmittedLight.a += transmissionSample.a;\n				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n			}\n			transmittedLight.a /= 3.0;\n		#else\n			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n			vec3 refractedRayExit = position + transmissionRay;\n			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n			vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n			refractionCoords += 1.0;\n			refractionCoords /= 2.0;\n			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n		#endif\n		vec3 attenuatedColor = transmittance * transmittedLight.rgb;\n		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n	}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	varying vec2 vUv;\n#endif\n#ifdef USE_MAP\n	varying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n	varying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n	varying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n	varying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n	varying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n	varying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n	varying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n	varying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	varying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	varying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n	varying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	varying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	varying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	varying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	varying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	varying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	varying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n	varying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	varying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	varying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	uniform mat3 transmissionMapTransform;\n	varying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n	uniform mat3 thicknessMapTransform;\n	varying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	varying vec2 vUv;\n#endif\n#ifdef USE_MAP\n	uniform mat3 mapTransform;\n	varying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n	uniform mat3 alphaMapTransform;\n	varying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n	uniform mat3 lightMapTransform;\n	varying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n	uniform mat3 aoMapTransform;\n	varying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n	uniform mat3 bumpMapTransform;\n	varying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n	uniform mat3 normalMapTransform;\n	varying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n	uniform mat3 displacementMapTransform;\n	varying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n	uniform mat3 emissiveMapTransform;\n	varying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n	uniform mat3 metalnessMapTransform;\n	varying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	uniform mat3 roughnessMapTransform;\n	varying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	uniform mat3 anisotropyMapTransform;\n	varying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n	uniform mat3 clearcoatMapTransform;\n	varying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	uniform mat3 clearcoatNormalMapTransform;\n	varying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	uniform mat3 clearcoatRoughnessMapTransform;\n	varying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	uniform mat3 sheenColorMapTransform;\n	varying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	uniform mat3 sheenRoughnessMapTransform;\n	varying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	uniform mat3 iridescenceMapTransform;\n	varying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	uniform mat3 iridescenceThicknessMapTransform;\n	varying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n	uniform mat3 specularMapTransform;\n	varying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	uniform mat3 specularColorMapTransform;\n	varying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	uniform mat3 specularIntensityMapTransform;\n	varying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	uniform mat3 transmissionMapTransform;\n	varying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n	uniform mat3 thicknessMapTransform;\n	varying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	vUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n	vec4 worldPosition = vec4( transformed, 1.0 );\n	#ifdef USE_BATCHING\n		worldPosition = batchingMatrix * worldPosition;\n	#endif\n	#ifdef USE_INSTANCING\n		worldPosition = instanceMatrix * worldPosition;\n	#endif\n	worldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	gl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n	vec4 texColor = texture2D( t2D, vUv );\n	#ifdef DECODE_VIDEO_TEXTURE\n		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n	#endif\n	texColor.rgb *= backgroundIntensity;\n	gl_FragColor = texColor;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n	uniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n	uniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n	#elif defined( ENVMAP_TYPE_CUBE_UV )\n		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n	#else\n		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n	#endif\n	texColor.rgb *= backgroundIntensity;\n	gl_FragColor = texColor;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n	gl_FragColor = texColor;\n	gl_FragColor.a *= opacity;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <skinbase_vertex>\n	#include <morphinstance_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n	uniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	vec4 diffuseColor = vec4( 1.0 );\n	#include <clipping_planes_fragment>\n	#if DEPTH_PACKING == 3200\n		diffuseColor.a = opacity;\n	#endif\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <logdepthbuf_fragment>\n	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n	#if DEPTH_PACKING == 3200\n		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n	#elif DEPTH_PACKING == 3201\n		gl_FragColor = packDepthToRGBA( fragCoordZ );\n	#elif DEPTH_PACKING == 3202\n		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n	#elif DEPTH_PACKING == 3203\n		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n	#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <skinbase_vertex>\n	#include <morphinstance_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <worldpos_vertex>\n	#include <clipping_planes_vertex>\n	vWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n	vec4 diffuseColor = vec4( 1.0 );\n	#include <clipping_planes_fragment>\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	float dist = length( vWorldPosition - referencePosition );\n	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n	dist = saturate( dist );\n	gl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vec3 direction = normalize( vWorldDirection );\n	vec2 sampleUV = equirectUv( direction );\n	gl_FragColor = texture2D( tEquirect, sampleUV );\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	vLineDistance = scale * lineDistance;\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	if ( mod( vLineDistance, totalSize ) > dashSize ) {\n		discard;\n	}\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinbase_vertex>\n		#include <skinnormal_vertex>\n		#include <defaultnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n	#else\n		reflectedLight.indirectDiffuse += vec3( 1.0 );\n	#endif\n	#include <aomap_fragment>\n	reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n	vec3 outgoingLight = reflectedLight.indirectDiffuse;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_lambert_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n	vViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	vec3 viewDir = normalize( vViewPosition );\n	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n	vec3 y = cross( viewDir, x );\n	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n	#ifdef USE_MATCAP\n		vec4 matcapColor = texture2D( matcap, uv );\n	#else\n		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n	#endif\n	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	varying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	vViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	varying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n	#ifdef OPAQUE\n		gl_FragColor.a = 1.0;\n	#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_phong_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n	varying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n	vWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n	#define IOR\n	#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n	uniform float ior;\n#endif\n#ifdef USE_SPECULAR\n	uniform float specularIntensity;\n	uniform vec3 specularColor;\n	#ifdef USE_SPECULAR_COLORMAP\n		uniform sampler2D specularColorMap;\n	#endif\n	#ifdef USE_SPECULAR_INTENSITYMAP\n		uniform sampler2D specularIntensityMap;\n	#endif\n#endif\n#ifdef USE_CLEARCOAT\n	uniform float clearcoat;\n	uniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n	uniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n	uniform float iridescence;\n	uniform float iridescenceIOR;\n	uniform float iridescenceThicknessMinimum;\n	uniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n	uniform vec3 sheenColor;\n	uniform float sheenRoughness;\n	#ifdef USE_SHEEN_COLORMAP\n		uniform sampler2D sheenColorMap;\n	#endif\n	#ifdef USE_SHEEN_ROUGHNESSMAP\n		uniform sampler2D sheenRoughnessMap;\n	#endif\n#endif\n#ifdef USE_ANISOTROPY\n	uniform vec2 anisotropyVector;\n	#ifdef USE_ANISOTROPYMAP\n		uniform sampler2D anisotropyMap;\n	#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <roughnessmap_fragment>\n	#include <metalnessmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <clearcoat_normal_fragment_begin>\n	#include <clearcoat_normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_physical_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n	#include <transmission_fragment>\n	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n	#ifdef USE_SHEEN\n		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n	#endif\n	#ifdef USE_CLEARCOAT\n		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n	#endif\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_toon_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n	varying vec2 vUv;\n	uniform mat3 uvTransform;\n#endif\nvoid main() {\n	#ifdef USE_POINTS_UV\n		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	#endif\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	gl_PointSize = size;\n	#ifdef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n	#endif\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_particle_fragment>\n	#include <color_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n	#include <logdepthbuf_fragment>\n	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	vec4 mvPosition = modelViewMatrix[ 3 ];\n	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n	#ifndef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) scale *= - mvPosition.z;\n	#endif\n	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n	vec2 rotatedPosition;\n	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n	mvPosition.xy += rotatedPosition;\n	gl_Position = projectionMatrix * mvPosition;\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n}"},r4={common:{diffuse:{value:new nf(0xffffff)},opacity:{value:1},map:{value:null},mapTransform:{value:new eH},alphaMap:{value:null},alphaMapTransform:{value:new eH},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new eH}},envmap:{envMap:{value:null},envMapRotation:{value:new eH},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new eH}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new eH}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new eH},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new eH},normalScale:{value:new eG(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new eH},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new eH}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new eH}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new eH}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new nf(0xffffff)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new nf(0xffffff)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new eH},alphaTest:{value:0},uvTransform:{value:new eH}},sprite:{diffuse:{value:new nf(0xffffff)},opacity:{value:1},center:{value:new eG(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new eH},alphaMap:{value:null},alphaMapTransform:{value:new eH},alphaTest:{value:0}}},r5={basic:{uniforms:nK([r4.common,r4.specularmap,r4.envmap,r4.aomap,r4.lightmap,r4.fog]),vertexShader:r3.meshbasic_vert,fragmentShader:r3.meshbasic_frag},lambert:{uniforms:nK([r4.common,r4.specularmap,r4.envmap,r4.aomap,r4.lightmap,r4.emissivemap,r4.bumpmap,r4.normalmap,r4.displacementmap,r4.fog,r4.lights,{emissive:{value:new nf(0)}}]),vertexShader:r3.meshlambert_vert,fragmentShader:r3.meshlambert_frag},phong:{uniforms:nK([r4.common,r4.specularmap,r4.envmap,r4.aomap,r4.lightmap,r4.emissivemap,r4.bumpmap,r4.normalmap,r4.displacementmap,r4.fog,r4.lights,{emissive:{value:new nf(0)},specular:{value:new nf(1118481)},shininess:{value:30}}]),vertexShader:r3.meshphong_vert,fragmentShader:r3.meshphong_frag},standard:{uniforms:nK([r4.common,r4.envmap,r4.aomap,r4.lightmap,r4.emissivemap,r4.bumpmap,r4.normalmap,r4.displacementmap,r4.roughnessmap,r4.metalnessmap,r4.fog,r4.lights,{emissive:{value:new nf(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:r3.meshphysical_vert,fragmentShader:r3.meshphysical_frag},toon:{uniforms:nK([r4.common,r4.aomap,r4.lightmap,r4.emissivemap,r4.bumpmap,r4.normalmap,r4.displacementmap,r4.gradientmap,r4.fog,r4.lights,{emissive:{value:new nf(0)}}]),vertexShader:r3.meshtoon_vert,fragmentShader:r3.meshtoon_frag},matcap:{uniforms:nK([r4.common,r4.bumpmap,r4.normalmap,r4.displacementmap,r4.fog,{matcap:{value:null}}]),vertexShader:r3.meshmatcap_vert,fragmentShader:r3.meshmatcap_frag},points:{uniforms:nK([r4.points,r4.fog]),vertexShader:r3.points_vert,fragmentShader:r3.points_frag},dashed:{uniforms:nK([r4.common,r4.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:r3.linedashed_vert,fragmentShader:r3.linedashed_frag},depth:{uniforms:nK([r4.common,r4.displacementmap]),vertexShader:r3.depth_vert,fragmentShader:r3.depth_frag},normal:{uniforms:nK([r4.common,r4.bumpmap,r4.normalmap,r4.displacementmap,{opacity:{value:1}}]),vertexShader:r3.meshnormal_vert,fragmentShader:r3.meshnormal_frag},sprite:{uniforms:nK([r4.sprite,r4.fog]),vertexShader:r3.sprite_vert,fragmentShader:r3.sprite_frag},background:{uniforms:{uvTransform:{value:new eH},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:r3.background_vert,fragmentShader:r3.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new eH}},vertexShader:r3.backgroundCube_vert,fragmentShader:r3.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:r3.cube_vert,fragmentShader:r3.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:r3.equirect_vert,fragmentShader:r3.equirect_frag},distanceRGBA:{uniforms:nK([r4.common,r4.displacementmap,{referencePosition:{value:new tn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:r3.distanceRGBA_vert,fragmentShader:r3.distanceRGBA_frag},shadow:{uniforms:nK([r4.lights,r4.fog,{color:{value:new nf(0)},opacity:{value:1}}]),vertexShader:r3.shadow_vert,fragmentShader:r3.shadow_frag}};r5.physical={uniforms:nK([r5.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new eH},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new eH},clearcoatNormalScale:{value:new eG(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new eH},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new eH},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new eH},sheen:{value:0},sheenColor:{value:new nf(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new eH},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new eH},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new eH},transmissionSamplerSize:{value:new eG},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new eH},attenuationDistance:{value:0},attenuationColor:{value:new nf(0)},specularColor:{value:new nf(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new eH},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new eH},anisotropyVector:{value:new eG},anisotropyMap:{value:null},anisotropyMapTransform:{value:new eH}}]),vertexShader:r3.meshphysical_vert,fragmentShader:r3.meshphysical_frag};var r6={r:0,b:0,g:0},r8=new tG,r9=new tU;function r7(e,t,n,i,r,a,o){var s,l,u=new nf(0),c=+(!0!==a),h=null,d=0,p=null;function f(e){var i=!0===e.isScene?e.background:null;return i&&i.isTexture&&(i=(e.backgroundBlurriness>0?n:t).get(i)),i}function v(t,n){t.getRGB(r6,nZ(e)),i.buffers.color.setClear(r6.r,r6.g,r6.b,n,o)}return{getClearColor:function(){return u},setClearColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;u.set(e),v(u,c=t)},getClearAlpha:function(){return c},setClearAlpha:function(e){v(u,c=e)},render:function(t){var n=!1,r=f(t);null===r?v(u,c):r&&r.isColor&&(v(r,1),n=!0);var a=e.xr.getEnvironmentBlendMode();"additive"===a?i.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===a&&i.buffers.color.setClear(0,0,0,0,o),(e.autoClear||n)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,n){var i=f(n);i&&(i.isCubeTexture||306===i.mapping)?(void 0===l&&((l=new nj(new nq(1,1,1),new nQ({name:"BackgroundCubeMaterial",uniforms:nY(r5.backgroundCube.uniforms),vertexShader:r5.backgroundCube.vertexShader,fragmentShader:r5.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(l)),r8.copy(n.backgroundRotation),r8.x*=-1,r8.y*=-1,r8.z*=-1,i.isCubeTexture&&!1===i.isRenderTargetTexture&&(r8.y*=-1,r8.z*=-1),l.material.uniforms.envMap.value=i,l.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.uniforms.backgroundRotation.value.setFromMatrix4(r9.makeRotationFromEuler(r8)),l.material.toneMapped=eQ.getTransfer(i.colorSpace)!==ek,(h!==i||d!==i.version||p!==e.toneMapping)&&(l.material.needsUpdate=!0,h=i,d=i.version,p=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null)):i&&i.isTexture&&(void 0===s&&((s=new nj(new rd(2,2),new nQ({name:"BackgroundMaterial",uniforms:nY(r5.background.uniforms),vertexShader:r5.background.vertexShader,fragmentShader:r5.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(s)),s.material.uniforms.t2D.value=i,s.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,s.material.toneMapped=eQ.getTransfer(i.colorSpace)!==ek,!0===i.matrixAutoUpdate&&i.updateMatrix(),s.material.uniforms.uvTransform.value.copy(i.matrix),(h!==i||d!==i.version||p!==e.toneMapping)&&(s.material.needsUpdate=!0,h=i,d=i.version,p=e.toneMapping),s.layers.enableAll(),t.unshift(s,s.geometry,s.material,0,0,null))},dispose:function(){void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0),void 0!==s&&(s.geometry.dispose(),s.material.dispose(),s=void 0)}}}function ae(e,t){var n=e.getParameter(e.MAX_VERTEX_ATTRIBS),i={},r=u(null),a=r,o=!1;function s(t){return e.bindVertexArray(t)}function l(t){return e.deleteVertexArray(t)}function u(e){for(var t=[],i=[],r=[],a=0;a<n;a++)t[a]=0,i[a]=0,r[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:r,object:e,attributes:{},index:null}}function c(){for(var e=a.newAttributes,t=0,n=e.length;t<n;t++)e[t]=0}function h(e){d(e,0)}function d(t,n){var i=a.newAttributes,r=a.enabledAttributes,o=a.attributeDivisors;i[t]=1,0===r[t]&&(e.enableVertexAttribArray(t),r[t]=1),o[t]!==n&&(e.vertexAttribDivisor(t,n),o[t]=n)}function p(){for(var t=a.newAttributes,n=a.enabledAttributes,i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function f(t,n,i,r,a,o,s){!0===s?e.vertexAttribIPointer(t,n,i,a,o):e.vertexAttribPointer(t,n,i,r,a,o)}function v(){m(),o=!0,a!==r&&s((a=r).object)}function m(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:function(n,r,l,v,m){var g,_,y,x,b,w,S=!1,M=(g=v,_=l,y=!0===r.wireframe,void 0===(x=i[g.id])&&(x={},i[g.id]=x),void 0===(b=x[_.id])&&(b={},x[_.id]=b),void 0===(w=b[y])&&(w=u(e.createVertexArray()),b[y]=w),w);a!==M&&s((a=M).object),(S=function(e,t,n,i){var r=a.attributes,o=t.attributes,s=0,l=n.getAttributes();for(var u in l)if(l[u].location>=0){var c=r[u],h=o[u];if(void 0===h&&("instanceMatrix"===u&&e.instanceMatrix&&(h=e.instanceMatrix),"instanceColor"===u&&e.instanceColor&&(h=e.instanceColor)),void 0===c||c.attribute!==h||h&&c.data!==h.data)return!0;s++}return a.attributesNum!==s||a.index!==i}(n,v,l,m))&&function(e,t,n,i){var r={},o=t.attributes,s=0,l=n.getAttributes();for(var u in l)if(l[u].location>=0){var c=o[u];void 0===c&&("instanceMatrix"===u&&e.instanceMatrix&&(c=e.instanceMatrix),"instanceColor"===u&&e.instanceColor&&(c=e.instanceColor));var h={};h.attribute=c,c&&c.data&&(h.data=c.data),r[u]=h,s++}a.attributes=r,a.attributesNum=s,a.index=i}(n,v,l,m),null!==m&&t.update(m,e.ELEMENT_ARRAY_BUFFER),(S||o)&&(o=!1,function(n,i,r,a){c();var o=a.attributes,s=r.getAttributes(),l=i.defaultAttributeValues;for(var u in s){var v=s[u];if(v.location>=0){var m=o[u];if(void 0===m&&("instanceMatrix"===u&&n.instanceMatrix&&(m=n.instanceMatrix),"instanceColor"===u&&n.instanceColor&&(m=n.instanceColor)),void 0!==m){var g=m.normalized,_=m.itemSize,y=t.get(m);if(void 0===y)continue;var x=y.buffer,b=y.type,w=y.bytesPerElement,S=b===e.INT||b===e.UNSIGNED_INT||1013===m.gpuType;if(m.isInterleavedBufferAttribute){var M=m.data,E=M.stride,T=m.offset;if(M.isInstancedInterleavedBuffer){for(var C=0;C<v.locationSize;C++)d(v.location+C,M.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=M.meshPerAttribute*M.count)}else for(var k=0;k<v.locationSize;k++)h(v.location+k);e.bindBuffer(e.ARRAY_BUFFER,x);for(var A=0;A<v.locationSize;A++)f(v.location+A,_/v.locationSize,b,g,E*w,(T+_/v.locationSize*A)*w,S)}else{if(m.isInstancedBufferAttribute){for(var P=0;P<v.locationSize;P++)d(v.location+P,m.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=m.meshPerAttribute*m.count)}else for(var R=0;R<v.locationSize;R++)h(v.location+R);e.bindBuffer(e.ARRAY_BUFFER,x);for(var U=0;U<v.locationSize;U++)f(v.location+U,_/v.locationSize,b,g,_*w,_/v.locationSize*U*w,S)}}else if(void 0!==l){var L=l[u];if(void 0!==L)switch(L.length){case 2:e.vertexAttrib2fv(v.location,L);break;case 3:e.vertexAttrib3fv(v.location,L);break;case 4:e.vertexAttrib4fv(v.location,L);break;default:e.vertexAttrib1fv(v.location,L)}}}}p()}(n,r,l,v),null!==m&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(m).buffer))},reset:v,resetDefaultState:m,dispose:function(){for(var e in v(),i){var t=i[e];for(var n in t){var r=t[n];for(var a in r)l(r[a].object),delete r[a];delete t[n]}delete i[e]}},releaseStatesOfGeometry:function(e){if(void 0!==i[e.id]){var t=i[e.id];for(var n in t){var r=t[n];for(var a in r)l(r[a].object),delete r[a];delete t[n]}delete i[e.id]}},releaseStatesOfProgram:function(e){for(var t in i){var n=i[t];if(void 0!==n[e.id]){var r=n[e.id];for(var a in r)l(r[a].object),delete r[a];delete n[e.id]}}},initAttributes:c,enableAttribute:h,disableUnusedAttributes:p}}function at(e,t,n){var i;function r(t,r,a){0!==a&&(e.drawArraysInstanced(i,t,r,a),n.update(r,i,a))}this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i,1)},this.renderInstances=r,this.renderMultiDraw=function(e,r,a){if(0!==a){t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,e,0,r,0,a);for(var o=0,s=0;s<a;s++)o+=r[s];n.update(o,i,1)}},this.renderMultiDrawInstances=function(e,a,o,s){if(0!==o){var l=t.get("WEBGL_multi_draw");if(null===l)for(var u=0;u<e.length;u++)r(e[u],a[u],s[u]);else{l.multiDrawArraysInstancedWEBGL(i,e,0,a,0,s,0,o);for(var c=0,h=0;h<o;h++)c+=a[h]*s[h];n.update(c,i,1)}}}}function an(e,t,n,i){function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var a,o=void 0!==n.precision?n.precision:"highp",s=r(o);s!==o&&(o=s);var l=!0===n.logarithmicDepthBuffer,u=!0===n.reverseDepthBuffer&&t.has("EXT_clip_control"),c=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==a)return a;if(!0===t.has("EXT_texture_filter_anisotropic")){var n=t.get("EXT_texture_filter_anisotropic");a=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else a=0;return a},getMaxPrecision:r,textureFormatReadable:function(t){return 1023===t||i.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){var r=1016===n&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return 1009===n||i.convert(n)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)||1015===n||!!r},precision:o,logarithmicDepthBuffer:l,reverseDepthBuffer:u,maxTextures:c,maxVertexTextures:h,maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:h>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function ai(e){var t=this,n=null,i=0,r=!1,a=!1,o=new ic,s=new eH,l={value:null,needsUpdate:!1};function u(e,n,i,r){var a=null!==e?e.length:0,u=null;if(0!==a){if(u=l.value,!0!==r||null===u){var c=i+4*a,h=n.matrixWorldInverse;s.getNormalMatrix(h),(null===u||u.length<c)&&(u=new Float32Array(c));for(var d=0,p=i;d!==a;++d,p+=4)o.copy(e[d]).applyMatrix4(h,s),o.normal.toArray(u,p),u[p+3]=o.constant}l.value=u,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){var n=0!==e.length||t||0!==i||r;return r=t,i=e.length,n},this.beginShadows=function(){a=!0,u(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){n=u(e,t,0)},this.setState=function(o,s,c){var h=o.clippingPlanes,d=o.clipIntersection,p=o.clipShadows,f=e.get(o);if(r&&null!==h&&0!==h.length&&(!a||p)){var v=a?0:i,m=4*v,g=f.clippingState||null;l.value=g,g=u(h,s,m,c);for(var _=0;_!==m;++_)g[_]=n[_];f.clippingState=g,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=v}else a?u(null):(l.value!==n&&(l.value=n,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0)}}function ar(e){var t=new WeakMap;function n(e,t){return 303===t?e.mapping=301:304===t&&(e.mapping=302),e}function i(e){var n=e.target;n.removeEventListener("dispose",i);var r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){var a=r.mapping;if(303===a||304===a){if(t.has(r))return n(t.get(r).texture,r.mapping);var o=r.image;if(!o||!(o.height>0))return null;var s=new n6(o.height);return s.fromEquirectangularTexture(e,r),t.set(r,s),r.addEventListener("dispose",i),n(s.texture,r.mapping)}}return r},dispose:function(){t=new WeakMap}}}var aa=[.125,.215,.35,.446,.526,.582],ao=new rV,as=new nf,al=null,au=0,ac=0,ah=!1,ad=(1+Math.sqrt(5))/2,ap=1/ad,af=[new tn(-ad,ap,0),new tn(ad,ap,0),new tn(-ap,0,ad),new tn(ap,0,ad),new tn(0,ad,-ap),new tn(0,ad,ap),new tn(-1,1,-1),new tn(1,1,-1),new tn(-1,1,1),new tn(1,1,1)],av=function(){function t(n){e(this,t),this._renderer=n,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}return n(t,[{key:"fromScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;al=this._renderer.getRenderTarget(),au=this._renderer.getActiveCubeFace(),ac=this._renderer.getActiveMipmapLevel(),ah=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);var r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}},{key:"fromEquirectangular",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"fromCubemap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"compileCubemapShader",value:function(){null===this._cubemapMaterial&&(this._cubemapMaterial=ay(),this._compileMaterial(this._cubemapMaterial))}},{key:"compileEquirectangularShader",value:function(){null===this._equirectMaterial&&(this._equirectMaterial=a_(),this._compileMaterial(this._equirectMaterial))}},{key:"dispose",value:function(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}},{key:"_setSize",value:function(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}},{key:"_dispose",value:function(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(var e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}},{key:"_cleanup",value:function(e){this._renderer.setRenderTarget(al,au,ac),this._renderer.xr.enabled=ah,e.scissorTest=!1,ag(e,0,0,e.width,e.height)}},{key:"_fromTexture",value:function(e,t){301===e.mapping||302===e.mapping?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),al=this._renderer.getRenderTarget(),au=this._renderer.getActiveCubeFace(),ac=this._renderer.getActiveMipmapLevel(),ah=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;var n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}},{key:"_allocateTargets",value:function(){var e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:1006,minFilter:1006,generateMipmaps:!1,type:1016,format:1023,colorSpace:eT,depthBuffer:!1},i=am(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=am(e,t,n);var r,a,o,s,l,u,c=this._lodMax;u=function(e){for(var t=[],n=[],i=[],r=e,a=e-4+1+aa.length,o=0;o<a;o++){var s=Math.pow(2,r);n.push(s);var l=1/s;o>e-4?l=aa[o-e+4-1]:0===o&&(l=0),i.push(l);for(var u=1/(s-2),c=-u,h=1+u,d=[c,c,h,c,h,h,c,c,h,h,c,h],p=new Float32Array(108),f=new Float32Array(72),v=new Float32Array(36),m=0;m<6;m++){var g=m%3*2/3-1,_=m>2?0:-1,y=[g,_,0,g+2/3,_,0,g+2/3,_+1,0,g,_,0,g+2/3,_+1,0,g,_+1,0];p.set(y,18*m),f.set(d,12*m);var x=[m,m,m,m,m,m];v.set(x,6*m)}var b=new nL;b.setAttribute("position",new nw(p,3)),b.setAttribute("uv",new nw(f,2)),b.setAttribute("faceIndex",new nw(v,1)),t.push(b),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(c),this._sizeLods=u.sizeLods,this._lodPlanes=u.lodPlanes,this._sigmas=u.sigmas,this._blurMaterial=(r=c,a=e,o=t,s=new Float32Array(20),l=new tn(0,1,0),new nQ({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/a,CUBEUV_TEXEL_HEIGHT:1/o,CUBEUV_MAX_MIP:"".concat(r,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:s},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:l}},vertexShader:ax(),fragmentShader:"\n\n			precision mediump float;\n			precision mediump int;\n\n			varying vec3 vOutputDirection;\n\n			uniform sampler2D envMap;\n			uniform int samples;\n			uniform float weights[ n ];\n			uniform bool latitudinal;\n			uniform float dTheta;\n			uniform float mipInt;\n			uniform vec3 poleAxis;\n\n			#define ENVMAP_TYPE_CUBE_UV\n			#include <cube_uv_reflection_fragment>\n\n			vec3 getSample( float theta, vec3 axis ) {\n\n				float cosTheta = cos( theta );\n				// Rodrigues' axis-angle rotation\n				vec3 sampleDirection = vOutputDirection * cosTheta\n					+ cross( axis, vOutputDirection ) * sin( theta )\n					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n				return bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n			}\n\n			void main() {\n\n				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n				}\n\n				axis = normalize( axis );\n\n				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n				for ( int i = 1; i < n; i++ ) {\n\n					if ( i >= samples ) {\n\n						break;\n\n					}\n\n					float theta = dTheta * float( i );\n					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n				}\n\n			}\n		",blending:0,depthTest:!1,depthWrite:!1}))}return i}},{key:"_compileMaterial",value:function(e){var t=new nj(this._lodPlanes[0],e);this._renderer.compile(t,ao)}},{key:"_sceneToCubeUV",value:function(e,t,n,i){var r=new n3(90,1,t,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,u=s.toneMapping;s.getClearColor(as),s.toneMapping=0,s.autoClear=!1;var c=new n_({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),h=new nj(new nq,c),d=!1,p=e.background;p?p.isColor&&(c.color.copy(p),e.background=null,d=!0):(c.color.copy(as),d=!0);for(var f=0;f<6;f++){var v=f%3;0===v?(r.up.set(0,a[f],0),r.lookAt(o[f],0,0)):1===v?(r.up.set(0,0,a[f]),r.lookAt(0,o[f],0)):(r.up.set(0,a[f],0),r.lookAt(0,0,o[f]));var m=this._cubeSize;ag(i,v*m,f>2?m:0,m,m),s.setRenderTarget(i),d&&s.render(h,r),s.render(e,r)}h.geometry.dispose(),h.material.dispose(),s.toneMapping=u,s.autoClear=l,e.background=p}},{key:"_textureToCubeUV",value:function(e,t){var n=this._renderer,i=301===e.mapping||302===e.mapping;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=ay()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=a_());var r=i?this._cubemapMaterial:this._equirectMaterial,a=new nj(this._lodPlanes[0],r);r.uniforms.envMap.value=e;var o=this._cubeSize;ag(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(a,ao)}},{key:"_applyPMREM",value:function(e){var t=this._renderer,n=t.autoClear;t.autoClear=!1;for(var i=this._lodPlanes.length,r=1;r<i;r++){var a=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),o=af[(i-r-1)%af.length];this._blur(e,r-1,r,a,o)}t.autoClear=n}},{key:"_blur",value:function(e,t,n,i,r){var a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",r),this._halfBlur(a,e,n,n,i,"longitudinal",r)}},{key:"_halfBlur",value:function(e,t,n,i,r,a,o){for(var s=this._renderer,l=this._blurMaterial,u=new nj(this._lodPlanes[i],l),c=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):20,v=[],m=0,g=0;g<20;++g){var _=g/p,y=Math.exp(-_*_/2);v.push(y),0===g?m+=y:g<f&&(m+=2*y)}for(var x=0;x<v.length;x++)v[x]=v[x]/m;c.envMap.value=e.texture,c.samples.value=f,c.weights.value=v,c.latitudinal.value="latitudinal"===a,o&&(c.poleAxis.value=o);var b=this._lodMax;c.dTheta.value=d,c.mipInt.value=b-n;var w=this._sizeLods[i],S=4*(this._cubeSize-w);ag(t,3*w*(i>b-4?i-b+4:0),S,3*w,2*w),s.setRenderTarget(t),s.render(u,ao)}}]),t}();function am(e,t,n){var i=new e9(e,t,n);return i.texture.mapping=306,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function ag(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function a_(){return new nQ({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:ax(),fragmentShader:"\n\n			precision mediump float;\n			precision mediump int;\n\n			varying vec3 vOutputDirection;\n\n			uniform sampler2D envMap;\n\n			#include <common>\n\n			void main() {\n\n				vec3 outputDirection = normalize( vOutputDirection );\n				vec2 uv = equirectUv( outputDirection );\n\n				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n			}\n		",blending:0,depthTest:!1,depthWrite:!1})}function ay(){return new nQ({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:ax(),fragmentShader:"\n\n			precision mediump float;\n			precision mediump int;\n\n			uniform float flipEnvMap;\n\n			varying vec3 vOutputDirection;\n\n			uniform samplerCube envMap;\n\n			void main() {\n\n				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n			}\n		",blending:0,depthTest:!1,depthWrite:!1})}function ax(){return"\n\n		precision mediump float;\n		precision mediump int;\n\n		attribute float faceIndex;\n\n		varying vec3 vOutputDirection;\n\n		// RH coordinate system; PMREM face-indexing convention\n		vec3 getDirection( vec2 uv, float face ) {\n\n			uv = 2.0 * uv - 1.0;\n\n			vec3 direction = vec3( uv, 1.0 );\n\n			if ( face == 0.0 ) {\n\n				direction = direction.zyx; // ( 1, v, u ) pos x\n\n			} else if ( face == 1.0 ) {\n\n				direction = direction.xzy;\n				direction.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n			} else if ( face == 2.0 ) {\n\n				direction.x *= -1.0; // ( -u, v, 1 ) pos z\n\n			} else if ( face == 3.0 ) {\n\n				direction = direction.zyx;\n				direction.xz *= -1.0; // ( -1, v, -u ) neg x\n\n			} else if ( face == 4.0 ) {\n\n				direction = direction.xzy;\n				direction.xy *= -1.0; // ( -u, -1, v ) neg y\n\n			} else if ( face == 5.0 ) {\n\n				direction.z *= -1.0; // ( u, v, -1 ) neg z\n\n			}\n\n			return direction;\n\n		}\n\n		void main() {\n\n			vOutputDirection = getDirection( uv, faceIndex );\n			gl_Position = vec4( position, 1.0 );\n\n		}\n	"}function ab(e){var t=new WeakMap,n=null;function i(e){var n=e.target;n.removeEventListener("dispose",i);var r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){var a=r.mapping,o=303===a||304===a,s=301===a||302===a;if(o||s){var l=t.get(r),u=void 0!==l?l.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==u)return null===n&&(n=new av(e)),(l=o?n.fromEquirectangular(r,l):n.fromCubemap(r,l)).texture.pmremVersion=r.pmremVersion,t.set(r,l),l.texture;if(void 0!==l)return l.texture;var c=r.image;return o&&c&&c.height>0||s&&c&&function(e){for(var t=0,n=0;n<6;n++)void 0!==e[n]&&t++;return 6===t}(c)?(null===n&&(n=new av(e)),(l=o?n.fromEquirectangular(r):n.fromCubemap(r)).texture.pmremVersion=r.pmremVersion,t.set(r,l),r.addEventListener("dispose",i),l.texture):null}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function aw(e){var t={};function n(n){var i;if(void 0!==t[n])return t[n];switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){var t=n(e);return null===t&&eK("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function aS(e,t,n,i){var r={},a=new WeakMap;function o(e){var s=e.target;for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);s.removeEventListener("dispose",o),delete r[s.id];var u=a.get(s);u&&(t.remove(u),a.delete(s)),i.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){var n=[],i=e.index,r=e.attributes.position,o=0;if(null!==i){var s=i.array;o=i.version;for(var l=0,u=s.length;l<u;l+=3){var c=s[l+0],h=s[l+1],d=s[l+2];n.push(c,h,h,d,d,c)}}else{if(void 0===r)return;var p=r.array;o=r.version;for(var f=0,v=p.length/3-1;f<v;f+=3){var m=f+0,g=f+1,_=f+2;n.push(m,g,g,_,_,m)}}var y=new(ej(n)?nM:nS)(n,1);y.version=o;var x=a.get(e);x&&t.remove(x),a.set(e,y)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",o),r[t.id]=!0,n.memory.geometries++),t},update:function(n){var i=n.attributes;for(var r in i)t.update(i[r],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){var t=a.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function aM(e,t,n){var i,r,a;function o(t,o,s){0!==s&&(e.drawElementsInstanced(i,o,r,t*a,s),n.update(o,i,s))}this.setMode=function(e){i=e},this.setIndex=function(e){r=e.type,a=e.bytesPerElement},this.render=function(t,o){e.drawElements(i,o,r,t*a),n.update(o,i,1)},this.renderInstances=o,this.renderMultiDraw=function(e,a,o){if(0!==o){t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,a,0,r,e,0,o);for(var s=0,l=0;l<o;l++)s+=a[l];n.update(s,i,1)}},this.renderMultiDrawInstances=function(e,s,l,u){if(0!==l){var c=t.get("WEBGL_multi_draw");if(null===c)for(var h=0;h<e.length;h++)o(e[h]/a,s[h],u[h]);else{c.multiDrawElementsInstancedWEBGL(i,s,0,r,e,0,u,0,l);for(var d=0,p=0;p<l;p++)d+=s[p]*u[p];n.update(d,i,1)}}}}function aE(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,i,r){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=n/3*r;break;case e.LINES:t.lines+=n/2*r;break;case e.LINE_STRIP:t.lines+=r*(n-1);break;case e.LINE_LOOP:t.lines+=r*n;break;case e.POINTS:t.points+=r*n}}}}function aT(e,t,n){var i=new WeakMap,r=new e8;return{update:function(a,o,s){var l=a.morphTargetInfluences,u=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,c=void 0!==u?u.length:0,h=i.get(o);if(void 0===h||h.count!==c){void 0!==h&&h.texture.dispose();var d=void 0!==o.morphAttributes.position,p=void 0!==o.morphAttributes.normal,f=void 0!==o.morphAttributes.color,v=o.morphAttributes.position||[],m=o.morphAttributes.normal||[],g=o.morphAttributes.color||[],_=0;!0===d&&(_=1),!0===p&&(_=2),!0===f&&(_=3);var y=o.attributes.position.count*_,x=1;y>t.maxTextureSize&&(x=Math.ceil(y/t.maxTextureSize),y=t.maxTextureSize);var b=new Float32Array(y*x*4*c),w=new e7(b,y,x,c);w.type=1015,w.needsUpdate=!0;for(var S=4*_,M=0;M<c;M++)for(var E=v[M],T=m[M],C=g[M],k=y*x*4*M,A=0;A<E.count;A++){var P=A*S;!0===d&&(r.fromBufferAttribute(E,A),b[k+P+0]=r.x,b[k+P+1]=r.y,b[k+P+2]=r.z,b[k+P+3]=0),!0===p&&(r.fromBufferAttribute(T,A),b[k+P+4]=r.x,b[k+P+5]=r.y,b[k+P+6]=r.z,b[k+P+7]=0),!0===f&&(r.fromBufferAttribute(C,A),b[k+P+8]=r.x,b[k+P+9]=r.y,b[k+P+10]=r.z,b[k+P+11]=4===C.itemSize?r.w:1)}h={count:c,texture:w,size:new eG(y,x)},i.set(o,h),o.addEventListener("dispose",function e(){w.dispose(),i.delete(o),o.removeEventListener("dispose",e)})}if(!0===a.isInstancedMesh&&null!==a.morphTexture)s.getUniforms().setValue(e,"morphTexture",a.morphTexture,n);else{for(var R=0,U=0;U<l.length;U++)R+=l[U];var L=o.morphTargetsRelative?1:1-R;s.getUniforms().setValue(e,"morphTargetBaseInfluence",L),s.getUniforms().setValue(e,"morphTargetInfluences",l)}s.getUniforms().setValue(e,"morphTargetsTexture",h.texture,n),s.getUniforms().setValue(e,"morphTargetsTextureSize",h.size)}}}function aC(e,t,n,i){var r=new WeakMap;function a(e){var t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(o){var s=i.render.frame,l=o.geometry,u=t.get(o,l);if(r.get(u)!==s&&(t.update(u),r.set(u,s)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",a)&&o.addEventListener("dispose",a),r.get(o)!==s&&(n.update(o.instanceMatrix,e.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,e.ARRAY_BUFFER),r.set(o,s))),o.isSkinnedMesh){var c=o.skeleton;r.get(c)!==s&&(c.update(),r.set(c,s))}return u},dispose:function(){r=new WeakMap}}}var ak=new e6,aA=new ik(1,1),aP=new e7,aR=new te,aU=new n5,aL=[],aD=[],aI=new Float32Array(16),aN=new Float32Array(9),aO=new Float32Array(4);function aF(e,t,n){var i=e[0];if(i<=0||i>0)return e;var r=t*n,a=aL[r];if(void 0===a&&(a=new Float32Array(r),aL[r]=a),0!==t){i.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(a,s)}return a}function aB(e,t){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function aV(e,t){for(var n=0,i=t.length;n<i;n++)e[n]=t[n]}function az(e,t){var n=aD[t];void 0===n&&(n=new Int32Array(t),aD[t]=n);for(var i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function aG(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function aH(e,t){var n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(aB(n,t))return;e.uniform2fv(this.addr,t),aV(n,t)}}function aW(e,t){var n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)(n[0]!==t.r||n[1]!==t.g||n[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(aB(n,t))return;e.uniform3fv(this.addr,t),aV(n,t)}}function aj(e,t){var n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z||n[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(aB(n,t))return;e.uniform4fv(this.addr,t),aV(n,t)}}function aX(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(aB(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),aV(n,t)}else{if(aB(n,i))return;aO.set(i),e.uniformMatrix2fv(this.addr,!1,aO),aV(n,i)}}function aq(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(aB(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),aV(n,t)}else{if(aB(n,i))return;aN.set(i),e.uniformMatrix3fv(this.addr,!1,aN),aV(n,i)}}function aY(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(aB(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),aV(n,t)}else{if(aB(n,i))return;aI.set(i),e.uniformMatrix4fv(this.addr,!1,aI),aV(n,i)}}function aK(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function aZ(e,t){var n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(aB(n,t))return;e.uniform2iv(this.addr,t),aV(n,t)}}function aJ(e,t){var n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(aB(n,t))return;e.uniform3iv(this.addr,t),aV(n,t)}}function aQ(e,t){var n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z||n[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(aB(n,t))return;e.uniform4iv(this.addr,t),aV(n,t)}}function a$(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function a0(e,t){var n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(aB(n,t))return;e.uniform2uiv(this.addr,t),aV(n,t)}}function a1(e,t){var n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(aB(n,t))return;e.uniform3uiv(this.addr,t),aV(n,t)}}function a2(e,t){var n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z||n[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(aB(n,t))return;e.uniform4uiv(this.addr,t),aV(n,t)}}function a3(e,t,n){var i,r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),this.type===e.SAMPLER_2D_SHADOW?(aA.compareFunction=515,i=aA):i=ak,n.setTexture2D(t||i,a)}function a4(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||aR,r)}function a5(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||aU,r)}function a6(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||aP,r)}function a8(e,t){e.uniform1fv(this.addr,t)}function a9(e,t){var n=aF(t,this.size,2);e.uniform2fv(this.addr,n)}function a7(e,t){var n=aF(t,this.size,3);e.uniform3fv(this.addr,n)}function oe(e,t){var n=aF(t,this.size,4);e.uniform4fv(this.addr,n)}function ot(e,t){var n=aF(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function on(e,t){var n=aF(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function oi(e,t){var n=aF(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function or(e,t){e.uniform1iv(this.addr,t)}function oa(e,t){e.uniform2iv(this.addr,t)}function oo(e,t){e.uniform3iv(this.addr,t)}function os(e,t){e.uniform4iv(this.addr,t)}function ol(e,t){e.uniform1uiv(this.addr,t)}function ou(e,t){e.uniform2uiv(this.addr,t)}function oc(e,t){e.uniform3uiv(this.addr,t)}function oh(e,t){e.uniform4uiv(this.addr,t)}function od(e,t,n){var i=this.cache,r=t.length,a=az(n,r);aB(i,a)||(e.uniform1iv(this.addr,a),aV(i,a));for(var o=0;o!==r;++o)n.setTexture2D(t[o]||ak,a[o])}function op(e,t,n){var i=this.cache,r=t.length,a=az(n,r);aB(i,a)||(e.uniform1iv(this.addr,a),aV(i,a));for(var o=0;o!==r;++o)n.setTexture3D(t[o]||aR,a[o])}function of(e,t,n){var i=this.cache,r=t.length,a=az(n,r);aB(i,a)||(e.uniform1iv(this.addr,a),aV(i,a));for(var o=0;o!==r;++o)n.setTextureCube(t[o]||aU,a[o])}function ov(e,t,n){var i=this.cache,r=t.length,a=az(n,r);aB(i,a)||(e.uniform1iv(this.addr,a),aV(i,a));for(var o=0;o!==r;++o)n.setTexture2DArray(t[o]||aP,a[o])}var om=function t(n,i,r){e(this,t),this.id=n,this.addr=r,this.cache=[],this.type=i.type,this.setValue=function(e){switch(e){case 5126:return aG;case 35664:return aH;case 35665:return aW;case 35666:return aj;case 35674:return aX;case 35675:return aq;case 35676:return aY;case 5124:case 35670:return aK;case 35667:case 35671:return aZ;case 35668:case 35672:return aJ;case 35669:case 35673:return aQ;case 5125:return a$;case 36294:return a0;case 36295:return a1;case 36296:return a2;case 35678:case 36198:case 36298:case 36306:case 35682:return a3;case 35679:case 36299:case 36307:return a4;case 35680:case 36300:case 36308:case 36293:return a5;case 36289:case 36303:case 36311:case 36292:return a6}}(i.type)},og=function t(n,i,r){e(this,t),this.id=n,this.addr=r,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=function(e){switch(e){case 5126:return a8;case 35664:return a9;case 35665:return a7;case 35666:return oe;case 35674:return ot;case 35675:return on;case 35676:return oi;case 5124:case 35670:return or;case 35667:case 35671:return oa;case 35668:case 35672:return oo;case 35669:case 35673:return os;case 5125:return ol;case 36294:return ou;case 36295:return oc;case 36296:return oh;case 35678:case 36198:case 36298:case 36306:case 35682:return od;case 35679:case 36299:case 36307:return op;case 35680:case 36300:case 36308:case 36293:return of;case 36289:case 36303:case 36311:case 36292:return ov}}(i.type)},o_=function(){function t(n){e(this,t),this.id=n,this.seq=[],this.map={}}return n(t,[{key:"setValue",value:function(e,t,n){for(var i=this.seq,r=0,a=i.length;r!==a;++r){var o=i[r];o.setValue(e,t[o.id],n)}}}]),t}(),oy=/(\w+)(\])?(\[|\.)?/g;function ox(e,t){e.seq.push(t),e.map[t.id]=t}var ob=function(){function t(n,i){e(this,t),this.seq=[],this.map={};for(var r=n.getProgramParameter(i,n.ACTIVE_UNIFORMS),a=0;a<r;++a){var o=n.getActiveUniform(i,a),s=n.getUniformLocation(i,o.name);!function(e,t,n){var i=e.name,r=i.length;for(oy.lastIndex=0;;){var a=oy.exec(i),o=oy.lastIndex,s=a[1],l="]"===a[2],u=a[3];if(l&&(s|=0),void 0===u||"["===u&&o+2===r){ox(n,void 0===u?new om(s,e,t):new og(s,e,t));break}var c=n.map[s];void 0===c&&ox(n,c=new o_(s)),n=c}}(o,s,this)}}return n(t,[{key:"setValue",value:function(e,t,n,i){var r=this.map[t];void 0!==r&&r.setValue(e,n,i)}},{key:"setOptional",value:function(e,t,n){var i=t[n];void 0!==i&&this.setValue(e,n,i)}}],[{key:"upload",value:function(e,t,n,i){for(var r=0,a=t.length;r!==a;++r){var o=t[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,i)}}},{key:"seqWithValue",value:function(e,t){for(var n=[],i=0,r=e.length;i!==r;++i){var a=e[i];a.id in t&&n.push(a)}return n}}]),t}();function ow(e,t,n){var i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}var oS=0,oM=new eH;function oE(e,t,n){var i=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";var a=/ERROR: 0:(\d+)/.exec(r);if(!a)return r;var o=parseInt(a[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){for(var n=e.split("\n"),i=[],r=Math.max(t-6,0),a=Math.min(t+6,n.length),o=r;o<a;o++){var s=o+1;i.push("".concat(s===t?">":" "," ").concat(s,": ").concat(n[o]))}return i.join("\n")}(e.getShaderSource(t),o)}var oT=new tn;function oC(e){return""!==e}function ok(e,t){var n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function oA(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var oP=/^[ \t]*#include +<([\w\d./]+)>/gm;function oR(e){return e.replace(oP,oL)}var oU=new Map;function oL(e,t){var n=r3[t];if(void 0===n){var i=oU.get(t);if(void 0!==i)n=r3[i];else throw Error("Can not resolve #include <"+t+">")}return oR(n)}var oD=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function oI(e){return e.replace(oD,oN)}function oN(e,t,n,i){for(var r="",a=parseInt(t);a<parseInt(n);a++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return r}function oO(e){var t="precision ".concat(e.precision," float;\n	precision ").concat(e.precision," int;\n	precision ").concat(e.precision," sampler2D;\n	precision ").concat(e.precision," samplerCube;\n	precision ").concat(e.precision," sampler3D;\n	precision ").concat(e.precision," sampler2DArray;\n	precision ").concat(e.precision," sampler2DShadow;\n	precision ").concat(e.precision," samplerCubeShadow;\n	precision ").concat(e.precision," sampler2DArrayShadow;\n	precision ").concat(e.precision," isampler2D;\n	precision ").concat(e.precision," isampler3D;\n	precision ").concat(e.precision," isamplerCube;\n	precision ").concat(e.precision," isampler2DArray;\n	precision ").concat(e.precision," usampler2D;\n	precision ").concat(e.precision," usampler3D;\n	precision ").concat(e.precision," usamplerCube;\n	precision ").concat(e.precision," usampler2DArray;\n	");return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function oF(e,t,n,i){var r,a,o,s,l,u,c,h,d,p,f=e.getContext(),v=n.defines,m=n.vertexShader,g=n.fragmentShader,_=(r="SHADOWMAP_TYPE_BASIC",1===n.shadowMapType?r="SHADOWMAP_TYPE_PCF":2===n.shadowMapType?r="SHADOWMAP_TYPE_PCF_SOFT":3===n.shadowMapType&&(r="SHADOWMAP_TYPE_VSM"),r),y=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),x=(a="ENVMAP_MODE_REFLECTION",n.envMap&&302===n.envMapMode&&(a="ENVMAP_MODE_REFRACTION"),a),b=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),w=function(e){var t=e.envMapCubeUVHeight;if(null===t)return null;var n=Math.log2(t)-2;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:1/t,maxMip:n}}(n),S=[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(oC).join("\n"),M=function(e){var t=[];for(var n in e){var i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(v),E=f.createProgram(),T=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((c=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,M].filter(oC).join("\n")).length>0&&(c+="\n"),(h=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,M].filter(oC).join("\n")).length>0&&(h+="\n")):(c=[oO(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,M,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+x:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+_:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif","\n"].filter(oC).join("\n"),h=[oO(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,M,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+y:"",n.envMap?"#define "+x:"",n.envMap?"#define "+b:"",w?"#define CUBEUV_TEXEL_WIDTH "+w.texelWidth:"",w?"#define CUBEUV_TEXEL_HEIGHT "+w.texelHeight:"",w?"#define CUBEUV_MAX_MIP "+w.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+_:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?r3.tonemapping_pars_fragment:"",0!==n.toneMapping?function(e,t){var n;switch(t){case 1:default:n="Linear";break;case 2:n="Reinhard";break;case 3:n="Cineon";break;case 4:n="ACESFilmic";break;case 6:n="AgX";break;case 7:n="Neutral";break;case 5:n="Custom"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",r3.colorspace_pars_fragment,(o=function(e){eQ._getMatrix(oM,eQ.workingColorSpace,e);var t="mat3( ".concat(oM.elements.map(function(e){return e.toFixed(4)})," )");switch(eQ.getTransfer(e)){case eC:return[t,"LinearTransferOETF"];case ek:return[t,"sRGBTransferOETF"];default:return[t,"LinearTransferOETF"]}}(n.outputColorSpace),["vec4 ".concat("linearToOutputTexel","( vec4 value ) {"),"	return ".concat(o[1],"( vec4( value.rgb * ").concat(o[0],", value.a ) );"),"}"].join("\n")),(eQ.getLuminanceCoefficients(oT),s=oT.x.toFixed(4),l=oT.y.toFixed(4),u=oT.z.toFixed(4),["float luminance( const in vec3 rgb ) {","	const vec3 weights = vec3( ".concat(s,", ").concat(l,", ").concat(u," );"),"	return dot( weights, rgb );","}"].join("\n")),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(oC).join("\n")),m=oA(m=ok(m=oR(m),n),n),g=oA(g=ok(g=oR(g),n),n),m=oI(m),g=oI(g),!0!==n.isRawShaderMaterial&&(T="#version 300 es\n",c=[S,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+c,h=["#define varying in",n.glslVersion===eA?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===eA?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+h);var C=T+c+m,k=T+h+g,A=ow(f,f.VERTEX_SHADER,C),P=ow(f,f.FRAGMENT_SHADER,k);function R(t){if(e.debug.checkShaderErrors){var n=f.getProgramInfoLog(E).trim(),i=f.getShaderInfoLog(A).trim(),r=f.getShaderInfoLog(P).trim(),a=!0,o=!0;!1===f.getProgramParameter(E,f.LINK_STATUS)?(a=!1,"function"==typeof e.debug.onShaderError?e.debug.onShaderError(f,E,A,P):(oE(f,A,"vertex"),oE(f,P,"fragment"))):""!==n||(""===i||""===r)&&(o=!1),o&&(t.diagnostics={runnable:a,programLog:n,vertexShader:{log:i,prefix:c},fragmentShader:{log:r,prefix:h}})}f.deleteShader(A),f.deleteShader(P),d=new ob(f,E),p=function(e,t){for(var n={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),r=0;r<i;r++){var a=e.getActiveAttrib(t,r),o=a.name,s=1;a.type===e.FLOAT_MAT2&&(s=2),a.type===e.FLOAT_MAT3&&(s=3),a.type===e.FLOAT_MAT4&&(s=4),n[o]={type:a.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(f,E)}f.attachShader(E,A),f.attachShader(E,P),void 0!==n.index0AttributeName?f.bindAttribLocation(E,0,n.index0AttributeName):!0===n.morphTargets&&f.bindAttribLocation(E,0,"position"),f.linkProgram(E),this.getUniforms=function(){return void 0===d&&R(this),d},this.getAttributes=function(){return void 0===p&&R(this),p};var U=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===U&&(U=f.getProgramParameter(E,37297)),U},this.destroy=function(){i.releaseStatesOfProgram(this),f.deleteProgram(E),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=oS++,this.cacheKey=t,this.usedTimes=1,this.program=E,this.vertexShader=A,this.fragmentShader=P,this}var oB=0,oV=function(){function t(){e(this,t),this.shaderCache=new Map,this.materialCache=new Map}return n(t,[{key:"update",value:function(e){var t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(i)&&(a.add(i),i.usedTimes++),!1===a.has(r)&&(a.add(r),r.usedTimes++),this}},{key:"remove",value:function(e){var t=this.materialCache.get(e),n=!0,i=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.usedTimes--,0===s.usedTimes&&this.shaderCache.delete(s.code)}}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return this.materialCache.delete(e),this}},{key:"getVertexShaderID",value:function(e){return this._getShaderStage(e.vertexShader).id}},{key:"getFragmentShaderID",value:function(e){return this._getShaderStage(e.fragmentShader).id}},{key:"dispose",value:function(){this.shaderCache.clear(),this.materialCache.clear()}},{key:"_getShaderCacheForMaterial",value:function(e){var t=this.materialCache,n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}},{key:"_getShaderStage",value:function(e){var t=this.shaderCache,n=t.get(e);return void 0===n&&(n=new oz(e),t.set(e,n)),n}}]),t}(),oz=function t(n){e(this,t),this.id=oB++,this.code=n,this.usedTimes=0};function oG(e,t,n,i,r,a,o){var s=new tH,l=new oV,u=new Set,c=[],h=r.logarithmicDepthBuffer,d=r.vertexTextures,p=r.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(e){return(u.add(e),0===e)?"uv":"uv".concat(e)}return{getParameters:function(a,s,c,m,g){var _,y,x,b,w=m.fog,S=g.geometry,M=a.isMeshStandardMaterial?m.environment:null,E=(a.isMeshStandardMaterial?n:t).get(a.envMap||M),T=E&&306===E.mapping?E.image.height:null,C=f[a.type];null!==a.precision&&(p=r.getMaxPrecision(a.precision),a.precision);var k=S.morphAttributes.position||S.morphAttributes.normal||S.morphAttributes.color,A=void 0!==k?k.length:0,P=0;if(void 0!==S.morphAttributes.position&&(P=1),void 0!==S.morphAttributes.normal&&(P=2),void 0!==S.morphAttributes.color&&(P=3),C){var R=r5[C];_=R.vertexShader,y=R.fragmentShader}else _=a.vertexShader,y=a.fragmentShader,l.update(a),x=l.getVertexShaderID(a),b=l.getFragmentShaderID(a);var U=e.getRenderTarget(),L=e.state.buffers.depth.getReversed(),D=!0===g.isInstancedMesh,I=!0===g.isBatchedMesh,N=!!a.map,O=!!a.matcap,F=!!E,B=!!a.aoMap,V=!!a.lightMap,z=!!a.bumpMap,G=!!a.normalMap,H=!!a.displacementMap,W=!!a.emissiveMap,j=!!a.metalnessMap,X=!!a.roughnessMap,q=a.anisotropy>0,Y=a.clearcoat>0,K=a.dispersion>0,Z=a.iridescence>0,J=a.sheen>0,Q=a.transmission>0,$=q&&!!a.anisotropyMap,ee=Y&&!!a.clearcoatMap,et=Y&&!!a.clearcoatNormalMap,en=Y&&!!a.clearcoatRoughnessMap,ei=Z&&!!a.iridescenceMap,er=Z&&!!a.iridescenceThicknessMap,ea=J&&!!a.sheenColorMap,eo=J&&!!a.sheenRoughnessMap,es=!!a.specularMap,el=!!a.specularColorMap,eu=!!a.specularIntensityMap,ec=Q&&!!a.transmissionMap,eh=Q&&!!a.thicknessMap,ed=!!a.gradientMap,ep=!!a.alphaMap,ef=a.alphaTest>0,ev=!!a.alphaHash,em=!!a.extensions,eg=0;a.toneMapped&&(null===U||!0===U.isXRRenderTarget)&&(eg=e.toneMapping);var e_={shaderID:C,shaderType:a.type,shaderName:a.name,vertexShader:_,fragmentShader:y,defines:a.defines,customVertexShaderID:x,customFragmentShaderID:b,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:p,batching:I,batchingColor:I&&null!==g._colorsTexture,instancing:D,instancingColor:D&&null!==g.instanceColor,instancingMorph:D&&null!==g.morphTexture,supportsVertexTextures:d,outputColorSpace:null===U?e.outputColorSpace:!0===U.isXRRenderTarget?U.texture.colorSpace:eT,alphaToCoverage:!!a.alphaToCoverage,map:N,matcap:O,envMap:F,envMapMode:F&&E.mapping,envMapCubeUVHeight:T,aoMap:B,lightMap:V,bumpMap:z,normalMap:G,displacementMap:d&&H,emissiveMap:W,normalMapObjectSpace:G&&1===a.normalMapType,normalMapTangentSpace:G&&0===a.normalMapType,metalnessMap:j,roughnessMap:X,anisotropy:q,anisotropyMap:$,clearcoat:Y,clearcoatMap:ee,clearcoatNormalMap:et,clearcoatRoughnessMap:en,dispersion:K,iridescence:Z,iridescenceMap:ei,iridescenceThicknessMap:er,sheen:J,sheenColorMap:ea,sheenRoughnessMap:eo,specularMap:es,specularColorMap:el,specularIntensityMap:eu,transmission:Q,transmissionMap:ec,thicknessMap:eh,gradientMap:ed,opaque:!1===a.transparent&&1===a.blending&&!1===a.alphaToCoverage,alphaMap:ep,alphaTest:ef,alphaHash:ev,combine:a.combine,mapUv:N&&v(a.map.channel),aoMapUv:B&&v(a.aoMap.channel),lightMapUv:V&&v(a.lightMap.channel),bumpMapUv:z&&v(a.bumpMap.channel),normalMapUv:G&&v(a.normalMap.channel),displacementMapUv:H&&v(a.displacementMap.channel),emissiveMapUv:W&&v(a.emissiveMap.channel),metalnessMapUv:j&&v(a.metalnessMap.channel),roughnessMapUv:X&&v(a.roughnessMap.channel),anisotropyMapUv:$&&v(a.anisotropyMap.channel),clearcoatMapUv:ee&&v(a.clearcoatMap.channel),clearcoatNormalMapUv:et&&v(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:en&&v(a.clearcoatRoughnessMap.channel),iridescenceMapUv:ei&&v(a.iridescenceMap.channel),iridescenceThicknessMapUv:er&&v(a.iridescenceThicknessMap.channel),sheenColorMapUv:ea&&v(a.sheenColorMap.channel),sheenRoughnessMapUv:eo&&v(a.sheenRoughnessMap.channel),specularMapUv:es&&v(a.specularMap.channel),specularColorMapUv:el&&v(a.specularColorMap.channel),specularIntensityMapUv:eu&&v(a.specularIntensityMap.channel),transmissionMapUv:ec&&v(a.transmissionMap.channel),thicknessMapUv:eh&&v(a.thicknessMap.channel),alphaMapUv:ep&&v(a.alphaMap.channel),vertexTangents:!!S.attributes.tangent&&(G||q),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!S.attributes.color&&4===S.attributes.color.itemSize,pointsUvs:!0===g.isPoints&&!!S.attributes.uv&&(N||ep),fog:!!w,useFog:!0===a.fog,fogExp2:!!w&&w.isFogExp2,flatShading:!0===a.flatShading,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:h,reverseDepthBuffer:L,skinning:!0===g.isSkinnedMesh,morphTargets:void 0!==S.morphAttributes.position,morphNormals:void 0!==S.morphAttributes.normal,morphColors:void 0!==S.morphAttributes.color,morphTargetsCount:A,morphTextureStride:P,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numLightProbes:s.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:eg,decodeVideoTexture:N&&!0===a.map.isVideoTexture&&eQ.getTransfer(a.map.colorSpace)===ek,decodeVideoTextureEmissive:W&&!0===a.emissiveMap.isVideoTexture&&eQ.getTransfer(a.emissiveMap.colorSpace)===ek,premultipliedAlpha:a.premultipliedAlpha,doubleSided:2===a.side,flipSided:1===a.side,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionClipCullDistance:em&&!0===a.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(em&&!0===a.extensions.multiDraw||I)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()};return e_.vertexUv1s=u.has(1),e_.vertexUv2s=u.has(2),e_.vertexUv3s=u.has(3),u.clear(),e_},getProgramCacheKey:function(t){var n,i,r,a,o=[];if(t.shaderID?o.push(t.shaderID):(o.push(t.customVertexShaderID),o.push(t.customFragmentShaderID)),void 0!==t.defines)for(var l in t.defines)o.push(l),o.push(t.defines[l]);return!1===t.isRawShaderMaterial&&(n=o,i=t,n.push(i.precision),n.push(i.outputColorSpace),n.push(i.envMapMode),n.push(i.envMapCubeUVHeight),n.push(i.mapUv),n.push(i.alphaMapUv),n.push(i.lightMapUv),n.push(i.aoMapUv),n.push(i.bumpMapUv),n.push(i.normalMapUv),n.push(i.displacementMapUv),n.push(i.emissiveMapUv),n.push(i.metalnessMapUv),n.push(i.roughnessMapUv),n.push(i.anisotropyMapUv),n.push(i.clearcoatMapUv),n.push(i.clearcoatNormalMapUv),n.push(i.clearcoatRoughnessMapUv),n.push(i.iridescenceMapUv),n.push(i.iridescenceThicknessMapUv),n.push(i.sheenColorMapUv),n.push(i.sheenRoughnessMapUv),n.push(i.specularMapUv),n.push(i.specularColorMapUv),n.push(i.specularIntensityMapUv),n.push(i.transmissionMapUv),n.push(i.thicknessMapUv),n.push(i.combine),n.push(i.fogExp2),n.push(i.sizeAttenuation),n.push(i.morphTargetsCount),n.push(i.morphAttributeCount),n.push(i.numDirLights),n.push(i.numPointLights),n.push(i.numSpotLights),n.push(i.numSpotLightMaps),n.push(i.numHemiLights),n.push(i.numRectAreaLights),n.push(i.numDirLightShadows),n.push(i.numPointLightShadows),n.push(i.numSpotLightShadows),n.push(i.numSpotLightShadowsWithMaps),n.push(i.numLightProbes),n.push(i.shadowMapType),n.push(i.toneMapping),n.push(i.numClippingPlanes),n.push(i.numClipIntersection),n.push(i.depthPacking),r=o,a=t,s.disableAll(),a.supportsVertexTextures&&s.enable(0),a.instancing&&s.enable(1),a.instancingColor&&s.enable(2),a.instancingMorph&&s.enable(3),a.matcap&&s.enable(4),a.envMap&&s.enable(5),a.normalMapObjectSpace&&s.enable(6),a.normalMapTangentSpace&&s.enable(7),a.clearcoat&&s.enable(8),a.iridescence&&s.enable(9),a.alphaTest&&s.enable(10),a.vertexColors&&s.enable(11),a.vertexAlphas&&s.enable(12),a.vertexUv1s&&s.enable(13),a.vertexUv2s&&s.enable(14),a.vertexUv3s&&s.enable(15),a.vertexTangents&&s.enable(16),a.anisotropy&&s.enable(17),a.alphaHash&&s.enable(18),a.batching&&s.enable(19),a.dispersion&&s.enable(20),a.batchingColor&&s.enable(21),r.push(s.mask),s.disableAll(),a.fog&&s.enable(0),a.useFog&&s.enable(1),a.flatShading&&s.enable(2),a.logarithmicDepthBuffer&&s.enable(3),a.reverseDepthBuffer&&s.enable(4),a.skinning&&s.enable(5),a.morphTargets&&s.enable(6),a.morphNormals&&s.enable(7),a.morphColors&&s.enable(8),a.premultipliedAlpha&&s.enable(9),a.shadowMapEnabled&&s.enable(10),a.doubleSided&&s.enable(11),a.flipSided&&s.enable(12),a.useDepthPacking&&s.enable(13),a.dithering&&s.enable(14),a.transmission&&s.enable(15),a.sheen&&s.enable(16),a.opaque&&s.enable(17),a.pointsUvs&&s.enable(18),a.decodeVideoTexture&&s.enable(19),a.decodeVideoTextureEmissive&&s.enable(20),a.alphaToCoverage&&s.enable(21),r.push(s.mask),o.push(e.outputColorSpace)),o.push(t.customProgramCacheKey),o.join()},getUniforms:function(e){var t,n=f[e.type];if(n){var i=r5[n];t=nJ.clone(i.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){for(var i,r=0,o=c.length;r<o;r++){var s=c[r];if(s.cacheKey===n){i=s,++i.usedTimes;break}}return void 0===i&&(i=new oF(e,n,t,a),c.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){var t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function oH(){var e=new WeakMap;return{has:function(t){return e.has(t)},get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function oW(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function oj(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function oX(){var e=[],t=0,n=[],i=[],r=[];function a(n,i,r,a,o,s){var l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:a,renderOrder:n.renderOrder,z:o,group:s},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=a,l.renderOrder=n.renderOrder,l.z=o,l.group=s),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,o,s,l,u){var c=a(e,t,o,s,l,u);o.transmission>0?i.push(c):!0===o.transparent?r.push(c):n.push(c)},unshift:function(e,t,o,s,l,u){var c=a(e,t,o,s,l,u);o.transmission>0?i.unshift(c):!0===o.transparent?r.unshift(c):n.unshift(c)},finish:function(){for(var n=t,i=e.length;n<i;n++){var r=e[n];if(null===r.id)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.group=null}},sort:function(e,t){n.length>1&&n.sort(e||oW),i.length>1&&i.sort(t||oj),r.length>1&&r.sort(t||oj)}}}function oq(){var e=new WeakMap;return{get:function(t,n){var i,r=e.get(t);return void 0===r?(i=new oX,e.set(t,[i])):n>=r.length?(i=new oX,r.push(i)):i=r[n],i},dispose:function(){e=new WeakMap}}}function oY(){var e={};return{get:function(t){var n;if(void 0!==e[t.id])return e[t.id];switch(t.type){case"DirectionalLight":n={direction:new tn,color:new nf};break;case"SpotLight":n={position:new tn,direction:new tn,color:new nf,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new tn,color:new nf,distance:0,decay:0};break;case"HemisphereLight":n={direction:new tn,skyColor:new nf,groundColor:new nf};break;case"RectAreaLight":n={color:new nf,position:new tn,halfWidth:new tn,halfHeight:new tn}}return e[t.id]=n,n}}}var oK=0;function oZ(e,t){return 2*!!t.castShadow-2*!!e.castShadow+ +!!t.map-+!!e.map}function oJ(e){for(var t,n=new oY,i=(t={},{get:function(e){var n;if(void 0!==t[e.id])return t[e.id];switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new eG};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new eG,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0},a=0;a<9;a++)r.probe.push(new tn);var o=new tn,s=new tU,l=new tU;return{setup:function(t){for(var a=0,o=0,s=0,l=0;l<9;l++)r.probe[l].set(0,0,0);var u=0,c=0,h=0,d=0,p=0,f=0,v=0,m=0,g=0,_=0,y=0;t.sort(oZ);for(var x=0,b=t.length;x<b;x++){var w=t[x],S=w.color,M=w.intensity,E=w.distance,T=w.shadow&&w.shadow.map?w.shadow.map.texture:null;if(w.isAmbientLight)a+=S.r*M,o+=S.g*M,s+=S.b*M;else if(w.isLightProbe){for(var C=0;C<9;C++)r.probe[C].addScaledVector(w.sh.coefficients[C],M);y++}else if(w.isDirectionalLight){var k=n.get(w);if(k.color.copy(w.color).multiplyScalar(w.intensity),w.castShadow){var A=w.shadow,P=i.get(w);P.shadowIntensity=A.intensity,P.shadowBias=A.bias,P.shadowNormalBias=A.normalBias,P.shadowRadius=A.radius,P.shadowMapSize=A.mapSize,r.directionalShadow[u]=P,r.directionalShadowMap[u]=T,r.directionalShadowMatrix[u]=w.shadow.matrix,f++}r.directional[u]=k,u++}else if(w.isSpotLight){var R=n.get(w);R.position.setFromMatrixPosition(w.matrixWorld),R.color.copy(S).multiplyScalar(M),R.distance=E,R.coneCos=Math.cos(w.angle),R.penumbraCos=Math.cos(w.angle*(1-w.penumbra)),R.decay=w.decay,r.spot[h]=R;var U=w.shadow;if(w.map&&(r.spotLightMap[g]=w.map,g++,U.updateMatrices(w),w.castShadow&&_++),r.spotLightMatrix[h]=U.matrix,w.castShadow){var L=i.get(w);L.shadowIntensity=U.intensity,L.shadowBias=U.bias,L.shadowNormalBias=U.normalBias,L.shadowRadius=U.radius,L.shadowMapSize=U.mapSize,r.spotShadow[h]=L,r.spotShadowMap[h]=T,m++}h++}else if(w.isRectAreaLight){var D=n.get(w);D.color.copy(S).multiplyScalar(M),D.halfWidth.set(.5*w.width,0,0),D.halfHeight.set(0,.5*w.height,0),r.rectArea[d]=D,d++}else if(w.isPointLight){var I=n.get(w);if(I.color.copy(w.color).multiplyScalar(w.intensity),I.distance=w.distance,I.decay=w.decay,w.castShadow){var N=w.shadow,O=i.get(w);O.shadowIntensity=N.intensity,O.shadowBias=N.bias,O.shadowNormalBias=N.normalBias,O.shadowRadius=N.radius,O.shadowMapSize=N.mapSize,O.shadowCameraNear=N.camera.near,O.shadowCameraFar=N.camera.far,r.pointShadow[c]=O,r.pointShadowMap[c]=T,r.pointShadowMatrix[c]=w.shadow.matrix,v++}r.point[c]=I,c++}else if(w.isHemisphereLight){var F=n.get(w);F.skyColor.copy(w.color).multiplyScalar(M),F.groundColor.copy(w.groundColor).multiplyScalar(M),r.hemi[p]=F,p++}}d>0&&(!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=r4.LTC_FLOAT_1,r.rectAreaLTC2=r4.LTC_FLOAT_2):(r.rectAreaLTC1=r4.LTC_HALF_1,r.rectAreaLTC2=r4.LTC_HALF_2)),r.ambient[0]=a,r.ambient[1]=o,r.ambient[2]=s;var B=r.hash;(B.directionalLength!==u||B.pointLength!==c||B.spotLength!==h||B.rectAreaLength!==d||B.hemiLength!==p||B.numDirectionalShadows!==f||B.numPointShadows!==v||B.numSpotShadows!==m||B.numSpotMaps!==g||B.numLightProbes!==y)&&(r.directional.length=u,r.spot.length=h,r.rectArea.length=d,r.point.length=c,r.hemi.length=p,r.directionalShadow.length=f,r.directionalShadowMap.length=f,r.pointShadow.length=v,r.pointShadowMap.length=v,r.spotShadow.length=m,r.spotShadowMap.length=m,r.directionalShadowMatrix.length=f,r.pointShadowMatrix.length=v,r.spotLightMatrix.length=m+g-_,r.spotLightMap.length=g,r.numSpotLightShadowsWithMaps=_,r.numLightProbes=y,B.directionalLength=u,B.pointLength=c,B.spotLength=h,B.rectAreaLength=d,B.hemiLength=p,B.numDirectionalShadows=f,B.numPointShadows=v,B.numSpotShadows=m,B.numSpotMaps=g,B.numLightProbes=y,r.version=oK++)},setupView:function(e,t){for(var n=0,i=0,a=0,u=0,c=0,h=t.matrixWorldInverse,d=0,p=e.length;d<p;d++){var f=e[d];if(f.isDirectionalLight){var v=r.directional[n];v.direction.setFromMatrixPosition(f.matrixWorld),o.setFromMatrixPosition(f.target.matrixWorld),v.direction.sub(o),v.direction.transformDirection(h),n++}else if(f.isSpotLight){var m=r.spot[a];m.position.setFromMatrixPosition(f.matrixWorld),m.position.applyMatrix4(h),m.direction.setFromMatrixPosition(f.matrixWorld),o.setFromMatrixPosition(f.target.matrixWorld),m.direction.sub(o),m.direction.transformDirection(h),a++}else if(f.isRectAreaLight){var g=r.rectArea[u];g.position.setFromMatrixPosition(f.matrixWorld),g.position.applyMatrix4(h),l.identity(),s.copy(f.matrixWorld),s.premultiply(h),l.extractRotation(s),g.halfWidth.set(.5*f.width,0,0),g.halfHeight.set(0,.5*f.height,0),g.halfWidth.applyMatrix4(l),g.halfHeight.applyMatrix4(l),u++}else if(f.isPointLight){var _=r.point[i];_.position.setFromMatrixPosition(f.matrixWorld),_.position.applyMatrix4(h),i++}else if(f.isHemisphereLight){var y=r.hemi[c];y.direction.setFromMatrixPosition(f.matrixWorld),y.direction.transformDirection(h),c++}}},state:r}}function oQ(e){var t=new oJ(e),n=[],i=[],r={lightsArray:n,shadowsArray:i,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){r.camera=e,n.length=0,i.length=0},state:r,setupLights:function(){t.setup(n)},setupLightsView:function(e){t.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){i.push(e)}}}function o$(e){var t=new WeakMap;return{get:function(n){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=t.get(n);return void 0===a?(i=new oQ(e),t.set(n,[i])):r>=a.length?(i=new oQ(e),a.push(i)):i=a[r],i},dispose:function(){t=new WeakMap}}}function o0(e,t,n){var r,a=new ip,o=new eG,s=new eG,l=new e8,u=new rf({depthPacking:3201}),c=new rv,h={},d=n.maxTextureSize,p=(i(r={},0,1),i(r,1,0),i(r,2,2),r),f=new nQ({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new eG},radius:{value:4}},vertexShader:"void main() {\n	gl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n	const float samples = float( VSM_SAMPLES );\n	float mean = 0.0;\n	float squared_mean = 0.0;\n	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n	for ( float i = 0.0; i < samples; i ++ ) {\n		float uvOffset = uvStart + i * uvStride;\n		#ifdef HORIZONTAL_PASS\n			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n			mean += distribution.x;\n			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n		#else\n			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n			mean += depth;\n			squared_mean += depth * depth;\n		#endif\n	}\n	mean = mean / samples;\n	squared_mean = squared_mean / samples;\n	float std_dev = sqrt( squared_mean - mean * mean );\n	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),v=f.clone();v.defines.HORIZONTAL_PASS=1;var m=new nL;m.setAttribute("position",new nw(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var g=new nj(m,f),_=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;var y=this.type;function x(t,n,i,r){var a=null,o=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==o)a=o;else if(a=!0===i.isPointLight?c:u,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){var s=a.uuid,l=n.uuid,d=h[s];void 0===d&&(d={},h[s]=d);var f=d[l];void 0===f&&(f=a.clone(),d[l]=f,n.addEventListener("dispose",b)),a=f}return a.visible=n.visible,a.wireframe=n.wireframe,3===r?a.side=null!==n.shadowSide?n.shadowSide:n.side:a.side=null!==n.shadowSide?n.shadowSide:p[n.side],a.alphaMap=n.alphaMap,a.alphaTest=n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,!0===i.isPointLight&&!0===a.isMeshDistanceMaterial&&(e.properties.get(a).light=i),a}function b(e){for(var t in e.target.removeEventListener("dispose",b),h){var n=h[t],i=e.target.uuid;i in n&&(n[i].dispose(),delete n[i])}}this.render=function(n,i,r){if(!1!==_.enabled&&(!1!==_.autoUpdate||!1!==_.needsUpdate)&&0!==n.length){var u=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),p=e.state;p.setBlending(0),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(var m=3!==y&&3===this.type,b=3===y&&3!==this.type,w=0,S=n.length;w<S;w++){var M=n[w],E=M.shadow;if(void 0!==E&&(!1!==E.autoUpdate||!1!==E.needsUpdate)){o.copy(E.mapSize);var T=E.getFrameExtents();if(o.multiply(T),s.copy(E.mapSize),(o.x>d||o.y>d)&&(o.x>d&&(s.x=Math.floor(d/T.x),o.x=s.x*T.x,E.mapSize.x=s.x),o.y>d&&(s.y=Math.floor(d/T.y),o.y=s.y*T.y,E.mapSize.y=s.y)),null===E.map||!0===m||!0===b){var C=3!==this.type?{minFilter:1003,magFilter:1003}:{};null!==E.map&&E.map.dispose(),E.map=new e9(o.x,o.y,C),E.map.texture.name=M.name+".shadowMap",E.camera.updateProjectionMatrix()}e.setRenderTarget(E.map),e.clear();for(var k=E.getViewportCount(),A=0;A<k;A++){var P=E.getViewport(A);l.set(s.x*P.x,s.y*P.y,s.x*P.z,s.y*P.w),p.viewport(l),E.updateMatrices(M,A),a=E.getFrustum(),function n(i,r,o,s,l){if(!1!==i.visible){if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&3===l)&&(!i.frustumCulled||a.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,i.matrixWorld);var u=t.update(i),c=i.material;if(Array.isArray(c))for(var h=u.groups,d=0,p=h.length;d<p;d++){var f=h[d],v=c[f.materialIndex];if(v&&v.visible){var m=x(i,v,s,l);i.onBeforeShadow(e,i,r,o,u,m,f),e.renderBufferDirect(o,null,u,m,i,f),i.onAfterShadow(e,i,r,o,u,m,f)}}else if(c.visible){var g=x(i,c,s,l);i.onBeforeShadow(e,i,r,o,u,g,null),e.renderBufferDirect(o,null,u,g,i,null),i.onAfterShadow(e,i,r,o,u,g,null)}}for(var _=i.children,y=0,b=_.length;y<b;y++)n(_[y],r,o,s,l)}}(i,r,E.camera,M,this.type)}!0!==E.isPointLightShadow&&3===this.type&&function(n,i){var r=t.update(g);f.defines.VSM_SAMPLES!==n.blurSamples&&(f.defines.VSM_SAMPLES=n.blurSamples,v.defines.VSM_SAMPLES=n.blurSamples,f.needsUpdate=!0,v.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new e9(o.x,o.y)),f.uniforms.shadow_pass.value=n.map.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,r,f,g,null),v.uniforms.shadow_pass.value=n.mapPass.texture,v.uniforms.resolution.value=n.mapSize,v.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,r,v,g,null)}(E,r),E.needsUpdate=!1}}y=this.type,_.needsUpdate=!1,e.setRenderTarget(u,c,h)}}}var o1=(i(f={},0,1),i(f,2,6),i(f,4,7),i(f,3,5),i(f,1,0),i(f,6,2),i(f,7,4),i(f,5,3),f);function o2(e,t){var n,r,a=new function(){var t=!1,n=new e8,i=null,r=new e8(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,a,o,s){!0===s&&(t*=o,i*=o,a*=o),n.set(t,i,a,o),!1===r.equals(n)&&(e.clearColor(t,i,a,o),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},o=new function(){var n=!1,i=!1,r=null,a=null,o=null;return{setReversed:function(e){if(i!==e){var n=t.get("EXT_clip_control");i?n.clipControlEXT(n.LOWER_LEFT_EXT,n.ZERO_TO_ONE_EXT):n.clipControlEXT(n.LOWER_LEFT_EXT,n.NEGATIVE_ONE_TO_ONE_EXT);var r=o;o=null,this.setClear(r)}i=e},getReversed:function(){return i},setTest:function(t){t?H(e.DEPTH_TEST):W(e.DEPTH_TEST)},setMask:function(t){r===t||n||(e.depthMask(t),r=t)},setFunc:function(t){if(i&&(t=o1[t]),a!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}a=t}},setLocked:function(e){n=e},setClear:function(t){o!==t&&(i&&(t=1-t),e.clearDepth(t),o=t)},reset:function(){n=!1,r=null,a=null,o=null,i=!1}}},s=new function(){var t=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,u=null;return{setTest:function(n){t||(n?H(e.STENCIL_TEST):W(e.STENCIL_TEST))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,o){(i!==t||r!==n||a!==o)&&(e.stencilFunc(t,n,o),i=t,r=n,a=o)},setOp:function(t,n,i){(o!==t||s!==n||l!==i)&&(e.stencilOp(t,n,i),o=t,s=n,l=i)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,u=null}}},l=new WeakMap,u=new WeakMap,c={},h={},d=new WeakMap,p=[],f=null,v=!1,m=null,g=null,_=null,y=null,x=null,b=null,w=null,S=new nf(0,0,0),M=0,E=!1,T=null,C=null,k=null,A=null,P=null,R=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),U=!1,L=0,D=e.getParameter(e.VERSION);-1!==D.indexOf("WebGL")?U=parseFloat(/^WebGL (\d)/.exec(D)[1])>=1:-1!==D.indexOf("OpenGL ES")&&(U=parseFloat(/^OpenGL ES (\d)/.exec(D)[1])>=2);var I=null,N={},O=e.getParameter(e.SCISSOR_BOX),F=e.getParameter(e.VIEWPORT),B=new e8().fromArray(O),V=new e8().fromArray(F);function z(t,n,i,r){var a=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var s=0;s<i;s++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,r,0,e.RGBA,e.UNSIGNED_BYTE,a):e.texImage2D(n+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,a);return o}var G={};function H(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function W(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}G[e.TEXTURE_2D]=z(e.TEXTURE_2D,e.TEXTURE_2D,1),G[e.TEXTURE_CUBE_MAP]=z(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),G[e.TEXTURE_2D_ARRAY]=z(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),G[e.TEXTURE_3D]=z(e.TEXTURE_3D,e.TEXTURE_3D,1,1),a.setClear(0,0,0,1),o.setClear(1),s.setClear(0),H(e.DEPTH_TEST),o.setFunc(3),Y(!1),K(1),H(e.CULL_FACE),q(0);var j=(i(n={},100,e.FUNC_ADD),i(n,101,e.FUNC_SUBTRACT),i(n,102,e.FUNC_REVERSE_SUBTRACT),n);j[103]=e.MIN,j[104]=e.MAX;var X=(i(r={},200,e.ZERO),i(r,201,e.ONE),i(r,202,e.SRC_COLOR),i(r,204,e.SRC_ALPHA),i(r,210,e.SRC_ALPHA_SATURATE),i(r,208,e.DST_COLOR),i(r,206,e.DST_ALPHA),i(r,203,e.ONE_MINUS_SRC_COLOR),i(r,205,e.ONE_MINUS_SRC_ALPHA),i(r,209,e.ONE_MINUS_DST_COLOR),i(r,207,e.ONE_MINUS_DST_ALPHA),i(r,211,e.CONSTANT_COLOR),i(r,212,e.ONE_MINUS_CONSTANT_COLOR),i(r,213,e.CONSTANT_ALPHA),i(r,214,e.ONE_MINUS_CONSTANT_ALPHA),r);function q(t,n,i,r,a,o,s,l,u,c){if(0===t){!0===v&&(W(e.BLEND),v=!1);return}if(!1===v&&(H(e.BLEND),v=!0),5!==t){if(t!==m||c!==E){if((100!==g||100!==x)&&(e.blendEquation(e.FUNC_ADD),g=100,x=100),c)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR)}_=null,y=null,b=null,w=null,S.set(0,0,0),M=0,m=t,E=c}return}a=a||n,o=o||i,s=s||r,(n!==g||a!==x)&&(e.blendEquationSeparate(j[n],j[a]),g=n,x=a),(i!==_||r!==y||o!==b||s!==w)&&(e.blendFuncSeparate(X[i],X[r],X[o],X[s]),_=i,y=r,b=o,w=s),(!1===l.equals(S)||u!==M)&&(e.blendColor(l.r,l.g,l.b,u),S.copy(l),M=u),m=t,E=!1}function Y(t){T!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),T=t)}function K(t){0!==t?(H(e.CULL_FACE),t!==C&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):W(e.CULL_FACE),C=t}function Z(t,n,i){t?(H(e.POLYGON_OFFSET_FILL),(A!==n||P!==i)&&(e.polygonOffset(n,i),A=n,P=i)):W(e.POLYGON_OFFSET_FILL)}return{buffers:{color:a,depth:o,stencil:s},enable:H,disable:W,bindFramebuffer:function(t,n){return h[t]!==n&&(e.bindFramebuffer(t,n),h[t]=n,t===e.DRAW_FRAMEBUFFER&&(h[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(h[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(t,n){var i=p,r=!1;if(t){void 0===(i=d.get(n))&&(i=[],d.set(n,i));var a=t.textures;if(i.length!==a.length||i[0]!==e.COLOR_ATTACHMENT0){for(var o=0,s=a.length;o<s;o++)i[o]=e.COLOR_ATTACHMENT0+o;i.length=a.length,r=!0}}else i[0]!==e.BACK&&(i[0]=e.BACK,r=!0);r&&e.drawBuffers(i)},useProgram:function(t){return f!==t&&(e.useProgram(t),f=t,!0)},setBlending:q,setMaterial:function(t,n){2===t.side?W(e.CULL_FACE):H(e.CULL_FACE);var i=1===t.side;n&&(i=!i),Y(i),1===t.blending&&!1===t.transparent?q(0):q(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),o.setFunc(t.depthFunc),o.setTest(t.depthTest),o.setMask(t.depthWrite),a.setMask(t.colorWrite);var r=t.stencilWrite;s.setTest(r),r&&(s.setMask(t.stencilWriteMask),s.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),s.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),Z(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?H(e.SAMPLE_ALPHA_TO_COVERAGE):W(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Y,setCullFace:K,setLineWidth:function(t){t!==k&&(U&&e.lineWidth(t),k=t)},setPolygonOffset:Z,setScissorTest:function(t){t?H(e.SCISSOR_TEST):W(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+R-1),I!==t&&(e.activeTexture(t),I=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===I?e.TEXTURE0+R-1:I);var r=N[i];void 0===r&&(r={type:void 0,texture:void 0},N[i]=r),(r.type!==t||r.texture!==n)&&(I!==i&&(e.activeTexture(i),I=i),e.bindTexture(t,n||G[t]),r.type=t,r.texture=n)},unbindTexture:function(){var t=N[I];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){}},updateUBOMapping:function(t,n){var i=u.get(n);void 0===i&&(i=new WeakMap,u.set(n,i));var r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){var i=u.get(n).get(t);l.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),l.set(n,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){}},scissor:function(t){!1===B.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),B.copy(t))},viewport:function(t){!1===V.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),V.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),o.setReversed(!1),e.clearDepth(1),e.stencilMask(0xffffffff),e.stencilFunc(e.ALWAYS,0,0xffffffff),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},I=null,N={},h={},d=new WeakMap,p=[],f=null,v=!1,m=null,g=null,_=null,y=null,x=null,b=null,w=null,S=new nf(0,0,0),M=0,E=!1,T=null,C=null,k=null,A=null,P=null,B.set(0,0,e.canvas.width,e.canvas.height),V.set(0,0,e.canvas.width,e.canvas.height),a.reset(),o.reset(),s.reset()}}}function o3(e,t,n,r,a,o,s){var l,u,c,h,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),f=new eG,v=new WeakMap,m=new WeakMap,g=!1;try{g="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function _(e,t){return g?new OffscreenCanvas(e,t):eq("canvas")}function y(e,t,n){var i=1,r=W(e);if((r.width>n||r.height>n)&&(i=n/Math.max(r.width,r.height)),i<1&&("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame)){var a=Math.floor(i*r.width),o=Math.floor(i*r.height);void 0===l&&(l=_(a,o));var s=t?_(a,o):l;return s.width=a,s.height=o,s.getContext("2d").drawImage(e,0,0,a,o),s}return e}function x(e){return e.generateMipmaps}function b(t){e.generateMipmap(t)}function w(n,i,r,a){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(null!==n&&void 0!==e[n])return e[n];var s=i;if(i===e.RED&&(r===e.FLOAT&&(s=e.R32F),r===e.HALF_FLOAT&&(s=e.R16F),r===e.UNSIGNED_BYTE&&(s=e.R8)),i===e.RED_INTEGER&&(r===e.UNSIGNED_BYTE&&(s=e.R8UI),r===e.UNSIGNED_SHORT&&(s=e.R16UI),r===e.UNSIGNED_INT&&(s=e.R32UI),r===e.BYTE&&(s=e.R8I),r===e.SHORT&&(s=e.R16I),r===e.INT&&(s=e.R32I)),i===e.RG&&(r===e.FLOAT&&(s=e.RG32F),r===e.HALF_FLOAT&&(s=e.RG16F),r===e.UNSIGNED_BYTE&&(s=e.RG8)),i===e.RG_INTEGER&&(r===e.UNSIGNED_BYTE&&(s=e.RG8UI),r===e.UNSIGNED_SHORT&&(s=e.RG16UI),r===e.UNSIGNED_INT&&(s=e.RG32UI),r===e.BYTE&&(s=e.RG8I),r===e.SHORT&&(s=e.RG16I),r===e.INT&&(s=e.RG32I)),i===e.RGB_INTEGER&&(r===e.UNSIGNED_BYTE&&(s=e.RGB8UI),r===e.UNSIGNED_SHORT&&(s=e.RGB16UI),r===e.UNSIGNED_INT&&(s=e.RGB32UI),r===e.BYTE&&(s=e.RGB8I),r===e.SHORT&&(s=e.RGB16I),r===e.INT&&(s=e.RGB32I)),i===e.RGBA_INTEGER&&(r===e.UNSIGNED_BYTE&&(s=e.RGBA8UI),r===e.UNSIGNED_SHORT&&(s=e.RGBA16UI),r===e.UNSIGNED_INT&&(s=e.RGBA32UI),r===e.BYTE&&(s=e.RGBA8I),r===e.SHORT&&(s=e.RGBA16I),r===e.INT&&(s=e.RGBA32I)),i===e.RGB&&r===e.UNSIGNED_INT_5_9_9_9_REV&&(s=e.RGB9_E5),i===e.RGBA){var l=o?eC:eQ.getTransfer(a);r===e.FLOAT&&(s=e.RGBA32F),r===e.HALF_FLOAT&&(s=e.RGBA16F),r===e.UNSIGNED_BYTE&&(s=l===ek?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(s=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(s=e.RGB5_A1)}return(s===e.R16F||s===e.R32F||s===e.RG16F||s===e.RG32F||s===e.RGBA16F||s===e.RGBA32F)&&t.get("EXT_color_buffer_float"),s}function S(t,n){var i;return t?null===n||1014===n||1020===n?i=e.DEPTH24_STENCIL8:1015===n?i=e.DEPTH32F_STENCIL8:1012===n&&(i=e.DEPTH24_STENCIL8):null===n||1014===n||1020===n?i=e.DEPTH_COMPONENT24:1015===n?i=e.DEPTH_COMPONENT32F:1012===n&&(i=e.DEPTH_COMPONENT16),i}function M(e,t){return!0===x(e)||e.isFramebufferTexture&&1003!==e.minFilter&&1006!==e.minFilter?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function E(e){var t=e.target;t.removeEventListener("dispose",E),function(e){var t=r.get(e);if(void 0!==t.__webglInit){var n=e.source,i=m.get(n);if(i){var a=i[t.__cacheKey];a.usedTimes--,0===a.usedTimes&&C(e),0===Object.keys(i).length&&m.delete(n)}r.remove(e)}}(t),t.isVideoTexture&&v.delete(t)}function T(t){var n=t.target;n.removeEventListener("dispose",T),function(t){var n=r.get(t);if(t.depthTexture&&(t.depthTexture.dispose(),r.remove(t.depthTexture)),t.isWebGLCubeRenderTarget)for(var i=0;i<6;i++){if(Array.isArray(n.__webglFramebuffer[i]))for(var a=0;a<n.__webglFramebuffer[i].length;a++)e.deleteFramebuffer(n.__webglFramebuffer[i][a]);else e.deleteFramebuffer(n.__webglFramebuffer[i]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[i])}else{if(Array.isArray(n.__webglFramebuffer))for(var o=0;o<n.__webglFramebuffer.length;o++)e.deleteFramebuffer(n.__webglFramebuffer[o]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(var l=0;l<n.__webglColorRenderbuffer.length;l++)n.__webglColorRenderbuffer[l]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[l]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}for(var u=t.textures,c=0,h=u.length;c<h;c++){var d=r.get(u[c]);d.__webglTexture&&(e.deleteTexture(d.__webglTexture),s.memory.textures--),r.remove(u[c])}r.remove(t)}(n)}function C(t){var n=r.get(t);e.deleteTexture(n.__webglTexture);var i=t.source,a=m.get(i);delete a[n.__cacheKey],s.memory.textures--}var k=0;function A(t,i){var a,o,l=r.get(t);if(t.isVideoTexture&&(a=t,o=s.render.frame,v.get(a)!==o&&(v.set(a,o),a.update())),!1===t.isRenderTargetTexture&&t.version>0&&l.__version!==t.version){var u=t.image;if(null===u);else if(!1===u.complete);else{I(l,t,i);return}}n.bindTexture(e.TEXTURE_2D,l.__webglTexture,e.TEXTURE0+i)}var P=(i(u={},1e3,e.REPEAT),i(u,1001,e.CLAMP_TO_EDGE),i(u,1002,e.MIRRORED_REPEAT),u),R=(i(c={},1003,e.NEAREST),i(c,1004,e.NEAREST_MIPMAP_NEAREST),i(c,1005,e.NEAREST_MIPMAP_LINEAR),i(c,1006,e.LINEAR),i(c,1007,e.LINEAR_MIPMAP_NEAREST),i(c,1008,e.LINEAR_MIPMAP_LINEAR),c),U=(i(h={},512,e.NEVER),i(h,519,e.ALWAYS),i(h,513,e.LESS),i(h,515,e.LEQUAL),i(h,514,e.EQUAL),i(h,518,e.GEQUAL),i(h,516,e.GREATER),i(h,517,e.NOTEQUAL),h);function L(n,i){if(1015===i.type&&!1===t.has("OES_texture_float_linear")&&(1006===i.magFilter||1007===i.magFilter||1005===i.magFilter||1008===i.magFilter||1006===i.minFilter||1007===i.minFilter||1005===i.minFilter||i.minFilter),e.texParameteri(n,e.TEXTURE_WRAP_S,P[i.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,P[i.wrapT]),(n===e.TEXTURE_3D||n===e.TEXTURE_2D_ARRAY)&&e.texParameteri(n,e.TEXTURE_WRAP_R,P[i.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,R[i.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,R[i.minFilter]),i.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,U[i.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")&&1003!==i.magFilter&&(1005===i.minFilter||1008===i.minFilter)&&(1015!==i.type||!1!==t.has("OES_texture_float_linear"))&&(i.anisotropy>1||r.get(i).__currentAnisotropy)){var o=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i.anisotropy,a.getMaxAnisotropy())),r.get(i).__currentAnisotropy=i.anisotropy}}function D(t,n){var i,r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",E));var a=n.source,o=m.get(a);void 0===o&&(o={},m.set(a,o));var l=((i=[]).push(n.wrapS),i.push(n.wrapT),i.push(n.wrapR||0),i.push(n.magFilter),i.push(n.minFilter),i.push(n.anisotropy),i.push(n.internalFormat),i.push(n.format),i.push(n.type),i.push(n.generateMipmaps),i.push(n.premultiplyAlpha),i.push(n.flipY),i.push(n.unpackAlignment),i.push(n.colorSpace),i.join());if(l!==t.__cacheKey){void 0===o[l]&&(o[l]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,r=!0),o[l].usedTimes++;var u=o[t.__cacheKey];void 0!==u&&(o[t.__cacheKey].usedTimes--,0===u.usedTimes&&C(n)),t.__cacheKey=l,t.__webglTexture=o[l].texture}return r}function I(t,i,s){var l=e.TEXTURE_2D;(i.isDataArrayTexture||i.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),i.isData3DTexture&&(l=e.TEXTURE_3D);var u=D(t,i),c=i.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+s);var h=r.get(c);if(c.version!==h.__version||!0===u){n.activeTexture(e.TEXTURE0+s);var d=eQ.getPrimaries(eQ.workingColorSpace),p=""===i.colorSpace?null:eQ.getPrimaries(i.colorSpace),f=""===i.colorSpace||d===p?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,i.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,f);var v=y(i.image,!1,a.maxTextureSize);v=H(i,v);var m=o.convert(i.format,i.colorSpace),g=o.convert(i.type),_=w(i.internalFormat,m,g,i.colorSpace,i.isVideoTexture);L(l,i);var E=i.mipmaps,T=!0!==i.isVideoTexture,C=void 0===h.__version||!0===u,k=c.dataReady,A=M(i,v);if(i.isDepthTexture)_=S(1027===i.format,i.type),C&&(T?n.texStorage2D(e.TEXTURE_2D,1,_,v.width,v.height):n.texImage2D(e.TEXTURE_2D,0,_,v.width,v.height,0,m,g,null));else if(i.isDataTexture){if(E.length>0){T&&C&&n.texStorage2D(e.TEXTURE_2D,A,_,E[0].width,E[0].height);for(var P=0,R=E.length;P<R;P++)V=E[P],T?k&&n.texSubImage2D(e.TEXTURE_2D,P,0,0,V.width,V.height,m,g,V.data):n.texImage2D(e.TEXTURE_2D,P,_,V.width,V.height,0,m,g,V.data);i.generateMipmaps=!1}else T?(C&&n.texStorage2D(e.TEXTURE_2D,A,_,v.width,v.height),k&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,v.width,v.height,m,g,v.data)):n.texImage2D(e.TEXTURE_2D,0,_,v.width,v.height,0,m,g,v.data)}else if(i.isCompressedTexture){if(i.isCompressedArrayTexture){T&&C&&n.texStorage3D(e.TEXTURE_2D_ARRAY,A,_,E[0].width,E[0].height,v.depth);for(var U=0,I=E.length;U<I;U++)if(V=E[U],1023!==i.format){if(null!==m){if(T){if(k){if(i.layerUpdates.size>0){var N=r0(V.width,V.height,i.format,i.type),O=!0,F=!1,B=void 0;try{for(var V,z,G=i.layerUpdates[Symbol.iterator]();!(O=(z=G.next()).done);O=!0){var j=z.value,X=V.data.subarray(j*N/V.data.BYTES_PER_ELEMENT,(j+1)*N/V.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,U,0,0,j,V.width,V.height,1,m,X)}}catch(e){F=!0,B=e}finally{try{O||null==G.return||G.return()}finally{if(F)throw B}}i.clearLayerUpdates()}else n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,U,0,0,0,V.width,V.height,v.depth,m,V.data)}}else n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,U,_,V.width,V.height,v.depth,0,V.data,0,0)}}else T?k&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,U,0,0,0,V.width,V.height,v.depth,m,g,V.data):n.texImage3D(e.TEXTURE_2D_ARRAY,U,_,V.width,V.height,v.depth,0,m,g,V.data)}else{T&&C&&n.texStorage2D(e.TEXTURE_2D,A,_,E[0].width,E[0].height);for(var q=0,Y=E.length;q<Y;q++)V=E[q],1023!==i.format?null!==m&&(T?k&&n.compressedTexSubImage2D(e.TEXTURE_2D,q,0,0,V.width,V.height,m,V.data):n.compressedTexImage2D(e.TEXTURE_2D,q,_,V.width,V.height,0,V.data)):T?k&&n.texSubImage2D(e.TEXTURE_2D,q,0,0,V.width,V.height,m,g,V.data):n.texImage2D(e.TEXTURE_2D,q,_,V.width,V.height,0,m,g,V.data)}}else if(i.isDataArrayTexture){if(T){if(C&&n.texStorage3D(e.TEXTURE_2D_ARRAY,A,_,v.width,v.height,v.depth),k){if(i.layerUpdates.size>0){var K=r0(v.width,v.height,i.format,i.type),Z=!0,J=!1,Q=void 0;try{for(var $,ee=i.layerUpdates[Symbol.iterator]();!(Z=($=ee.next()).done);Z=!0){var et=$.value,en=v.data.subarray(et*K/v.data.BYTES_PER_ELEMENT,(et+1)*K/v.data.BYTES_PER_ELEMENT);n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,et,v.width,v.height,1,m,g,en)}}catch(e){J=!0,Q=e}finally{try{Z||null==ee.return||ee.return()}finally{if(J)throw Q}}i.clearLayerUpdates()}else n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,v.width,v.height,v.depth,m,g,v.data)}}else n.texImage3D(e.TEXTURE_2D_ARRAY,0,_,v.width,v.height,v.depth,0,m,g,v.data)}else if(i.isData3DTexture)T?(C&&n.texStorage3D(e.TEXTURE_3D,A,_,v.width,v.height,v.depth),k&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,v.width,v.height,v.depth,m,g,v.data)):n.texImage3D(e.TEXTURE_3D,0,_,v.width,v.height,v.depth,0,m,g,v.data);else if(i.isFramebufferTexture){if(C){if(T)n.texStorage2D(e.TEXTURE_2D,A,_,v.width,v.height);else for(var ei=v.width,er=v.height,ea=0;ea<A;ea++)n.texImage2D(e.TEXTURE_2D,ea,_,ei,er,0,m,g,null),ei>>=1,er>>=1}}else if(E.length>0){if(T&&C){var eo=W(E[0]);n.texStorage2D(e.TEXTURE_2D,A,_,eo.width,eo.height)}for(var es=0,el=E.length;es<el;es++)V=E[es],T?k&&n.texSubImage2D(e.TEXTURE_2D,es,0,0,m,g,V):n.texImage2D(e.TEXTURE_2D,es,_,m,g,V);i.generateMipmaps=!1}else if(T){if(C){var eu=W(v);n.texStorage2D(e.TEXTURE_2D,A,_,eu.width,eu.height)}k&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,m,g,v)}else n.texImage2D(e.TEXTURE_2D,0,_,m,g,v);x(i)&&b(l),h.__version=c.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}function N(t,i,a,s,l,u){var c=o.convert(a.format,a.colorSpace),h=o.convert(a.type),p=w(a.internalFormat,c,h,a.colorSpace),f=r.get(i),v=r.get(a);if(v.__renderTarget=i,!f.__hasExternalTextures){var m=Math.max(1,i.width>>u),g=Math.max(1,i.height>>u);l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?n.texImage3D(l,u,p,m,g,i.depth,0,c,h,null):n.texImage2D(l,u,p,m,g,0,c,h,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),G(i)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,s,l,v.__webglTexture,0,z(i)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,s,l,v.__webglTexture,u),n.bindFramebuffer(e.FRAMEBUFFER,null)}function O(t,n,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer){var r=n.depthTexture,a=r&&r.isDepthTexture?r.type:null,s=S(n.stencilBuffer,a),l=n.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=z(n);G(n)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,u,s,n.width,n.height):i?e.renderbufferStorageMultisample(e.RENDERBUFFER,u,s,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,s,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,t)}else for(var c=n.textures,h=0;h<c.length;h++){var p=c[h],f=o.convert(p.format,p.colorSpace),v=o.convert(p.type),m=w(p.internalFormat,f,v,p.colorSpace),g=z(n);i&&!1===G(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,g,m,n.width,n.height):G(n)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,g,m,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,m,n.width,n.height)}e.bindRenderbuffer(e.RENDERBUFFER,null)}function F(t){var i=r.get(t),a=!0===t.isWebGLCubeRenderTarget;if(i.__boundDepthTexture!==t.depthTexture){var o=t.depthTexture;if(i.__depthDisposeCallback&&i.__depthDisposeCallback(),o){var s=function(){delete i.__boundDepthTexture,delete i.__depthDisposeCallback,o.removeEventListener("dispose",s)};o.addEventListener("dispose",s),i.__depthDisposeCallback=s}i.__boundDepthTexture=o}if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(a)throw Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!(i.depthTexture&&i.depthTexture.isDepthTexture))throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");var a=r.get(i.depthTexture);a.__renderTarget=i,a.__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),A(i.depthTexture,0);var o=a.__webglTexture,s=z(i);if(1026===i.depthTexture.format)G(i)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0);else if(1027===i.depthTexture.format)G(i)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0);else throw Error("Unknown depthTexture format")}(i.__webglFramebuffer,t)}else if(a){i.__webglDepthbuffer=[];for(var l=0;l<6;l++)if(n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[l]),void 0===i.__webglDepthbuffer[l])i.__webglDepthbuffer[l]=e.createRenderbuffer(),O(i.__webglDepthbuffer[l],t,!1);else{var u=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=i.__webglDepthbuffer[l];e.bindRenderbuffer(e.RENDERBUFFER,c),e.framebufferRenderbuffer(e.FRAMEBUFFER,u,e.RENDERBUFFER,c)}}else if(n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),void 0===i.__webglDepthbuffer)i.__webglDepthbuffer=e.createRenderbuffer(),O(i.__webglDepthbuffer,t,!1);else{var h=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,p=i.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,p),e.framebufferRenderbuffer(e.FRAMEBUFFER,h,e.RENDERBUFFER,p)}n.bindFramebuffer(e.FRAMEBUFFER,null)}var B=[],V=[];function z(e){return Math.min(a.maxSamples,e.samples)}function G(e){var n=r.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function H(e,t){var n=e.colorSpace;return e.format,e.type,!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==eT&&""!==n&&eQ.getTransfer(n),t}function W(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?(f.width=e.naturalWidth||e.width,f.height=e.naturalHeight||e.height):"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?(f.width=e.displayWidth,f.height=e.displayHeight):(f.width=e.width,f.height=e.height),f}this.allocateTextureUnit=function(){var e=k;return a.maxTextures,k+=1,e},this.resetTextureUnits=function(){k=0},this.setTexture2D=A,this.setTexture2DArray=function(t,i){var a=r.get(t);if(t.version>0&&a.__version!==t.version){I(a,t,i);return}n.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+i)},this.setTexture3D=function(t,i){var a=r.get(t);if(t.version>0&&a.__version!==t.version){I(a,t,i);return}n.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+i)},this.setTextureCube=function(t,i){var s=r.get(t);if(t.version>0&&s.__version!==t.version){(function(t,i,s){if(6===i.image.length){var l=D(t,i),u=i.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+s);var c=r.get(u);if(u.version!==c.__version||!0===l){n.activeTexture(e.TEXTURE0+s);var h,d=eQ.getPrimaries(eQ.workingColorSpace),p=""===i.colorSpace?null:eQ.getPrimaries(i.colorSpace),f=""===i.colorSpace||d===p?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,i.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,f);for(var v=i.isCompressedTexture||i.image[0].isCompressedTexture,m=i.image[0]&&i.image[0].isDataTexture,g=[],_=0;_<6;_++)v||m?g[_]=m?i.image[_].image:i.image[_]:g[_]=y(i.image[_],!0,a.maxCubemapSize),g[_]=H(i,g[_]);var S=g[0],E=o.convert(i.format,i.colorSpace),T=o.convert(i.type),C=w(i.internalFormat,E,T,i.colorSpace),k=!0!==i.isVideoTexture,A=void 0===c.__version||!0===l,P=u.dataReady,R=M(i,S);if(L(e.TEXTURE_CUBE_MAP,i),v){k&&A&&n.texStorage2D(e.TEXTURE_CUBE_MAP,R,C,S.width,S.height);for(var U=0;U<6;U++){h=g[U].mipmaps;for(var I=0;I<h.length;I++){var N=h[I];1023!==i.format?null!==E&&(k?P&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+U,I,0,0,N.width,N.height,E,N.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+U,I,C,N.width,N.height,0,N.data)):k?P&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+U,I,0,0,N.width,N.height,E,T,N.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+U,I,C,N.width,N.height,0,E,T,N.data)}}}else{if(h=i.mipmaps,k&&A){h.length>0&&R++;var O=W(g[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,R,C,O.width,O.height)}for(var F=0;F<6;F++)if(m){k?P&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+F,0,0,0,g[F].width,g[F].height,E,T,g[F].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+F,0,C,g[F].width,g[F].height,0,E,T,g[F].data);for(var B=0;B<h.length;B++){var V=h[B].image[F].image;k?P&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+F,B+1,0,0,V.width,V.height,E,T,V.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+F,B+1,C,V.width,V.height,0,E,T,V.data)}}else{k?P&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+F,0,0,0,E,T,g[F]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+F,0,C,E,T,g[F]);for(var z=0;z<h.length;z++){var G=h[z];k?P&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+F,z+1,0,0,E,T,G.image[F]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+F,z+1,C,E,T,G.image[F])}}}x(i)&&b(e.TEXTURE_CUBE_MAP),c.__version=u.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}})(s,t,i);return}n.bindTexture(e.TEXTURE_CUBE_MAP,s.__webglTexture,e.TEXTURE0+i)},this.rebindTextures=function(t,n,i){var a=r.get(t);void 0!==n&&N(a.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==i&&F(t)},this.setupRenderTarget=function(t){var i=t.texture,a=r.get(t),l=r.get(i);t.addEventListener("dispose",T);var u=t.textures,c=!0===t.isWebGLCubeRenderTarget,h=u.length>1;if(!h&&(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=i.version,s.memory.textures++),c){a.__webglFramebuffer=[];for(var d=0;d<6;d++)if(i.mipmaps&&i.mipmaps.length>0){a.__webglFramebuffer[d]=[];for(var p=0;p<i.mipmaps.length;p++)a.__webglFramebuffer[d][p]=e.createFramebuffer()}else a.__webglFramebuffer[d]=e.createFramebuffer()}else{if(i.mipmaps&&i.mipmaps.length>0){a.__webglFramebuffer=[];for(var f=0;f<i.mipmaps.length;f++)a.__webglFramebuffer[f]=e.createFramebuffer()}else a.__webglFramebuffer=e.createFramebuffer();if(h)for(var v=0,m=u.length;v<m;v++){var g=r.get(u[v]);void 0===g.__webglTexture&&(g.__webglTexture=e.createTexture(),s.memory.textures++)}if(t.samples>0&&!1===G(t)){a.__webglMultisampledFramebuffer=e.createFramebuffer(),a.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,a.__webglMultisampledFramebuffer);for(var _=0;_<u.length;_++){var y=u[_];a.__webglColorRenderbuffer[_]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,a.__webglColorRenderbuffer[_]);var S=o.convert(y.format,y.colorSpace),M=o.convert(y.type),E=w(y.internalFormat,S,M,y.colorSpace,!0===t.isXRRenderTarget),C=z(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,C,E,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+_,e.RENDERBUFFER,a.__webglColorRenderbuffer[_])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(a.__webglDepthRenderbuffer=e.createRenderbuffer(),O(a.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(c){n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),L(e.TEXTURE_CUBE_MAP,i);for(var k=0;k<6;k++)if(i.mipmaps&&i.mipmaps.length>0)for(var A=0;A<i.mipmaps.length;A++)N(a.__webglFramebuffer[k][A],t,i,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+k,A);else N(a.__webglFramebuffer[k],t,i,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+k,0);x(i)&&b(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){for(var P=0,R=u.length;P<R;P++){var U=u[P],D=r.get(U);n.bindTexture(e.TEXTURE_2D,D.__webglTexture),L(e.TEXTURE_2D,U),N(a.__webglFramebuffer,t,U,e.COLOR_ATTACHMENT0+P,e.TEXTURE_2D,0),x(U)&&b(e.TEXTURE_2D)}n.unbindTexture()}else{var I=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(I=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(I,l.__webglTexture),L(I,i),i.mipmaps&&i.mipmaps.length>0)for(var B=0;B<i.mipmaps.length;B++)N(a.__webglFramebuffer[B],t,i,e.COLOR_ATTACHMENT0,I,B);else N(a.__webglFramebuffer,t,i,e.COLOR_ATTACHMENT0,I,0);x(i)&&b(I),n.unbindTexture()}t.depthBuffer&&F(t)},this.updateRenderTargetMipmap=function(t){for(var i=t.textures,a=0,o=i.length;a<o;a++){var s=i[a];if(x(s)){var l=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:t.isWebGL3DRenderTarget?e.TEXTURE_3D:t.isWebGLArrayRenderTarget||t.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D,u=r.get(s).__webglTexture;n.bindTexture(l,u),b(l),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0){if(!1===G(t)){var i=t.textures,a=t.width,o=t.height,s=e.COLOR_BUFFER_BIT,l=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=r.get(t),c=i.length>1;if(c)for(var h=0;h<i.length;h++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+h,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+h,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(var d=0;d<i.length;d++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(s|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(s|=e.STENCIL_BUFFER_BIT)),c){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[d]);var f=r.get(i[d]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,f,0)}e.blitFramebuffer(0,0,a,o,0,0,a,o,s,e.NEAREST),!0===p&&(B.length=0,V.length=0,B.push(e.COLOR_ATTACHMENT0+d),t.depthBuffer&&!1===t.resolveDepthBuffer&&(B.push(l),V.push(l),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,V)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,B))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),c)for(var v=0;v<i.length;v++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+v,e.RENDERBUFFER,u.__webglColorRenderbuffer[v]);var m=r.get(i[v]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+v,e.TEXTURE_2D,m,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&p){var g=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[g])}}},this.setupDepthRenderbuffer=F,this.setupFrameBufferTexture=N,this.useMultisampledRTT=G}function o4(e,t){return{convert:function(n){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=eQ.getTransfer(r);if(1009===n)return e.UNSIGNED_BYTE;if(1017===n)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===n)return e.UNSIGNED_SHORT_5_5_5_1;if(35902===n)return e.UNSIGNED_INT_5_9_9_9_REV;if(1010===n)return e.BYTE;if(1011===n)return e.SHORT;if(1012===n)return e.UNSIGNED_SHORT;if(1013===n)return e.INT;if(1014===n)return e.UNSIGNED_INT;if(1015===n)return e.FLOAT;if(1016===n)return e.HALF_FLOAT;if(1021===n)return e.ALPHA;if(1022===n)return e.RGB;if(1023===n)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(1026===n)return e.DEPTH_COMPONENT;if(1027===n)return e.DEPTH_STENCIL;if(1028===n)return e.RED;if(1029===n)return e.RED_INTEGER;if(1030===n)return e.RG;if(1031===n)return e.RG_INTEGER;if(1033===n)return e.RGBA_INTEGER;if(33776===n||33777===n||33778===n||33779===n){if(a===ek){if(null===(i=t.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(33776===n)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===n)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===n)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===n)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(i=t.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===n)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===n)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===n)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===n)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}}if(35840===n||35841===n||35842===n||35843===n){if(null===(i=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===n)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===n)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===n)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===n)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n||37492===n||37496===n){if(null===(i=t.get("WEBGL_compressed_texture_etc")))return null;if(36196===n||37492===n)return a===ek?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(37496===n)return a===ek?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(37808===n||37809===n||37810===n||37811===n||37812===n||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n){if(null===(i=t.get("WEBGL_compressed_texture_astc")))return null;if(37808===n)return a===ek?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===n)return a===ek?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===n)return a===ek?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===n)return a===ek?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===n)return a===ek?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===n)return a===ek?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===n)return a===ek?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===n)return a===ek?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===n)return a===ek?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===n)return a===ek?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===n)return a===ek?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===n)return a===ek?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===n)return a===ek?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===n)return a===ek?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===n||36494===n||36495===n){if(null===(i=t.get("EXT_texture_compression_bptc")))return null;if(36492===n)return a===ek?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===n)return i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===n)return i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||36284===n||36285===n||36286===n){if(null===(i=t.get("EXT_texture_compression_rgtc")))return null;if(36492===n)return i.COMPRESSED_RED_RGTC1_EXT;if(36284===n)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===n)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===n)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return 1020===n?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}var o5=function(){function t(){e(this,t),this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}return n(t,[{key:"init",value:function(e,t,n){if(null===this.texture){var i=new e6;e.properties.get(i).__webglTexture=t.texture,(t.depthNear!==n.depthNear||t.depthFar!==n.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}},{key:"getMesh",value:function(e){if(null!==this.texture&&null===this.mesh){var t=e.cameras[0].viewport,n=new nQ({vertexShader:"\nvoid main() {\n\n	gl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n	if ( coord.x >= 1.0 ) {\n\n		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n	} else {\n\n		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n	}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new nj(new rd(20,20),n)}return this.mesh}},{key:"reset",value:function(){this.texture=null,this.mesh=null}},{key:"getDepthTexture",value:function(){return this.texture}}]),t}(),o6=function(t){function n(t,i){e(this,n),r=ev(this,n);var r,a,o=null,s=1,l=null,u="local-floor",c=1,h=null,d=null,p=null,f=null,v=null,m=null,g=new o5,_=i.getContextAttributes(),y=null,x=null,b=[],w=[],S=new eG,M=null,E=new n3;E.viewport=new e8;var T=new n3;T.viewport=new e8;var C=[E,T],k=new rG,A=null,P=null;function R(e){var t=w.indexOf(e.inputSource);if(-1!==t){var n=b[t];void 0!==n&&(n.update(e.inputSource,e.frame,h||l),n.dispatchEvent({type:e.type,data:e.inputSource}))}}function U(){o.removeEventListener("select",R),o.removeEventListener("selectstart",R),o.removeEventListener("selectend",R),o.removeEventListener("squeeze",R),o.removeEventListener("squeezestart",R),o.removeEventListener("squeezeend",R),o.removeEventListener("end",U),o.removeEventListener("inputsourceschange",L);for(var e=0;e<b.length;e++){var n=w[e];null!==n&&(w[e]=null,b[e].disconnect(n))}A=null,P=null,g.reset(),t.setRenderTarget(y),v=null,f=null,p=null,o=null,x=null,F.stop(),r.isPresenting=!1,t.setPixelRatio(M),t.setSize(S.width,S.height,!1),r.dispatchEvent({type:"sessionend"})}function L(e){for(var t=0;t<e.removed.length;t++){var n=e.removed[t],i=w.indexOf(n);i>=0&&(w[i]=null,b[i].disconnect(n))}for(var r=0;r<e.added.length;r++){var a=e.added[r],o=w.indexOf(a);if(-1===o){for(var s=0;s<b.length;s++){if(s>=w.length){w.push(a),o=s;break}if(null===w[s]){w[s]=a,o=s;break}}if(-1===o)break}var l=b[o];l&&l.connect(a)}}r.cameraAutoUpdate=!0,r.enabled=!1,r.isPresenting=!1,r.getController=function(e){var t=b[e];return void 0===t&&(t=new n7,b[e]=t),t.getTargetRaySpace()},r.getControllerGrip=function(e){var t=b[e];return void 0===t&&(t=new n7,b[e]=t),t.getGripSpace()},r.getHand=function(e){var t=b[e];return void 0===t&&(t=new n7,b[e]=t),t.getHandSpace()},r.setFramebufferScaleFactor=function(e){s=e,r.isPresenting},r.setReferenceSpaceType=function(e){u=e,r.isPresenting},r.getReferenceSpace=function(){return h||l},r.setReferenceSpace=function(e){h=e},r.getBaseLayer=function(){return null!==f?f:v},r.getBinding=function(){return p},r.getFrame=function(){return m},r.getSession=function(){return o},r.setSession=(a=el(function(e){var n,a,d,m,g;return ec(this,function(b){switch(b.label){case 0:if(null===(o=e))return[3,4];if(y=t.getRenderTarget(),o.addEventListener("select",R),o.addEventListener("selectstart",R),o.addEventListener("selectend",R),o.addEventListener("squeeze",R),o.addEventListener("squeezestart",R),o.addEventListener("squeezeend",R),o.addEventListener("end",U),o.addEventListener("inputsourceschange",L),!0===_.xrCompatible)return[3,2];return[4,i.makeXRCompatible()];case 1:b.sent(),b.label=2;case 2:return M=t.getPixelRatio(),t.getSize(S),"undefined"!=typeof XRWebGLBinding&&"createProjectionLayer"in XRWebGLBinding.prototype?(a=null,d=null,m=null,_.depth&&(m=_.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,a=_.stencil?1027:1026,d=_.stencil?1020:1014),g={colorFormat:i.RGBA8,depthFormat:m,scaleFactor:s},f=(p=new XRWebGLBinding(o,i)).createProjectionLayer(g),o.updateRenderState({layers:[f]}),t.setPixelRatio(1),t.setSize(f.textureWidth,f.textureHeight,!1),x=new e9(f.textureWidth,f.textureHeight,{format:1023,type:1009,depthTexture:new ik(f.textureWidth,f.textureHeight,d,void 0,void 0,void 0,void 0,void 0,void 0,a),stencilBuffer:_.stencil,colorSpace:t.outputColorSpace,samples:4*!!_.antialias,resolveDepthBuffer:!1===f.ignoreDepthValues})):(n={antialias:_.antialias,alpha:!0,depth:_.depth,stencil:_.stencil,framebufferScaleFactor:s},v=new XRWebGLLayer(o,i,n),o.updateRenderState({baseLayer:v}),t.setPixelRatio(1),t.setSize(v.framebufferWidth,v.framebufferHeight,!1),x=new e9(v.framebufferWidth,v.framebufferHeight,{format:1023,type:1009,colorSpace:t.outputColorSpace,stencilBuffer:_.stencil})),x.isXRRenderTarget=!0,this.setFoveation(c),h=null,[4,o.requestReferenceSpace(u)];case 3:l=b.sent(),F.setContext(o),F.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"}),b.label=4;case 4:return[2]}})}),function(e){return a.apply(this,arguments)}),r.getEnvironmentBlendMode=function(){if(null!==o)return o.environmentBlendMode},r.getDepthTexture=function(){return g.getDepthTexture()};var D=new tn,I=new tn;function N(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}r.updateCamera=function(e){if(null!==o){var t,n,i,r=e.near,a=e.far;null!==g.texture&&(g.depthNear>0&&(r=g.depthNear),g.depthFar>0&&(a=g.depthFar)),k.near=T.near=E.near=r,k.far=T.far=E.far=a,(A!==k.near||P!==k.far)&&(o.updateRenderState({depthNear:k.near,depthFar:k.far}),A=k.near,P=k.far),E.layers.mask=2|e.layers.mask,T.layers.mask=4|e.layers.mask,k.layers.mask=E.layers.mask|T.layers.mask;var s=e.parent,l=k.cameras;N(k,s);for(var u=0;u<l.length;u++)N(l[u],s);2===l.length?function(e,t,n){D.setFromMatrixPosition(t.matrixWorld),I.setFromMatrixPosition(n.matrixWorld);var i=D.distanceTo(I),r=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=r[14]/(r[10]-1),s=r[14]/(r[10]+1),l=(r[9]+1)/r[5],u=(r[9]-1)/r[5],c=(r[8]-1)/r[0],h=(a[8]+1)/a[0],d=i/(-c+h),p=-(d*c);if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(p),e.translateZ(d),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===r[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{var f=o+d,v=s+d;e.projectionMatrix.makePerspective(o*c-p,o*h+(i-p),l*s/v*f,u*s/v*f,f,v),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(k,E,T):k.projectionMatrix.copy(E.projectionMatrix),t=e,n=k,null===(i=s)?t.matrix.copy(n.matrixWorld):(t.matrix.copy(i.matrixWorld),t.matrix.invert(),t.matrix.multiply(n.matrixWorld)),t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(n.projectionMatrix),t.projectionMatrixInverse.copy(n.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*eD*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}},r.getCamera=function(){return k},r.getFoveation=function(){if(null!==f||null!==v)return c},r.setFoveation=function(e){c=e,null!==f&&(f.fixedFoveation=e),null!==v&&void 0!==v.fixedFoveation&&(v.fixedFoveation=e)},r.hasDepthSensing=function(){return null!==g.texture},r.getDepthSensingMesh=function(){return g.getMesh(k)};var O=null,F=new r1;return F.setAnimationLoop(function(e,n){if(d=n.getViewerPose(h||l),m=n,null!==d){var i=d.views;null!==v&&(t.setRenderTargetFramebuffer(x,v.framebuffer),t.setRenderTarget(x));var a=!1;i.length!==k.cameras.length&&(k.cameras.length=0,a=!0);for(var s=0;s<i.length;s++){var u=i[s],c=null;if(null!==v)c=v.getViewport(u);else{var _=p.getViewSubImage(f,u);c=_.viewport,0===s&&(t.setRenderTargetTextures(x,_.colorTexture,f.ignoreDepthValues?void 0:_.depthStencilTexture),t.setRenderTarget(x))}var y=C[s];void 0===y&&((y=new n3).layers.enable(s),y.viewport=new e8,C[s]=y),y.matrix.fromArray(u.transform.matrix),y.matrix.decompose(y.position,y.quaternion,y.scale),y.projectionMatrix.fromArray(u.projectionMatrix),y.projectionMatrixInverse.copy(y.projectionMatrix).invert(),y.viewport.set(c.x,c.y,c.width,c.height),0===s&&(k.matrix.copy(y.matrix),k.matrix.decompose(k.position,k.quaternion,k.scale)),!0===a&&k.cameras.push(y)}var S=o.enabledFeatures;if(S&&S.includes("depth-sensing")&&"gpu-optimized"==o.depthUsage&&p){var M=p.getDepthInformation(i[0]);M&&M.isValid&&M.texture&&g.init(t,M,o.renderState)}}for(var E=0;E<b.length;E++){var T=w[E],A=b[E];null!==T&&void 0!==A&&A.update(T,n,h||l)}O&&O(e,n),n.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:n}),m=null}),r.setAnimationLoop=function(e){O=e},r.dispose=function(){},r}return e_(n,t),n}(eP),o8=new tG,o9=new tU;function o7(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function i(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map,n(i.map,e.mapTransform)),i.alphaMap&&(e.alphaMap.value=i.alphaMap,n(i.alphaMap,e.alphaMapTransform)),i.bumpMap&&(e.bumpMap.value=i.bumpMap,n(i.bumpMap,e.bumpMapTransform),e.bumpScale.value=i.bumpScale,1===i.side&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,n(i.normalMap,e.normalMapTransform),e.normalScale.value.copy(i.normalScale),1===i.side&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,n(i.displacementMap,e.displacementMapTransform),e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,e.emissiveMapTransform)),i.specularMap&&(e.specularMap.value=i.specularMap,n(i.specularMap,e.specularMapTransform)),i.alphaTest>0&&(e.alphaTest.value=i.alphaTest);var r=t.get(i),a=r.envMap,o=r.envMapRotation;a&&(e.envMap.value=a,o8.copy(o),o8.x*=-1,o8.y*=-1,o8.z*=-1,a.isCubeTexture&&!1===a.isRenderTargetTexture&&(o8.y*=-1,o8.z*=-1),e.envMapRotation.value.setFromMatrix4(o9.makeRotationFromEuler(o8)),e.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,e.reflectivity.value=i.reflectivity,e.ior.value=i.ior,e.refractionRatio.value=i.refractionRatio),i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity,n(i.lightMap,e.lightMapTransform)),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity,n(i.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,nZ(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,r,a,o,s){var l,u,c,h,d,p,f,v,m,g,_,y,x,b,w,S,M,E,T,C,k,A,P,R;r.isMeshBasicMaterial?i(e,r):r.isMeshLambertMaterial?i(e,r):r.isMeshToonMaterial?(i(e,r),l=e,(u=r).gradientMap&&(l.gradientMap.value=u.gradientMap)):r.isMeshPhongMaterial?(i(e,r),c=e,h=r,c.specular.value.copy(h.specular),c.shininess.value=Math.max(h.shininess,1e-4)):r.isMeshStandardMaterial?(i(e,r),d=e,p=r,d.metalness.value=p.metalness,p.metalnessMap&&(d.metalnessMap.value=p.metalnessMap,n(p.metalnessMap,d.metalnessMapTransform)),d.roughness.value=p.roughness,p.roughnessMap&&(d.roughnessMap.value=p.roughnessMap,n(p.roughnessMap,d.roughnessMapTransform)),p.envMap&&(d.envMapIntensity.value=p.envMapIntensity),r.isMeshPhysicalMaterial&&(f=e,v=r,m=s,f.ior.value=v.ior,v.sheen>0&&(f.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),f.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(f.sheenColorMap.value=v.sheenColorMap,n(v.sheenColorMap,f.sheenColorMapTransform)),v.sheenRoughnessMap&&(f.sheenRoughnessMap.value=v.sheenRoughnessMap,n(v.sheenRoughnessMap,f.sheenRoughnessMapTransform))),v.clearcoat>0&&(f.clearcoat.value=v.clearcoat,f.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(f.clearcoatMap.value=v.clearcoatMap,n(v.clearcoatMap,f.clearcoatMapTransform)),v.clearcoatRoughnessMap&&(f.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap,n(v.clearcoatRoughnessMap,f.clearcoatRoughnessMapTransform)),v.clearcoatNormalMap&&(f.clearcoatNormalMap.value=v.clearcoatNormalMap,n(v.clearcoatNormalMap,f.clearcoatNormalMapTransform),f.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),1===v.side&&f.clearcoatNormalScale.value.negate())),v.dispersion>0&&(f.dispersion.value=v.dispersion),v.iridescence>0&&(f.iridescence.value=v.iridescence,f.iridescenceIOR.value=v.iridescenceIOR,f.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],f.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(f.iridescenceMap.value=v.iridescenceMap,n(v.iridescenceMap,f.iridescenceMapTransform)),v.iridescenceThicknessMap&&(f.iridescenceThicknessMap.value=v.iridescenceThicknessMap,n(v.iridescenceThicknessMap,f.iridescenceThicknessMapTransform))),v.transmission>0&&(f.transmission.value=v.transmission,f.transmissionSamplerMap.value=m.texture,f.transmissionSamplerSize.value.set(m.width,m.height),v.transmissionMap&&(f.transmissionMap.value=v.transmissionMap,n(v.transmissionMap,f.transmissionMapTransform)),f.thickness.value=v.thickness,v.thicknessMap&&(f.thicknessMap.value=v.thicknessMap,n(v.thicknessMap,f.thicknessMapTransform)),f.attenuationDistance.value=v.attenuationDistance,f.attenuationColor.value.copy(v.attenuationColor)),v.anisotropy>0&&(f.anisotropyVector.value.set(v.anisotropy*Math.cos(v.anisotropyRotation),v.anisotropy*Math.sin(v.anisotropyRotation)),v.anisotropyMap&&(f.anisotropyMap.value=v.anisotropyMap,n(v.anisotropyMap,f.anisotropyMapTransform))),f.specularIntensity.value=v.specularIntensity,f.specularColor.value.copy(v.specularColor),v.specularColorMap&&(f.specularColorMap.value=v.specularColorMap,n(v.specularColorMap,f.specularColorMapTransform)),v.specularIntensityMap&&(f.specularIntensityMap.value=v.specularIntensityMap,n(v.specularIntensityMap,f.specularIntensityMapTransform)))):r.isMeshMatcapMaterial?(i(e,r),g=e,(_=r).matcap&&(g.matcap.value=_.matcap)):r.isMeshDepthMaterial?i(e,r):r.isMeshDistanceMaterial?(i(e,r),y=e,x=r,b=t.get(x).light,y.referencePosition.value.setFromMatrixPosition(b.matrixWorld),y.nearDistance.value=b.shadow.camera.near,y.farDistance.value=b.shadow.camera.far):r.isMeshNormalMaterial?i(e,r):r.isLineBasicMaterial?(w=e,S=r,w.diffuse.value.copy(S.color),w.opacity.value=S.opacity,S.map&&(w.map.value=S.map,n(S.map,w.mapTransform)),r.isLineDashedMaterial&&(M=e,E=r,M.dashSize.value=E.dashSize,M.totalSize.value=E.dashSize+E.gapSize,M.scale.value=E.scale)):r.isPointsMaterial?(T=e,C=r,k=a,A=o,T.diffuse.value.copy(C.color),T.opacity.value=C.opacity,T.size.value=C.size*k,T.scale.value=.5*A,C.map&&(T.map.value=C.map,n(C.map,T.uvTransform)),C.alphaMap&&(T.alphaMap.value=C.alphaMap,n(C.alphaMap,T.alphaMapTransform)),C.alphaTest>0&&(T.alphaTest.value=C.alphaTest)):r.isSpriteMaterial?(P=e,R=r,P.diffuse.value.copy(R.color),P.opacity.value=R.opacity,P.rotation.value=R.rotation,R.map&&(P.map.value=R.map,n(R.map,P.mapTransform)),R.alphaMap&&(P.alphaMap.value=R.alphaMap,n(R.alphaMap,P.alphaMapTransform)),R.alphaTest>0&&(P.alphaTest.value=R.alphaTest)):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function se(e,t,n,i){var r={},a={},o=[],s=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(e){var t={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture,t}function u(t){var n=t.target;n.removeEventListener("dispose",u);var i=o.indexOf(n.__bindingPointIndex);o.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete a[n.id]}return{bind:function(e,t){var n=t.program;i.uniformBlockBinding(e,n)},update:function(n,c){var h,d,p,f,v,m=r[n.id];void 0===m&&(function(e){for(var t=e.uniforms,n=0,i=0,r=t.length;i<r;i++)for(var a=Array.isArray(t[i])?t[i]:[t[i]],o=0,s=a.length;o<s;o++)for(var u=a[o],c=Array.isArray(u.value)?u.value:[u.value],h=0,d=c.length;h<d;h++){var p=l(c[h]),f=n%16,v=f%p.boundary,m=f+v;n+=v,0!==m&&16-m<p.storage&&(n+=16-m),u.__data=new Float32Array(p.storage/Float32Array.BYTES_PER_ELEMENT),u.__offset=n,n+=p.storage}var g=n%16;g>0&&(n+=16-g),e.__size=n,e.__cache={}}(n),h=n,d=function(){for(var e=0;e<s;e++)if(-1===o.indexOf(e))return o.push(e),e;return 0}(),h.__bindingPointIndex=d,p=e.createBuffer(),f=h.__size,v=h.usage,e.bindBuffer(e.UNIFORM_BUFFER,p),e.bufferData(e.UNIFORM_BUFFER,f,v),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,d,p),m=p,r[n.id]=m,n.addEventListener("dispose",u));var g=c.program;i.updateUBOMapping(n,g);var _=t.render.frame;a[n.id]!==_&&(function(t){var n=r[t.id],i=t.uniforms,a=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(var o=0,s=i.length;o<s;o++)for(var u=Array.isArray(i[o])?i[o]:[i[o]],c=0,h=u.length;c<h;c++){var d=u[c];if(!0===function(e,t,n,i){var r=e.value,a=t+"_"+n;if(void 0===i[a])return"number"==typeof r||"boolean"==typeof r?i[a]=r:i[a]=r.clone(),!0;var o=i[a];if("number"==typeof r||"boolean"==typeof r){if(o!==r)return i[a]=r,!0}else if(!1===o.equals(r))return o.copy(r),!0;return!1}(d,o,c,a)){for(var p=d.__offset,f=Array.isArray(d.value)?d.value:[d.value],v=0,m=0;m<f.length;m++){var g=f[m],_=l(g);"number"==typeof g||"boolean"==typeof g?(d.__data[0]=g,e.bufferSubData(e.UNIFORM_BUFFER,p+v,d.__data)):g.isMatrix3?(d.__data[0]=g.elements[0],d.__data[1]=g.elements[1],d.__data[2]=g.elements[2],d.__data[3]=0,d.__data[4]=g.elements[3],d.__data[5]=g.elements[4],d.__data[6]=g.elements[5],d.__data[7]=0,d.__data[8]=g.elements[6],d.__data[9]=g.elements[7],d.__data[10]=g.elements[8],d.__data[11]=0):(g.toArray(d.__data,v),v+=_.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,p,d.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),a[n.id]=_)},dispose:function(){for(var t in r)e.deleteBuffer(r[t]);o=[],r={},a={}}}}var st=function(){function t(){var n,i,r,a,o,s,l,u,c,h,d,p,f,v,m,g,_,y,x,b,w,S,M,E,T,C,k,A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e(this,t);var P=A.canvas,R=void 0===P?((n=eq("canvas")).style.display="block",n):P,U=A.context,L=void 0===U?null:U,D=A.depth,I=A.stencil,N=void 0!==I&&I,O=A.alpha,F=A.antialias,B=A.premultipliedAlpha,V=void 0===B||B,z=A.preserveDrawingBuffer,G=A.powerPreference,H=A.failIfMajorPerformanceCaveat,W=A.reverseDepthBuffer,j=void 0!==W&&W;if(this.isWebGLRenderer=!0,null!==L){if("undefined"!=typeof WebGLRenderingContext&&L instanceof WebGLRenderingContext)throw Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");r=L.getContextAttributes().alpha}else r=void 0!==O&&O;var X=new Uint32Array(4),q=new Int32Array(4),Y=null,K=null,Z=[],J=[];this.domElement=R,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=eE,this.toneMapping=0,this.toneMappingExposure=1;var Q=this,$=!1,ee=0,et=0,en=null,ei=-1,er=null,ea=new e8,eo=new e8,es=null,eu=new nf(0),eh=0,ed=R.width,ep=R.height,ef=1,ev=null,em=null,eg=new e8(0,0,ed,ep),e_=new e8(0,0,ed,ep),ey=!1,ex=new ip,eb=!1,ew=!1;this.transmissionResolutionScale=1;var eS=new tU,eM=new tU,eC=new tn,ek=new e8,eA={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0},eP=!1;function eR(){return null===en?ef:1}var eU=L;function eL(e,t){return R.getContext(e,t)}try{if("setAttribute"in R&&R.setAttribute("data-engine","three.js r".concat("173")),R.addEventListener("webglcontextlost",eO,!1),R.addEventListener("webglcontextrestored",eF,!1),R.addEventListener("webglcontextcreationerror",eB,!1),null===eU){var eD="webgl2";if(eU=eL(eD,{alpha:!0,depth:void 0===D||D,stencil:N,antialias:void 0!==F&&F,premultipliedAlpha:V,preserveDrawingBuffer:void 0!==z&&z,powerPreference:void 0===G?"default":G,failIfMajorPerformanceCaveat:void 0!==H&&H}),null===eU){if(eL(eD))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.")}}}catch(e){throw e}function eI(){(a=new aw(eU)).init(),T=new o4(eU,a),o=new an(eU,a,A,T),s=new o2(eU,a),o.reverseDepthBuffer&&j&&s.buffers.depth.setReversed(!0),l=new aE(eU),u=new oH,c=new o3(eU,a,s,u,o,T,l),h=new ar(Q),d=new ab(Q),p=new r2(eU),C=new ae(eU,p),f=new aS(eU,p,l,C),v=new aC(eU,f,p,l),S=new aT(eU,o,c),x=new ai(u),m=new oG(Q,h,d,a,o,C,x),g=new o7(Q,u),_=new oq,y=new o$(a),w=new r7(Q,h,d,s,v,r,V),b=new o0(Q,v,o),k=new se(eU,l,o,s),M=new at(eU,a,l),E=new aM(eU,a,l),l.programs=m.programs,Q.capabilities=o,Q.extensions=a,Q.properties=u,Q.renderLists=_,Q.shadowMap=b,Q.state=s,Q.info=l}eI();var eN=new o6(Q,eU);function eO(e){e.preventDefault(),$=!0}function eF(){$=!1;var e=l.autoReset,t=b.enabled,n=b.autoUpdate,i=b.needsUpdate,r=b.type;eI(),l.autoReset=e,b.enabled=t,b.autoUpdate=n,b.needsUpdate=i,b.type=r}function eB(e){}function eV(e){var t,n,i,r=e.target;r.removeEventListener("dispose",eV),n=t=r,void 0!==(i=u.get(n).programs)&&(i.forEach(function(e){m.releaseProgram(e)}),n.isShaderMaterial&&m.releaseShaderCache(n)),u.remove(t)}function ez(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,e0(e,t,n),e.side=0,e.needsUpdate=!0,e0(e,t,n),e.side=2):e0(e,t,n)}this.xr=eN,this.getContext=function(){return eU},this.getContextAttributes=function(){return eU.getContextAttributes()},this.forceContextLoss=function(){var e=a.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=a.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return ef},this.setPixelRatio=function(e){void 0!==e&&(ef=e,this.setSize(ed,ep,!1))},this.getSize=function(e){return e.set(ed,ep)},this.setSize=function(e,t){var n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];!eN.isPresenting&&(ed=e,ep=t,R.width=Math.floor(e*ef),R.height=Math.floor(t*ef),!0===n&&(R.style.width=e+"px",R.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(ed*ef,ep*ef).floor()},this.setDrawingBufferSize=function(e,t,n){ed=e,ep=t,ef=n,R.width=Math.floor(e*n),R.height=Math.floor(t*n),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(ea)},this.getViewport=function(e){return e.copy(eg)},this.setViewport=function(e,t,n,i){e.isVector4?eg.set(e.x,e.y,e.z,e.w):eg.set(e,t,n,i),s.viewport(ea.copy(eg).multiplyScalar(ef).round())},this.getScissor=function(e){return e.copy(e_)},this.setScissor=function(e,t,n,i){e.isVector4?e_.set(e.x,e.y,e.z,e.w):e_.set(e,t,n,i),s.scissor(eo.copy(e_).multiplyScalar(ef).round())},this.getScissorTest=function(){return ey},this.setScissorTest=function(e){s.setScissorTest(ey=e)},this.setOpaqueSort=function(e){ev=e},this.setTransparentSort=function(e){em=e},this.getClearColor=function(e){return e.copy(w.getClearColor())},this.setClearColor=function(){w.setClearColor.apply(w,arguments)},this.getClearAlpha=function(){return w.getClearAlpha()},this.setClearAlpha=function(){w.setClearAlpha.apply(w,arguments)},this.clear=function(){var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],i=0;if(e){var r=!1;if(null!==en){var a=en.texture.format;r=1033===a||1031===a||1029===a}if(r){var o=en.texture.type,s=1009===o||1014===o||1012===o||1020===o||1017===o||1018===o,l=w.getClearColor(),u=w.getClearAlpha(),c=l.r,h=l.g,d=l.b;s?(X[0]=c,X[1]=h,X[2]=d,X[3]=u,eU.clearBufferuiv(eU.COLOR,0,X)):(q[0]=c,q[1]=h,q[2]=d,q[3]=u,eU.clearBufferiv(eU.COLOR,0,q))}else i|=eU.COLOR_BUFFER_BIT}t&&(i|=eU.DEPTH_BUFFER_BIT),n&&(i|=eU.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(0xffffffff)),eU.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){R.removeEventListener("webglcontextlost",eO,!1),R.removeEventListener("webglcontextrestored",eF,!1),R.removeEventListener("webglcontextcreationerror",eB,!1),w.dispose(),_.dispose(),y.dispose(),u.dispose(),h.dispose(),d.dispose(),v.dispose(),C.dispose(),k.dispose(),m.dispose(),eN.dispose(),eN.removeEventListener("sessionstart",eH),eN.removeEventListener("sessionend",eW),ej.stop()},this.renderBufferDirect=function(e,t,n,i,r,l){null===t&&(t=eA);var v,m=r.isMesh&&0>r.matrixWorld.determinant(),_=function(e,t,n,i,r){!0!==t.isScene&&(t=eA),c.resetTextureUnits();var a,l,p,f,v=t.fog,m=i.isMeshStandardMaterial?t.environment:null,_=null===en?Q.outputColorSpace:!0===en.isXRRenderTarget?en.texture.colorSpace:eT,y=(i.isMeshStandardMaterial?d:h).get(i.envMap||m),b=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,w=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),M=!!n.morphAttributes.position,E=!!n.morphAttributes.normal,T=!!n.morphAttributes.color,C=0;i.toneMapped&&(null===en||!0===en.isXRRenderTarget)&&(C=Q.toneMapping);var A=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,P=void 0!==A?A.length:0,R=u.get(i),U=K.state.lights;if(!0===eb&&(!0===ew||e!==er)){var L=e===er&&i.id===ei;x.setState(i,e,L)}var D=!1;i.version===R.__version?R.needsLights&&R.lightsStateVersion!==U.state.version?D=!0:R.outputColorSpace!==_?D=!0:r.isBatchedMesh&&!1===R.batching?D=!0:r.isBatchedMesh||!0!==R.batching?r.isBatchedMesh&&!0===R.batchingColor&&null===r.colorTexture?D=!0:r.isBatchedMesh&&!1===R.batchingColor&&null!==r.colorTexture?D=!0:r.isInstancedMesh&&!1===R.instancing?D=!0:r.isInstancedMesh||!0!==R.instancing?r.isSkinnedMesh&&!1===R.skinning?D=!0:r.isSkinnedMesh||!0!==R.skinning?r.isInstancedMesh&&!0===R.instancingColor&&null===r.instanceColor?D=!0:r.isInstancedMesh&&!1===R.instancingColor&&null!==r.instanceColor?D=!0:r.isInstancedMesh&&!0===R.instancingMorph&&null===r.morphTexture?D=!0:r.isInstancedMesh&&!1===R.instancingMorph&&null!==r.morphTexture?D=!0:R.envMap!==y?D=!0:!0===i.fog&&R.fog!==v?D=!0:void 0!==R.numClippingPlanes&&(R.numClippingPlanes!==x.numPlanes||R.numIntersection!==x.numIntersection)?D=!0:R.vertexAlphas!==b?D=!0:R.vertexTangents!==w?D=!0:R.morphTargets!==M?D=!0:R.morphNormals!==E?D=!0:R.morphColors!==T?D=!0:R.toneMapping!==C?D=!0:R.morphTargetsCount!==P&&(D=!0):D=!0:D=!0:D=!0:(D=!0,R.__version=i.version);var I=R.currentProgram;!0===D&&(I=e0(i,t,r));var N=!1,O=!1,F=!1,B=I.getUniforms(),V=R.uniforms;if(s.useProgram(I.program)&&(N=!0,O=!0,F=!0),i.id!==ei&&(ei=i.id,O=!0),N||er!==e){s.buffers.depth.getReversed()?(eS.copy(e.projectionMatrix),(p=eS.elements)[2]=.5*p[2]+.5*p[3],p[6]=.5*p[6]+.5*p[7],p[10]=.5*p[10]+.5*p[11],p[14]=.5*p[14]+.5*p[15],-1===(f=eS.elements)[11]?(f[10]=-f[10]-1,f[14]=-f[14]):(f[10]=-f[10],f[14]=-f[14]+1),B.setValue(eU,"projectionMatrix",eS)):B.setValue(eU,"projectionMatrix",e.projectionMatrix),B.setValue(eU,"viewMatrix",e.matrixWorldInverse);var z=B.map.cameraPosition;void 0!==z&&z.setValue(eU,eC.setFromMatrixPosition(e.matrixWorld)),o.logarithmicDepthBuffer&&B.setValue(eU,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&B.setValue(eU,"isOrthographic",!0===e.isOrthographicCamera),er!==e&&(er=e,O=!0,F=!0)}if(r.isSkinnedMesh){B.setOptional(eU,r,"bindMatrix"),B.setOptional(eU,r,"bindMatrixInverse");var G=r.skeleton;G&&(null===G.boneTexture&&G.computeBoneTexture(),B.setValue(eU,"boneTexture",G.boneTexture,c))}r.isBatchedMesh&&(B.setOptional(eU,r,"batchingTexture"),B.setValue(eU,"batchingTexture",r._matricesTexture,c),B.setOptional(eU,r,"batchingIdTexture"),B.setValue(eU,"batchingIdTexture",r._indirectTexture,c),B.setOptional(eU,r,"batchingColorTexture"),null!==r._colorsTexture&&B.setValue(eU,"batchingColorTexture",r._colorsTexture,c));var H=n.morphAttributes;if((void 0!==H.position||void 0!==H.normal||void 0!==H.color)&&S.update(r,n,I),(O||R.receiveShadow!==r.receiveShadow)&&(R.receiveShadow=r.receiveShadow,B.setValue(eU,"receiveShadow",r.receiveShadow)),i.isMeshGouraudMaterial&&null!==i.envMap&&(V.envMap.value=y,V.flipEnvMap.value=y.isCubeTexture&&!1===y.isRenderTargetTexture?-1:1),i.isMeshStandardMaterial&&null===i.envMap&&null!==t.environment&&(V.envMapIntensity.value=t.environmentIntensity),O&&(B.setValue(eU,"toneMappingExposure",Q.toneMappingExposure),R.needsLights&&(a=V,l=F,a.ambientLightColor.needsUpdate=l,a.lightProbe.needsUpdate=l,a.directionalLights.needsUpdate=l,a.directionalLightShadows.needsUpdate=l,a.pointLights.needsUpdate=l,a.pointLightShadows.needsUpdate=l,a.spotLights.needsUpdate=l,a.spotLightShadows.needsUpdate=l,a.rectAreaLights.needsUpdate=l,a.hemisphereLights.needsUpdate=l),v&&!0===i.fog&&g.refreshFogUniforms(V,v),g.refreshMaterialUniforms(V,i,ef,ep,K.state.transmissionRenderTarget[e.id]),ob.upload(eU,e1(R),V,c)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(ob.upload(eU,e1(R),V,c),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&B.setValue(eU,"center",r.center),B.setValue(eU,"modelViewMatrix",r.modelViewMatrix),B.setValue(eU,"normalMatrix",r.normalMatrix),B.setValue(eU,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial)for(var W=i.uniformsGroups,j=0,X=W.length;j<X;j++){var q=W[j];k.update(q,I),k.bind(q,I)}return I}(e,t,n,i,r);s.setMaterial(i,m);var y=n.index,b=1;if(!0===i.wireframe){if(void 0===(y=f.getWireframeAttribute(n)))return;b=2}var w=n.drawRange,T=n.attributes.position,A=w.start*b,P=(w.start+w.count)*b;null!==l&&(A=Math.max(A,l.start*b),P=Math.min(P,(l.start+l.count)*b)),null!==y?(A=Math.max(A,0),P=Math.min(P,y.count)):null!=T&&(A=Math.max(A,0),P=Math.min(P,T.count));var R=P-A;if(!(R<0)&&R!==1/0){C.setup(r,i,_,n,y);var U=M;if(null!==y&&(v=p.get(y),(U=E).setIndex(v)),r.isMesh)!0===i.wireframe?(s.setLineWidth(i.wireframeLinewidth*eR()),U.setMode(eU.LINES)):U.setMode(eU.TRIANGLES);else if(r.isLine){var L=i.linewidth;void 0===L&&(L=1),s.setLineWidth(L*eR()),r.isLineSegments?U.setMode(eU.LINES):r.isLineLoop?U.setMode(eU.LINE_LOOP):U.setMode(eU.LINE_STRIP)}else r.isPoints?U.setMode(eU.POINTS):r.isSprite&&U.setMode(eU.TRIANGLES);if(r.isBatchedMesh){if(null!==r._multiDrawInstances)U.renderMultiDrawInstances(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount,r._multiDrawInstances);else if(a.get("WEBGL_multi_draw"))U.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else for(var D=r._multiDrawStarts,I=r._multiDrawCounts,N=r._multiDrawCount,O=y?p.get(y).bytesPerElement:1,F=u.get(i).currentProgram.getUniforms(),B=0;B<N;B++)F.setValue(eU,"_gl_DrawID",B),U.render(D[B]/O,I[B])}else if(r.isInstancedMesh)U.renderInstances(A,R,r.count);else if(n.isInstancedBufferGeometry){var V=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,z=Math.min(n.instanceCount,V);U.renderInstances(A,R,z)}else U.render(A,R)}},this.compile=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=e),(K=y.get(n)).init(t),J.push(K),n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(K.pushLight(e),e.castShadow&&K.pushShadow(e))}),e!==n&&e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(K.pushLight(e),e.castShadow&&K.pushShadow(e))}),K.setupLights();var i=new Set;return e.traverse(function(e){if(e.isMesh||e.isPoints||e.isLine||e.isSprite){var t=e.material;if(t){if(Array.isArray(t))for(var r=0;r<t.length;r++){var a=t[r];ez(a,n,e),i.add(a)}else ez(t,n,e),i.add(t)}}}),J.pop(),K=null,i},this.compileAsync=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=this.compile(e,t,n);return new Promise(function(t){function n(){if(i.forEach(function(e){u.get(e).currentProgram.isReady()&&i.delete(e)}),0===i.size){t(e);return}setTimeout(n,10)}null!==a.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};var eG=null;function eH(){ej.stop()}function eW(){ej.start()}var ej=new r1;function eX(e,t,n,i){if(!1!==e.visible){if(e.layers.test(t.layers)){if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)K.pushLight(e),e.castShadow&&K.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||ex.intersectsSprite(e)){i&&ek.setFromMatrixPosition(e.matrixWorld).applyMatrix4(eM);var r=v.update(e),a=e.material;a.visible&&Y.push(e,r,a,n,ek.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||ex.intersectsObject(e))){var o=v.update(e),s=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),ek.copy(e.boundingSphere.center)):(null===o.boundingSphere&&o.computeBoundingSphere(),ek.copy(o.boundingSphere.center)),ek.applyMatrix4(e.matrixWorld).applyMatrix4(eM)),Array.isArray(s))for(var l=o.groups,u=0,c=l.length;u<c;u++){var h=l[u],d=s[h.materialIndex];d&&d.visible&&Y.push(e,o,d,n,ek.z,h)}else s.visible&&Y.push(e,o,s,n,ek.z,null)}}for(var p=e.children,f=0,m=p.length;f<m;f++)eX(p[f],t,n,i)}}function eY(e,t,n,i){var r=e.opaque,a=e.transmissive,o=e.transparent;K.setupLightsView(n),!0===eb&&x.setGlobalState(Q.clippingPlanes,n),i&&s.viewport(ea.copy(i)),r.length>0&&eJ(r,t,n),a.length>0&&eJ(a,t,n),o.length>0&&eJ(o,t,n),s.buffers.depth.setTest(!0),s.buffers.depth.setMask(!0),s.buffers.color.setMask(!0),s.setPolygonOffset(!1)}function eZ(e,t,n,i){if(null===(!0===n.isScene?n.overrideMaterial:null)){void 0===K.state.transmissionRenderTarget[i.id]&&(K.state.transmissionRenderTarget[i.id]=new e9(1,1,{generateMipmaps:!0,type:a.has("EXT_color_buffer_half_float")||a.has("EXT_color_buffer_float")?1016:1009,minFilter:1008,samples:4,stencilBuffer:N,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:eQ.workingColorSpace}));var r=K.state.transmissionRenderTarget[i.id],o=i.viewport||ea;r.setSize(o.z*Q.transmissionResolutionScale,o.w*Q.transmissionResolutionScale);var s=Q.getRenderTarget();Q.setRenderTarget(r),Q.getClearColor(eu),(eh=Q.getClearAlpha())<1&&Q.setClearColor(0xffffff,.5),Q.clear(),eP&&w.render(n);var l=Q.toneMapping;Q.toneMapping=0;var u=i.viewport;if(void 0!==i.viewport&&(i.viewport=void 0),K.setupLightsView(i),!0===eb&&x.setGlobalState(Q.clippingPlanes,i),eJ(e,n,i),c.updateMultisampleRenderTarget(r),c.updateRenderTargetMipmap(r),!1===a.has("WEBGL_multisampled_render_to_texture")){for(var h=!1,d=0,p=t.length;d<p;d++){var f=t[d],v=f.object,m=f.geometry,g=f.material,_=f.group;if(2===g.side&&v.layers.test(i.layers)){var y=g.side;g.side=1,g.needsUpdate=!0,e$(v,n,i,m,g,_),g.side=y,g.needsUpdate=!0,h=!0}}!0===h&&(c.updateMultisampleRenderTarget(r),c.updateRenderTargetMipmap(r))}Q.setRenderTarget(s),Q.setClearColor(eu,eh),void 0!==u&&(i.viewport=u),Q.toneMapping=l}}function eJ(e,t,n){for(var i=!0===t.isScene?t.overrideMaterial:null,r=0,a=e.length;r<a;r++){var o=e[r],s=o.object,l=o.geometry,u=null===i?o.material:i,c=o.group;s.layers.test(n.layers)&&e$(s,t,n,l,u,c)}}function e$(e,t,n,i,r,a){e.onBeforeRender(Q,t,n,i,r,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(Q,t,n,i,e,a),!0===r.transparent&&2===r.side&&!1===r.forceSinglePass?(r.side=1,r.needsUpdate=!0,Q.renderBufferDirect(n,t,i,r,e,a),r.side=0,r.needsUpdate=!0,Q.renderBufferDirect(n,t,i,r,e,a),r.side=2):Q.renderBufferDirect(n,t,i,r,e,a),e.onAfterRender(Q,t,n,i,r,a)}function e0(e,t,n){!0!==t.isScene&&(t=eA);var i,r=u.get(e),a=K.state.lights,o=K.state.shadowsArray,s=a.state.version,l=m.getParameters(e,a.state,o,t,n),c=m.getProgramCacheKey(l),p=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?d:h).get(e.envMap||r.environment),r.envMapRotation=null!==r.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===p&&(e.addEventListener("dispose",eV),p=new Map,r.programs=p);var f=p.get(c);if(void 0!==f){if(r.currentProgram===f&&r.lightsStateVersion===s)return e2(e,l),f}else l.uniforms=m.getUniforms(e),e.onBeforeCompile(l,Q),f=m.acquireProgram(l,c),p.set(c,f),r.uniforms=l.uniforms;var v=r.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(v.clippingPlanes=x.uniform),e2(e,l),r.needsLights=(i=e).isMeshLambertMaterial||i.isMeshToonMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.isShadowMaterial||i.isShaderMaterial&&!0===i.lights,r.lightsStateVersion=s,r.needsLights&&(v.ambientLightColor.value=a.state.ambient,v.lightProbe.value=a.state.probe,v.directionalLights.value=a.state.directional,v.directionalLightShadows.value=a.state.directionalShadow,v.spotLights.value=a.state.spot,v.spotLightShadows.value=a.state.spotShadow,v.rectAreaLights.value=a.state.rectArea,v.ltc_1.value=a.state.rectAreaLTC1,v.ltc_2.value=a.state.rectAreaLTC2,v.pointLights.value=a.state.point,v.pointLightShadows.value=a.state.pointShadow,v.hemisphereLights.value=a.state.hemi,v.directionalShadowMap.value=a.state.directionalShadowMap,v.directionalShadowMatrix.value=a.state.directionalShadowMatrix,v.spotShadowMap.value=a.state.spotShadowMap,v.spotLightMatrix.value=a.state.spotLightMatrix,v.spotLightMap.value=a.state.spotLightMap,v.pointShadowMap.value=a.state.pointShadowMap,v.pointShadowMatrix.value=a.state.pointShadowMatrix),r.currentProgram=f,r.uniformsList=null,f}function e1(e){if(null===e.uniformsList){var t=e.currentProgram.getUniforms();e.uniformsList=ob.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function e2(e,t){var n=u.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.batchingColor=t.batchingColor,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}ej.setAnimationLoop(function(e){eG&&eG(e)}),"undefined"!=typeof self&&ej.setContext(self),this.setAnimationLoop=function(e){eG=e,eN.setAnimationLoop(e),null===e?ej.stop():ej.start()},eN.addEventListener("sessionstart",eH),eN.addEventListener("sessionend",eW),this.render=function(e,t){if((void 0===t||!0===t.isCamera)&&!0!==$){if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===eN.enabled&&!0===eN.isPresenting&&(!0===eN.cameraAutoUpdate&&eN.updateCamera(t),t=eN.getCamera()),!0===e.isScene&&e.onBeforeRender(Q,e,t,en),(K=y.get(e,J.length)).init(t),J.push(K),eM.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ex.setFromProjectionMatrix(eM),ew=this.localClippingEnabled,eb=x.init(this.clippingPlanes,ew),(Y=_.get(e,Z.length)).init(),Z.push(Y),!0===eN.enabled&&!0===eN.isPresenting){var n=Q.xr.getDepthSensingMesh();null!==n&&eX(n,t,-1/0,Q.sortObjects)}eX(e,t,0,Q.sortObjects),Y.finish(),!0===Q.sortObjects&&Y.sort(ev,em),(eP=!1===eN.enabled||!1===eN.isPresenting||!1===eN.hasDepthSensing())&&w.addToRenderList(Y,e),this.info.render.frame++,!0===eb&&x.beginShadows();var i=K.state.shadowsArray;b.render(i,e,t),!0===eb&&x.endShadows(),!0===this.info.autoReset&&this.info.reset();var r=Y.opaque,a=Y.transmissive;if(K.setupLights(),t.isArrayCamera){var o=t.cameras;if(a.length>0)for(var s=0,l=o.length;s<l;s++)eZ(r,a,e,o[s]);eP&&w.render(e);for(var u=0,h=o.length;u<h;u++){var d=o[u];eY(Y,e,d,d.viewport)}}else a.length>0&&eZ(r,a,e,t),eP&&w.render(e),eY(Y,e,t);null!==en&&0===et&&(c.updateMultisampleRenderTarget(en),c.updateRenderTargetMipmap(en)),!0===e.isScene&&e.onAfterRender(Q,e,t),C.resetDefaultState(),ei=-1,er=null,J.pop(),J.length>0?(K=J[J.length-1],!0===eb&&x.setGlobalState(Q.clippingPlanes,K.state.camera)):K=null,Z.pop(),Y=Z.length>0?Z[Z.length-1]:null}},this.getActiveCubeFace=function(){return ee},this.getActiveMipmapLevel=function(){return et},this.getRenderTarget=function(){return en},this.setRenderTargetTextures=function(e,t,n){u.get(e.texture).__webglTexture=t,u.get(e.depthTexture).__webglTexture=n;var i=u.get(e);i.__hasExternalTextures=!0,i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0!==a.has("WEBGL_multisampled_render_to_texture")||(i.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(e,t){var n=u.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t};var e3=eU.createFramebuffer();this.setRenderTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;en=e,ee=t,et=n;var i=!0,r=null,a=!1,o=!1;if(e){var l=u.get(e);if(void 0!==l.__useDefaultFramebuffer)s.bindFramebuffer(eU.FRAMEBUFFER,null),i=!1;else if(void 0===l.__webglFramebuffer)c.setupRenderTarget(e);else if(l.__hasExternalTextures)c.rebindTextures(e,u.get(e.texture).__webglTexture,u.get(e.depthTexture).__webglTexture);else if(e.depthBuffer){var h=e.depthTexture;if(l.__boundDepthTexture!==h){if(null!==h&&u.has(h)&&(e.width!==h.image.width||e.height!==h.image.height))throw Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");c.setupDepthRenderbuffer(e)}}var d=e.texture;(d.isData3DTexture||d.isDataArrayTexture||d.isCompressedArrayTexture)&&(o=!0);var p=u.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=Array.isArray(p[t])?p[t][n]:p[t],a=!0):r=e.samples>0&&!1===c.useMultisampledRTT(e)?u.get(e).__webglMultisampledFramebuffer:Array.isArray(p)?p[n]:p,ea.copy(e.viewport),eo.copy(e.scissor),es=e.scissorTest}else ea.copy(eg).multiplyScalar(ef).floor(),eo.copy(e_).multiplyScalar(ef).floor(),es=ey;if(0!==n&&(r=e3),s.bindFramebuffer(eU.FRAMEBUFFER,r)&&i&&s.drawBuffers(e,r),s.viewport(ea),s.scissor(eo),s.setScissorTest(es),a){var f=u.get(e.texture);eU.framebufferTexture2D(eU.FRAMEBUFFER,eU.COLOR_ATTACHMENT0,eU.TEXTURE_CUBE_MAP_POSITIVE_X+t,f.__webglTexture,n)}else if(o){var v=u.get(e.texture);eU.framebufferTextureLayer(eU.FRAMEBUFFER,eU.COLOR_ATTACHMENT0,v.__webglTexture,n,t)}else if(null!==e&&0!==n){var m=u.get(e.texture);eU.framebufferTexture2D(eU.FRAMEBUFFER,eU.COLOR_ATTACHMENT0,eU.TEXTURE_2D,m.__webglTexture,n)}ei=-1},this.readRenderTargetPixels=function(e,t,n,i,r,a,l){if(e&&e.isWebGLRenderTarget){var c=u.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==l&&(c=c[l]),c){s.bindFramebuffer(eU.FRAMEBUFFER,c);try{var h=e.texture,d=h.format,p=h.type;if(!o.textureFormatReadable(d)||!o.textureTypeReadable(p))return;t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&eU.readPixels(t,n,i,r,T.convert(d),T.convert(p),a)}finally{var f=null!==en?u.get(en).__webglFramebuffer:null;s.bindFramebuffer(eU.FRAMEBUFFER,f)}}}},this.readRenderTargetPixelsAsync=(i=el(function(e,t,n,i,r,a,l){var c,h,d,p,f,v,m;return ec(this,function(g){switch(g.label){case 0:var _,y;if(!(e&&e.isWebGLRenderTarget))throw Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");if(c=u.get(e).__webglFramebuffer,e.isWebGLCubeRenderTarget&&void 0!==l&&(c=c[l]),!c)return[3,3];if(d=(h=e.texture).format,p=h.type,!o.textureFormatReadable(d))throw Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!o.textureTypeReadable(p))throw Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(!(t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r))return[3,2];return s.bindFramebuffer(eU.FRAMEBUFFER,c),f=eU.createBuffer(),eU.bindBuffer(eU.PIXEL_PACK_BUFFER,f),eU.bufferData(eU.PIXEL_PACK_BUFFER,a.byteLength,eU.STREAM_READ),eU.readPixels(t,n,i,r,T.convert(d),T.convert(p),0),v=null!==en?u.get(en).__webglFramebuffer:null,s.bindFramebuffer(eU.FRAMEBUFFER,v),m=eU.fenceSync(eU.SYNC_GPU_COMMANDS_COMPLETE,0),eU.flush(),[4,(_=eU,y=m,new Promise(function(e,t){setTimeout(function n(){switch(_.clientWaitSync(y,_.SYNC_FLUSH_COMMANDS_BIT,0)){case _.WAIT_FAILED:t();break;case _.TIMEOUT_EXPIRED:setTimeout(n,4);break;default:e()}},4)}))];case 1:return g.sent(),eU.bindBuffer(eU.PIXEL_PACK_BUFFER,f),eU.getBufferSubData(eU.PIXEL_PACK_BUFFER,0,a),eU.deleteBuffer(f),eU.deleteSync(m),[2,a];case 2:throw Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.");case 3:return[2]}})}),function(e,t,n,r,a,o,s){return i.apply(this,arguments)}),this.copyFramebufferToTexture=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!0!==e.isTexture&&(eK("WebGLRenderer: copyFramebufferToTexture function signature has changed."),t=arguments[0]||null,e=arguments[1]);var i=Math.pow(2,-n),r=Math.floor(e.image.width*i),a=Math.floor(e.image.height*i),o=null!==t?t.x:0,l=null!==t?t.y:0;c.setTexture2D(e,0),eU.copyTexSubImage2D(eU.TEXTURE_2D,n,0,0,o,l,r,a),s.unbindTexture()};var e4=eU.createFramebuffer(),e5=eU.createFramebuffer();this.copyTextureToTexture=function(e,t){var n,i,r,a,o,l,h,d,p,f,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,_=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;!0!==e.isTexture&&(eK("WebGLRenderer: copyTextureToTexture function signature has changed."),m=arguments[0]||null,e=arguments[1],t=arguments[2],_=arguments[3]||0,v=null),null===_&&(0!==g?(eK("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),_=g,g=0):_=0);var y=e.isCompressedTexture?e.mipmaps[_]:e.image;if(null!==v)n=v.max.x-v.min.x,i=v.max.y-v.min.y,r=v.isBox3?v.max.z-v.min.z:1,a=v.min.x,o=v.min.y,l=v.isBox3?v.min.z:0;else{var x=Math.pow(2,-g);n=Math.floor(y.width*x),i=Math.floor(y.height*x),r=e.isDataArrayTexture?y.depth:e.isData3DTexture?Math.floor(y.depth*x):1,a=0,o=0,l=0}null!==m?(h=m.x,d=m.y,p=m.z):(h=0,d=0,p=0);var b=T.convert(t.format),w=T.convert(t.type);t.isData3DTexture?(c.setTexture3D(t,0),f=eU.TEXTURE_3D):t.isDataArrayTexture||t.isCompressedArrayTexture?(c.setTexture2DArray(t,0),f=eU.TEXTURE_2D_ARRAY):(c.setTexture2D(t,0),f=eU.TEXTURE_2D),eU.pixelStorei(eU.UNPACK_FLIP_Y_WEBGL,t.flipY),eU.pixelStorei(eU.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),eU.pixelStorei(eU.UNPACK_ALIGNMENT,t.unpackAlignment);var S=eU.getParameter(eU.UNPACK_ROW_LENGTH),M=eU.getParameter(eU.UNPACK_IMAGE_HEIGHT),E=eU.getParameter(eU.UNPACK_SKIP_PIXELS),C=eU.getParameter(eU.UNPACK_SKIP_ROWS),k=eU.getParameter(eU.UNPACK_SKIP_IMAGES);eU.pixelStorei(eU.UNPACK_ROW_LENGTH,y.width),eU.pixelStorei(eU.UNPACK_IMAGE_HEIGHT,y.height),eU.pixelStorei(eU.UNPACK_SKIP_PIXELS,a),eU.pixelStorei(eU.UNPACK_SKIP_ROWS,o),eU.pixelStorei(eU.UNPACK_SKIP_IMAGES,l);var A=e.isDataArrayTexture||e.isData3DTexture,P=t.isDataArrayTexture||t.isData3DTexture;if(e.isDepthTexture){var R=u.get(e),U=u.get(t),L=u.get(R.__renderTarget),D=u.get(U.__renderTarget);s.bindFramebuffer(eU.READ_FRAMEBUFFER,L.__webglFramebuffer),s.bindFramebuffer(eU.DRAW_FRAMEBUFFER,D.__webglFramebuffer);for(var I=0;I<r;I++)A&&(eU.framebufferTextureLayer(eU.READ_FRAMEBUFFER,eU.COLOR_ATTACHMENT0,u.get(e).__webglTexture,g,l+I),eU.framebufferTextureLayer(eU.DRAW_FRAMEBUFFER,eU.COLOR_ATTACHMENT0,u.get(t).__webglTexture,_,p+I)),eU.blitFramebuffer(a,o,n,i,h,d,n,i,eU.DEPTH_BUFFER_BIT,eU.NEAREST);s.bindFramebuffer(eU.READ_FRAMEBUFFER,null),s.bindFramebuffer(eU.DRAW_FRAMEBUFFER,null)}else if(0!==g||e.isRenderTargetTexture||u.has(e)){var N=u.get(e),O=u.get(t);s.bindFramebuffer(eU.READ_FRAMEBUFFER,e4),s.bindFramebuffer(eU.DRAW_FRAMEBUFFER,e5);for(var F=0;F<r;F++)A?eU.framebufferTextureLayer(eU.READ_FRAMEBUFFER,eU.COLOR_ATTACHMENT0,N.__webglTexture,g,l+F):eU.framebufferTexture2D(eU.READ_FRAMEBUFFER,eU.COLOR_ATTACHMENT0,eU.TEXTURE_2D,N.__webglTexture,g),P?eU.framebufferTextureLayer(eU.DRAW_FRAMEBUFFER,eU.COLOR_ATTACHMENT0,O.__webglTexture,_,p+F):eU.framebufferTexture2D(eU.DRAW_FRAMEBUFFER,eU.COLOR_ATTACHMENT0,eU.TEXTURE_2D,O.__webglTexture,_),0!==g?eU.blitFramebuffer(a,o,n,i,h,d,n,i,eU.COLOR_BUFFER_BIT,eU.NEAREST):P?eU.copyTexSubImage3D(f,_,h,d,p+F,a,o,n,i):eU.copyTexSubImage2D(f,_,h,d,a,o,n,i);s.bindFramebuffer(eU.READ_FRAMEBUFFER,null),s.bindFramebuffer(eU.DRAW_FRAMEBUFFER,null)}else P?e.isDataTexture||e.isData3DTexture?eU.texSubImage3D(f,_,h,d,p,n,i,r,b,w,y.data):t.isCompressedArrayTexture?eU.compressedTexSubImage3D(f,_,h,d,p,n,i,r,b,y.data):eU.texSubImage3D(f,_,h,d,p,n,i,r,b,w,y):e.isDataTexture?eU.texSubImage2D(eU.TEXTURE_2D,_,h,d,n,i,b,w,y.data):e.isCompressedTexture?eU.compressedTexSubImage2D(eU.TEXTURE_2D,_,h,d,y.width,y.height,b,y.data):eU.texSubImage2D(eU.TEXTURE_2D,_,h,d,n,i,b,w,y);eU.pixelStorei(eU.UNPACK_ROW_LENGTH,S),eU.pixelStorei(eU.UNPACK_IMAGE_HEIGHT,M),eU.pixelStorei(eU.UNPACK_SKIP_PIXELS,E),eU.pixelStorei(eU.UNPACK_SKIP_ROWS,C),eU.pixelStorei(eU.UNPACK_SKIP_IMAGES,k),0===_&&t.generateMipmaps&&eU.generateMipmap(f),s.unbindTexture()},this.copyTextureToTexture3D=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return!0!==e.isTexture&&(eK("WebGLRenderer: copyTextureToTexture3D function signature has changed."),n=arguments[0]||null,i=arguments[1]||null,e=arguments[2],t=arguments[3],r=arguments[4]||0),eK('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(e,t,n,i,r)},this.initRenderTarget=function(e){void 0===u.get(e).__webglFramebuffer&&c.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?c.setTextureCube(e,0):e.isData3DTexture?c.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?c.setTexture2DArray(e,0):c.setTexture2D(e,0),s.unbindTexture()},this.resetState=function(){ee=0,et=0,en=null,s.reset(),C.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}return n(t,[{key:"coordinateSystem",get:function(){return 2e3}},{key:"outputColorSpace",get:function(){return this._outputColorSpace},set:function(e){this._outputColorSpace=e;var t=this.getContext();t.drawingBufferColorspace=eQ._getDrawingBufferColorSpace(e),t.unpackColorSpace=eQ._getUnpackColorSpace()}}]),t}(),sn={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n		varying vec2 vUv;\n\n		void main() {\n\n			vUv = uv;\n			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n		}",fragmentShader:"\n\n		uniform float opacity;\n\n		uniform sampler2D tDiffuse;\n\n		varying vec2 vUv;\n\n		void main() {\n\n			vec4 texel = texture2D( tDiffuse, vUv );\n			gl_FragColor = opacity * texel;\n\n\n		}"},si=function(){function t(){e(this,t),this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}return n(t,[{key:"setSize",value:function(){}},{key:"render",value:function(){}},{key:"dispose",value:function(){}}]),t}(),sr=new rV(-1,1,1,-1,0,1),sa=new(function(t){function n(){var t;return e(this,n),(t=ev(this,n)).setAttribute("position",new nE([-1,3,0,-1,-1,0,3,-1,0],3)),t.setAttribute("uv",new nE([0,2,0,0,2,0],2)),t}return e_(n,t),n}(nL)),so=function(){function t(n){e(this,t),this._mesh=new nj(sa,n)}return n(t,[{key:"dispose",value:function(){this._mesh.geometry.dispose()}},{key:"render",value:function(e){e.render(this._mesh,sr)}},{key:"material",get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}]),t}(),ss=function(t){function i(t,n){var r;return e(this,i),(r=ev(this,i)).textureID=void 0!==n?n:"tDiffuse",t instanceof nQ?(r.uniforms=t.uniforms,r.material=t):t&&(r.uniforms=nJ.clone(t.uniforms),r.material=new nQ({name:void 0!==t.name?t.name:"unspecified",defines:Object.assign({},t.defines),uniforms:r.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),r.fsQuad=new so(r.material),r}return e_(i,t),n(i,[{key:"render",value:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)),this.fsQuad.render(e)}},{key:"dispose",value:function(){this.material.dispose(),this.fsQuad.dispose()}}]),i}(si),sl=function(t){function i(t,n){var r;return e(this,i),(r=ev(this,i)).scene=t,r.camera=n,r.clear=!0,r.needsSwap=!1,r.inverse=!1,r}return e_(i,t),n(i,[{key:"render",value:function(e,t,n){var i,r,a=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(i=0,r=1):(i=1,r=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),o.buffers.stencil.setFunc(a.ALWAYS,i,0xffffffff),o.buffers.stencil.setClear(r),o.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.color.setMask(!0),o.buffers.depth.setMask(!0),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(a.EQUAL,1,0xffffffff),o.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),o.buffers.stencil.setLocked(!0)}}]),i}(si),su=function(t){function i(){var t;return e(this,i),(t=ev(this,i)).needsSwap=!1,t}return e_(i,t),n(i,[{key:"render",value:function(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}]),i}(si),sc=function(){function t(n,i){if(e(this,t),this.renderer=n,this._pixelRatio=n.getPixelRatio(),void 0===i){var r=n.getSize(new eG);this._width=r.width,this._height=r.height,(i=new e9(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:1016})).texture.name="EffectComposer.rt1"}else this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new ss(sn),this.copyPass.material.blending=0,this.clock=new rH}return n(t,[{key:"swapBuffers",value:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}},{key:"addPass",value:function(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}},{key:"insertPass",value:function(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}},{key:"removePass",value:function(e){var t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}},{key:"isLastEnabledPass",value:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}},{key:"render",value:function(e){void 0===e&&(e=this.clock.getDelta());for(var t=this.renderer.getRenderTarget(),n=!1,i=0,r=this.passes.length;i<r;i++){var a=this.passes[i];if(!1!==a.enabled){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),a.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),a.needsSwap){if(n){var o=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(o.NOTEQUAL,1,0xffffffff),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),s.setFunc(o.EQUAL,1,0xffffffff)}this.swapBuffers()}void 0!==sl&&(a instanceof sl?n=!0:a instanceof su&&(n=!1))}}this.renderer.setRenderTarget(t)}},{key:"reset",value:function(e){if(void 0===e){var t=this.renderer.getSize(new eG);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}},{key:"setSize",value:function(e,t){this._width=e,this._height=t;var n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(var r=0;r<this.passes.length;r++)this.passes[r].setSize(n,i)}},{key:"setPixelRatio",value:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}},{key:"dispose",value:function(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}]),t}(),sh=function(t){function i(t,n){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return e(this,i),(r=ev(this,i)).scene=t,r.camera=n,r.overrideMaterial=a,r.clearColor=o,r.clearAlpha=s,r.clear=!0,r.clearDepth=!1,r.needsSwap=!1,r._oldClearColor=new nf,r}return e_(i,t),n(i,[{key:"render",value:function(e,t,n){var i,r,a=e.autoClear;e.autoClear=!1,null!==this.overrideMaterial&&(r=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),null!==this.clearAlpha&&(i=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),!0==this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),!0===this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),null!==this.clearColor&&e.setClearColor(this._oldClearColor),null!==this.clearAlpha&&e.setClearAlpha(i),null!==this.overrideMaterial&&(this.scene.overrideMaterial=r),e.autoClear=a}}]),i}(si),sd={name:"AfterimageShader",uniforms:{damp:{value:.96},tOld:{value:null},tNew:{value:null}},vertexShader:"\n\n		varying vec2 vUv;\n\n		void main() {\n\n			vUv = uv;\n			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n		}",fragmentShader:"\n\n		uniform float damp;\n\n		uniform sampler2D tOld;\n		uniform sampler2D tNew;\n\n		varying vec2 vUv;\n\n		vec4 when_gt( vec4 x, float y ) {\n\n			return max( sign( x - y ), 0.0 );\n\n		}\n\n		void main() {\n\n			vec4 texelOld = texture2D( tOld, vUv );\n			vec4 texelNew = texture2D( tNew, vUv );\n\n			texelOld *= damp * when_gt( texelOld, 0.1 );\n\n			gl_FragColor = max(texelNew, texelOld);\n\n		}"},sp=function(t){function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.96;return e(this,i),(t=ev(this,i)).shader=sd,t.uniforms=nJ.clone(t.shader.uniforms),t.uniforms.damp.value=n,t.textureComp=new e9(window.innerWidth,window.innerHeight,{magFilter:1003,type:1016}),t.textureOld=new e9(window.innerWidth,window.innerHeight,{magFilter:1003,type:1016}),t.compFsMaterial=new nQ({uniforms:t.uniforms,vertexShader:t.shader.vertexShader,fragmentShader:t.shader.fragmentShader}),t.compFsQuad=new so(t.compFsMaterial),t.copyFsMaterial=new nQ({uniforms:nJ.clone(sn.uniforms),vertexShader:sn.vertexShader,fragmentShader:sn.fragmentShader,blending:0,depthTest:!1,depthWrite:!1}),t.copyFsQuad=new so(t.copyFsMaterial),t}return e_(i,t),n(i,[{key:"render",value:function(e,t,n){this.uniforms.tOld.value=this.textureOld.texture,this.uniforms.tNew.value=n.texture,e.setRenderTarget(this.textureComp),this.compFsQuad.render(e),this.copyFsQuad.material.uniforms.tDiffuse.value=this.textureComp.texture,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear()),this.copyFsQuad.render(e);var i=this.textureOld;this.textureOld=this.textureComp,this.textureComp=i}},{key:"setSize",value:function(e,t){this.textureComp.setSize(e,t),this.textureOld.setSize(e,t)}},{key:"dispose",value:function(){this.textureComp.dispose(),this.textureOld.dispose(),this.compFsMaterial.dispose(),this.copyFsMaterial.dispose(),this.compFsQuad.dispose(),this.copyFsQuad.dispose()}}]),i}(si),sf="OutputShader",sv={tDiffuse:{value:null},toneMappingExposure:{value:1}},sm="\n		precision highp float;\n\n		uniform mat4 modelViewMatrix;\n		uniform mat4 projectionMatrix;\n\n		attribute vec3 position;\n		attribute vec2 uv;\n\n		varying vec2 vUv;\n\n		void main() {\n\n			vUv = uv;\n			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n		}",sg="\n\n		precision highp float;\n\n		uniform sampler2D tDiffuse;\n\n		#include <tonemapping_pars_fragment>\n		#include <colorspace_pars_fragment>\n\n		varying vec2 vUv;\n\n		void main() {\n\n			gl_FragColor = texture2D( tDiffuse, vUv );\n\n			// tone mapping\n\n			#ifdef LINEAR_TONE_MAPPING\n\n				gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );\n\n			#elif defined( REINHARD_TONE_MAPPING )\n\n				gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );\n\n			#elif defined( CINEON_TONE_MAPPING )\n\n				gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );\n\n			#elif defined( ACES_FILMIC_TONE_MAPPING )\n\n				gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );\n\n			#elif defined( AGX_TONE_MAPPING )\n\n				gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );\n\n			#elif defined( NEUTRAL_TONE_MAPPING )\n\n				gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );\n\n			#elif defined( CUSTOM_TONE_MAPPING )\n\n				gl_FragColor.rgb = CustomToneMapping( gl_FragColor.rgb );\n\n			#endif\n\n			// color space\n\n			#ifdef SRGB_TRANSFER\n\n				gl_FragColor = sRGBTransferOETF( gl_FragColor );\n\n			#endif\n\n		}",s_=function(t){function i(){var t;return e(this,i),(t=ev(this,i)).uniforms=nJ.clone(sv),t.material=new rp({name:sf,uniforms:t.uniforms,vertexShader:sm,fragmentShader:sg}),t.fsQuad=new so(t.material),t._outputColorSpace=null,t._toneMapping=null,t}return e_(i,t),n(i,[{key:"render",value:function(e,t,n){this.uniforms.tDiffuse.value=n.texture,this.uniforms.toneMappingExposure.value=e.toneMappingExposure,(this._outputColorSpace!==e.outputColorSpace||this._toneMapping!==e.toneMapping)&&(this._outputColorSpace=e.outputColorSpace,this._toneMapping=e.toneMapping,this.material.defines={},eQ.getTransfer(this._outputColorSpace)===ek&&(this.material.defines.SRGB_TRANSFER=""),1===this._toneMapping?this.material.defines.LINEAR_TONE_MAPPING="":2===this._toneMapping?this.material.defines.REINHARD_TONE_MAPPING="":3===this._toneMapping?this.material.defines.CINEON_TONE_MAPPING="":4===this._toneMapping?this.material.defines.ACES_FILMIC_TONE_MAPPING="":6===this._toneMapping?this.material.defines.AGX_TONE_MAPPING="":7===this._toneMapping?this.material.defines.NEUTRAL_TONE_MAPPING="":5===this._toneMapping&&(this.material.defines.CUSTOM_TONE_MAPPING=""),this.material.needsUpdate=!0),!0===this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)),this.fsQuad.render(e)}},{key:"dispose",value:function(){this.material.dispose(),this.fsQuad.dispose()}}]),i}(si),sy={};!function(t){var r=function(){function t(n){e(this,t);var i=eb(n.split("-"),2),r=i[0],a=i[1],o=r.split(".");this.major=parseInt(o[0],10),this.minor=parseInt(o[1],10),this.patch=parseInt(o[2],10),this.prerelease=null!=a?a:null}return n(t,[{key:"toString",value:function(){var e=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[e,this.prerelease].join("-"):e}}]),t}(),a=function(){function t(n){e(this,t),this.controller_=n}return n(t,[{key:"element",get:function(){return this.controller_.view.element}},{key:"disabled",get:function(){return this.controller_.viewProps.get("disabled")},set:function(e){this.controller_.viewProps.set("disabled",e)}},{key:"hidden",get:function(){return this.controller_.viewProps.get("hidden")},set:function(e){this.controller_.viewProps.set("hidden",e)}},{key:"dispose",value:function(){this.controller_.viewProps.set("disposed",!0)}}]),t}(),o=function t(n){e(this,t),this.target=n},s=function(t){function n(t,i,r,a){var o;return e(this,n),(o=ev(this,n,[t])).value=i,o.presetKey=r,o.last=null==a||a,o}return e_(n,t),n}(o),l=function(t){function n(t,i,r){var a;return e(this,n),(a=ev(this,n,[t])).value=i,a.presetKey=r,a}return e_(n,t),n}(o),u=function(t){function n(t,i){var r;return e(this,n),(r=ev(this,n,[t])).expanded=i,r}return e_(n,t),n}(o),c=function(t){function n(t,i){var r;return e(this,n),(r=ev(this,n,[t])).index=i,r}return e_(n,t),n}(o);function h(e){return null==e}function d(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function p(e,t){var n=e;do{var i=Object.getOwnPropertyDescriptor(n,t);if(i&&(void 0!==i.set||!0===i.writable))return!0;n=Object.getPrototypeOf(n)}while(null!==n)return!1}var f={alreadydisposed:function(){return"View has been already disposed"},invalidparams:function(e){return"Invalid parameters for '".concat(e.name,"'")},nomatchingcontroller:function(e){return"No matching controller for '".concat(e.key,"'")},nomatchingview:function(e){return"No matching view for '".concat(JSON.stringify(e.params),"'")},notbindable:function(){return"Value is not bindable"},propertynotfound:function(e){return"Property '".concat(e.name,"' not found")},shouldneverhappen:function(){return"This error should never happen"}},v=function(){function t(n){var i;e(this,t),this.message=null!==(i=f[n.type](n.context))&&void 0!==i?i:"Unexpected error",this.name=this.constructor.name,this.stack=Error(this.message).stack,this.type=n.type}return n(t,null,[{key:"alreadyDisposed",value:function(){return new t({type:"alreadydisposed"})}},{key:"notBindable",value:function(){return new t({type:"notbindable"})}},{key:"propertyNotFound",value:function(e){return new t({type:"propertynotfound",context:{name:e}})}},{key:"shouldNeverHappen",value:function(){return new t({type:"shouldneverhappen"})}}]),t}(),m=function(){function t(n,i,r){e(this,t),this.obj_=n,this.key_=i,this.presetKey_=null!=r?r:i}return n(t,[{key:"key",get:function(){return this.key_}},{key:"presetKey",get:function(){return this.presetKey_}},{key:"read",value:function(){return this.obj_[this.key_]}},{key:"write",value:function(e){this.obj_[this.key_]=e}},{key:"writeProperty",value:function(e,n){var i=this.read();if(!t.isBindable(i))throw v.notBindable();if(!(e in i))throw v.propertyNotFound(e);i[e]=n}}],[{key:"isBindable",value:function(e){return null!==e&&((void 0===e?"undefined":eu(e))==="object"||"function"==typeof e)}}]),t}(),g=function(t){function i(){return e(this,i),ev(this,i,arguments)}return e_(i,t),n(i,[{key:"label",get:function(){return this.controller_.props.get("label")},set:function(e){this.controller_.props.set("label",e)}},{key:"title",get:function(){var e;return null!==(e=this.controller_.valueController.props.get("title"))&&void 0!==e?e:""},set:function(e){this.controller_.valueController.props.set("title",e)}},{key:"on",value:function(e,t){var n=this,i=t.bind(this);return this.controller_.valueController.emitter.on(e,function(){i(new o(n))}),this}}]),i}(a),_=function(){function t(){e(this,t),this.observers_={}}return n(t,[{key:"on",value:function(e,t){var n=this.observers_[e];return n||(n=this.observers_[e]=[]),n.push({handler:t}),this}},{key:"off",value:function(e,t){var n=this.observers_[e];return n&&(this.observers_[e]=n.filter(function(e){return e.handler!==t})),this}},{key:"emit",value:function(e,t){var n=this.observers_[e];n&&n.forEach(function(e){e.handler(t)})}}]),t}();function y(e){return function(t,n){return["tp","-",e,"v",t?"_".concat(t):"",n?"-".concat(n):""].join("")}}function x(e){return e.rawValue}function b(e,t){e.emitter.on("change",function(e){return t(x(e))}),t(e.rawValue)}function w(e,t,n){b(e.value(t),n)}function S(e,t){return function(n){n?e.classList.add(t):e.classList.remove(t)}}function M(e,t){b(e,function(e){t.textContent=null!=e?e:""})}var E=y("btn"),T=function t(n,i){e(this,t),this.element=n.createElement("div"),this.element.classList.add(E()),i.viewProps.bindClassModifiers(this.element);var r=n.createElement("button");r.classList.add(E("b")),i.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;var a=n.createElement("div");a.classList.add(E("t")),M(i.props.value("title"),a),this.buttonElement.appendChild(a)},C=function(){function t(n,i){e(this,t),this.emitter=new _,this.onClick_=this.onClick_.bind(this),this.props=i.props,this.viewProps=i.viewProps,this.view=new T(n,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}return n(t,[{key:"onClick_",value:function(){this.emitter.emit("click",{sender:this})}}]),t}(),k=function(){function t(n,i){var r;e(this,t),this.constraint_=null==i?void 0:i.constraint,this.equals_=null!==(r=null==i?void 0:i.equals)&&void 0!==r?r:function(e,t){return e===t},this.emitter=new _,this.rawValue_=n}return n(t,[{key:"constraint",get:function(){return this.constraint_}},{key:"rawValue",get:function(){return this.rawValue_},set:function(e){this.setRawValue(e,{forceEmit:!1,last:!0})}},{key:"setRawValue",value:function(e,t){var n=null!=t?t:{forceEmit:!1,last:!0},i=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;(!this.equals_(r,i)||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=i,this.emitter.emit("change",{options:n,previousRawValue:r,rawValue:i,sender:this}))}}]),t}(),A=function(){function t(n){e(this,t),this.emitter=new _,this.value_=n}return n(t,[{key:"rawValue",get:function(){return this.value_},set:function(e){this.setRawValue(e,{forceEmit:!1,last:!0})}},{key:"setRawValue",value:function(e,t){var n=null!=t?t:{forceEmit:!1,last:!0},i=this.value_;(i!==e||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:n,previousRawValue:i,rawValue:this.value_,sender:this}))}}]),t}();function P(e,t){var n=null==t?void 0:t.constraint,i=null==t?void 0:t.equals;return n||i?new k(e,t):new A(e)}var R=function(){function t(n){var i,r=function(e){i.valMap_[e].emitter.on("change",function(){a.emitter.emit("change",{key:e,sender:a})})},a=this;for(var o in e(this,t),this.emitter=new _,this.valMap_=n,this.valMap_)i=this,r(o)}return n(t,[{key:"get",value:function(e){return this.valMap_[e].rawValue}},{key:"set",value:function(e,t){this.valMap_[e].rawValue=t}},{key:"value",value:function(e){return this.valMap_[e]}}],[{key:"createCore",value:function(e){return Object.keys(e).reduce(function(t,n){return Object.assign(t,i({},n,P(e[n])))},{})}},{key:"fromObject",value:function(e){return new t(this.createCore(e))}}]),t}();function U(e){return function(t){return function(n){if(!t&&void 0===n)return{succeeded:!1,value:void 0};if(t&&void 0===n)return{succeeded:!0,value:void 0};var i=e(n);return void 0!==i?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}}function L(e){return{custom:function(t){return U(t)(e)},boolean:U(function(e){return"boolean"==typeof e?e:void 0})(e),number:U(function(e){return"number"==typeof e?e:void 0})(e),string:U(function(e){return"string"==typeof e?e:void 0})(e),function:U(function(e){return"function"==typeof e?e:void 0})(e),constant:function(t){return U(function(e){return e===t?t:void 0})(e)},raw:U(function(e){return e})(e),object:function(t){return U(function(e){if(null!==e&&(void 0===e?"undefined":eu(e))==="object")return Object.keys(t).reduce(function(n,r){if(void 0!==n){var a=(0,t[r])(e[r]);return a.succeeded?Object.assign(Object.assign({},n),i({},r,a.value)):void 0}},{})})(e)},array:function(t){return U(function(e){if(Array.isArray(e))return e.reduce(function(e,n){if(void 0!==e){var i=t(n);if(i.succeeded&&void 0!==i.value)return ew(e).concat([i.value])}},[])})(e)}}}var D={optional:L(!0),required:L(!1)};function I(e,t){var n=D.required.object(t)(e);return n.succeeded?n.value:void 0}var N=function(){function t(n){e(this,t),this.value_=n}return n(t,[{key:"emitter",get:function(){return this.value_.emitter}},{key:"rawValue",get:function(){return this.value_.rawValue}}],[{key:"create",value:function(e){return[new t(e),function(t,n){e.setRawValue(t,n)}]}}]),t}(),O=y("");function F(e,t){return S(e,O(void 0,t))}var B=function(t){function i(t){var n,r,a;return e(this,i),(n=ev(this,i,[t])).onDisabledChange_=n.onDisabledChange_.bind(n),n.onParentChange_=n.onParentChange_.bind(n),n.onParentGlobalDisabledChange_=n.onParentGlobalDisabledChange_.bind(n),a=eb(N.create(P(n.getGlobalDisabled_())),2),n.globalDisabled_=a[0],n.setGlobalDisabled_=a[1],n.value("disabled").emitter.on("change",n.onDisabledChange_),n.value("parent").emitter.on("change",n.onParentChange_),null===(r=n.get("parent"))||void 0===r||r.globalDisabled.emitter.on("change",n.onParentGlobalDisabledChange_),n}return e_(i,t),n(i,[{key:"globalDisabled",get:function(){return this.globalDisabled_}},{key:"bindClassModifiers",value:function(e){b(this.globalDisabled_,F(e,"disabled")),w(this,"hidden",F(e,"hidden"))}},{key:"bindDisabled",value:function(e){b(this.globalDisabled_,function(t){e.disabled=t})}},{key:"bindTabIndex",value:function(e){b(this.globalDisabled_,function(t){e.tabIndex=t?-1:0})}},{key:"handleDispose",value:function(e){this.value("disposed").emitter.on("change",function(t){t&&e()})}},{key:"getGlobalDisabled_",value:function(){var e=this.get("parent");return!!e&&e.globalDisabled.rawValue||this.get("disabled")}},{key:"updateGlobalDisabled_",value:function(){this.setGlobalDisabled_(this.getGlobalDisabled_())}},{key:"onDisabledChange_",value:function(){this.updateGlobalDisabled_()}},{key:"onParentGlobalDisabledChange_",value:function(){this.updateGlobalDisabled_()}},{key:"onParentChange_",value:function(e){var t,n=e.previousRawValue;null==n||n.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),null===(t=this.get("parent"))||void 0===t||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}],[{key:"create",value:function(e){var t,n,r,a=null!=e?e:{};return new i(R.createCore({disabled:null!==(t=a.disabled)&&void 0!==t&&t,disposed:!1,hidden:null!==(n=a.hidden)&&void 0!==n&&n,parent:null!==(r=a.parent)&&void 0!==r?r:null}))}}]),i}(R),V=y(""),z={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"},G=function(){function t(n){var i=this;e(this,t),this.parent_=null,this.blade=n.blade,this.view=n.view,this.viewProps=n.viewProps;var r=this.view.element;this.blade.value("positions").emitter.on("change",function(){["veryfirst","first","last","verylast"].forEach(function(e){r.classList.remove(V(void 0,z[e]))}),i.blade.get("positions").forEach(function(e){r.classList.add(V(void 0,z[e]))})}),this.viewProps.handleDispose(function(){r&&r.parentElement&&r.parentElement.removeChild(r)})}return n(t,[{key:"parent",get:function(){return this.parent_},set:function(e){if(this.parent_=e,!("parent"in this.viewProps.valMap_)){B.name;return}this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}}]),t}(),H="http://www.w3.org/2000/svg";function W(e){e.offsetHeight}function j(e){return void 0!==e.ontouchstart}var X={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function q(e,t){var n=e.createElementNS(H,"svg");return n.innerHTML=X[t],n}function Y(e,t,n){e.insertBefore(t,e.children[n])}function K(e){e.parentElement&&e.parentElement.removeChild(e)}function Z(e){for(;e.children.length>0;)e.removeChild(e.children[0])}function J(e){return e.relatedTarget?e.relatedTarget:"explicitOriginalTarget"in e?e.explicitOriginalTarget:null}var Q=y("lbl"),$=function t(n,i){var r=this;e(this,t),this.element=n.createElement("div"),this.element.classList.add(Q()),i.viewProps.bindClassModifiers(this.element);var a=n.createElement("div");a.classList.add(Q("l")),w(i.props,"label",function(e){if(h(e))r.element.classList.add(Q(void 0,"nol"));else{var t;r.element.classList.remove(Q(void 0,"nol")),function(e){for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0])}(a),a.appendChild((t=n.createDocumentFragment(),e.split("\n").map(function(e){return n.createTextNode(e)}).forEach(function(e,i){i>0&&t.appendChild(n.createElement("br")),t.appendChild(e)}),t))}}),this.element.appendChild(a),this.labelElement=a;var o=n.createElement("div");o.classList.add(Q("v")),this.element.appendChild(o),this.valueElement=o},ee=function(t){function n(t,i){e(this,n);var r,a=i.valueController.viewProps;return(r=ev(this,n,[Object.assign(Object.assign({},i),{view:new $(t,{props:i.props,viewProps:a}),viewProps:a})])).props=i.props,r.valueController=i.valueController,r.view.valueElement.appendChild(r.valueController.view.element),r}return e_(n,t),n}(G),et={id:"button",type:"blade",accept:function(e){var t=I(e,{title:D.required.string,view:D.required.constant("button"),label:D.optional.string});return t?{params:t}:null},controller:function(e){return new ee(e.document,{blade:e.blade,props:R.fromObject({label:e.params.label}),valueController:new C(e.document,{props:R.fromObject({title:e.params.title}),viewProps:e.viewProps})})},api:function(e){return e.controller instanceof ee&&e.controller.valueController instanceof C?new g(e.controller):null}},en=function(t){function n(t){var i;return e(this,n),(i=ev(this,n,[t])).value=t.value,i}return e_(n,t),n}(G);function ei(){return new R({positions:P([],{equals:d})})}var er=function(t){function i(t){return e(this,i),ev(this,i,[t])}return e_(i,t),n(i,[{key:"styleExpanded",get:function(){var e;return null!==(e=this.get("temporaryExpanded"))&&void 0!==e?e:this.get("expanded")}},{key:"styleHeight",get:function(){if(!this.styleExpanded)return"0";var e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!h(e)?"".concat(e,"px"):"auto"}},{key:"bindExpandedClass",value:function(e,t){var n=this,i=function(){n.styleExpanded?e.classList.add(t):e.classList.remove(t)};w(this,"expanded",i),w(this,"temporaryExpanded",i)}},{key:"cleanUpTransition",value:function(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}],[{key:"create",value:function(e){return new i(R.createCore({completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null}))}}]),i}(R);function ea(e,t){t.style.height=e.styleHeight}function eo(e,t){e.value("expanded").emitter.on("beforechange",function(){if(e.set("completed",!1),h(e.get("expandedHeight"))){var n,i,r,a=(n=0,i=function(){e.set("expandedHeight",null),e.set("temporaryExpanded",!0),W(t),n=t.clientHeight,e.set("temporaryExpanded",null),W(t)},r=t.style.transition,t.style.transition="none",i(),t.style.transition=r,n);a>0&&e.set("expandedHeight",a)}e.set("shouldFixHeight",!0),W(t)}),e.emitter.on("change",function(){ea(e,t)}),ea(e,t),t.addEventListener("transitionend",function(t){"height"===t.propertyName&&e.cleanUpTransition()})}var es=function(t){function n(t,i){var r;return e(this,n),(r=ev(this,n,[t])).rackApi_=i,r}return e_(n,t),n}(a),el=function(){function t(n){e(this,t),this.emitter=new _,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=n}return n(t,[{key:"items",get:function(){return this.items_}},{key:"allItems",value:function(){return Array.from(this.cache_)}},{key:"find",value:function(e){var t=!0,n=!1,i=void 0;try{for(var r,a=this.allItems()[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value;if(e(o))return o}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}return null}},{key:"includes",value:function(e){return this.cache_.has(e)}},{key:"add",value:function(e,t){var n=this;if(this.includes(e))throw v.shouldNeverHappen();var i=void 0!==t?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);var r=this.extract_(e);r&&(r.emitter.on("add",this.onSubListAdd_),r.emitter.on("remove",this.onSubListRemove_),r.allItems().forEach(function(e){n.cache_.add(e)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}},{key:"remove",value:function(e){var t=this.items_.indexOf(e);if(!(t<0)){this.items_.splice(t,1),this.cache_.delete(e);var n=this.extract_(e);n&&(n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}}},{key:"onSubListAdd_",value:function(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}},{key:"onSubListRemove_",value:function(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}]),t}(),ec=function(t){function i(t){var n;return e(this,i),(n=ev(this,i,[t])).onBindingChange_=n.onBindingChange_.bind(n),n.emitter_=new _,n.controller_.binding.emitter.on("change",n.onBindingChange_),n}return e_(i,t),n(i,[{key:"label",get:function(){return this.controller_.props.get("label")},set:function(e){this.controller_.props.set("label",e)}},{key:"on",value:function(e,t){var n=t.bind(this);return this.emitter_.on(e,function(e){n(e.event)}),this}},{key:"refresh",value:function(){this.controller_.binding.read()}},{key:"onBindingChange_",value:function(e){var t=e.sender.target.read();this.emitter_.emit("change",{event:new s(this,t,this.controller_.binding.target.presetKey,e.options.last)})}}]),i}(a),eh=function(t){function n(t,i){var r;return e(this,n),(r=ev(this,n,[t,i])).binding=i.binding,r}return e_(n,t),n}(ee),ed=function(t){function i(t){var n;return e(this,i),(n=ev(this,i,[t])).onBindingUpdate_=n.onBindingUpdate_.bind(n),n.emitter_=new _,n.controller_.binding.emitter.on("update",n.onBindingUpdate_),n}return e_(i,t),n(i,[{key:"label",get:function(){return this.controller_.props.get("label")},set:function(e){this.controller_.props.set("label",e)}},{key:"on",value:function(e,t){var n=t.bind(this);return this.emitter_.on(e,function(e){n(e.event)}),this}},{key:"refresh",value:function(){this.controller_.binding.read()}},{key:"onBindingUpdate_",value:function(e){var t=e.sender.target.read();this.emitter_.emit("update",{event:new l(this,t,this.controller_.binding.target.presetKey)})}}]),i}(a),ef=function(t){function n(t,i){var r;return e(this,n),(r=ev(this,n,[t,i])).binding=i.binding,r.viewProps.bindDisabled(r.binding.ticker),r.viewProps.handleDispose(function(){r.binding.dispose()}),r}return e_(n,t),n}(ee);function eg(e){return e instanceof eM?e.apiSet_:e instanceof es?e.rackApi_.apiSet_:null}function ey(e,t){var n=e.find(function(e){return e.controller_===t});if(!n)throw v.shouldNeverHappen();return n}function ex(e,t,n){if(!m.isBindable(e))throw v.notBindable();return new m(e,t,n)}var eM=function(t){function i(t,n){e(this,i),(r=ev(this,i,[t])).onRackAdd_=r.onRackAdd_.bind(r),r.onRackRemove_=r.onRackRemove_.bind(r),r.onRackInputChange_=r.onRackInputChange_.bind(r),r.onRackMonitorUpdate_=r.onRackMonitorUpdate_.bind(r),r.emitter_=new _,r.apiSet_=new el(eg),r.pool_=n;var r,a=r.controller_.rack;return a.emitter.on("add",r.onRackAdd_),a.emitter.on("remove",r.onRackRemove_),a.emitter.on("inputchange",r.onRackInputChange_),a.emitter.on("monitorupdate",r.onRackMonitorUpdate_),a.children.forEach(function(e){r.setUpApi_(e)}),r}return e_(i,t),n(i,[{key:"children",get:function(){var e=this;return this.controller_.rack.children.map(function(t){return ey(e.apiSet_,t)})}},{key:"addInput",value:function(e,t,n){var i=null!=n?n:{},r=this.controller_.view.element.ownerDocument,a=new ec(this.pool_.createInput(r,ex(e,t,i.presetKey),i));return this.add(a,i.index)}},{key:"addMonitor",value:function(e,t,n){var i=null!=n?n:{},r=this.controller_.view.element.ownerDocument,a=new ed(this.pool_.createMonitor(r,ex(e,t),i));return this.add(a,i.index)}},{key:"addFolder",value:function(e){return this.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}},{key:"addButton",value:function(e){return this.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}},{key:"addSeparator",value:function(e){return this.addBlade(Object.assign(Object.assign({},null!=e?e:{}),{view:"separator"}))}},{key:"addTab",value:function(e){return this.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}},{key:"add",value:function(e,t){this.controller_.rack.add(e.controller_,t);var n=this.apiSet_.find(function(t){return t.controller_===e.controller_});return n&&this.apiSet_.remove(n),this.apiSet_.add(e),e}},{key:"remove",value:function(e){this.controller_.rack.remove(e.controller_)}},{key:"addBlade",value:function(e){var t=this.controller_.view.element.ownerDocument,n=this.pool_.createBlade(t,e),i=this.pool_.createBladeApi(n);return this.add(i,e.index)}},{key:"on",value:function(e,t){var n=t.bind(this);return this.emitter_.on(e,function(e){n(e.event)}),this}},{key:"setUpApi_",value:function(e){this.apiSet_.find(function(t){return t.controller_===e})||this.apiSet_.add(this.pool_.createBladeApi(e))}},{key:"onRackAdd_",value:function(e){this.setUpApi_(e.bladeController)}},{key:"onRackRemove_",value:function(e){if(e.isRoot){var t=ey(this.apiSet_,e.bladeController);this.apiSet_.remove(t)}}},{key:"onRackInputChange_",value:function(e){var t=e.bladeController;if(t instanceof eh){var n=ey(this.apiSet_,t),i=t.binding;this.emitter_.emit("change",{event:new s(n,i.target.read(),i.target.presetKey,e.options.last)})}else if(t instanceof en){var r=ey(this.apiSet_,t);this.emitter_.emit("change",{event:new s(r,t.value.rawValue,void 0,e.options.last)})}}},{key:"onRackMonitorUpdate_",value:function(e){if(!(e.bladeController instanceof ef))throw v.shouldNeverHappen();var t=ey(this.apiSet_,e.bladeController),n=e.bladeController.binding;this.emitter_.emit("update",{event:new l(t,n.target.read(),n.target.presetKey)})}}]),i}(a),eE=function(t){function i(t,n){var r;return e(this,i),(r=ev(this,i,[t,new eM(t.rackController,n)])).emitter_=new _,r.controller_.foldable.value("expanded").emitter.on("change",function(e){r.emitter_.emit("fold",{event:new u(r,e.sender.rawValue)})}),r.rackApi_.on("change",function(e){r.emitter_.emit("change",{event:e})}),r.rackApi_.on("update",function(e){r.emitter_.emit("update",{event:e})}),r}return e_(i,t),n(i,[{key:"expanded",get:function(){return this.controller_.foldable.get("expanded")},set:function(e){this.controller_.foldable.set("expanded",e)}},{key:"title",get:function(){return this.controller_.props.get("title")},set:function(e){this.controller_.props.set("title",e)}},{key:"children",get:function(){return this.rackApi_.children}},{key:"addInput",value:function(e,t,n){return this.rackApi_.addInput(e,t,n)}},{key:"addMonitor",value:function(e,t,n){return this.rackApi_.addMonitor(e,t,n)}},{key:"addFolder",value:function(e){return this.rackApi_.addFolder(e)}},{key:"addButton",value:function(e){return this.rackApi_.addButton(e)}},{key:"addSeparator",value:function(e){return this.rackApi_.addSeparator(e)}},{key:"addTab",value:function(e){return this.rackApi_.addTab(e)}},{key:"add",value:function(e,t){return this.rackApi_.add(e,t)}},{key:"remove",value:function(e){this.rackApi_.remove(e)}},{key:"addBlade",value:function(e){return this.rackApi_.addBlade(e)}},{key:"on",value:function(e,t){var n=t.bind(this);return this.emitter_.on(e,function(e){n(e.event)}),this}}]),i}(es),eT=function(t){function n(t){var i;return e(this,n),(i=ev(this,n,[{blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}])).rackController=t.rackController,i}return e_(n,t),n}(G),eC=function t(n,i){e(this,t);var r=y(i.viewName);this.element=n.createElement("div"),this.element.classList.add(r()),i.viewProps.bindClassModifiers(this.element)};function ek(e){return e instanceof eR?e.rack:e instanceof eT?e.rackController.rack:null}function eA(e){var t=ek(e);return t?t.bcSet_:null}var eP=function(){function t(n){var i,r;e(this,t),this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new _,this.blade_=null!==(i=n.blade)&&void 0!==i?i:null,null===(r=this.blade_)||void 0===r||r.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=n.viewProps,this.bcSet_=new el(eA),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}return n(t,[{key:"children",get:function(){return this.bcSet_.items}},{key:"add",value:function(e,t){var n;null===(n=e.parent)||void 0===n||n.remove(e),p(e,"parent")?e.parent=this:e.parent_=this,this.bcSet_.add(e,t)}},{key:"remove",value:function(e){p(e,"parent")?e.parent=null:e.parent_=null,this.bcSet_.remove(e)}},{key:"find",value:function(e){return this.bcSet_.allItems().filter(function(t){return t instanceof e})}},{key:"onSetAdd_",value:function(e){this.updatePositions_();var t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,isRoot:t,sender:this}),t){var n=e.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),n instanceof eh)n.binding.emitter.on("change",this.onChildInputChange_);else if(n instanceof ef)n.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(n instanceof en)n.value.emitter.on("change",this.onChildValueChange_);else{var i=ek(n);if(i){var r=i.emitter;r.on("layout",this.onDescendantLayout_),r.on("inputchange",this.onDescendantInputChange_),r.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}}},{key:"onSetRemove_",value:function(e){this.updatePositions_();var t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,isRoot:t,sender:this}),t){var n=e.item;if(n instanceof eh)n.binding.emitter.off("change",this.onChildInputChange_);else if(n instanceof ef)n.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(n instanceof en)n.value.emitter.off("change",this.onChildValueChange_);else{var i=ek(n);if(i){var r=i.emitter;r.off("layout",this.onDescendantLayout_),r.off("inputchange",this.onDescendantInputChange_),r.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}}},{key:"updatePositions_",value:function(){var e=this,t=this.bcSet_.items.filter(function(e){return!e.viewProps.get("hidden")}),n=t[0],i=t[t.length-1];this.bcSet_.items.forEach(function(t){var r=[];t===n&&(r.push("first"),(!e.blade_||e.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),t===i&&(r.push("last"),(!e.blade_||e.blade_.get("positions").includes("verylast"))&&r.push("verylast")),t.blade.set("positions",r)})}},{key:"onChildPositionsChange_",value:function(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}},{key:"onChildViewPropsChange_",value:function(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}},{key:"onChildDispose_",value:function(){var e=this;this.bcSet_.items.filter(function(e){return e.viewProps.get("disposed")}).forEach(function(t){e.bcSet_.remove(t)})}},{key:"onChildInputChange_",value:function(e){var t=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(i instanceof eh&&i.binding===t)return i}return null}(this.find(eh),e.sender);if(!t)throw v.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}},{key:"onChildMonitorUpdate_",value:function(e){var t=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(i instanceof ef&&i.binding===t)return i}return null}(this.find(ef),e.sender);if(!t)throw v.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:t,sender:this})}},{key:"onChildValueChange_",value:function(e){var t=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(i instanceof en&&i.value===t)return i}return null}(this.find(en),e.sender);if(!t)throw v.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}},{key:"onDescendantLayout_",value:function(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}},{key:"onDescendantInputChange_",value:function(e){this.emitter.emit("inputchange",{bladeController:e.bladeController,options:e.options,sender:this})}},{key:"onDescendantMonitorUpdate_",value:function(e){this.emitter.emit("monitorupdate",{bladeController:e.bladeController,sender:this})}},{key:"onBladePositionsChange_",value:function(){this.updatePositions_()}}]),t}(),eR=function(t){function i(t,n){e(this,i),(r=ev(this,i,[Object.assign(Object.assign({},n),{view:new eC(t,{viewName:"brk",viewProps:n.viewProps})})])).onRackAdd_=r.onRackAdd_.bind(r),r.onRackRemove_=r.onRackRemove_.bind(r);var r,a=new eP({blade:n.root?void 0:n.blade,viewProps:n.viewProps});return a.emitter.on("add",r.onRackAdd_),a.emitter.on("remove",r.onRackRemove_),r.rack=a,r.viewProps.handleDispose(function(){for(var e=r.rack.children.length-1;e>=0;e--)r.rack.children[e].viewProps.set("disposed",!0)}),r}return e_(i,t),n(i,[{key:"onRackAdd_",value:function(e){e.isRoot&&Y(this.view.element,e.bladeController.view.element,e.index)}},{key:"onRackRemove_",value:function(e){e.isRoot&&K(e.bladeController.view.element)}}]),i}(G),eU=y("cnt"),eL=function t(n,i){var r,a=this;e(this,t),this.className_=y(null!==(r=i.viewName)&&void 0!==r?r:"fld"),this.element=n.createElement("div"),this.element.classList.add(this.className_(),eU()),i.viewProps.bindClassModifiers(this.element),this.foldable_=i.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),w(this.foldable_,"completed",S(this.element,this.className_(void 0,"cpl")));var o=n.createElement("button");o.classList.add(this.className_("b")),w(i.props,"title",function(e){h(e)?a.element.classList.add(a.className_(void 0,"not")):a.element.classList.remove(a.className_(void 0,"not"))}),i.viewProps.bindDisabled(o),this.element.appendChild(o),this.buttonElement=o;var s=n.createElement("div");s.classList.add(this.className_("i")),this.element.appendChild(s);var l=n.createElement("div");l.classList.add(this.className_("t")),M(i.props.value("title"),l),this.buttonElement.appendChild(l),this.titleElement=l;var u=n.createElement("div");u.classList.add(this.className_("m")),this.buttonElement.appendChild(u);var c=i.containerElement;c.classList.add(this.className_("c")),this.element.appendChild(c),this.containerElement=c},eD=function(t){function i(t,n){e(this,i);var r,a,o=er.create(null===(a=n.expanded)||void 0===a||a),s=new eR(t,{blade:n.blade,root:n.root,viewProps:n.viewProps});return(r=ev(this,i,[Object.assign(Object.assign({},n),{rackController:s,view:new eL(t,{containerElement:s.view.element,foldable:o,props:n.props,viewName:n.root?"rot":void 0,viewProps:n.viewProps})})])).onTitleClick_=r.onTitleClick_.bind(r),r.props=n.props,r.foldable=o,eo(r.foldable,r.view.containerElement),r.rackController.rack.emitter.on("add",function(){r.foldable.cleanUpTransition()}),r.rackController.rack.emitter.on("remove",function(){r.foldable.cleanUpTransition()}),r.view.buttonElement.addEventListener("click",r.onTitleClick_),r}return e_(i,t),n(i,[{key:"document",get:function(){return this.view.element.ownerDocument}},{key:"onTitleClick_",value:function(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}]),i}(eT),eI={id:"folder",type:"blade",accept:function(e){var t=I(e,{title:D.required.string,view:D.required.constant("folder"),expanded:D.optional.boolean});return t?{params:t}:null},controller:function(e){return new eD(e.document,{blade:e.blade,expanded:e.params.expanded,props:R.fromObject({title:e.params.title}),viewProps:e.viewProps})},api:function(e){return e.controller instanceof eD?new eE(e.controller,e.pool):null}},eN=function(t){function n(t,i){e(this,n);var r,a=i.valueController.viewProps;return(r=ev(this,n,[Object.assign(Object.assign({},i),{value:i.valueController.value,view:new $(t,{props:i.props,viewProps:a}),viewProps:a})])).props=i.props,r.valueController=i.valueController,r.view.valueElement.appendChild(r.valueController.view.element),r}return e_(n,t),n}(en),eO=function(t){function n(){return e(this,n),ev(this,n,arguments)}return e_(n,t),n}(a),eF=y("spr"),eB=function t(n,i){e(this,t),this.element=n.createElement("div"),this.element.classList.add(eF()),i.viewProps.bindClassModifiers(this.element);var r=n.createElement("hr");r.classList.add(eF("r")),this.element.appendChild(r)},eV=function(t){function n(t,i){return e(this,n),ev(this,n,[Object.assign(Object.assign({},i),{view:new eB(t,{viewProps:i.viewProps})})])}return e_(n,t),n}(G),ez={id:"separator",type:"blade",accept:function(e){var t=I(e,{view:D.required.constant("separator")});return t?{params:t}:null},controller:function(e){return new eV(e.document,{blade:e.blade,viewProps:e.viewProps})},api:function(e){return e.controller instanceof eV?new eO(e.controller):null}},eG=y("tbi"),eH=function t(n,i){var r=this;e(this,t),this.element=n.createElement("div"),this.element.classList.add(eG()),i.viewProps.bindClassModifiers(this.element),w(i.props,"selected",function(e){e?r.element.classList.add(eG(void 0,"sel")):r.element.classList.remove(eG(void 0,"sel"))});var a=n.createElement("button");a.classList.add(eG("b")),i.viewProps.bindDisabled(a),this.element.appendChild(a),this.buttonElement=a;var o=n.createElement("div");o.classList.add(eG("t")),M(i.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o},eW=function(){function t(n,i){e(this,t),this.emitter=new _,this.onClick_=this.onClick_.bind(this),this.props=i.props,this.viewProps=i.viewProps,this.view=new eH(n,{props:i.props,viewProps:i.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}return n(t,[{key:"onClick_",value:function(){this.emitter.emit("click",{sender:this})}}]),t}(),ej=function(){function t(n,i){var r=this;e(this,t),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new eW(n,{props:i.itemProps,viewProps:B.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new eR(n,{blade:ei(),viewProps:B.create()}),this.props=i.props,w(this.props,"selected",function(e){r.itemController.props.set("selected",e),r.contentController.viewProps.set("hidden",!e)})}return n(t,[{key:"itemController",get:function(){return this.ic_}},{key:"contentController",get:function(){return this.cc_}},{key:"onItemClick_",value:function(){this.props.set("selected",!0)}}]),t}(),eX=function(){function t(n,i){e(this,t),this.controller_=n,this.rackApi_=i}return n(t,[{key:"title",get:function(){var e;return null!==(e=this.controller_.itemController.props.get("title"))&&void 0!==e?e:""},set:function(e){this.controller_.itemController.props.set("title",e)}},{key:"selected",get:function(){return this.controller_.props.get("selected")},set:function(e){this.controller_.props.set("selected",e)}},{key:"children",get:function(){return this.rackApi_.children}},{key:"addButton",value:function(e){return this.rackApi_.addButton(e)}},{key:"addFolder",value:function(e){return this.rackApi_.addFolder(e)}},{key:"addSeparator",value:function(e){return this.rackApi_.addSeparator(e)}},{key:"addTab",value:function(e){return this.rackApi_.addTab(e)}},{key:"add",value:function(e,t){this.rackApi_.add(e,t)}},{key:"remove",value:function(e){this.rackApi_.remove(e)}},{key:"addInput",value:function(e,t,n){return this.rackApi_.addInput(e,t,n)}},{key:"addMonitor",value:function(e,t,n){return this.rackApi_.addMonitor(e,t,n)}},{key:"addBlade",value:function(e){return this.rackApi_.addBlade(e)}}]),t}(),eq=function(t){function i(t,n){var r;return e(this,i),(r=ev(this,i,[t,new eM(t.rackController,n)])).onPageAdd_=r.onPageAdd_.bind(r),r.onPageRemove_=r.onPageRemove_.bind(r),r.onSelect_=r.onSelect_.bind(r),r.emitter_=new _,r.pageApiMap_=new Map,r.rackApi_.on("change",function(e){r.emitter_.emit("change",{event:e})}),r.rackApi_.on("update",function(e){r.emitter_.emit("update",{event:e})}),r.controller_.tab.selectedIndex.emitter.on("change",r.onSelect_),r.controller_.pageSet.emitter.on("add",r.onPageAdd_),r.controller_.pageSet.emitter.on("remove",r.onPageRemove_),r.controller_.pageSet.items.forEach(function(e){r.setUpPageApi_(e)}),r}return e_(i,t),n(i,[{key:"pages",get:function(){var e=this;return this.controller_.pageSet.items.map(function(t){var n=e.pageApiMap_.get(t);if(!n)throw v.shouldNeverHappen();return n})}},{key:"addPage",value:function(e){var t=new ej(this.controller_.view.element.ownerDocument,{itemProps:R.fromObject({selected:!1,title:e.title}),props:R.fromObject({selected:!1})});this.controller_.add(t,e.index);var n=this.pageApiMap_.get(t);if(!n)throw v.shouldNeverHappen();return n}},{key:"removePage",value:function(e){this.controller_.remove(e)}},{key:"on",value:function(e,t){var n=t.bind(this);return this.emitter_.on(e,function(e){n(e.event)}),this}},{key:"setUpPageApi_",value:function(e){var t=this.rackApi_.apiSet_.find(function(t){return t.controller_===e.contentController});if(!t)throw v.shouldNeverHappen();var n=new eX(e,t);this.pageApiMap_.set(e,n)}},{key:"onPageAdd_",value:function(e){this.setUpPageApi_(e.item)}},{key:"onPageRemove_",value:function(e){if(!this.pageApiMap_.get(e.item))throw v.shouldNeverHappen();this.pageApiMap_.delete(e.item)}},{key:"onSelect_",value:function(e){this.emitter_.emit("select",{event:new c(this,e.rawValue)})}}]),i}(es),eY=function(){function t(){e(this,t),this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=P(!0),this.selectedIndex=P(-1),this.items_=[]}return n(t,[{key:"add",value:function(e,t){var n=null!=t?t:this.items_.length;this.items_.splice(n,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}},{key:"remove",value:function(e){var t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}},{key:"keepSelection_",value:function(){if(0===this.items_.length){this.selectedIndex.rawValue=-1,this.empty.rawValue=!0;return}var e=this.items_.findIndex(function(e){return e.rawValue});e<0?(this.items_.forEach(function(e,t){e.rawValue=0===t}),this.selectedIndex.rawValue=0):(this.items_.forEach(function(t,n){t.rawValue=n===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}},{key:"onItemSelectedChange_",value:function(e){if(e.rawValue){var t=this.items_.findIndex(function(t){return t===e.sender});this.items_.forEach(function(e,n){e.rawValue=n===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}}]),t}(),eK=y("tab"),eZ=function t(n,i){e(this,t),this.element=n.createElement("div"),this.element.classList.add(eK(),eU()),i.viewProps.bindClassModifiers(this.element),b(i.empty,S(this.element,eK(void 0,"nop")));var r=n.createElement("div");r.classList.add(eK("t")),this.element.appendChild(r),this.itemsElement=r;var a=n.createElement("div");a.classList.add(eK("i")),this.element.appendChild(a);var o=i.contentsElement;o.classList.add(eK("c")),this.element.appendChild(o),this.contentsElement=o},eJ=function(t){function i(t,n){e(this,i);var r,a=new eR(t,{blade:n.blade,viewProps:n.viewProps}),o=new eY;return(r=ev(this,i,[{blade:n.blade,rackController:a,view:new eZ(t,{contentsElement:a.view.element,empty:o.empty,viewProps:n.viewProps})}])).onPageAdd_=r.onPageAdd_.bind(r),r.onPageRemove_=r.onPageRemove_.bind(r),r.pageSet_=new el(function(){return null}),r.pageSet_.emitter.on("add",r.onPageAdd_),r.pageSet_.emitter.on("remove",r.onPageRemove_),r.tab=o,r}return e_(i,t),n(i,[{key:"pageSet",get:function(){return this.pageSet_}},{key:"add",value:function(e,t){this.pageSet_.add(e,t)}},{key:"remove",value:function(e){this.pageSet_.remove(this.pageSet_.items[e])}},{key:"onPageAdd_",value:function(e){var t=e.item;Y(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(t.contentController,e.index),this.tab.add(t.props.value("selected"))}},{key:"onPageRemove_",value:function(e){var t=e.item;K(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.rackController.rack.remove(t.contentController),this.tab.remove(t.props.value("selected"))}}]),i}(eT),eQ={id:"tab",type:"blade",accept:function(e){var t=I(e,{pages:D.required.array(D.required.object({title:D.required.string})),view:D.required.constant("tab")});return t&&0!==t.pages.length?{params:t}:null},controller:function(e){var t=new eJ(e.document,{blade:e.blade,viewProps:e.viewProps});return e.params.pages.forEach(function(n){var i=new ej(e.document,{itemProps:R.fromObject({selected:!1,title:n.title}),props:R.fromObject({selected:!1})});t.add(i)}),t},api:function(e){return e.controller instanceof eJ?new eq(e.controller,e.pool):null}},e$=function(){function t(){e(this,t),this.disabled=!1,this.emitter=new _}return n(t,[{key:"dispose",value:function(){}},{key:"tick",value:function(){this.disabled||this.emitter.emit("tick",{sender:this})}}]),t}(),e0=function(){function t(n,i){e(this,t),this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=n,this.emitter=new _,this.interval_=i,this.setTimer_()}return n(t,[{key:"disabled",get:function(){return this.disabled_},set:function(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}},{key:"dispose",value:function(){this.clearTimer_()}},{key:"clearTimer_",value:function(){if(null!==this.timerId_){var e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}}},{key:"setTimer_",value:function(){if(this.clearTimer_(),!(this.interval_<=0)){var e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}}},{key:"onTick_",value:function(){this.disabled_||this.emitter.emit("tick",{sender:this})}}]),t}(),e1=function(){function t(n){e(this,t),this.onValueChange_=this.onValueChange_.bind(this),this.reader=n.reader,this.writer=n.writer,this.emitter=new _,this.value=n.value,this.value.emitter.on("change",this.onValueChange_),this.target=n.target,this.read()}return n(t,[{key:"read",value:function(){var e=this.target.read();void 0!==e&&(this.value.rawValue=this.reader(e))}},{key:"write_",value:function(e){this.writer(this.target,e)}},{key:"onValueChange_",value:function(e){this.write_(e.rawValue),this.emitter.emit("change",{options:e.options,rawValue:e.rawValue,sender:this})}}]),t}();function e2(e,t){for(;e.length<t;)e.push(void 0)}var e3=function(){function t(n){e(this,t),this.onTick_=this.onTick_.bind(this),this.reader_=n.reader,this.target=n.target,this.emitter=new _,this.value=n.value,this.ticker=n.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}return n(t,[{key:"dispose",value:function(){this.ticker.dispose()}},{key:"read",value:function(){var e=this.target.read();if(void 0!==e){var t,n,i=this.value.rawValue,r=this.reader_(e);this.value.rawValue=((n=ew((t=i.indexOf(void 0))<0?i:i.slice(0,t)).concat([r])).length>i.length?n.splice(0,n.length-i.length):e2(n,i.length),n),this.emitter.emit("update",{rawValue:r,sender:this})}}},{key:"onTick_",value:function(e){this.read()}}]),t}(),e4=function(){function t(n){e(this,t),this.constraints=n}return n(t,[{key:"constrain",value:function(e){return this.constraints.reduce(function(e,t){return t.constrain(e)},e)}}]),t}();function e5(e,t){if(e instanceof t)return e;if(e instanceof e4){var n=e.constraints.reduce(function(e,n){return e||(n instanceof t?n:null)},null);if(n)return n}return null}var e6=function(){function t(n){e(this,t),this.values=R.fromObject({max:n.max,min:n.min})}return n(t,[{key:"constrain",value:function(e){var t=this.values.get("max");return Math.min(Math.max(e,this.values.get("min")),t)}}]),t}(),e8=function(){function t(n){e(this,t),this.values=R.fromObject({options:n})}return n(t,[{key:"options",get:function(){return this.values.get("options")}},{key:"constrain",value:function(e){var t=this.values.get("options");return 0===t.length?e:t.filter(function(t){return t.value===e}).length>0?e:t[0].value}}]),t}(),e9=function(){function t(n){e(this,t),this.values=R.fromObject({max:n.max,min:n.min})}return n(t,[{key:"maxValue",get:function(){return this.values.get("max")}},{key:"minValue",get:function(){return this.values.get("min")}},{key:"constrain",value:function(e){var t=this.values.get("max"),n=this.values.get("min"),i=e;return h(n)||(i=Math.max(i,n)),h(t)||(i=Math.min(i,t)),i}}]),t}(),e7=function(){function t(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.step=n,this.origin=i}return n(t,[{key:"constrain",value:function(e){var t=this.origin%this.step,n=Math.round((e-t)/this.step);return t+n*this.step}}]),t}(),te=y("lst"),tt=function(){function t(n,i){var r=this;e(this,t),this.onValueChange_=this.onValueChange_.bind(this),this.props_=i.props,this.element=n.createElement("div"),this.element.classList.add(te()),i.viewProps.bindClassModifiers(this.element);var a=n.createElement("select");a.classList.add(te("s")),i.viewProps.bindDisabled(a),this.element.appendChild(a),this.selectElement=a;var o=n.createElement("div");o.classList.add(te("m")),o.appendChild(q(n,"dropdown")),this.element.appendChild(o),i.value.emitter.on("change",this.onValueChange_),this.value_=i.value,w(this.props_,"options",function(e){Z(r.selectElement),e.forEach(function(e){var t=n.createElement("option");t.textContent=e.text,r.selectElement.appendChild(t)}),r.update_()})}return n(t,[{key:"update_",value:function(){var e=this.props_.get("options").map(function(e){return e.value});this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}},{key:"onValueChange_",value:function(){this.update_()}}]),t}(),tn=function(){function t(n,i){e(this,t),this.onSelectChange_=this.onSelectChange_.bind(this),this.props=i.props,this.value=i.value,this.viewProps=i.viewProps,this.view=new tt(n,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}return n(t,[{key:"onSelectChange_",value:function(e){var t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}}]),t}(),ti=y("pop"),tr=function t(n,i){e(this,t),this.element=n.createElement("div"),this.element.classList.add(ti()),i.viewProps.bindClassModifiers(this.element),b(i.shows,S(this.element,ti(void 0,"v")))},ta=function t(n,i){e(this,t),this.shows=P(!1),this.viewProps=i.viewProps,this.view=new tr(n,{shows:this.shows,viewProps:this.viewProps})},to=y("txt"),ts=function(){function t(n,i){e(this,t),this.onChange_=this.onChange_.bind(this),this.element=n.createElement("div"),this.element.classList.add(to()),i.viewProps.bindClassModifiers(this.element),this.props_=i.props,this.props_.emitter.on("change",this.onChange_);var r=n.createElement("input");r.classList.add(to("i")),r.type="text",i.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,i.value.emitter.on("change",this.onChange_),this.value_=i.value,this.refresh()}return n(t,[{key:"refresh",value:function(){var e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}},{key:"onChange_",value:function(){this.refresh()}}]),t}(),tl=function(){function t(n,i){e(this,t),this.onInputChange_=this.onInputChange_.bind(this),this.parser_=i.parser,this.props=i.props,this.value=i.value,this.viewProps=i.viewProps,this.view=new ts(n,{props:i.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}return n(t,[{key:"onInputChange_",value:function(e){var t=e.currentTarget.value,n=this.parser_(t);h(n)||(this.value.rawValue=n),this.view.refresh()}}]),t}();function tu(e){return"false"!==e&&!!e}function tc(e){return String(e)}var th=function(){function t(n){e(this,t),this.text=n}return n(t,[{key:"evaluate",value:function(){return Number(this.text)}},{key:"toString",value:function(){return this.text}}]),t}(),td={"**":function(e,t){return Math.pow(e,t)},"*":function(e,t){return e*t},"/":function(e,t){return e/t},"%":function(e,t){return e%t},"+":function(e,t){return e+t},"-":function(e,t){return e-t},"<<":function(e,t){return e<<t},">>":function(e,t){return e>>t},">>>":function(e,t){return e>>>t},"&":function(e,t){return e&t},"^":function(e,t){return e^t},"|":function(e,t){return e|t}},tp=function(){function t(n,i,r){e(this,t),this.left=i,this.operator=n,this.right=r}return n(t,[{key:"evaluate",value:function(){var e=td[this.operator];if(!e)throw Error("unexpected binary operator: '".concat(this.operator));return e(this.left.evaluate(),this.right.evaluate())}},{key:"toString",value:function(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}]),t}(),tf={"+":function(e){return e},"-":function(e){return-e},"~":function(e){return~e}},tv=function(){function t(n,i){e(this,t),this.operator=n,this.expression=i}return n(t,[{key:"evaluate",value:function(){var e=tf[this.operator];if(!e)throw Error("unexpected unary operator: '".concat(this.operator));return e(this.expression.evaluate())}},{key:"toString",value:function(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}]),t}();function tm(e){return function(t,n){for(var i=0;i<e.length;i++){var r=e[i](t,n);if(""!==r)return r}return""}}function tg(e,t){var n,i=e.substr(t).match(/^\s+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function t_(e,t){var n,i=e.substr(t).match(/^[0-9]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function ty(e,t){var n=e.substr(t,1);if(t+=1,"e"!==n.toLowerCase())return"";var i=function(e,t){var n=t_(e,t);if(""!==n)return n;var i=e.substr(t,1);if(t+=1,"-"!==i&&"+"!==i)return"";var r=t_(e,t);return""===r?"":i+r}(e,t);return""===i?"":n+i}function tx(e,t){var n,i,r=e.substr(t,1);if("0"===r)return r;var a=(n=t,(i=e.substr(n,1)).match(/^[1-9]$/)?i:"");return(t+=a.length,""===a)?"":a+t_(e,t)}var tb=tm([function(e,t){var n=tx(e,t);if(t+=n.length,""===n)return"";var i=e.substr(t,1);if(t+=i.length,"."!==i)return"";var r=t_(e,t);return t+=r.length,n+i+r+ty(e,t)},function(e,t){var n=e.substr(t,1);if(t+=n.length,"."!==n)return"";var i=t_(e,t);return(t+=i.length,""===i)?"":n+i+ty(e,t)},function(e,t){var n=tx(e,t);return(t+=n.length,""===n)?"":n+ty(e,t)}]),tw=tm([function(e,t){var n,i,r,a=e.substr(t,2);if(t+=a.length,"0b"!==a.toLowerCase())return"";var o=(n=t,null!==(i=(r=e.substr(n).match(/^[01]+/))&&r[0])&&void 0!==i?i:"");return""===o?"":a+o},function(e,t){var n,i,r,a=e.substr(t,2);if(t+=a.length,"0o"!==a.toLowerCase())return"";var o=(n=t,null!==(i=(r=e.substr(n).match(/^[0-7]+/))&&r[0])&&void 0!==i?i:"");return""===o?"":a+o},function(e,t){var n,i,r,a=e.substr(t,2);if(t+=a.length,"0x"!==a.toLowerCase())return"";var o=(n=t,null!==(i=(r=e.substr(n).match(/^[0-9a-f]+/i))&&r[0])&&void 0!==i?i:"");return""===o?"":a+o}]),tS=tm([tw,tb]),tM=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(function(e,t){return function(n,i){var r=e(n,i);if(!r)return null;i=r.cursor;for(var a=r.evaluable;;){var o=function(e,t,n){n+=tg(t,n).length;var i=e.filter(function(e){return t.startsWith(e,n)})[0];return i?(n+=i.length,{cursor:n+=tg(t,n).length,operator:i}):null}(t,n,i);if(!o)break;var s=e(n,i=o.cursor);if(!s)return null;i=s.cursor,a=new tp(o.operator,a,s.evaluable)}return a?{cursor:i,evaluable:a}:null}},function e(t,n){var i,r,a,o,s=null!==(o=tS(t,a=i=n),a+=o.length,r=""===o?null:{evaluable:new th(o),cursor:a})&&void 0!==r?r:function(e,t){var n=e.substr(t,1);if(t+=n.length,"("!==n)return null;var i=tE(e,t);if(!i)return null;t=i.cursor,t+=tg(e,t).length;var r=e.substr(t,1);return(t+=r.length,")"!==r)?null:{evaluable:i.evaluable,cursor:t}}(t,i);if(s)return s;var l=t.substr(n,1);if(n+=l.length,"+"!==l&&"-"!==l&&"~"!==l)return null;var u=e(t,n);return u?{cursor:n=u.cursor,evaluable:new tv(l,u.evaluable)}:null});function tE(e,t){return t+=tg(e,t).length,tM(e,t)}function tT(e){var t,n,i=(t=tE(e,0))&&t.cursor+tg(e,t.cursor).length===e.length?t.evaluable:null;return null!==(n=null==i?void 0:i.evaluate())&&void 0!==n?n:null}function tC(e){if("number"==typeof e)return e;if("string"==typeof e){var t=tT(e);if(!h(t))return t}return 0}function tk(e){return String(e)}function tA(e){return function(t){return t.toFixed(Math.max(Math.min(e,20),0))}}var tP=tA(0);function tR(e){return tP(e)+"%"}function tU(e){return String(e)}function tL(e){return e}function tD(e){var t=e.primary,n=e.secondary,i=e.forward,r=e.backward,a=!1;function o(e){a||(a=!0,e(),a=!1)}t.emitter.on("change",function(e){o(function(){n.setRawValue(i(t,n),e.options)})}),n.emitter.on("change",function(e){o(function(){t.setRawValue(r(t,n),e.options)}),o(function(){n.setRawValue(i(t,n),e.options)})}),o(function(){n.setRawValue(i(t,n),{forceEmit:!1,last:!0})})}function tI(e,t){var n=e*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+n:t.downKey?-n:0}function tN(e){return{altKey:e.altKey,downKey:"ArrowDown"===e.key,shiftKey:e.shiftKey,upKey:"ArrowUp"===e.key}}function tO(e){return{altKey:e.altKey,downKey:"ArrowLeft"===e.key,shiftKey:e.shiftKey,upKey:"ArrowRight"===e.key}}function tF(e){return"ArrowUp"===e||"ArrowDown"===e||"ArrowLeft"===e||"ArrowRight"===e}function tB(e,t){var n,i,r=t.ownerDocument.defaultView,a=t.getBoundingClientRect();return{x:e.pageX-((null!==(n=r&&r.scrollX)&&void 0!==n?n:0)+a.left),y:e.pageY-((null!==(i=r&&r.scrollY)&&void 0!==i?i:0)+a.top)}}var tV=function(){function t(n){e(this,t),this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=n,this.emitter=new _,n.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),n.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),n.addEventListener("touchend",this.onTouchEnd_),n.addEventListener("mousedown",this.onMouseDown_)}return n(t,[{key:"computePosition_",value:function(e){var t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}},{key:"onMouseDown_",value:function(e){e.preventDefault(),null===(t=e.currentTarget)||void 0===t||t.focus();var t,n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(tB(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}},{key:"onDocumentMouseMove_",value:function(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(tB(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}},{key:"onDocumentMouseUp_",value:function(e){var t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(tB(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}},{key:"onTouchStart_",value:function(e){e.preventDefault();var t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}},{key:"onTouchMove_",value:function(e){var t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}},{key:"onTouchEnd_",value:function(e){var t,n=null!==(t=e.targetTouches.item(0))&&void 0!==t?t:this.lastTouch_,i=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(n?{x:n.clientX-i.left,y:n.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey})}}]),t}();function tz(e,t,n,i,r){return i+(e-t)/(n-t)*(r-i)}function tG(e){return String(e.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function tH(e,t,n){return Math.min(Math.max(e,t),n)}var tW=y("txt"),tj=function(){function t(n,i){e(this,t),this.onChange_=this.onChange_.bind(this),this.props_=i.props,this.props_.emitter.on("change",this.onChange_),this.element=n.createElement("div"),this.element.classList.add(tW(),tW(void 0,"num")),i.arrayPosition&&this.element.classList.add(tW(void 0,i.arrayPosition)),i.viewProps.bindClassModifiers(this.element);var r=n.createElement("input");r.classList.add(tW("i")),r.type="text",i.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=i.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(tW()),this.inputElement.classList.add(tW("i"));var a=n.createElement("div");a.classList.add(tW("k")),this.element.appendChild(a),this.knobElement=a;var o=n.createElementNS(H,"svg");o.classList.add(tW("g")),this.knobElement.appendChild(o);var s=n.createElementNS(H,"path");s.classList.add(tW("gb")),o.appendChild(s),this.guideBodyElem_=s;var l=n.createElementNS(H,"path");l.classList.add(tW("gh")),o.appendChild(l),this.guideHeadElem_=l;var u=n.createElement("div");u.classList.add(y("tt")()),this.knobElement.appendChild(u),this.tooltipElem_=u,i.value.emitter.on("change",this.onChange_),this.value=i.value,this.refresh()}return n(t,[{key:"onDraggingChange_",value:function(e){if(null===e.rawValue){this.element.classList.remove(tW(void 0,"drg"));return}this.element.classList.add(tW(void 0,"drg"));var t=e.rawValue/this.props_.get("draggingScale"),n=t+(t>0?-1:+(t<0)),i=tH(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",["M ".concat(n+i,",0 L").concat(n,",4 L").concat(n+i,",8"),"M ".concat(t,",-1 L").concat(t,",9")].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d","M 0,4 L".concat(t,",4"));var r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left="".concat(t,"px")}},{key:"refresh",value:function(){var e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}},{key:"onChange_",value:function(){this.refresh()}}]),t}(),tX=function(){function t(n,i){e(this,t),this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=i.baseStep,this.parser_=i.parser,this.props=i.props,this.sliderProps_=null!==(r=i.sliderProps)&&void 0!==r?r:null,this.value=i.value,this.viewProps=i.viewProps,this.dragging_=P(null),this.view=new tj(n,{arrayPosition:i.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);var r,a=new tV(this.view.knobElement);a.emitter.on("down",this.onPointerDown_),a.emitter.on("move",this.onPointerMove_),a.emitter.on("up",this.onPointerUp_)}return n(t,[{key:"constrainValue_",value:function(e){var t,n,i=null===(t=this.sliderProps_)||void 0===t?void 0:t.get("minValue"),r=null===(n=this.sliderProps_)||void 0===n?void 0:n.get("maxValue"),a=e;return void 0!==i&&(a=Math.max(a,i)),void 0!==r&&(a=Math.min(a,r)),a}},{key:"onInputChange_",value:function(e){var t=e.currentTarget.value,n=this.parser_(t);h(n)||(this.value.rawValue=this.constrainValue_(n)),this.view.refresh()}},{key:"onInputKeyDown_",value:function(e){var t=tI(this.baseStep_,tN(e));0!==t&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}},{key:"onInputKeyUp_",value:function(e){0!==tI(this.baseStep_,tN(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},{key:"onPointerDown_",value:function(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}},{key:"computeDraggingValue_",value:function(e){if(!e.point)return null;var t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("draggingScale"))}},{key:"onPointerMove_",value:function(e){var t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}},{key:"onPointerUp_",value:function(e){var t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}]),t}(),tq=y("sld"),tY=function(){function t(n,i){e(this,t),this.onChange_=this.onChange_.bind(this),this.props_=i.props,this.props_.emitter.on("change",this.onChange_),this.element=n.createElement("div"),this.element.classList.add(tq()),i.viewProps.bindClassModifiers(this.element);var r=n.createElement("div");r.classList.add(tq("t")),i.viewProps.bindTabIndex(r),this.element.appendChild(r),this.trackElement=r;var a=n.createElement("div");a.classList.add(tq("k")),this.trackElement.appendChild(a),this.knobElement=a,i.value.emitter.on("change",this.onChange_),this.value=i.value,this.update_()}return n(t,[{key:"update_",value:function(){var e=tH(tz(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width="".concat(e,"%")}},{key:"onChange_",value:function(){this.update_()}}]),t}(),tK=function(){function t(n,i){e(this,t),this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=i.baseStep,this.value=i.value,this.viewProps=i.viewProps,this.props=i.props,this.view=new tY(n,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new tV(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}return n(t,[{key:"handlePointerEvent_",value:function(e,t){e.point&&this.value.setRawValue(tz(tH(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),t)}},{key:"onPointerDownOrMove_",value:function(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}},{key:"onPointerUp_",value:function(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}},{key:"onKeyDown_",value:function(e){var t=tI(this.baseStep_,tO(e));0!==t&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}},{key:"onKeyUp_",value:function(e){0!==tI(this.baseStep_,tO(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}]),t}(),tZ=y("sldtxt"),tJ=function t(n,i){e(this,t),this.element=n.createElement("div"),this.element.classList.add(tZ());var r=n.createElement("div");r.classList.add(tZ("s")),this.sliderView_=i.sliderView,r.appendChild(this.sliderView_.element),this.element.appendChild(r);var a=n.createElement("div");a.classList.add(tZ("t")),this.textView_=i.textView,a.appendChild(this.textView_.element),this.element.appendChild(a)},tQ=function(){function t(n,i){e(this,t),this.value=i.value,this.viewProps=i.viewProps,this.sliderC_=new tK(n,{baseStep:i.baseStep,props:i.sliderProps,value:i.value,viewProps:this.viewProps}),this.textC_=new tX(n,{baseStep:i.baseStep,parser:i.parser,props:i.textProps,sliderProps:i.sliderProps,value:i.value,viewProps:i.viewProps}),this.view=new tJ(n,{sliderView:this.sliderC_.view,textView:this.textC_.view})}return n(t,[{key:"sliderController",get:function(){return this.sliderC_}},{key:"textController",get:function(){return this.textC_}}]),t}();function t$(e,t){e.write(t)}function t0(e){return Array.isArray(e)?D.required.array(D.required.object({text:D.required.string,value:D.required.raw}))(e).value:(void 0===e?"undefined":eu(e))==="object"?D.required.raw(e).value:void 0}function t1(e){if("inline"===e||"popup"===e)return e}function t2(e){return D.required.object({max:D.optional.number,min:D.optional.number,step:D.optional.number})(e).value}function t3(e){if(Array.isArray(e))return e;var t=[];return Object.keys(e).forEach(function(n){t.push({text:n,value:e[n]})}),t}function t4(e){return h(e)?null:new e8(t3(e))}function t5(e,t){var n=e&&e5(e,e7);return n?tG(n.step):Math.max(tG(t),2)}function t6(e){var t,n=(t=e?e5(e,e7):null)?t.step:null;return null!=n?n:1}function t8(e,t){var n,i=e&&e5(e,e7),r=Math.abs(null!==(n=null==i?void 0:i.step)&&void 0!==n?n:t);return 0===r?.1:Math.pow(10,Math.floor(Math.log10(r))-1)}var t9=y("ckb"),t7=function(){function t(n,i){e(this,t),this.onValueChange_=this.onValueChange_.bind(this),this.element=n.createElement("div"),this.element.classList.add(t9()),i.viewProps.bindClassModifiers(this.element);var r=n.createElement("label");r.classList.add(t9("l")),this.element.appendChild(r);var a=n.createElement("input");a.classList.add(t9("i")),a.type="checkbox",r.appendChild(a),this.inputElement=a,i.viewProps.bindDisabled(this.inputElement);var o=n.createElement("div");o.classList.add(t9("w")),r.appendChild(o);var s=q(n,"check");o.appendChild(s),i.value.emitter.on("change",this.onValueChange_),this.value=i.value,this.update_()}return n(t,[{key:"update_",value:function(){this.inputElement.checked=this.value.rawValue}},{key:"onValueChange_",value:function(){this.update_()}}]),t}(),ne=function(){function t(n,i){e(this,t),this.onInputChange_=this.onInputChange_.bind(this),this.value=i.value,this.viewProps=i.viewProps,this.view=new t7(n,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}return n(t,[{key:"onInputChange_",value:function(e){var t=e.currentTarget;this.value.rawValue=t.checked}}]),t}(),nt={id:"input-bool",type:"input",accept:function(e,t){if("boolean"!=typeof e)return null;var n=I(t,{options:D.optional.custom(t0)});return n?{initialValue:e,params:n}:null},binding:{reader:function(e){return tu},constraint:function(e){var t,n,i;return t=e.params,n=[],(i=t4(t.options))&&n.push(i),new e4(n)},writer:function(e){return t$}},controller:function(e){var t=e.document,n=e.value,i=e.constraint,r=i&&e5(i,e8);return r?new tn(t,{props:new R({options:r.values.value("options")}),value:n,viewProps:e.viewProps}):new ne(t,{value:n,viewProps:e.viewProps})}},nn=y("col"),ni=function t(n,i){e(this,t),this.element=n.createElement("div"),this.element.classList.add(nn()),i.foldable.bindExpandedClass(this.element,nn(void 0,"expanded")),w(i.foldable,"completed",S(this.element,nn(void 0,"cpl")));var r=n.createElement("div");r.classList.add(nn("h")),this.element.appendChild(r);var a=n.createElement("div");a.classList.add(nn("s")),r.appendChild(a),this.swatchElement=a;var o=n.createElement("div");if(o.classList.add(nn("t")),r.appendChild(o),this.textElement=o,"inline"===i.pickerLayout){var s=n.createElement("div");s.classList.add(nn("p")),this.element.appendChild(s),this.pickerElement=s}else this.pickerElement=null};function nr(e,t,n){var i,r,a,o,s,l,u,c,h,d=(e%360+360)%360,p=tH(t/100,0,1),f=tH(n/100,0,1),v=f*p,m=v*(1-Math.abs(d/60%2-1)),g=f-v;return d>=0&&d<60?(i=(o=[v,m,0])[0],r=o[1],a=o[2]):d>=60&&d<120?(i=(s=[m,v,0])[0],r=s[1],a=s[2]):d>=120&&d<180?(i=(l=[0,v,m])[0],r=l[1],a=l[2]):d>=180&&d<240?(i=(u=[0,m,v])[0],r=u[1],a=u[2]):d>=240&&d<300?(i=(c=[m,0,v])[0],r=c[1],a=c[2]):(i=(h=[v,0,m])[0],r=h[1],a=h[2]),[(i+g)*255,(r+g)*255,(a+g)*255]}function na(e){return[e[0],e[1],e[2]]}function no(e,t){return[e[0],e[1],e[2],t]}var ns={hsl:{hsl:function(e,t,n){return[e,t,n]},hsv:function(e,t,n){var i=n+t*(100-Math.abs(2*n-100))/200;return[e,0!==i?t*(100-Math.abs(2*n-100))/i:0,n+t*(100-Math.abs(2*n-100))/200]},rgb:function(e,t,n){var i,r,a,o,s,l,u,c,h,d=(e%360+360)%360,p=tH(t/100,0,1),f=tH(n/100,0,1),v=(1-Math.abs(2*f-1))*p,m=v*(1-Math.abs(d/60%2-1)),g=f-v/2;return d>=0&&d<60?(i=(o=[v,m,0])[0],r=o[1],a=o[2]):d>=60&&d<120?(i=(s=[m,v,0])[0],r=s[1],a=s[2]):d>=120&&d<180?(i=(l=[0,v,m])[0],r=l[1],a=l[2]):d>=180&&d<240?(i=(u=[0,m,v])[0],r=u[1],a=u[2]):d>=240&&d<300?(i=(c=[m,0,v])[0],r=c[1],a=c[2]):(i=(h=[v,0,m])[0],r=h[1],a=h[2]),[(i+g)*255,(r+g)*255,(a+g)*255]}},hsv:{hsl:function(e,t,n){var i=100-Math.abs(n*(200-t)/100-100);return[e,0!==i?t*n/i:0,n*(200-t)/200]},hsv:function(e,t,n){return[e,t,n]},rgb:nr},rgb:{hsl:function(e,t,n){var i=tH(e/255,0,1),r=tH(t/255,0,1),a=tH(n/255,0,1),o=Math.max(i,r,a),s=Math.min(i,r,a),l=o-s,u=0,c=0;return 0!==l&&(c=l/(1-Math.abs(o+s-1)),u=(u=i===o?(r-a)/l:r===o?2+(a-i)/l:4+(i-r)/l)/6+ +(u<0)),[360*u,100*c,(s+o)/2*100]},hsv:function(e,t,n){var i=tH(e/255,0,1),r=tH(t/255,0,1),a=tH(n/255,0,1),o=Math.max(i,r,a),s=o-Math.min(i,r,a);return[0===s?0:o===i?((r-a)/s%6+6)%6*60:o===r?60*((a-i)/s+2):60*((i-r)/s+4),100*(0===o?0:s/o),100*o]},rgb:function(e,t,n){return[e,t,n]}}};function nl(e,t){return["float"===t?1:"rgb"===e?255:360,"float"===t?1:"rgb"===e?255:100,"float"===t?1:"rgb"===e?255:100]}function nu(e,t,n,i){var r=nl(t,n),a=nl(t,i);return e.map(function(e,t){return e/r[t]*a[t]})}function nc(e,t){return!((void 0===e?"undefined":eu(e))!=="object"||h(e))&&t in e&&"number"==typeof e[t]}var nh=function(){function t(n,i){var r,a,o,s,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"int";e(this,t),this.mode=i,this.type=l,this.comps_=(a=nl(i,l),["rgb"===i?tH(n[0],0,a[0]):(o=n[0])===(s=a[0])?s:(o%s+s)%s,tH(n[1],0,a[1]),tH(n[2],0,a[2]),tH(null!==(r=n[3])&&void 0!==r?r:1,0,1)])}return n(t,[{key:"getComponents",value:function(e){var t,n,i,r,a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"int";return no((t=na(this.comps_),n={mode:this.mode,type:this.type},i={mode:null!=e?e:this.mode,type:o},a=nu(t,n.mode,n.type,"int"),nu((r=ns[n.mode])[i.mode].apply(r,ew(a)),i.mode,"int",i.type)),this.comps_[3])}},{key:"toRgbaObject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"int",t=this.getComponents("rgb",e);return{r:t[0],g:t[1],b:t[2],a:t[3]}}}],[{key:"black",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"int";return new t([0,0,0],"rgb",e)}},{key:"fromObject",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"int";return new t("a"in e?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b],"rgb",n)}},{key:"toRgbaObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"int";return e.toRgbaObject(t)}},{key:"isRgbColorObject",value:function(e){return nc(e,"r")&&nc(e,"g")&&nc(e,"b")}},{key:"isRgbaColorObject",value:function(e){return this.isRgbColorObject(e)&&nc(e,"a")}},{key:"isColorObject",value:function(e){return this.isRgbColorObject(e)}},{key:"equals",value:function(e,t){if(e.mode!==t.mode)return!1;for(var n=e.comps_,i=t.comps_,r=0;r<n.length;r++)if(n[r]!==i[r])return!1;return!0}}]),t}(),nd=y("colp"),np=function(){function t(n,i){e(this,t),this.alphaViews_=null,this.element=n.createElement("div"),this.element.classList.add(nd()),i.viewProps.bindClassModifiers(this.element);var r=n.createElement("div");r.classList.add(nd("hsv"));var a=n.createElement("div");a.classList.add(nd("sv")),this.svPaletteView_=i.svPaletteView,a.appendChild(this.svPaletteView_.element),r.appendChild(a);var o=n.createElement("div");o.classList.add(nd("h")),this.hPaletteView_=i.hPaletteView,o.appendChild(this.hPaletteView_.element),r.appendChild(o),this.element.appendChild(r);var s=n.createElement("div");if(s.classList.add(nd("rgb")),this.textView_=i.textView,s.appendChild(this.textView_.element),this.element.appendChild(s),i.alphaViews){this.alphaViews_={palette:i.alphaViews.palette,text:i.alphaViews.text};var l=n.createElement("div");l.classList.add(nd("a"));var u=n.createElement("div");u.classList.add(nd("ap")),u.appendChild(this.alphaViews_.palette.element),l.appendChild(u);var c=n.createElement("div");c.classList.add(nd("at")),c.appendChild(this.alphaViews_.text.element),l.appendChild(c),this.element.appendChild(l)}}return n(t,[{key:"allFocusableElements",get:function(){var e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement].concat(ew(this.textView_.textViews.map(function(e){return e.inputElement})));return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}]),t}();function nf(e){return"int"===e?"int":"float"===e?"float":void 0}function nv(e){return I(e,{alpha:D.optional.boolean,color:D.optional.object({alpha:D.optional.boolean,type:D.optional.custom(nf)}),expanded:D.optional.boolean,picker:D.optional.custom(t1)})}function nm(e){return e?.1:1}function ng(e){var t;return null===(t=e.color)||void 0===t?void 0:t.type}function n_(e,t){var n=e.match(/^(.+)%$/);return n?Math.min(.01*parseFloat(n[1])*t,t):Math.min(parseFloat(e),t)}var ny={deg:function(e){return e},grad:function(e){return 360*e/400},rad:function(e){return 360*e/(2*Math.PI)},turn:function(e){return 360*e}};function nx(e){var t=e.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(e);var n=parseFloat(t[1]);return ny[t[2]](n)}function nb(e){var t=e.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;var n=[n_(t[1],255),n_(t[2],255),n_(t[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function nw(e){return function(t){var n=nb(t);return n?new nh(n,"rgb",e):null}}function nS(e){var t=e.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;var n=[n_(t[1],255),n_(t[2],255),n_(t[3],255),n_(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function nM(e){return function(t){var n=nS(t);return n?new nh(n,"rgb",e):null}}function nE(e){var t=e.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;var n=[nx(t[1]),n_(t[2],100),n_(t[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function nT(e){return function(t){var n=nE(t);return n?new nh(n,"hsl",e):null}}function nC(e){var t=e.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;var n=[nx(t[1]),n_(t[2],100),n_(t[3],100),n_(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function nk(e){return function(t){var n=nC(t);return n?new nh(n,"hsl",e):null}}function nA(e){var t=e.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)];var n=e.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:null}function nP(e){var t=e.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),tz(parseInt(t[4]+t[4],16),0,255,0,1)];var n=e.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),tz(parseInt(n[4],16),0,255,0,1)]:null}function nR(e){var t=e.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;var n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function nU(e){return function(t){var n=nR(t);return n?new nh(n,"rgb",e):null}}function nL(e){var t=e.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;var n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function nD(e){return function(t){var n=nL(t);return n?new nh(n,"rgb",e):null}}var nI=[{parser:nA,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:nP,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:nb,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:nS,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:nE,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:nC,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:nR,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:nL,result:{alpha:!0,mode:"rgb",notation:"object"}}];function nN(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"int",n=nI.reduce(function(t,n){var i=n.parser,r=n.result;return t||(i(e)?r:null)},null);return n?"hex"===n.notation&&"float"!==t?Object.assign(Object.assign({},n),{type:"int"}):"func"===n.notation?Object.assign(Object.assign({},n),{type:t}):null:null}var nO={int:[function(e){var t=nA(e);return t?new nh(t,"rgb","int"):null},function(e){var t=nP(e);return t?new nh(t,"rgb","int"):null},nw("int"),nM("int"),nT("int"),nk("int"),nU("int"),nD("int")],float:[nw("float"),nM("float"),nT("float"),nk("float"),nU("float"),nD("float")]};function nF(e){var t=nO[e];return function(e){return t.reduce(function(t,n){return t||n(e)},null)}}function nB(e){var t=tH(Math.floor(e),0,255).toString(16);return 1===t.length?"0".concat(t):t}function nV(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#",n=na(e.getComponents("rgb")).map(nB).join("");return"".concat(t).concat(n)}function nz(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#",n=e.getComponents("rgb"),i=[n[0],n[1],n[2],255*n[3]].map(nB).join("");return"".concat(t).concat(i)}function nG(e,t){var n=tA(2*("float"===t)),i=na(e.getComponents("rgb",t)).map(function(e){return n(e)});return"rgb(".concat(i.join(", "),")")}function nH(e,t){var n=tA(2),i=tA(2*("float"===t)),r=e.getComponents("rgb",t).map(function(e,t){return(3===t?n:i)(e)});return"rgba(".concat(r.join(", "),")")}function nW(e,t){var n=tA(2*("float"===t)),i=["r","g","b"],r=na(e.getComponents("rgb",t)).map(function(e,t){return"".concat(i[t],": ").concat(n(e))});return"{".concat(r.join(", "),"}")}function nj(e,t){var n=tA(2),i=tA(2*("float"===t)),r=["r","g","b","a"],a=e.getComponents("rgb",t).map(function(e,t){return"".concat(r[t],": ").concat((3===t?n:i)(e))});return"{".concat(a.join(", "),"}")}var nX=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:nV},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:nz},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(e){var t=[tA(0),tR,tR],n=na(e.getComponents("hsl")).map(function(e,n){return t[n](e)});return"hsl(".concat(n.join(", "),")")}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(e){var t=[tA(0),tR,tR,tA(2)],n=e.getComponents("hsl").map(function(e,n){return t[n](e)});return"hsla(".concat(n.join(", "),")")}}].concat(ew(["int","float"].reduce(function(e,t){return ew(e).concat([{format:{alpha:!1,mode:"rgb",notation:"func",type:t},stringifier:function(e){return nG(e,t)}},{format:{alpha:!0,mode:"rgb",notation:"func",type:t},stringifier:function(e){return nH(e,t)}},{format:{alpha:!1,mode:"rgb",notation:"object",type:t},stringifier:function(e){return nW(e,t)}},{format:{alpha:!0,mode:"rgb",notation:"object",type:t},stringifier:function(e){return nj(e,t)}}])},[])));function nq(e){return nX.reduce(function(t,n){var i;return t?t:(i=n.format).alpha===e.alpha&&i.mode===e.mode&&i.notation===e.notation&&i.type===e.type?n.stringifier:null},null)}var nY=y("apl"),nK=function(){function t(n,i){e(this,t),this.onValueChange_=this.onValueChange_.bind(this),this.value=i.value,this.value.emitter.on("change",this.onValueChange_),this.element=n.createElement("div"),this.element.classList.add(nY()),i.viewProps.bindClassModifiers(this.element),i.viewProps.bindTabIndex(this.element);var r=n.createElement("div");r.classList.add(nY("b")),this.element.appendChild(r);var a=n.createElement("div");a.classList.add(nY("c")),r.appendChild(a),this.colorElem_=a;var o=n.createElement("div");o.classList.add(nY("m")),this.element.appendChild(o),this.markerElem_=o;var s=n.createElement("div");s.classList.add(nY("p")),this.markerElem_.appendChild(s),this.previewElem_=s,this.update_()}return n(t,[{key:"update_",value:function(){var e=this.value.rawValue,t=e.getComponents("rgb"),n=new nh([t[0],t[1],t[2],0],"rgb"),i=new nh([t[0],t[1],t[2],255],"rgb"),r=["to right",nH(n),nH(i)];this.colorElem_.style.background="linear-gradient(".concat(r.join(","),")"),this.previewElem_.style.backgroundColor=nH(e);var a=tz(t[3],0,1,0,100);this.markerElem_.style.left="".concat(a,"%")}},{key:"onValueChange_",value:function(){this.update_()}}]),t}(),nZ=function(){function t(n,i){e(this,t),this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=i.value,this.viewProps=i.viewProps,this.view=new nK(n,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new tV(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}return n(t,[{key:"handlePointerEvent_",value:function(e,t){if(e.point){var n=e.point.x/e.bounds.width,i=eb(this.value.rawValue.getComponents("hsv"),3),r=i[0],a=i[1],o=i[2];this.value.setRawValue(new nh([r,a,o,n],"hsv"),t)}}},{key:"onPointerDown_",value:function(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}},{key:"onPointerMove_",value:function(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}},{key:"onPointerUp_",value:function(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}},{key:"onKeyDown_",value:function(e){var t=tI(nm(!0),tO(e));if(0!==t){var n=eb(this.value.rawValue.getComponents("hsv"),4),i=n[0],r=n[1],a=n[2],o=n[3];this.value.setRawValue(new nh([i,r,a,o+t],"hsv"),{forceEmit:!1,last:!1})}}},{key:"onKeyUp_",value:function(e){0!==tI(nm(!0),tO(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}]),t}(),nJ=y("coltxt"),nQ=function(){function t(n,i){var r,a=this;e(this,t),this.element=n.createElement("div"),this.element.classList.add(nJ()),i.viewProps.bindClassModifiers(this.element);var o=n.createElement("div");o.classList.add(nJ("m")),this.modeElem_=((r=n.createElement("select")).appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce(function(e,t){var i=n.createElement("option");return i.textContent=t.text,i.value=t.value,e.appendChild(i),e},n.createDocumentFragment())),r),this.modeElem_.classList.add(nJ("ms")),o.appendChild(this.modeSelectElement),i.viewProps.bindDisabled(this.modeElem_);var s=n.createElement("div");s.classList.add(nJ("mm")),s.appendChild(q(n,"dropdown")),o.appendChild(s),this.element.appendChild(o);var l=n.createElement("div");l.classList.add(nJ("w")),this.element.appendChild(l),this.textsElem_=l,this.textViews_=i.textViews,this.applyTextViews_(),b(i.colorMode,function(e){a.modeElem_.value=e})}return n(t,[{key:"modeSelectElement",get:function(){return this.modeElem_}},{key:"textViews",get:function(){return this.textViews_},set:function(e){this.textViews_=e,this.applyTextViews_()}},{key:"applyTextViews_",value:function(){var e=this;Z(this.textsElem_);var t=this.element.ownerDocument;this.textViews_.forEach(function(n){var i=t.createElement("div");i.classList.add(nJ("c")),i.appendChild(n.element),e.textsElem_.appendChild(i)})}}]),t}();function n$(e,t,n){var i;return new tX(e,{arrayPosition:0===n?"fst":2===n?"lst":"mid",baseStep:nm(!1),parser:t.parser,props:R.fromObject({draggingScale:"float"===t.colorType?.01:1,formatter:tA(2*("float"===t.colorType))}),value:P(0,{constraint:(i=t.colorMode,new e6({min:0,max:nl(i,t.colorType)[n]}))}),viewProps:t.viewProps})}var n0=function(){function t(n,i){e(this,t),this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=i.colorType,this.parser_=i.parser,this.value=i.value,this.viewProps=i.viewProps,this.colorMode=P(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(n),this.view=new nQ(n,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}return n(t,[{key:"createComponentControllers_",value:function(e){var t=this,n={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},i=[n$(e,n,0),n$(e,n,1),n$(e,n,2)];return i.forEach(function(e,n){tD({primary:t.value,secondary:e.value,forward:function(e){return e.rawValue.getComponents(t.colorMode.rawValue,t.colorType_)[n]},backward:function(e,i){var r=t.colorMode.rawValue,a=e.rawValue.getComponents(r,t.colorType_);return a[n]=i.rawValue,new nh(no(na(a),a[3]),r,t.colorType_)}})}),i}},{key:"onModeSelectChange_",value:function(e){var t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}]),t}(),n1=y("hpl"),n2=function(){function t(n,i){e(this,t),this.onValueChange_=this.onValueChange_.bind(this),this.value=i.value,this.value.emitter.on("change",this.onValueChange_),this.element=n.createElement("div"),this.element.classList.add(n1()),i.viewProps.bindClassModifiers(this.element),i.viewProps.bindTabIndex(this.element);var r=n.createElement("div");r.classList.add(n1("c")),this.element.appendChild(r);var a=n.createElement("div");a.classList.add(n1("m")),this.element.appendChild(a),this.markerElem_=a,this.update_()}return n(t,[{key:"update_",value:function(){var e=eb(this.value.rawValue.getComponents("hsv"),1)[0];this.markerElem_.style.backgroundColor=nG(new nh([e,100,100],"hsv"));var t=tz(e,0,360,0,100);this.markerElem_.style.left="".concat(t,"%")}},{key:"onValueChange_",value:function(){this.update_()}}]),t}(),n3=function(){function t(n,i){e(this,t),this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=i.value,this.viewProps=i.viewProps,this.view=new n2(n,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new tV(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}return n(t,[{key:"handlePointerEvent_",value:function(e,t){if(e.point){var n=tz(tH(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),i=eb(this.value.rawValue.getComponents("hsv"),4),r=i[1],a=i[2],o=i[3];this.value.setRawValue(new nh([n,r,a,o],"hsv"),t)}}},{key:"onPointerDown_",value:function(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}},{key:"onPointerMove_",value:function(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}},{key:"onPointerUp_",value:function(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}},{key:"onKeyDown_",value:function(e){var t=tI(nm(!1),tO(e));if(0!==t){var n=eb(this.value.rawValue.getComponents("hsv"),4),i=n[0],r=n[1],a=n[2],o=n[3];this.value.setRawValue(new nh([i+t,r,a,o],"hsv"),{forceEmit:!1,last:!1})}}},{key:"onKeyUp_",value:function(e){0!==tI(nm(!1),tO(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}]),t}(),n4=y("svp"),n5=function(){function t(n,i){e(this,t),this.onValueChange_=this.onValueChange_.bind(this),this.value=i.value,this.value.emitter.on("change",this.onValueChange_),this.element=n.createElement("div"),this.element.classList.add(n4()),i.viewProps.bindClassModifiers(this.element),i.viewProps.bindTabIndex(this.element);var r=n.createElement("canvas");r.height=64,r.width=64,r.classList.add(n4("c")),this.element.appendChild(r),this.canvasElement=r;var a=n.createElement("div");a.classList.add(n4("m")),this.element.appendChild(a),this.markerElem_=a,this.update_()}return n(t,[{key:"update_",value:function(){var e,t,n=(t=(e=this.canvasElement).ownerDocument.defaultView)&&"document"in t?e.getContext("2d",{willReadFrequently:!0}):null;if(n){for(var i=this.value.rawValue.getComponents("hsv"),r=this.canvasElement.width,a=this.canvasElement.height,o=n.getImageData(0,0,r,a),s=o.data,l=0;l<a;l++)for(var u=0;u<r;u++){var c=tz(u,0,r,0,100),h=tz(l,0,a,100,0),d=nr(i[0],c,h),p=(l*r+u)*4;s[p]=d[0],s[p+1]=d[1],s[p+2]=d[2],s[p+3]=255}n.putImageData(o,0,0);var f=tz(i[1],0,100,0,100);this.markerElem_.style.left="".concat(f,"%");var v=tz(i[2],0,100,100,0);this.markerElem_.style.top="".concat(v,"%")}}},{key:"onValueChange_",value:function(){this.update_()}}]),t}(),n6=function(){function t(n,i){e(this,t),this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=i.value,this.viewProps=i.viewProps,this.view=new n5(n,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new tV(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}return n(t,[{key:"handlePointerEvent_",value:function(e,t){if(e.point){var n=tz(e.point.x,0,e.bounds.width,0,100),i=tz(e.point.y,0,e.bounds.height,100,0),r=eb(this.value.rawValue.getComponents("hsv"),4),a=r[0],o=r[3];this.value.setRawValue(new nh([a,n,i,o],"hsv"),t)}}},{key:"onPointerDown_",value:function(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}},{key:"onPointerMove_",value:function(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}},{key:"onPointerUp_",value:function(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}},{key:"onKeyDown_",value:function(e){tF(e.key)&&e.preventDefault();var t=eb(this.value.rawValue.getComponents("hsv"),4),n=t[0],i=t[1],r=t[2],a=t[3],o=nm(!1),s=tI(o,tO(e)),l=tI(o,tN(e));(0!==s||0!==l)&&this.value.setRawValue(new nh([n,i+s,r+l,a],"hsv"),{forceEmit:!1,last:!1})}},{key:"onKeyUp_",value:function(e){var t=nm(!1),n=tI(t,tO(e)),i=tI(t,tN(e));(0!==n||0!==i)&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}]),t}(),n8=function(){function t(n,i){e(this,t),this.value=i.value,this.viewProps=i.viewProps,this.hPaletteC_=new n3(n,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new n6(n,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=i.supportsAlpha?{palette:new nZ(n,{value:this.value,viewProps:this.viewProps}),text:new tX(n,{parser:tT,baseStep:.1,props:R.fromObject({draggingScale:.01,formatter:tA(2)}),value:P(0,{constraint:new e6({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&tD({primary:this.value,secondary:this.alphaIcs_.text.value,forward:function(e){return e.rawValue.getComponents()[3]},backward:function(e,t){var n=e.rawValue.getComponents();return n[3]=t.rawValue,new nh(n,e.rawValue.mode)}}),this.textC_=new n0(n,{colorType:i.colorType,parser:tT,value:this.value,viewProps:this.viewProps}),this.view=new np(n,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:i.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}return n(t,[{key:"textController",get:function(){return this.textC_}}]),t}(),n9=y("colsw"),n7=function(){function t(n,i){e(this,t),this.onValueChange_=this.onValueChange_.bind(this),i.value.emitter.on("change",this.onValueChange_),this.value=i.value,this.element=n.createElement("div"),this.element.classList.add(n9()),i.viewProps.bindClassModifiers(this.element);var r=n.createElement("div");r.classList.add(n9("sw")),this.element.appendChild(r),this.swatchElem_=r;var a=n.createElement("button");a.classList.add(n9("b")),i.viewProps.bindDisabled(a),this.element.appendChild(a),this.buttonElement=a,this.update_()}return n(t,[{key:"update_",value:function(){var e=this.value.rawValue;this.swatchElem_.style.backgroundColor=nz(e)}},{key:"onValueChange_",value:function(){this.update_()}}]),t}(),ie=function t(n,i){e(this,t),this.value=i.value,this.viewProps=i.viewProps,this.view=new n7(n,{value:this.value,viewProps:this.viewProps})},it=function(){function t(n,i){var r=this;e(this,t),this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=i.value,this.viewProps=i.viewProps,this.foldable_=er.create(i.expanded),this.swatchC_=new ie(n,{value:this.value,viewProps:this.viewProps});var a=this.swatchC_.view.buttonElement;a.addEventListener("blur",this.onButtonBlur_),a.addEventListener("click",this.onButtonClick_),this.textC_=new tl(n,{parser:i.parser,props:R.fromObject({formatter:i.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new ni(n,{foldable:this.foldable_,pickerLayout:i.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===i.pickerLayout?new ta(n,{viewProps:this.viewProps}):null;var o=new n8(n,{colorType:i.colorType,supportsAlpha:i.supportsAlpha,value:this.value,viewProps:this.viewProps});o.view.allFocusableElements.forEach(function(e){e.addEventListener("blur",r.onPopupChildBlur_),e.addEventListener("keydown",r.onPopupChildKeydown_)}),this.pickerC_=o,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(o.view.element),tD({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:function(e){return e.rawValue},backward:function(e,t){return t.rawValue}})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),eo(this.foldable_,this.view.pickerElement))}return n(t,[{key:"textController",get:function(){return this.textC_}},{key:"onButtonBlur_",value:function(e){if(this.popC_){var t=this.view.element,n=e.relatedTarget;n&&t.contains(n)||(this.popC_.shows.rawValue=!1)}}},{key:"onButtonClick_",value:function(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}},{key:"onPopupChildBlur_",value:function(e){if(this.popC_){var t=this.popC_.view.element,n=J(e);!(n&&t.contains(n))&&(!n||n!==this.swatchC_.view.buttonElement||j(t.ownerDocument))&&(this.popC_.shows.rawValue=!1)}}},{key:"onPopupChildKeydown_",value:function(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.swatchC_.view.buttonElement.focus()}}]),t}();function ii(e){return na(e.getComponents("rgb")).reduce(function(e,t){return e<<8|255&Math.floor(t)},0)}function ir(e){return e.getComponents("rgb").reduce(function(e,t,n){return e<<8|255&Math.floor(3===n?255*t:t)},0)>>>0}function ia(e){return"number"!=typeof e?nh.black():new nh([e>>16&255,e>>8&255,255&e],"rgb")}function io(e){return"number"!=typeof e?nh.black():new nh([e>>24&255,e>>16&255,e>>8&255,tz(255&e,0,255,0,1)],"rgb")}function is(e){var t;return null!=e&&!!e.alpha||null!==(t=null==e?void 0:e.color)&&void 0!==t&&!!t.alpha}var il={id:"input-color-number",type:"input",accept:function(e,t){if("number"!=typeof e||!("color"in t||"view"in t&&"color"===t.view))return null;var n=nv(t);return n?{initialValue:e,params:n}:null},binding:{reader:function(e){return is(e.params)?io:ia},equals:nh.equals,writer:function(e){var t;return t=is(e.params)?ir:ii,function(e,n){t$(e,t(n))}}},controller:function(e){var t=is(e.params),n="expanded"in e.params?e.params.expanded:void 0,i="picker"in e.params?e.params.picker:void 0;return new it(e.document,{colorType:"int",expanded:null!=n&&n,formatter:t?function(e){return nz(e,"0x")}:function(e){return nV(e,"0x")},parser:nF("int"),pickerLayout:null!=i?i:"popup",supportsAlpha:t,value:e.value,viewProps:e.viewProps})}},iu={id:"input-color-object",type:"input",accept:function(e,t){if(!nh.isColorObject(e))return null;var n=nv(t);return n?{initialValue:e,params:n}:null},binding:{reader:function(e){var t;return t=ng(e.params),function(e){return nh.isColorObject(e)?nh.fromObject(e,t):nh.black(t)}},equals:nh.equals,writer:function(e){var t,n,i;return t=e.initialValue,n=nh.isRgbaColorObject(t),i=ng(e.params),function(e,t){var r,a;n?(r=t.toRgbaObject(i),e.writeProperty("r",r.r),e.writeProperty("g",r.g),e.writeProperty("b",r.b),e.writeProperty("a",r.a)):(a=t.toRgbaObject(i),e.writeProperty("r",a.r),e.writeProperty("g",a.g),e.writeProperty("b",a.b))}}},controller:function(e){var t,n=nh.isRgbaColorObject(e.initialValue),i="expanded"in e.params?e.params.expanded:void 0,r="picker"in e.params?e.params.picker:void 0,a=null!==(t=ng(e.params))&&void 0!==t?t:"int";return new it(e.document,{colorType:a,expanded:null!=i&&i,formatter:function(e){return n?nj(e,a):nW(e,a)},parser:nF(a),pickerLayout:null!=r?r:"popup",supportsAlpha:n,value:e.value,viewProps:e.viewProps})}},ic={id:"input-color-string",type:"input",accept:function(e,t){if("string"!=typeof e||"view"in t&&"text"===t.view)return null;var n=nN(e,ng(t));if(!n||!nq(n))return null;var i=nv(t);return i?{initialValue:e,params:i}:null},binding:{reader:function(e){var t,n,i;return i=nO[n=null!==(t=ng(e.params))&&void 0!==t?t:"int"],function(e){if("string"!=typeof e)return nh.black(n);var t=i.reduce(function(t,n){return t||n(e)},null);return null!=t?t:nh.black(n)}},equals:nh.equals,writer:function(e){var t,n=nN(e.initialValue,ng(e.params));if(!n)throw v.shouldNeverHappen();var i=(t=nq(n))?function(e,n){t$(e,t(n))}:null;if(!i)throw v.notBindable();return i}},controller:function(e){var t=nN(e.initialValue,ng(e.params));if(!t)throw v.shouldNeverHappen();var n=nq(t);if(!n)throw v.shouldNeverHappen();var i="expanded"in e.params?e.params.expanded:void 0,r="picker"in e.params?e.params.picker:void 0;return new it(e.document,{colorType:t.type,expanded:null!=i&&i,formatter:n,parser:nF(t.type),pickerLayout:null!=r?r:"popup",supportsAlpha:t.alpha,value:e.value,viewProps:e.viewProps})}},ih=function(){function t(n){e(this,t),this.components=n.components,this.asm_=n.assembly}return n(t,[{key:"constrain",value:function(e){var t=this,n=this.asm_.toComponents(e).map(function(e,n){var i,r;return null!==(r=null===(i=t.components[n])||void 0===i?void 0:i.constrain(e))&&void 0!==r?r:e});return this.asm_.fromComponents(n)}}]),t}(),id=y("pndtxt"),ip=function t(n,i){var r=this;e(this,t),this.textViews=i.textViews,this.element=n.createElement("div"),this.element.classList.add(id()),this.textViews.forEach(function(e){var t=n.createElement("div");t.classList.add(id("a")),t.appendChild(e.element),r.element.appendChild(t)})},iv=function t(n,i){var r=this;e(this,t),this.value=i.value,this.viewProps=i.viewProps,this.acs_=i.axes.map(function(e,t){return new tX(n,{arrayPosition:0===t?"fst":t===i.axes.length-1?"lst":"mid",baseStep:i.axes[t].baseStep,parser:i.parser,props:i.axes[t].textProps,value:P(0,{constraint:i.axes[t].constraint}),viewProps:i.viewProps})}),this.acs_.forEach(function(e,t){tD({primary:r.value,secondary:e.value,forward:function(e){return i.assembly.toComponents(e.rawValue)[t]},backward:function(e,n){var r=i.assembly.toComponents(e.rawValue);return r[t]=n.rawValue,i.assembly.fromComponents(r)}})}),this.view=new ip(n,{textViews:this.acs_.map(function(e){return e.view})})};function im(e,t){return"step"in e&&!h(e.step)?new e7(e.step,t):null}function ig(e){return h(e.max)||h(e.min)?h(e.max)&&h(e.min)?null:new e9({max:e.max,min:e.min}):new e6({max:e.max,min:e.min})}var i_={id:"input-number",type:"input",accept:function(e,t){if("number"!=typeof e)return null;var n=I(t,{format:D.optional.function,max:D.optional.number,min:D.optional.number,options:D.optional.custom(t0),step:D.optional.number});return n?{initialValue:e,params:n}:null},binding:{reader:function(e){return tC},constraint:function(e){var t,n,i,r,a,o;return t=e.params,n=e.initialValue,i=[],(r=im(t,n))&&i.push(r),(a=ig(t))&&i.push(a),(o=t4(t.options))&&i.push(o),new e4(i)},writer:function(e){return t$}},controller:function(e){var t,n=e.value,i=e.constraint,r=i&&e5(i,e8);if(r)return new tn(e.document,{props:new R({options:r.values.value("options")}),value:n,viewProps:e.viewProps});var a=null!==(t="format"in e.params?e.params.format:void 0)&&void 0!==t?t:tA(t5(i,n.rawValue)),o=i&&e5(i,e6);return o?new tQ(e.document,{baseStep:t6(i),parser:tT,sliderProps:new R({maxValue:o.values.value("max"),minValue:o.values.value("min")}),textProps:R.fromObject({draggingScale:t8(i,n.rawValue),formatter:a}),value:n,viewProps:e.viewProps}):new tX(e.document,{baseStep:t6(i),parser:tT,props:R.fromObject({draggingScale:t8(i,n.rawValue),formatter:a}),value:n,viewProps:e.viewProps})}},iy=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.x=n,this.y=i}return n(t,[{key:"getComponents",value:function(){return[this.x,this.y]}},{key:"toObject",value:function(){return{x:this.x,y:this.y}}}],[{key:"isObject",value:function(e){if(h(e))return!1;var t=e.x,n=e.y;return"number"==typeof t&&"number"==typeof n}},{key:"equals",value:function(e,t){return e.x===t.x&&e.y===t.y}}]),t}(),ix={toComponents:function(e){return e.getComponents()},fromComponents:function(e){return eS(iy,ew(e))}},ib=y("p2d"),iw=function t(n,i){e(this,t),this.element=n.createElement("div"),this.element.classList.add(ib()),i.viewProps.bindClassModifiers(this.element),b(i.expanded,S(this.element,ib(void 0,"expanded")));var r=n.createElement("div");r.classList.add(ib("h")),this.element.appendChild(r);var a=n.createElement("button");a.classList.add(ib("b")),a.appendChild(q(n,"p2dpad")),i.viewProps.bindDisabled(a),r.appendChild(a),this.buttonElement=a;var o=n.createElement("div");if(o.classList.add(ib("t")),r.appendChild(o),this.textElement=o,"inline"===i.pickerLayout){var s=n.createElement("div");s.classList.add(ib("p")),this.element.appendChild(s),this.pickerElement=s}else this.pickerElement=null},iS=y("p2dp"),iM=function(){function t(n,i){e(this,t),this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=i.invertsY,this.maxValue_=i.maxValue,this.element=n.createElement("div"),this.element.classList.add(iS()),"popup"===i.layout&&this.element.classList.add(iS(void 0,"p")),i.viewProps.bindClassModifiers(this.element);var r=n.createElement("div");r.classList.add(iS("p")),i.viewProps.bindTabIndex(r),this.element.appendChild(r),this.padElement=r;var a=n.createElementNS(H,"svg");a.classList.add(iS("g")),this.padElement.appendChild(a),this.svgElem_=a;var o=n.createElementNS(H,"line");o.classList.add(iS("ax")),o.setAttributeNS(null,"x1","0"),o.setAttributeNS(null,"y1","50%"),o.setAttributeNS(null,"x2","100%"),o.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(o);var s=n.createElementNS(H,"line");s.classList.add(iS("ax")),s.setAttributeNS(null,"x1","50%"),s.setAttributeNS(null,"y1","0"),s.setAttributeNS(null,"x2","50%"),s.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(s);var l=n.createElementNS(H,"line");l.classList.add(iS("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;var u=n.createElement("div");u.classList.add(iS("m")),this.padElement.appendChild(u),this.markerElem_=u,i.value.emitter.on("change",this.onValueChange_),this.value=i.value,this.update_()}return n(t,[{key:"allFocusableElements",get:function(){return[this.padElement]}},{key:"update_",value:function(){var e=eb(this.value.rawValue.getComponents(),2),t=e[0],n=e[1],i=this.maxValue_,r=tz(t,-i,+i,0,100),a=tz(n,-i,+i,0,100),o=this.invertsY_?100-a:a;this.lineElem_.setAttributeNS(null,"x2","".concat(r,"%")),this.lineElem_.setAttributeNS(null,"y2","".concat(o,"%")),this.markerElem_.style.left="".concat(r,"%"),this.markerElem_.style.top="".concat(o,"%")}},{key:"onValueChange_",value:function(){this.update_()}},{key:"onFoldableChange_",value:function(){this.update_()}}]),t}();function iE(e,t,n){return[tI(t[0],tO(e)),tI(t[1],tN(e))*(n?1:-1)]}var iT=function(){function t(n,i){e(this,t),this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=i.value,this.viewProps=i.viewProps,this.baseSteps_=i.baseSteps,this.maxValue_=i.maxValue,this.invertsY_=i.invertsY,this.view=new iM(n,{invertsY:this.invertsY_,layout:i.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new tV(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}return n(t,[{key:"handlePointerEvent_",value:function(e,t){if(e.point){var n=this.maxValue_,i=tz(e.point.x,0,e.bounds.width,-n,+n),r=tz(this.invertsY_?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-n,+n);this.value.setRawValue(new iy(i,r),t)}}},{key:"onPointerDown_",value:function(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}},{key:"onPointerMove_",value:function(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}},{key:"onPointerUp_",value:function(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}},{key:"onPadKeyDown_",value:function(e){tF(e.key)&&e.preventDefault();var t=eb(iE(e,this.baseSteps_,this.invertsY_),2),n=t[0],i=t[1];(0!==n||0!==i)&&this.value.setRawValue(new iy(this.value.rawValue.x+n,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}},{key:"onPadKeyUp_",value:function(e){var t=eb(iE(e,this.baseSteps_,this.invertsY_),2),n=t[0],i=t[1];(0!==n||0!==i)&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}]),t}(),iC=function(){function t(n,i){var r,a,o=this;e(this,t),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=i.value,this.viewProps=i.viewProps,this.foldable_=er.create(i.expanded),this.popC_="popup"===i.pickerLayout?new ta(n,{viewProps:this.viewProps}):null;var s=new iT(n,{baseSteps:[i.axes[0].baseStep,i.axes[1].baseStep],invertsY:i.invertsY,layout:i.pickerLayout,maxValue:i.maxValue,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(function(e){e.addEventListener("blur",o.onPopupChildBlur_),e.addEventListener("keydown",o.onPopupChildKeydown_)}),this.pickerC_=s,this.textC_=new iv(n,{assembly:ix,axes:i.axes,parser:i.parser,value:this.value,viewProps:this.viewProps}),this.view=new iw(n,{expanded:this.foldable_.value("expanded"),pickerLayout:i.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(r=this.view.buttonElement)||void 0===r||r.addEventListener("blur",this.onPadButtonBlur_),null===(a=this.view.buttonElement)||void 0===a||a.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),tD({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:function(e){return e.rawValue},backward:function(e,t){return t.rawValue}})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),eo(this.foldable_,this.view.pickerElement))}return n(t,[{key:"onPadButtonBlur_",value:function(e){if(this.popC_){var t=this.view.element,n=e.relatedTarget;n&&t.contains(n)||(this.popC_.shows.rawValue=!1)}}},{key:"onPadButtonClick_",value:function(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}},{key:"onPopupChildBlur_",value:function(e){if(this.popC_){var t=this.popC_.view.element,n=J(e);!(n&&t.contains(n))&&(!n||n!==this.view.buttonElement||j(t.ownerDocument))&&(this.popC_.shows.rawValue=!1)}}},{key:"onPopupChildKeydown_",value:function(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.view.buttonElement.focus()}}]),t}(),ik=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e(this,t),this.x=n,this.y=i,this.z=r}return n(t,[{key:"getComponents",value:function(){return[this.x,this.y,this.z]}},{key:"toObject",value:function(){return{x:this.x,y:this.y,z:this.z}}}],[{key:"isObject",value:function(e){if(h(e))return!1;var t=e.x,n=e.y,i=e.z;return"number"==typeof t&&"number"==typeof n&&"number"==typeof i}},{key:"equals",value:function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}}]),t}(),iA={toComponents:function(e){return e.getComponents()},fromComponents:function(e){return eS(ik,ew(e))}};function iP(e){return ik.isObject(e)?new ik(e.x,e.y,e.z):new ik}function iR(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z)}function iU(e,t){return{baseStep:t6(t),constraint:t,textProps:R.fromObject({draggingScale:t8(t,e),formatter:tA(t5(t,e))})}}var iL={id:"input-point3d",type:"input",accept:function(e,t){if(!ik.isObject(e))return null;var n=I(t,{x:D.optional.custom(t2),y:D.optional.custom(t2),z:D.optional.custom(t2)});return n?{initialValue:e,params:n}:null},binding:{reader:function(e){return iP},constraint:function(e){var t,n;return t=e.params,n=e.initialValue,new ih({assembly:iA,components:[i4("x"in t?t.x:void 0,n.x),i4("y"in t?t.y:void 0,n.y),i4("z"in t?t.z:void 0,n.z)]})},equals:ik.equals,writer:function(e){return iR}},controller:function(e){var t=e.value,n=e.constraint;if(!(n instanceof ih))throw v.shouldNeverHappen();return new iv(e.document,{assembly:iA,axes:[iU(t.rawValue.x,n.components[0]),iU(t.rawValue.y,n.components[1]),iU(t.rawValue.z,n.components[2])],parser:tT,value:t,viewProps:e.viewProps})}},iD=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e(this,t),this.x=n,this.y=i,this.z=r,this.w=a}return n(t,[{key:"getComponents",value:function(){return[this.x,this.y,this.z,this.w]}},{key:"toObject",value:function(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}],[{key:"isObject",value:function(e){if(h(e))return!1;var t=e.x,n=e.y,i=e.z,r=e.w;return"number"==typeof t&&"number"==typeof n&&"number"==typeof i&&"number"==typeof r}},{key:"equals",value:function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}}]),t}(),iI={toComponents:function(e){return e.getComponents()},fromComponents:function(e){return eS(iD,ew(e))}};function iN(e){return iD.isObject(e)?new iD(e.x,e.y,e.z,e.w):new iD}function iO(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z),e.writeProperty("w",t.w)}var iF={id:"input-point4d",type:"input",accept:function(e,t){if(!iD.isObject(e))return null;var n=I(t,{x:D.optional.custom(t2),y:D.optional.custom(t2),z:D.optional.custom(t2),w:D.optional.custom(t2)});return n?{initialValue:e,params:n}:null},binding:{reader:function(e){return iN},constraint:function(e){var t,n;return t=e.params,n=e.initialValue,new ih({assembly:iI,components:[i4("x"in t?t.x:void 0,n.x),i4("y"in t?t.y:void 0,n.y),i4("z"in t?t.z:void 0,n.z),i4("w"in t?t.w:void 0,n.w)]})},equals:iD.equals,writer:function(e){return iO}},controller:function(e){var t=e.value,n=e.constraint;if(!(n instanceof ih))throw v.shouldNeverHappen();return new iv(e.document,{assembly:iI,axes:t.rawValue.getComponents().map(function(e,t){var i;return{baseStep:t6(i=n.components[t]),constraint:i,textProps:R.fromObject({draggingScale:t8(i,e),formatter:tA(t5(i,e))})}}),parser:tT,value:t,viewProps:e.viewProps})}},iB={id:"input-string",type:"input",accept:function(e,t){if("string"!=typeof e)return null;var n=I(t,{options:D.optional.custom(t0)});return n?{initialValue:e,params:n}:null},binding:{reader:function(e){return tU},constraint:function(e){var t,n,i;return t=e.params,n=[],(i=t4(t.options))&&n.push(i),new e4(n)},writer:function(e){return t$}},controller:function(e){var t=e.document,n=e.value,i=e.constraint,r=i&&e5(i,e8);return r?new tn(t,{props:new R({options:r.values.value("options")}),value:n,viewProps:e.viewProps}):new tl(t,{parser:function(e){return e},props:R.fromObject({formatter:tL}),value:n,viewProps:e.viewProps})}},iV={monitor:{defaultInterval:200,defaultLineCount:3}},iz=y("mll"),iG=function(){function t(n,i){e(this,t),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=i.formatter,this.element=n.createElement("div"),this.element.classList.add(iz()),i.viewProps.bindClassModifiers(this.element);var r=n.createElement("textarea");r.classList.add(iz("i")),r.style.height="calc(var(--bld-us) * ".concat(i.lineCount,")"),r.readOnly=!0,i.viewProps.bindDisabled(r),this.element.appendChild(r),this.textareaElem_=r,i.value.emitter.on("change",this.onValueUpdate_),this.value=i.value,this.update_()}return n(t,[{key:"update_",value:function(){var e=this,t=this.textareaElem_,n=t.scrollTop===t.scrollHeight-t.clientHeight,i=[];this.value.rawValue.forEach(function(t){void 0!==t&&i.push(e.formatter_(t))}),t.textContent=i.join("\n"),n&&(t.scrollTop=t.scrollHeight)}},{key:"onValueUpdate_",value:function(){this.update_()}}]),t}(),iH=function t(n,i){e(this,t),this.value=i.value,this.viewProps=i.viewProps,this.view=new iG(n,{formatter:i.formatter,lineCount:i.lineCount,value:this.value,viewProps:this.viewProps})},iW=y("sgl"),ij=function(){function t(n,i){e(this,t),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=i.formatter,this.element=n.createElement("div"),this.element.classList.add(iW()),i.viewProps.bindClassModifiers(this.element);var r=n.createElement("input");r.classList.add(iW("i")),r.readOnly=!0,r.type="text",i.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,i.value.emitter.on("change",this.onValueUpdate_),this.value=i.value,this.update_()}return n(t,[{key:"update_",value:function(){var e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=void 0!==t?this.formatter_(t):""}},{key:"onValueUpdate_",value:function(){this.update_()}}]),t}(),iX=function t(n,i){e(this,t),this.value=i.value,this.viewProps=i.viewProps,this.view=new ij(n,{formatter:i.formatter,value:this.value,viewProps:this.viewProps})},iq={id:"monitor-bool",type:"monitor",accept:function(e,t){if("boolean"!=typeof e)return null;var n=I(t,{lineCount:D.optional.number});return n?{initialValue:e,params:n}:null},binding:{reader:function(e){return tu}},controller:function(e){var t;return 1===e.value.rawValue.length?new iX(e.document,{formatter:tc,value:e.value,viewProps:e.viewProps}):new iH(e.document,{formatter:tc,lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:iV.monitor.defaultLineCount,value:e.value,viewProps:e.viewProps})}},iY=y("grl"),iK=function(){function t(n,i){e(this,t),this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=n.createElement("div"),this.element.classList.add(iY()),i.viewProps.bindClassModifiers(this.element),this.formatter_=i.formatter,this.props_=i.props,this.cursor_=i.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);var r=n.createElementNS(H,"svg");r.classList.add(iY("g")),r.style.height="calc(var(--bld-us) * ".concat(i.lineCount,")"),this.element.appendChild(r),this.svgElem_=r;var a=n.createElementNS(H,"polyline");this.svgElem_.appendChild(a),this.lineElem_=a;var o=n.createElement("div");o.classList.add(iY("t"),y("tt")()),this.element.appendChild(o),this.tooltipElem_=o,i.value.emitter.on("change",this.onValueUpdate_),this.value=i.value,this.update_()}return n(t,[{key:"graphElement",get:function(){return this.svgElem_}},{key:"update_",value:function(){var e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,n=this.props_.get("minValue"),i=this.props_.get("maxValue"),r=[];this.value.rawValue.forEach(function(a,o){if(void 0!==a){var s=tz(o,0,t,0,e.width),l=tz(a,n,i,e.height,0);r.push([s,l].join(","))}}),this.lineElem_.setAttributeNS(null,"points",r.join(" "));var a=this.tooltipElem_,o=this.value.rawValue[this.cursor_.rawValue];if(void 0===o){a.classList.remove(iY("t","a"));return}var s=tz(this.cursor_.rawValue,0,t,0,e.width),l=tz(o,n,i,e.height,0);a.style.left="".concat(s,"px"),a.style.top="".concat(l,"px"),a.textContent="".concat(this.formatter_(o)),a.classList.contains(iY("t","a"))||(a.classList.add(iY("t","a"),iY("t","in")),W(a),a.classList.remove(iY("t","in")))}},{key:"onValueUpdate_",value:function(){this.update_()}},{key:"onCursorChange_",value:function(){this.update_()}}]),t}(),iZ=function(){function t(n,i){if(e(this,t),this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=i.props,this.value=i.value,this.viewProps=i.viewProps,this.cursor_=P(-1),this.view=new iK(n,{cursor:this.cursor_,formatter:i.formatter,lineCount:i.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),j(n)){var r=new tV(this.view.element);r.emitter.on("down",this.onGraphPointerDown_),r.emitter.on("move",this.onGraphPointerMove_),r.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}return n(t,[{key:"onGraphMouseLeave_",value:function(){this.cursor_.rawValue=-1}},{key:"onGraphMouseMove_",value:function(e){var t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(tz(e.offsetX,0,t.width,0,this.value.rawValue.length))}},{key:"onGraphPointerDown_",value:function(e){this.onGraphPointerMove_(e)}},{key:"onGraphPointerMove_",value:function(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(tz(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}},{key:"onGraphPointerUp_",value:function(){this.cursor_.rawValue=-1}}]),t}();function iJ(e){return"format"in e&&!h(e.format)?e.format:tA(2)}function iQ(e){return"view"in e&&"graph"===e.view}var i$={id:"monitor-number",type:"monitor",accept:function(e,t){if("number"!=typeof e)return null;var n=I(t,{format:D.optional.function,lineCount:D.optional.number,max:D.optional.number,min:D.optional.number,view:D.optional.string});return n?{initialValue:e,params:n}:null},binding:{defaultBufferSize:function(e){return iQ(e)?64:1},reader:function(e){return tC}},controller:function(e){var t,n,i,r;return iQ(e.params)?new iZ(e.document,{formatter:iJ(e.params),lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:iV.monitor.defaultLineCount,props:R.fromObject({maxValue:null!==(n="max"in e.params?e.params.max:null)&&void 0!==n?n:100,minValue:null!==(i="min"in e.params?e.params.min:null)&&void 0!==i?i:0}),value:e.value,viewProps:e.viewProps}):1===e.value.rawValue.length?new iX(e.document,{formatter:iJ(e.params),value:e.value,viewProps:e.viewProps}):new iH(e.document,{formatter:iJ(e.params),lineCount:null!==(r=e.params.lineCount)&&void 0!==r?r:iV.monitor.defaultLineCount,value:e.value,viewProps:e.viewProps})}},i0={id:"monitor-string",type:"monitor",accept:function(e,t){if("string"!=typeof e)return null;var n=I(t,{lineCount:D.optional.number,multiline:D.optional.boolean});return n?{initialValue:e,params:n}:null},binding:{reader:function(e){return tU}},controller:function(e){var t,n=e.value;return n.rawValue.length>1||"multiline"in e.params&&e.params.multiline?new iH(e.document,{formatter:tL,lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:iV.monitor.defaultLineCount,value:n,viewProps:e.viewProps}):new iX(e.document,{formatter:tL,value:n,viewProps:e.viewProps})}},i1=function(){function t(){e(this,t),this.pluginsMap_={blades:[],inputs:[],monitors:[]}}return n(t,[{key:"getAll",value:function(){return ew(this.pluginsMap_.blades).concat(ew(this.pluginsMap_.inputs),ew(this.pluginsMap_.monitors))}},{key:"register",value:function(e){"blade"===e.type?this.pluginsMap_.blades.unshift(e):"input"===e.type?this.pluginsMap_.inputs.unshift(e):"monitor"===e.type&&this.pluginsMap_.monitors.unshift(e)}},{key:"createInput",value:function(e,t,n){if(h(t.read()))throw new v({context:{key:t.key},type:"nomatchingcontroller"});var i=this.pluginsMap_.inputs.reduce(function(i,r){return null!=i?i:function(e,t){var n,i=e.accept(t.target.read(),t.params);if(h(i))return null;var r={target:t.target,initialValue:i.initialValue,params:i.params},a=e.binding.reader(r),o=e.binding.constraint?e.binding.constraint(r):void 0,s=P(a(i.initialValue),{constraint:o,equals:e.binding.equals}),l=new e1({reader:a,target:t.target,value:s,writer:e.binding.writer(r)}),u=D.optional.boolean(t.params.disabled).value,c=D.optional.boolean(t.params.hidden).value,d=e.controller({constraint:o,document:t.document,initialValue:i.initialValue,params:i.params,value:l.value,viewProps:B.create({disabled:u,hidden:c})});return new eh(t.document,{binding:l,blade:ei(),props:R.fromObject({label:"label"in t.params?null!==(n=D.optional.string(t.params.label).value)&&void 0!==n?n:null:t.target.key}),valueController:d})}(r,{document:e,target:t,params:n})},null);if(i)return i;throw new v({context:{key:t.key},type:"nomatchingcontroller"})}},{key:"createMonitor",value:function(e,t,n){var i=this.pluginsMap_.monitors.reduce(function(i,r){return null!=i?i:function(e,t){var n,i,r,a,o,s=e.accept(t.target.read(),t.params);if(h(s))return null;var l={target:t.target,initialValue:s.initialValue,params:s.params},u=e.binding.reader(l),c=null!==(i=null!==(n=D.optional.number(t.params.bufferSize).value)&&void 0!==n?n:e.binding.defaultBufferSize&&e.binding.defaultBufferSize(s.params))&&void 0!==i?i:1,d=D.optional.number(t.params.interval).value,p=new e3({reader:u,target:t.target,ticker:(a=t.document,0===d?new e$:new e0(a,null!=d?d:iV.monitor.defaultInterval)),value:(e2(o=[],c),P(o))}),f=D.optional.boolean(t.params.disabled).value,v=D.optional.boolean(t.params.hidden).value,m=e.controller({document:t.document,params:s.params,value:p.value,viewProps:B.create({disabled:f,hidden:v})});return new ef(t.document,{binding:p,blade:ei(),props:R.fromObject({label:"label"in t.params?null!==(r=D.optional.string(t.params.label).value)&&void 0!==r?r:null:t.target.key}),valueController:m})}(r,{document:e,params:n,target:t})},null);if(i)return i;throw new v({context:{key:t.key},type:"nomatchingcontroller"})}},{key:"createBlade",value:function(e,t){var n=this.pluginsMap_.blades.reduce(function(n,i){return null!=n?n:function(e,t){var n=e.accept(t.params);if(!n)return null;var i=D.optional.boolean(t.params.disabled).value,r=D.optional.boolean(t.params.hidden).value;return e.controller({blade:ei(),document:t.document,params:Object.assign(Object.assign({},n.params),{disabled:i,hidden:r}),viewProps:B.create({disabled:i,hidden:r})})}(i,{document:e,params:t})},null);if(!n)throw new v({type:"nomatchingview",context:{params:t}});return n}},{key:"createBladeApi",value:function(e){var t=this;if(e instanceof eh)return new ec(e);if(e instanceof ef)return new ed(e);if(e instanceof eR)return new eM(e,this);var n=this.pluginsMap_.blades.reduce(function(n,i){return null!=n?n:i.api({controller:e,pool:t})},null);if(!n)throw v.shouldNeverHappen();return n}}]),t}();function i2(e){return iy.isObject(e)?new iy(e.x,e.y):new iy}function i3(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y)}function i4(e,t){if(e){var n=[],i=im(e,t);i&&n.push(i);var r=ig(e);return r&&n.push(r),new e4(n)}}function i5(e,t){var n=eb(e?function(e){var t=e5(e,e6);if(t)return[t.values.get("min"),t.values.get("max")];var n=e5(e,e9);return n?[n.minValue,n.maxValue]:[void 0,void 0]}(e):[],2),i=n[0],r=n[1];return h(i)&&h(r)?Math.max(10*Math.abs(t6(e)),10*Math.abs(t)):Math.max(Math.abs(null!=i?i:0),Math.abs(null!=r?r:0))}function i6(e,t){return{baseStep:t6(t),constraint:t,textProps:R.fromObject({draggingScale:t8(t,e),formatter:tA(t5(t,e))})}}var i8={id:"input-point2d",type:"input",accept:function(e,t){if(!iy.isObject(e))return null;var n=I(t,{expanded:D.optional.boolean,picker:D.optional.custom(t1),x:D.optional.custom(t2),y:D.optional.object({inverted:D.optional.boolean,max:D.optional.number,min:D.optional.number,step:D.optional.number})});return n?{initialValue:e,params:n}:null},binding:{reader:function(e){return i2},constraint:function(e){var t,n;return t=e.params,n=e.initialValue,new ih({assembly:ix,components:[i4("x"in t?t.x:void 0,n.x),i4("y"in t?t.y:void 0,n.y)]})},equals:iy.equals,writer:function(e){return i3}},controller:function(e){var t,n,i,r=e.document,a=e.value,o=e.constraint;if(!(o instanceof ih))throw v.shouldNeverHappen();var s="expanded"in e.params?e.params.expanded:void 0,l="picker"in e.params?e.params.picker:void 0;return new iC(r,{axes:[i6(a.rawValue.x,o.components[0]),i6(a.rawValue.y,o.components[1])],expanded:null!=s&&s,invertsY:function(e){if(!("y"in e))return!1;var t=e.y;return!!t&&"inverted"in t&&!!t.inverted}(e.params),maxValue:(t=a.rawValue,n=o instanceof ih?o.components[0]:void 0,i=o instanceof ih?o.components[1]:void 0,Math.max(i5(n,t.x),i5(i,t.y))),parser:tT,pickerLayout:null!=l?l:"popup",value:a,viewProps:e.viewProps})}},i9=function(t){function i(t){var n;return e(this,i),(n=ev(this,i,[t])).emitter_=new _,n.controller_.valueController.value.emitter.on("change",function(e){n.emitter_.emit("change",{event:new s(n,e.rawValue)})}),n}return e_(i,t),n(i,[{key:"label",get:function(){return this.controller_.props.get("label")},set:function(e){this.controller_.props.set("label",e)}},{key:"options",get:function(){return this.controller_.valueController.props.get("options")},set:function(e){this.controller_.valueController.props.set("options",e)}},{key:"value",get:function(){return this.controller_.valueController.value.rawValue},set:function(e){this.controller_.valueController.value.rawValue=e}},{key:"on",value:function(e,t){var n=t.bind(this);return this.emitter_.on(e,function(e){n(e.event)}),this}}]),i}(a),i7=function(t){function i(t){var n;return e(this,i),(n=ev(this,i,[t])).emitter_=new _,n.controller_.valueController.value.emitter.on("change",function(e){n.emitter_.emit("change",{event:new s(n,e.rawValue)})}),n}return e_(i,t),n(i,[{key:"label",get:function(){return this.controller_.props.get("label")},set:function(e){this.controller_.props.set("label",e)}},{key:"maxValue",get:function(){return this.controller_.valueController.sliderController.props.get("maxValue")},set:function(e){this.controller_.valueController.sliderController.props.set("maxValue",e)}},{key:"minValue",get:function(){return this.controller_.valueController.sliderController.props.get("minValue")},set:function(e){this.controller_.valueController.sliderController.props.set("minValue",e)}},{key:"value",get:function(){return this.controller_.valueController.value.rawValue},set:function(e){this.controller_.valueController.value.rawValue=e}},{key:"on",value:function(e,t){var n=t.bind(this);return this.emitter_.on(e,function(e){n(e.event)}),this}}]),i}(a),re=function(t){function i(t){var n;return e(this,i),(n=ev(this,i,[t])).emitter_=new _,n.controller_.valueController.value.emitter.on("change",function(e){n.emitter_.emit("change",{event:new s(n,e.rawValue)})}),n}return e_(i,t),n(i,[{key:"label",get:function(){return this.controller_.props.get("label")},set:function(e){this.controller_.props.set("label",e)}},{key:"formatter",get:function(){return this.controller_.valueController.props.get("formatter")},set:function(e){this.controller_.valueController.props.set("formatter",e)}},{key:"value",get:function(){return this.controller_.valueController.value.rawValue},set:function(e){this.controller_.valueController.value.rawValue=e}},{key:"on",value:function(e,t){var n=t.bind(this);return this.emitter_.on(e,function(e){n(e.event)}),this}}]),i}(a),rt={id:"list",type:"blade",accept:function(e){var t=I(e,{options:D.required.custom(t0),value:D.required.raw,view:D.required.constant("list"),label:D.optional.string});return t?{params:t}:null},controller:function(e){var t=new e8(t3(e.params.options)),n=P(e.params.value,{constraint:t}),i=new tn(e.document,{props:new R({options:t.values.value("options")}),value:n,viewProps:e.viewProps});return new eN(e.document,{blade:e.blade,props:R.fromObject({label:e.params.label}),valueController:i})},api:function(e){return e.controller instanceof eN&&e.controller.valueController instanceof tn?new i9(e.controller):null}},rn=function(t){function r(t,n){return e(this,r),ev(this,r,[t,n])}return e_(r,t),n(r,[{key:"element",get:function(){return this.controller_.view.element}},{key:"importPreset",value:function(e){(function(e,t){e.forEach(function(e){var n=t[e.target.presetKey];void 0!==n&&e.writer(e.target,e.reader(n))})})(this.controller_.rackController.rack.find(eh).map(function(e){return e.binding}),e),this.refresh()}},{key:"exportPreset",value:function(){return this.controller_.rackController.rack.find(eh).map(function(e){return e.binding.target}).reduce(function(e,t){return Object.assign(e,i({},t.presetKey,t.read()))},{})}},{key:"refresh",value:function(){this.controller_.rackController.rack.find(eh).forEach(function(e){e.binding.read()}),this.controller_.rackController.rack.find(ef).forEach(function(e){e.binding.read()})}}]),r}(eE),ri=function(t){function n(t,i){return e(this,n),ev(this,n,[t,{expanded:i.expanded,blade:i.blade,props:i.props,root:!0,viewProps:i.viewProps}])}return e_(n,t),n}(eD),rr={id:"slider",type:"blade",accept:function(e){var t=I(e,{max:D.required.number,min:D.required.number,view:D.required.constant("slider"),format:D.optional.function,label:D.optional.string,value:D.optional.number});return t?{params:t}:null},controller:function(e){var t,n,i=null!==(t=e.params.value)&&void 0!==t?t:0,r=new e6({max:e.params.max,min:e.params.min}),a=new tQ(e.document,{baseStep:1,parser:tT,sliderProps:new R({maxValue:r.values.value("max"),minValue:r.values.value("min")}),textProps:R.fromObject({draggingScale:t8(void 0,i),formatter:null!==(n=e.params.format)&&void 0!==n?n:tk}),value:P(i,{constraint:r}),viewProps:e.viewProps});return new eN(e.document,{blade:e.blade,props:R.fromObject({label:e.params.label}),valueController:a})},api:function(e){return e.controller instanceof eN&&e.controller.valueController instanceof tQ?new i7(e.controller):null}},ra={id:"text",type:"blade",accept:function(e){var t=I(e,{parse:D.required.function,value:D.required.raw,view:D.required.constant("text"),format:D.optional.function,label:D.optional.string});return t?{params:t}:null},controller:function(e){var t,n=new tl(e.document,{parser:e.params.parse,props:R.fromObject({formatter:null!==(t=e.params.format)&&void 0!==t?t:function(e){return String(e)}}),value:P(e.params.value),viewProps:e.viewProps});return new eN(e.document,{blade:e.blade,props:R.fromObject({label:e.params.label}),valueController:n})},api:function(e){return e.controller instanceof eN&&e.controller.valueController instanceof tl?new re(e.controller):null}};function ro(e,t,n){if(!e.querySelector("style[data-tp-style=".concat(t,"]"))){var i=e.createElement("style");i.dataset.tpStyle=t,i.textContent=n,e.head.appendChild(i)}}var rs=function(t){function i(t){e(this,i);var n,r,a,o,s,l=null!=t?t:{},u=null!==(o=l.document)&&void 0!==o?o:globalThis.document,c=(n=new i1,[i8,iL,iF,iB,i_,ic,iu,il,nt,iq,i0,i$,et,eI,ez,eQ].forEach(function(e){n.register(e)}),n);return(a=ev(this,i,[new ri(u,{expanded:l.expanded,blade:ei(),props:R.fromObject({title:l.title}),viewProps:B.create()}),c])).pool_=c,a.containerElem_=null!==(s=l.container)&&void 0!==s?s:((r=u.createElement("div")).classList.add(y("dfw")()),u.body&&u.body.appendChild(r),r),a.containerElem_.appendChild(a.element),a.doc_=u,a.usesDefaultWrapper_=!l.container,a.setUpDefaultPlugins_(),a}return e_(i,t),n(i,[{key:"document",get:function(){if(!this.doc_)throw v.alreadyDisposed();return this.doc_}},{key:"dispose",value:function(){var e=this.containerElem_;if(!e)throw v.alreadyDisposed();if(this.usesDefaultWrapper_){var t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,em(ep(i.prototype),"dispose",this).call(this)}},{key:"registerPlugin",value:function(e){var t=this;("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach(function(e){t.pool_.register(e),t.embedPluginStyle_(e)})}},{key:"embedPluginStyle_",value:function(e){e.css&&ro(this.document,"plugin-".concat(e.id),e.css)}},{key:"setUpDefaultPlugins_",value:function(){var e=this;ro(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(function(t){e.embedPluginStyle_(t)}),this.registerPlugin({plugins:[rr,rt,eQ,ra]})}}]),i}(rn),rl=new r("3.1.10");t.BladeApi=a,t.ButtonApi=g,t.FolderApi=eE,t.InputBindingApi=ec,t.ListApi=i9,t.MonitorBindingApi=ed,t.Pane=rs,t.SeparatorApi=eO,t.SliderApi=i7,t.TabApi=eq,t.TabPageApi=eX,t.TextApi=re,t.TpChangeEvent=s,t.VERSION=rl,Object.defineProperty(t,"__esModule",{value:!0})}(sy);var sx={},sb=sx={};function sw(){throw Error("setTimeout has not been defined")}function sS(){throw Error("clearTimeout has not been defined")}function sM(e){if(v===setTimeout)return setTimeout(e,0);if((v===sw||!v)&&setTimeout)return v=setTimeout,setTimeout(e,0);try{return v(e,0)}catch(t){try{return v.call(null,e,0)}catch(t){return v.call(this,e,0)}}}!function(){try{v="function"==typeof setTimeout?setTimeout:sw}catch(e){v=sw}try{m="function"==typeof clearTimeout?clearTimeout:sS}catch(e){m=sS}}();var sE=[],sT=!1,sC=-1;function sk(){sT&&g&&(sT=!1,g.length?sE=g.concat(sE):sC=-1,sE.length&&sA())}function sA(){if(!sT){var e=sM(sk);sT=!0;for(var t=sE.length;t;){for(g=sE,sE=[];++sC<t;)g&&g[sC].run();sC=-1,t=sE.length}g=null,sT=!1,function(e){if(m===clearTimeout)return clearTimeout(e);if((m===sS||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(e);try{m(e)}catch(t){try{return m.call(null,e)}catch(t){return m.call(this,e)}}}(e)}}function sP(e,t){this.fun=e,this.array=t}function sR(){}function sU(){var e=Object.create(null);function t(e,t){var n=void 0;self.troikaDefine=function(e){return n=e};var i=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+t+"\n)"],{type:"application/javascript"}));try{importScripts(i)}catch(e){}return URL.revokeObjectURL(i),delete self.troikaDefine,n}self.addEventListener("message",function(n){var i=n.data,r=i.messageId,a=i.action,o=i.data;try{"registerModule"===a&&function n(i,r){var a=i.id,o=i.name,s=i.dependencies;void 0===s&&(s=[]);var l=i.init;void 0===l&&(l=function(){});var u=i.getTransferables;if(void 0===u&&(u=null),!e[a])try{s=s.map(function(t){return t&&t.isWorkerModule&&(n(t,function(e){if(e instanceof Error)throw e}),t=e[t.id].value),t}),l=t("<"+o+">.init",l),u&&(u=t("<"+o+">.getTransferables",u));var c=null;"function"==typeof l&&(c=l.apply(void 0,s)),e[a]={id:a,value:c,getTransferables:u},r(c)}catch(e){e&&e.noLog,r(e)}}(o,function(e){e instanceof Error?postMessage({messageId:r,success:!1,error:e.message}):postMessage({messageId:r,success:!0,result:{isCallable:"function"==typeof e}})}),"callModule"===a&&function(t,n){var i,r=t.id,a=t.args;e[r]&&"function"==typeof e[r].value||n(Error("Worker module "+r+": not found or its 'init' did not return a function"));try{var o=(i=e[r]).value.apply(i,a);o&&"function"==typeof o.then?o.then(s,function(e){return n(e instanceof Error?e:Error(""+e))}):s(o)}catch(e){n(e)}function s(t){try{var i=e[r].getTransferables&&e[r].getTransferables(t);i&&Array.isArray(i)&&i.length||(i=void 0),n(t,i)}catch(e){n(e)}}}(o,function(e,t){e instanceof Error?postMessage({messageId:r,success:!1,error:e.message}):postMessage({messageId:r,success:!0,result:e},t||void 0)})}catch(e){postMessage({messageId:r,success:!1,error:e.stack})}})}sb.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];sE.push(new sP(e,t)),1!==sE.length||sT||sM(sA)},sP.prototype.run=function(){this.fun.apply(null,this.array)},sb.title="browser",sb.browser=!0,sb.env={},sb.argv=[],sb.version="",sb.versions={},sb.on=sR,sb.addListener=sR,sb.once=sR,sb.off=sR,sb.removeListener=sR,sb.removeAllListeners=sR,sb.emit=sR,sb.prependListener=sR,sb.prependOnceListener=sR,sb.listeners=function(e){return[]},sb.binding=function(e){throw Error("process.binding is not supported")},sb.cwd=function(){return"/"},sb.chdir=function(e){throw Error("process.chdir is not supported")},sb.umask=function(){return 0};var sL=function(){var e=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(e){void 0===sx||eu(sx)}return sL=function(){return e},e},sD=0,sI=0,sN=!1,sO=Object.create(null),sF=Object.create(null),sB=Object.create(null);function sV(e){if((!e||"function"!=typeof e.init)&&!sN)throw Error("requires `options.init` function");var t,n=e.dependencies,i=e.init,r=e.getTransferables,a=e.workerId;if(!sL())return(t=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return t._getInitResult().then(function(t){if("function"==typeof t)return t.apply(void 0,e);throw Error("Worker module function was called but `init` did not return a callable function")})})._getInitResult=function(){var n=e.dependencies,i=e.init,r=Promise.all(n=Array.isArray(n)?n.map(function(e){return e&&e._getInitResult?e._getInitResult():e}):[]).then(function(e){return i.apply(null,e)});return t._getInitResult=function(){return r},r},t;null==a&&(a="#default");var o="workerModule"+ ++sD,s=e.name||o,l=null;function u(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(!l){l=sG(a,"registerModule",u.workerModuleData);var n=function(){l=null,sF[a].delete(n)};(sF[a]||(sF[a]=new Set)).add(n)}return l.then(function(t){if(t.isCallable)return sG(a,"callModule",{id:o,args:e});throw Error("Worker module function was called but `init` did not return a callable function")})}return n=n&&n.map(function(e){return"function"!=typeof e||e.workerModuleData||(sN=!0,e=sV({workerId:a,name:"<"+s+"> function dependency: "+e.name,init:"function(){return (\n"+sz(e)+"\n)}"}),sN=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e}),u.workerModuleData={isWorkerModule:!0,id:o,name:s,dependencies:n,init:sz(i),getTransferables:r&&sz(r)},u}function sz(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function sG(e,t,n){return new Promise(function(i,r){var a=++sI;sB[a]=function(e){e.success?i(e.result):r(Error("Error in worker "+t+" call: "+e.error))},(function(e){var t=sO[e];if(!t){var n=sz(sU);(t=sO[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+n+")()"],{type:"application/javascript"})))).onmessage=function(e){var t=e.data,n=t.messageId,i=sB[n];if(!i)throw Error("WorkerModule response with empty or unknown messageId");delete sB[n],i(t)}}return t})(e).postMessage({messageId:a,action:t,data:n})})}function sH(){return function(e){function t(e,t){for(var n,i,r,a,o,s=/([MLQCZ])([^MLQCZ]*)/g;n=s.exec(e);){var l=n[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(e){return parseFloat(e)});switch(n[1]){case"M":a=i=l[0],o=r=l[1];break;case"L":(l[0]!==a||l[1]!==o)&&t("L",a,o,a=l[0],o=l[1]);break;case"Q":t("Q",a,o,a=l[2],o=l[3],l[0],l[1]);break;case"C":t("C",a,o,a=l[4],o=l[5],l[0],l[1],l[2],l[3]);break;case"Z":(a!==i||o!==r)&&t("L",a,o,i,r)}}}function n(e,n,i){void 0===i&&(i=16);var r={x:0,y:0};t(e,function(e,t,a,o,s,l,u,c,h){switch(e){case"L":n(t,a,o,s);break;case"Q":for(var d=t,p=a,f=1;f<i;f++)!function(e,t,n,i,r,a,o,s){var l=1-o;s.x=l*l*e+2*l*o*n+o*o*r,s.y=l*l*t+2*l*o*i+o*o*a}(t,a,l,u,o,s,f/(i-1),r),n(d,p,r.x,r.y),d=r.x,p=r.y;break;case"C":for(var v=t,m=a,g=1;g<i;g++)!function(e,t,n,i,r,a,o,s,l,u){var c=1-l;u.x=c*c*c*e+3*c*c*l*n+3*c*l*l*r+l*l*l*o,u.y=c*c*c*t+3*c*c*l*i+3*c*l*l*a+l*l*l*s}(t,a,l,u,c,h,o,s,g/(i-1),r),n(v,m,r.x,r.y),v=r.x,m=r.y}})}var i="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",r=new WeakMap,a={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function o(e,t){var n=e.getContext?e.getContext("webgl",a):e,i=r.get(n);if(!i){var o="undefined"!=typeof WebGL2RenderingContext&&n instanceof WebGL2RenderingContext,s={},l={},u={},c=-1,h=[];function d(e){var t=s[e];if(!t&&!(t=s[e]=n.getExtension(e)))throw Error(e+" not supported");return t}function p(e,t){var i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),i}function f(){s={},l={},u={},c=-1,h.length=0}n.canvas.addEventListener("webglcontextlost",function(e){f(),e.preventDefault()},!1),r.set(n,i={gl:n,isWebGL2:o,getExtension:d,withProgram:function(e,t,i,r){if(!l[e]){var a={},s={},u=n.createProgram();n.attachShader(u,p(t,n.VERTEX_SHADER)),n.attachShader(u,p(i,n.FRAGMENT_SHADER)),n.linkProgram(u),l[e]={program:u,transaction:function(e){n.useProgram(u),e({setUniform:function(e,t){for(var i=[],r=arguments.length-2;r-- >0;)i[r]=arguments[r+2];var a=s[t]||(s[t]=n.getUniformLocation(u,t));n["uniform"+e].apply(n,[a].concat(i))},setAttribute:function(e,t,i,r,s){var l=a[e];l||(l=a[e]={buf:n.createBuffer(),loc:n.getAttribLocation(u,e),data:null}),n.bindBuffer(n.ARRAY_BUFFER,l.buf),n.vertexAttribPointer(l.loc,t,n.FLOAT,!1,0,0),n.enableVertexAttribArray(l.loc),o?n.vertexAttribDivisor(l.loc,r):d("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(l.loc,r),s!==l.data&&(n.bufferData(n.ARRAY_BUFFER,s,i),l.data=s)}})}}}l[e].transaction(r)},withTexture:function(e,t){c++;try{n.activeTexture(n.TEXTURE0+c);var i=u[e];i||(i=u[e]=n.createTexture(),n.bindTexture(n.TEXTURE_2D,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.bindTexture(n.TEXTURE_2D,i),t(i,c)}finally{c--}},withTextureFramebuffer:function(e,t,i){var r=n.createFramebuffer();h.push(r),n.bindFramebuffer(n.FRAMEBUFFER,r),n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,e),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);try{i(r)}finally{n.deleteFramebuffer(r),n.bindFramebuffer(n.FRAMEBUFFER,h[--h.length-1]||null)}},handleContextLoss:f})}t(i)}function s(e,t,n,r,a,s,l,u){void 0===l&&(l=15),void 0===u&&(u=null),o(e,function(e){var o=e.gl,c=e.withProgram;(0,e.withTexture)("copy",function(e,h){o.texImage2D(o.TEXTURE_2D,0,o.RGBA,a,s,0,o.RGBA,o.UNSIGNED_BYTE,t),c("copy",i,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",function(e){var t=e.setUniform;(0,e.setAttribute)("aUV",2,o.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),t("1i","image",h),o.bindFramebuffer(o.FRAMEBUFFER,u||null),o.disable(o.BLEND),o.colorMask(8&l,4&l,2&l,1&l),o.viewport(n,r,a,s),o.scissor(n,r,a,s),o.drawArrays(o.TRIANGLES,0,3)})})})}var l=Object.freeze({__proto__:null,withWebGLContext:o,renderImageData:s,resizeWebGLCanvasWithoutClearing:function(e,t,n){var i=e.width,r=e.height;o(e,function(a){var o=a.gl,l=new Uint8Array(i*r*4);o.readPixels(0,0,i,r,o.RGBA,o.UNSIGNED_BYTE,l),e.width=t,e.height=n,s(o,l,0,0,i,r)})}});function u(e,t,i,r,a,o){void 0===o&&(o=1);var s=new Uint8Array(e*t),l=r[2]-r[0],u=r[3]-r[1],c=[];n(i,function(e,t,n,i){c.push({x1:e,y1:t,x2:n,y2:i,minX:Math.min(e,n),minY:Math.min(t,i),maxX:Math.max(e,n),maxY:Math.max(t,i)})}),c.sort(function(e,t){return e.maxX-t.maxX});for(var h=0;h<e;h++)for(var d=0;d<t;d++){var p=function(e,t){for(var n=1/0,i=1/0,r=c.length;r--;){var a=c[r];if(a.maxX+i<=e)break;if(e+i>a.minX&&t-i<a.maxY&&t+i>a.minY){var o=function(e,t,n,i,r,a){var o=r-n,s=a-i,l=o*o+s*s,u=l?Math.max(0,Math.min(1,((e-n)*o+(t-i)*s)/l)):0,c=e-(n+u*o),h=t-(i+u*s);return c*c+h*h}(e,t,a.x1,a.y1,a.x2,a.y2);o<n&&(i=Math.sqrt(n=o))}}return function(e,t){for(var n=0,i=c.length;i--;){var r=c[i];if(r.maxX<=e)break;r.y1>t!=r.y2>t&&e<(r.x2-r.x1)*(t-r.y1)/(r.y2-r.y1)+r.x1&&(n+=r.y1<r.y2?1:-1)}return 0!==n}(e,t)&&(i=-i),i}(r[0]+l*(h+.5)/e,r[1]+u*(d+.5)/t),f=Math.pow(1-Math.abs(p)/a,o)/2;p<0&&(f=1-f),f=Math.max(0,Math.min(255,Math.round(255*f))),s[d*e+h]=f}return s}function c(e,t,n,i,r,a,o,s,l,u){void 0===a&&(a=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===u&&(u=0),h(e,t,n,i,r,a,o,null,s,l,u)}function h(e,t,n,i,r,a,o,l,c,h,d){void 0===a&&(a=1),void 0===c&&(c=0),void 0===h&&(h=0),void 0===d&&(d=0);for(var p=u(e,t,n,i,r,a),f=new Uint8Array(4*p.length),v=0;v<p.length;v++)f[4*v+d]=p[v];s(o,f,c,h,e,t,1<<3-d,l)}var d=Object.freeze({__proto__:null,generate:u,generateIntoCanvas:c,generateIntoFramebuffer:h}),p=new Float32Array([0,0,2,0,0,2]),f=null,v=!1,m={},g=new WeakMap;function _(e){if(!v&&!w(e))throw Error("WebGL generation not supported")}function y(e,t,n,i,r,a,s){if(void 0===a&&(a=1),void 0===s&&(s=null),!s&&!(s=f)){var l="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!=typeof document?document.createElement("canvas"):null;if(!l)throw Error("OffscreenCanvas or DOM canvas not supported");s=f=l.getContext("webgl",{depth:!1})}_(s);var u=new Uint8Array(e*t*4);o(s,function(o){var s=o.gl,l=o.withTexture,c=o.withTextureFramebuffer;l("readable",function(o,l){s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,t,0,s.RGBA,s.UNSIGNED_BYTE,null),c(o,l,function(o){b(e,t,n,i,r,a,s,o,0,0,0),s.readPixels(0,0,e,t,s.RGBA,s.UNSIGNED_BYTE,u)})})});for(var c=new Uint8Array(e*t),h=0,d=0;h<u.length;h+=4)c[d++]=u[h];return c}function x(e,t,n,i,r,a,o,s,l,u){void 0===a&&(a=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===u&&(u=0),b(e,t,n,i,r,a,o,null,s,l,u)}function b(e,t,r,a,s,l,u,c,h,d,f){void 0===l&&(l=1),void 0===h&&(h=0),void 0===d&&(d=0),void 0===f&&(f=0),_(u);var v=[];n(r,function(e,t,n,i){v.push(e,t,n,i)}),v=new Float32Array(v),o(u,function(n){var r=n.gl,o=n.isWebGL2,u=n.getExtension,m=n.withProgram,g=n.withTexture,_=n.withTextureFramebuffer,y=n.handleContextLoss;if(g("rawDistances",function(n,g){(e!==n._lastWidth||t!==n._lastHeight)&&r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n._lastWidth=e,n._lastHeight=t,0,r.RGBA,r.UNSIGNED_BYTE,null),m("main","precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}","precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",function(i){var c=i.setAttribute,h=i.setUniform,d=!o&&u("ANGLE_instanced_arrays"),f=!o&&u("EXT_blend_minmax");c("aUV",2,r.STATIC_DRAW,0,p),c("aLineSegment",4,r.DYNAMIC_DRAW,1,v),h.apply(void 0,["4f","uGlyphBounds"].concat(a)),h("1f","uMaxDistance",s),h("1f","uExponent",l),_(n,g,function(n){r.enable(r.BLEND),r.colorMask(!0,!0,!0,!0),r.viewport(0,0,e,t),r.scissor(0,0,e,t),r.blendFunc(r.ONE,r.ONE),r.blendEquationSeparate(r.FUNC_ADD,o?r.MAX:f.MAX_EXT),r.clear(r.COLOR_BUFFER_BIT),o?r.drawArraysInstanced(r.TRIANGLES,0,3,v.length/4):d.drawArraysInstancedANGLE(r.TRIANGLES,0,3,v.length/4)})}),m("post",i,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",function(n){n.setAttribute("aUV",2,r.STATIC_DRAW,0,p),n.setUniform("1i","tex",g),r.bindFramebuffer(r.FRAMEBUFFER,c),r.disable(r.BLEND),r.colorMask(0===f,1===f,2===f,3===f),r.viewport(h,d,e,t),r.scissor(h,d,e,t),r.drawArrays(r.TRIANGLES,0,3)})}),r.isContextLost())throw y(),Error("webgl context lost")})}function w(e){var t=e&&e!==f?e.canvas||e:m,n=g.get(t);if(void 0===n){v=!0;var i=null;try{var r=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],a=y(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,e);n=a&&r.length===a.length&&a.every(function(e,t){return e===r[t]})}catch(e){n=!1,e.message}v=!1,g.set(t,n)}return n}var S=Object.freeze({__proto__:null,generate:y,generateIntoCanvas:x,generateIntoFramebuffer:b,isSupported:w});return e.forEachPathCommand=t,e.generate=function(e,t,n,i,r,a){void 0===r&&(r=Math.max(i[2]-i[0],i[3]-i[1])/2),void 0===a&&(a=1);try{return y.apply(S,arguments)}catch(e){return u.apply(d,arguments)}},e.generateIntoCanvas=function(e,t,n,i,r,a,o,s,l,u){void 0===r&&(r=Math.max(i[2]-i[0],i[3]-i[1])/2),void 0===a&&(a=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===u&&(u=0);try{return x.apply(S,arguments)}catch(e){return c.apply(d,arguments)}},e.javascript=d,e.pathToLineSegments=n,e.webgl=S,e.webglUtils=l,Object.defineProperty(e,"__esModule",{value:!0}),e}({})}var sW=/\bvoid\s+main\s*\(\s*\)\s*{/g;function sj(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(e,t){var n=r3[t];return n?sj(n):e})}for(var sX=[],sq=0;sq<256;sq++)sX[sq]=(sq<16?"0":"")+sq.toString(16);var sY=Object.assign||function(){for(var e=arguments[0],t=1,n=arguments.length;t<n;t++){var i=arguments[t];if(i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},sK=Date.now(),sZ=new WeakMap,sJ=new Map,sQ=1e10;function s$(e,t,n,i,r){return(i||r||n)&&(e=e.replace(sW,"\n".concat(n,"\nvoid troikaOrigMain").concat(t,"() {"))+"\nvoid main() {\n  ".concat(i,"\n  troikaOrigMain").concat(t,"();\n  ").concat(r,"\n}")),e}function s0(e,t){return"uniforms"===e?void 0:"function"==typeof t?t.toString():t}var s1=0,s2=new Map,s3=function(){return(self.performance||Date).now()},s4=sH(),s5=[],s6=0;function s8(){for(var e=s3();s5.length&&s3()-e<5;)s5.shift()();s6=s5.length?setTimeout(s8,0):0}var s9=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Promise(function(e,n){s5.push(function(){var i,r=s3();try{(i=s4.webgl).generateIntoCanvas.apply(i,ew(t)),e({timing:s3()-r})}catch(e){n(e)}}),s6||(s6=setTimeout(s8,0))})},s7={},le=0;function lt(e,t,n,i,r,a,o,s,l,u){var c="TroikaTextSDFGenerator_JS_"+le++%4,h=s7[c];return h||(h=s7[c]={workerModule:sV({name:c,workerId:c,dependencies:[sH,s3],init:function(e,t){var n=e().javascript.generate;return function(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];var a=t();return{textureData:n.apply(void 0,ew(i)),timing:t()-a}}},getTransferables:function(e){return[e.textureData.buffer]}}),requests:0,idleTimer:null}),h.requests++,clearTimeout(h.idleTimer),h.workerModule(e,t,n,i,r,a).then(function(n){for(var i=n.textureData,r=n.timing,a=s3(),d=new Uint8Array(4*i.length),p=0;p<i.length;p++)d[4*p+u]=i[p];return s4.webglUtils.renderImageData(o,d,s,l,e,t,1<<3-u),r+=s3()-a,0==--h.requests&&(h.idleTimer=setTimeout(function(){sF[c]&&sF[c].forEach(function(e){e()}),sO[c]&&(sO[c].terminate(),delete sO[c])},2e3)),{timing:r}})}var ln=s4.webglUtils.resizeWebGLCanvasWithoutClearing,li=sV({name:"Typr Font Parser",dependencies:[/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function(){var e,t,n;return"undefined"==typeof window&&(self.window=self),(e={},(t={parse:function(e){var n=t._bin,i=new Uint8Array(e);if("ttcf"==n.readASCII(i,0,4)){var r=4;n.readUshort(i,r),r+=2,n.readUshort(i,r),r+=2;var a=n.readUint(i,r);r+=4;for(var o=[],s=0;s<a;s++){var l=n.readUint(i,r);r+=4,o.push(t._readFont(i,l))}return o}return[t._readFont(i,0)]},_readFont:function(e,n){var i=t._bin,r=n;i.readFixed(e,n),n+=4;var a=i.readUshort(e,n);n+=2,i.readUshort(e,n),n+=2,i.readUshort(e,n),n+=2,i.readUshort(e,n),n+=2;for(var o=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],s={_data:e,_offset:r},l={},u=0;u<a;u++){var c=i.readASCII(e,n,4);n+=4,i.readUint(e,n),n+=4;var h=i.readUint(e,n);n+=4;var d=i.readUint(e,n);n+=4,l[c]={offset:h,length:d}}for(u=0;u<o.length;u++){var p=o[u];l[p]&&(s[p.trim()]=t[p.trim()].parse(e,l[p].offset,l[p].length,s))}return s},_tabOffset:function(e,n,i){for(var r=t._bin,a=r.readUshort(e,i+4),o=i+12,s=0;s<a;s++){var l=r.readASCII(e,o,4);o+=4,r.readUint(e,o),o+=4;var u=r.readUint(e,o);if(o+=4,r.readUint(e,o),o+=4,l==n)return u}return 0}})._bin={readFixed:function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<8|e[t+3])/65540},readF2dot14:function(e,n){return t._bin.readShort(e,n)/16384},readInt:function(e,n){return t._bin._view(e).getInt32(n)},readInt8:function(e,n){return t._bin._view(e).getInt8(n)},readShort:function(e,n){return t._bin._view(e).getInt16(n)},readUshort:function(e,n){return t._bin._view(e).getUint16(n)},readUshorts:function(e,n,i){for(var r=[],a=0;a<i;a++)r.push(t._bin.readUshort(e,n+2*a));return r},readUint:function(e,n){return t._bin._view(e).getUint32(n)},readUint64:function(e,n){return 0x100000000*t._bin.readUint(e,n)+t._bin.readUint(e,n+4)},readASCII:function(e,t,n){for(var i="",r=0;r<n;r++)i+=String.fromCharCode(e[t+r]);return i},readUnicode:function(e,t,n){for(var i="",r=0;r<n;r++)i+=String.fromCharCode(e[t++]<<8|e[t++]);return i},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(e,n,i){var r=t._bin._tdec;return r&&0==n&&i==e.length?r.decode(e):t._bin.readASCII(e,n,i)},readBytes:function(e,t,n){for(var i=[],r=0;r<n;r++)i.push(e[t+r]);return i},readASCIIArray:function(e,t,n){for(var i=[],r=0;r<n;r++)i.push(String.fromCharCode(e[t+r]));return i},_view:function(e){return e._dataView||(e._dataView=e.buffer?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(new Uint8Array(e).buffer))}},t._lctf={},t._lctf.parse=function(e,n,i,r,a){var o=t._bin,s={},l=n;o.readFixed(e,n),n+=4;var u=o.readUshort(e,n);n+=2;var c=o.readUshort(e,n);n+=2;var h=o.readUshort(e,n);return n+=2,s.scriptList=t._lctf.readScriptList(e,l+u),s.featureList=t._lctf.readFeatureList(e,l+c),s.lookupList=t._lctf.readLookupList(e,l+h,a),s},t._lctf.readLookupList=function(e,n,i){var r=t._bin,a=n,o=[],s=r.readUshort(e,n);n+=2;for(var l=0;l<s;l++){var u=r.readUshort(e,n);n+=2;var c=t._lctf.readLookupTable(e,a+u,i);o.push(c)}return o},t._lctf.readLookupTable=function(e,n,i){var r=t._bin,a=n,o={tabs:[]};o.ltype=r.readUshort(e,n),n+=2,o.flag=r.readUshort(e,n),n+=2;var s=r.readUshort(e,n);n+=2;for(var l=o.ltype,u=0;u<s;u++){var c=r.readUshort(e,n);n+=2;var h=i(e,l,a+c,o);o.tabs.push(h)}return o},t._lctf.numOfOnes=function(e){for(var t=0,n=0;n<32;n++)0!=(e>>>n&1)&&t++;return t},t._lctf.readClassDef=function(e,n){var i=t._bin,r=[],a=i.readUshort(e,n);if(n+=2,1==a){var o=i.readUshort(e,n);n+=2;var s=i.readUshort(e,n);n+=2;for(var l=0;l<s;l++)r.push(o+l),r.push(o+l),r.push(i.readUshort(e,n)),n+=2}if(2==a){var u=i.readUshort(e,n);for(n+=2,l=0;l<u;l++)r.push(i.readUshort(e,n)),n+=2,r.push(i.readUshort(e,n)),n+=2,r.push(i.readUshort(e,n)),n+=2}return r},t._lctf.getInterval=function(e,t){for(var n=0;n<e.length;n+=3){var i=e[n],r=e[n+1];if(e[n+2],i<=t&&t<=r)return n}return -1},t._lctf.readCoverage=function(e,n){var i=t._bin,r={};r.fmt=i.readUshort(e,n),n+=2;var a=i.readUshort(e,n);return n+=2,1==r.fmt&&(r.tab=i.readUshorts(e,n,a)),2==r.fmt&&(r.tab=i.readUshorts(e,n,3*a)),r},t._lctf.coverageIndex=function(e,n){var i=e.tab;if(1==e.fmt)return i.indexOf(n);if(2==e.fmt){var r=t._lctf.getInterval(i,n);if(-1!=r)return i[r+2]+(n-i[r])}return -1},t._lctf.readFeatureList=function(e,n){var i=t._bin,r=n,a=[],o=i.readUshort(e,n);n+=2;for(var s=0;s<o;s++){var l=i.readASCII(e,n,4);n+=4;var u=i.readUshort(e,n);n+=2;var c=t._lctf.readFeatureTable(e,r+u);c.tag=l.trim(),a.push(c)}return a},t._lctf.readFeatureTable=function(e,n){var i=t._bin,r=n,a={},o=i.readUshort(e,n);n+=2,o>0&&(a.featureParams=r+o);var s=i.readUshort(e,n);n+=2,a.tab=[];for(var l=0;l<s;l++)a.tab.push(i.readUshort(e,n+2*l));return a},t._lctf.readScriptList=function(e,n){var i=t._bin,r=n,a={},o=i.readUshort(e,n);n+=2;for(var s=0;s<o;s++){var l=i.readASCII(e,n,4);n+=4;var u=i.readUshort(e,n);n+=2,a[l.trim()]=t._lctf.readScriptTable(e,r+u)}return a},t._lctf.readScriptTable=function(e,n){var i=t._bin,r=n,a={},o=i.readUshort(e,n);n+=2,a.default=t._lctf.readLangSysTable(e,r+o);var s=i.readUshort(e,n);n+=2;for(var l=0;l<s;l++){var u=i.readASCII(e,n,4);n+=4;var c=i.readUshort(e,n);n+=2,a[u.trim()]=t._lctf.readLangSysTable(e,r+c)}return a},t._lctf.readLangSysTable=function(e,n){var i=t._bin,r={};i.readUshort(e,n),n+=2,r.reqFeature=i.readUshort(e,n),n+=2;var a=i.readUshort(e,n);return n+=2,r.features=i.readUshorts(e,n,a),r},t.CFF={},t.CFF.parse=function(e,n,i){var r=t._bin;(e=new Uint8Array(e.buffer,n,i))[n=0],e[++n],e[++n],e[++n],n++;var a=[];n=t.CFF.readIndex(e,n,a);for(var o=[],s=0;s<a.length-1;s++)o.push(r.readASCII(e,n+a[s],a[s+1]-a[s]));n+=a[a.length-1];var l=[];n=t.CFF.readIndex(e,n,l);var u=[];for(s=0;s<l.length-1;s++)u.push(t.CFF.readDict(e,n+l[s],n+l[s+1]));n+=l[l.length-1];var c=u[0],h=[];n=t.CFF.readIndex(e,n,h);var d=[];for(s=0;s<h.length-1;s++)d.push(r.readASCII(e,n+h[s],h[s+1]-h[s]));if(n+=h[h.length-1],t.CFF.readSubrs(e,n,c),c.CharStrings){n=c.CharStrings,h=[],n=t.CFF.readIndex(e,n,h);var p=[];for(s=0;s<h.length-1;s++)p.push(r.readBytes(e,n+h[s],h[s+1]-h[s]));c.CharStrings=p}if(c.ROS){n=c.FDArray;var f=[];for(n=t.CFF.readIndex(e,n,f),c.FDArray=[],s=0;s<f.length-1;s++){var v=t.CFF.readDict(e,n+f[s],n+f[s+1]);t.CFF._readFDict(e,v,d),c.FDArray.push(v)}n+=f[f.length-1],n=c.FDSelect,c.FDSelect=[];var m=e[n];if(n++,3!=m)throw m;var g=r.readUshort(e,n);for(n+=2,s=0;s<g+1;s++)c.FDSelect.push(r.readUshort(e,n),e[n+2]),n+=3}return c.Encoding&&(c.Encoding=t.CFF.readEncoding(e,c.Encoding,c.CharStrings.length)),c.charset&&(c.charset=t.CFF.readCharset(e,c.charset,c.CharStrings.length)),t.CFF._readFDict(e,c,d),c},t.CFF._readFDict=function(e,n,i){var r;for(var a in n.Private&&(r=n.Private[1],n.Private=t.CFF.readDict(e,r,r+n.Private[0]),n.Private.Subrs&&t.CFF.readSubrs(e,r+n.Private.Subrs,n.Private)),n)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(a)&&(n[a]=i[n[a]-426+35])},t.CFF.readSubrs=function(e,n,i){var r=t._bin,a=[];n=t.CFF.readIndex(e,n,a);var o,s=a.length;o=s<1240?107:s<33900?1131:32768,i.Bias=o,i.Subrs=[];for(var l=0;l<a.length-1;l++)i.Subrs.push(r.readBytes(e,n+a[l],a[l+1]-a[l]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(e,t){for(var n=0;n<e.charset.length;n++)if(e.charset[n]==t)return n;return -1},t.CFF.glyphBySE=function(e,n){return n<0||n>255?-1:t.CFF.glyphByUnicode(e,t.CFF.tableSE[n])},t.CFF.readEncoding=function(e,n,i){t._bin;var r=[".notdef"],a=e[n];if(n++,0!=a)throw"error: unknown encoding format: "+a;var o=e[n];n++;for(var s=0;s<o;s++)r.push(e[n+s]);return r},t.CFF.readCharset=function(e,n,i){var r=t._bin,a=[".notdef"],o=e[n];if(n++,0==o)for(var s=0;s<i;s++){var l=r.readUshort(e,n);n+=2,a.push(l)}else{if(1!=o&&2!=o)throw"error: format: "+o;for(;a.length<i;){l=r.readUshort(e,n),n+=2;var u=0;for(1==o?(u=e[n],n++):(u=r.readUshort(e,n),n+=2),s=0;s<=u;s++)a.push(l),l++}}return a},t.CFF.readIndex=function(e,n,i){var r=t._bin,a=r.readUshort(e,n)+1,o=e[n+=2];if(n++,1==o)for(var s=0;s<a;s++)i.push(e[n+s]);else if(2==o)for(s=0;s<a;s++)i.push(r.readUshort(e,n+2*s));else if(3==o)for(s=0;s<a;s++)i.push(0xffffff&r.readUint(e,n+3*s-1));else if(1!=a)throw"unsupported offset size: "+o+", count: "+a;return(n+=a*o)-1},t.CFF.getCharString=function(e,n,i){var r=t._bin,a=e[n],o=e[n+1];e[n+2],e[n+3],e[n+4];var s=1,l=null,u=null;a<=20&&(l=a,s=1),12==a&&(l=100*a+o,s=2),21<=a&&a<=27&&(l=a,s=1),28==a&&(u=r.readShort(e,n+1),s=3),29<=a&&a<=31&&(l=a,s=1),32<=a&&a<=246&&(u=a-139,s=1),247<=a&&a<=250&&(u=256*(a-247)+o+108,s=2),251<=a&&a<=254&&(u=-(256*(a-251))-o-108,s=2),255==a&&(u=r.readInt(e,n+1)/65535,s=5),i.val=null!=u?u:"o"+l,i.size=s},t.CFF.readCharString=function(e,n,i){for(var r=n+i,a=t._bin,o=[];n<r;){var s=e[n],l=e[n+1];e[n+2],e[n+3],e[n+4];var u=1,c=null,h=null;s<=20&&(c=s,u=1),12==s&&(c=100*s+l,u=2),19!=s&&20!=s||(c=s,u=2),21<=s&&s<=27&&(c=s,u=1),28==s&&(h=a.readShort(e,n+1),u=3),29<=s&&s<=31&&(c=s,u=1),32<=s&&s<=246&&(h=s-139,u=1),247<=s&&s<=250&&(h=256*(s-247)+l+108,u=2),251<=s&&s<=254&&(h=-(256*(s-251))-l-108,u=2),255==s&&(h=a.readInt(e,n+1)/65535,u=5),o.push(null!=h?h:"o"+c),n+=u}return o},t.CFF.readDict=function(e,n,i){for(var r=t._bin,a={},o=[];n<i;){var s=e[n],l=e[n+1];e[n+2],e[n+3],e[n+4];var u=1,c=null,h=null;if(28==s&&(h=r.readShort(e,n+1),u=3),29==s&&(h=r.readInt(e,n+1),u=5),32<=s&&s<=246&&(h=s-139,u=1),247<=s&&s<=250&&(h=256*(s-247)+l+108,u=2),251<=s&&s<=254&&(h=-(256*(s-251))-l-108,u=2),255==s)throw h=r.readInt(e,n+1)/65535,u=5,"unknown number";if(30==s){var d=[];for(u=1;;){var p=e[n+u];u++;var f=p>>4,v=15&p;if(15!=f&&d.push(f),15!=v&&d.push(v),15==v)break}for(var m="",g=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],_=0;_<d.length;_++)m+=g[d[_]];h=parseFloat(m)}s<=21&&(c=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],u=1,12==s&&(c=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],u=2)),null!=c?(a[c]=1==o.length?o[0]:o,o=[]):o.push(h),n+=u}return a},t.cmap={},t.cmap.parse=function(e,n,i){e=new Uint8Array(e.buffer,n,i),n=0;var r=t._bin,a={};r.readUshort(e,n),n+=2;var o=r.readUshort(e,n);n+=2;var s=[];a.tables=[];for(var l=0;l<o;l++){var u=r.readUshort(e,n);n+=2;var c=r.readUshort(e,n);n+=2;var h=r.readUint(e,n);n+=4;var d="p"+u+"e"+c,p=s.indexOf(h);if(-1==p){p=a.tables.length,s.push(h);var f,v=r.readUshort(e,h);0==v?f=t.cmap.parse0(e,h):4==v?f=t.cmap.parse4(e,h):6==v?f=t.cmap.parse6(e,h):12==v&&(f=t.cmap.parse12(e,h)),a.tables.push(f)}if(null!=a[d])throw"multiple tables for one platform+encoding";a[d]=p}return a},t.cmap.parse0=function(e,n){var i=t._bin,r={};r.format=i.readUshort(e,n),n+=2;var a=i.readUshort(e,n);n+=2,i.readUshort(e,n),n+=2,r.map=[];for(var o=0;o<a-6;o++)r.map.push(e[n+o]);return r},t.cmap.parse4=function(e,n){var i=t._bin,r=n,a={};a.format=i.readUshort(e,n),n+=2;var o=i.readUshort(e,n);n+=2,i.readUshort(e,n),n+=2;var s=i.readUshort(e,n);n+=2;var l=s/2;a.searchRange=i.readUshort(e,n),n+=2,a.entrySelector=i.readUshort(e,n),n+=2,a.rangeShift=i.readUshort(e,n),n+=2,a.endCount=i.readUshorts(e,n,l),n+=2*l,n+=2,a.startCount=i.readUshorts(e,n,l),n+=2*l,a.idDelta=[];for(var u=0;u<l;u++)a.idDelta.push(i.readShort(e,n)),n+=2;for(a.idRangeOffset=i.readUshorts(e,n,l),n+=2*l,a.glyphIdArray=[];n<r+o;)a.glyphIdArray.push(i.readUshort(e,n)),n+=2;return a},t.cmap.parse6=function(e,n){var i=t._bin,r={};r.format=i.readUshort(e,n),n+=2,i.readUshort(e,n),n+=2,i.readUshort(e,n),n+=2,r.firstCode=i.readUshort(e,n),n+=2;var a=i.readUshort(e,n);n+=2,r.glyphIdArray=[];for(var o=0;o<a;o++)r.glyphIdArray.push(i.readUshort(e,n)),n+=2;return r},t.cmap.parse12=function(e,n){var i=t._bin,r={};r.format=i.readUshort(e,n),n+=2,n+=2,i.readUint(e,n),n+=4,i.readUint(e,n),n+=4;var a=i.readUint(e,n);n+=4,r.groups=[];for(var o=0;o<a;o++){var s=n+12*o,l=i.readUint(e,s+0),u=i.readUint(e,s+4),c=i.readUint(e,s+8);r.groups.push([l,u,c])}return r},t.glyf={},t.glyf.parse=function(e,t,n,i){for(var r=[],a=0;a<i.maxp.numGlyphs;a++)r.push(null);return r},t.glyf._parseGlyf=function(e,n){var i,r=t._bin,a=e._data,o=t._tabOffset(a,"glyf",e._offset)+e.loca[n];if(e.loca[n]==e.loca[n+1])return null;var s={};if(s.noc=r.readShort(a,o),o+=2,s.xMin=r.readShort(a,o),o+=2,s.yMin=r.readShort(a,o),o+=2,s.xMax=r.readShort(a,o),o+=2,s.yMax=r.readShort(a,o),o+=2,s.xMin>=s.xMax||s.yMin>=s.yMax)return null;if(s.noc>0){s.endPts=[];for(var l=0;l<s.noc;l++)s.endPts.push(r.readUshort(a,o)),o+=2;var u=r.readUshort(a,o);if(o+=2,a.length-o<u)return null;s.instructions=r.readBytes(a,o,u),o+=u;var c=s.endPts[s.noc-1]+1;for(l=0,s.flags=[];l<c;l++){var h=a[o];if(o++,s.flags.push(h),0!=(8&h)){var d=a[o];o++;for(var p=0;p<d;p++)s.flags.push(h),l++}}for(l=0,s.xs=[];l<c;l++){var f=0!=(2&s.flags[l]),v=0!=(16&s.flags[l]);f?(s.xs.push(v?a[o]:-a[o]),o++):v?s.xs.push(0):(s.xs.push(r.readShort(a,o)),o+=2)}for(l=0,s.ys=[];l<c;l++)f=0!=(4&s.flags[l]),v=0!=(32&s.flags[l]),f?(s.ys.push(v?a[o]:-a[o]),o++):v?s.ys.push(0):(s.ys.push(r.readShort(a,o)),o+=2);var m=0,g=0;for(l=0;l<c;l++)m+=s.xs[l],g+=s.ys[l],s.xs[l]=m,s.ys[l]=g}else{s.parts=[];do{i=r.readUshort(a,o),o+=2;var _={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(s.parts.push(_),_.glyphIndex=r.readUshort(a,o),o+=2,1&i){var y=r.readShort(a,o);o+=2;var x=r.readShort(a,o);o+=2}else y=r.readInt8(a,o),o++,x=r.readInt8(a,o),o++;2&i?(_.m.tx=y,_.m.ty=x):(_.p1=y,_.p2=x),8&i?(_.m.a=_.m.d=r.readF2dot14(a,o),o+=2):64&i?(_.m.a=r.readF2dot14(a,o),o+=2,_.m.d=r.readF2dot14(a,o),o+=2):128&i&&(_.m.a=r.readF2dot14(a,o),o+=2,_.m.b=r.readF2dot14(a,o),o+=2,_.m.c=r.readF2dot14(a,o),o+=2,_.m.d=r.readF2dot14(a,o),o+=2)}while(32&i)if(256&i){var b=r.readUshort(a,o);for(o+=2,s.instr=[],l=0;l<b;l++)s.instr.push(a[o]),o++}}return s},t.GPOS={},t.GPOS.parse=function(e,n,i,r){return t._lctf.parse(e,n,i,r,t.GPOS.subt)},t.GPOS.subt=function(e,n,i,r){var a=t._bin,o=i,s={};if(s.fmt=a.readUshort(e,i),i+=2,1==n||2==n||3==n||7==n||8==n&&s.fmt<=2){var l=a.readUshort(e,i);i+=2,s.coverage=t._lctf.readCoverage(e,l+o)}if(1==n&&1==s.fmt){var u=a.readUshort(e,i);i+=2;var c=t._lctf.numOfOnes(u);0!=u&&(s.pos=t.GPOS.readValueRecord(e,i,u))}else if(2==n&&s.fmt>=1&&s.fmt<=2){u=a.readUshort(e,i),i+=2;var h=a.readUshort(e,i);i+=2,c=t._lctf.numOfOnes(u);var d=t._lctf.numOfOnes(h);if(1==s.fmt){s.pairsets=[];var p=a.readUshort(e,i);i+=2;for(var f=0;f<p;f++){var v=o+a.readUshort(e,i);i+=2;var m=a.readUshort(e,v);v+=2;for(var g=[],_=0;_<m;_++){var y=a.readUshort(e,v);v+=2,0!=u&&(E=t.GPOS.readValueRecord(e,v,u),v+=2*c),0!=h&&(T=t.GPOS.readValueRecord(e,v,h),v+=2*d),g.push({gid2:y,val1:E,val2:T})}s.pairsets.push(g)}}if(2==s.fmt){var x=a.readUshort(e,i);i+=2;var b=a.readUshort(e,i);i+=2;var w=a.readUshort(e,i);i+=2;var S=a.readUshort(e,i);for(i+=2,s.classDef1=t._lctf.readClassDef(e,o+x),s.classDef2=t._lctf.readClassDef(e,o+b),s.matrix=[],f=0;f<w;f++){var M=[];for(_=0;_<S;_++){var E=null,T=null;0!=u&&(E=t.GPOS.readValueRecord(e,i,u),i+=2*c),0!=h&&(T=t.GPOS.readValueRecord(e,i,h),i+=2*d),M.push({val1:E,val2:T})}s.matrix.push(M)}}}else if(9==n&&1==s.fmt){var C=a.readUshort(e,i);i+=2;var k=a.readUint(e,i);if(i+=4,9==r.ltype)r.ltype=C;else if(r.ltype!=C)throw"invalid extension substitution";return t.GPOS.subt(e,r.ltype,o+k)}return s},t.GPOS.readValueRecord=function(e,n,i){var r=t._bin,a=[];return a.push(1&i?r.readShort(e,n):0),n+=1&i?2:0,a.push(2&i?r.readShort(e,n):0),n+=2&i?2:0,a.push(4&i?r.readShort(e,n):0),n+=4&i?2:0,a.push(8&i?r.readShort(e,n):0),n+=8&i?2:0,a},t.GSUB={},t.GSUB.parse=function(e,n,i,r){return t._lctf.parse(e,n,i,r,t.GSUB.subt)},t.GSUB.subt=function(e,n,i,r){var a=t._bin,o=i,s={};if(s.fmt=a.readUshort(e,i),i+=2,1!=n&&4!=n&&5!=n&&6!=n)return null;if(1==n||4==n||5==n&&s.fmt<=2||6==n&&s.fmt<=2){var l=a.readUshort(e,i);i+=2,s.coverage=t._lctf.readCoverage(e,o+l)}if(1==n&&s.fmt>=1&&s.fmt<=2){if(1==s.fmt)s.delta=a.readShort(e,i),i+=2;else if(2==s.fmt){var u=a.readUshort(e,i);i+=2,s.newg=a.readUshorts(e,i,u),i+=2*s.newg.length}}else if(4==n){s.vals=[],u=a.readUshort(e,i),i+=2;for(var c=0;c<u;c++){var h=a.readUshort(e,i);i+=2,s.vals.push(t.GSUB.readLigatureSet(e,o+h))}}else if(5==n&&2==s.fmt){if(2==s.fmt){var d=a.readUshort(e,i);i+=2,s.cDef=t._lctf.readClassDef(e,o+d),s.scset=[];var p=a.readUshort(e,i);for(i+=2,c=0;c<p;c++){var f=a.readUshort(e,i);i+=2,s.scset.push(0==f?null:t.GSUB.readSubClassSet(e,o+f))}}}else if(6==n&&3==s.fmt){if(3==s.fmt){for(c=0;c<3;c++){u=a.readUshort(e,i),i+=2;for(var v=[],m=0;m<u;m++)v.push(t._lctf.readCoverage(e,o+a.readUshort(e,i+2*m)));i+=2*u,0==c&&(s.backCvg=v),1==c&&(s.inptCvg=v),2==c&&(s.ahedCvg=v)}u=a.readUshort(e,i),i+=2,s.lookupRec=t.GSUB.readSubstLookupRecords(e,i,u)}}else if(7==n&&1==s.fmt){var g=a.readUshort(e,i);i+=2;var _=a.readUint(e,i);if(i+=4,9==r.ltype)r.ltype=g;else if(r.ltype!=g)throw"invalid extension substitution";return t.GSUB.subt(e,r.ltype,o+_)}return s},t.GSUB.readSubClassSet=function(e,n){var i=t._bin.readUshort,r=n,a=[],o=i(e,n);n+=2;for(var s=0;s<o;s++){var l=i(e,n);n+=2,a.push(t.GSUB.readSubClassRule(e,r+l))}return a},t.GSUB.readSubClassRule=function(e,n){var i=t._bin.readUshort,r={},a=i(e,n),o=i(e,n+=2);n+=2,r.input=[];for(var s=0;s<a-1;s++)r.input.push(i(e,n)),n+=2;return r.substLookupRecords=t.GSUB.readSubstLookupRecords(e,n,o),r},t.GSUB.readSubstLookupRecords=function(e,n,i){for(var r=t._bin.readUshort,a=[],o=0;o<i;o++)a.push(r(e,n),r(e,n+2)),n+=4;return a},t.GSUB.readChainSubClassSet=function(e,n){var i=t._bin,r=n,a=[],o=i.readUshort(e,n);n+=2;for(var s=0;s<o;s++){var l=i.readUshort(e,n);n+=2,a.push(t.GSUB.readChainSubClassRule(e,r+l))}return a},t.GSUB.readChainSubClassRule=function(e,n){for(var i=t._bin,r={},a=["backtrack","input","lookahead"],o=0;o<a.length;o++){var s=i.readUshort(e,n);n+=2,1==o&&s--,r[a[o]]=i.readUshorts(e,n,s),n+=2*r[a[o]].length}return s=i.readUshort(e,n),n+=2,r.subst=i.readUshorts(e,n,2*s),n+=2*r.subst.length,r},t.GSUB.readLigatureSet=function(e,n){var i=t._bin,r=n,a=[],o=i.readUshort(e,n);n+=2;for(var s=0;s<o;s++){var l=i.readUshort(e,n);n+=2,a.push(t.GSUB.readLigature(e,r+l))}return a},t.GSUB.readLigature=function(e,n){var i=t._bin,r={chain:[]};r.nglyph=i.readUshort(e,n),n+=2;var a=i.readUshort(e,n);n+=2;for(var o=0;o<a-1;o++)r.chain.push(i.readUshort(e,n)),n+=2;return r},t.head={},t.head.parse=function(e,n,i){var r=t._bin,a={};return r.readFixed(e,n),n+=4,a.fontRevision=r.readFixed(e,n),n+=4,r.readUint(e,n),n+=4,r.readUint(e,n),n+=4,a.flags=r.readUshort(e,n),n+=2,a.unitsPerEm=r.readUshort(e,n),n+=2,a.created=r.readUint64(e,n),n+=8,a.modified=r.readUint64(e,n),n+=8,a.xMin=r.readShort(e,n),n+=2,a.yMin=r.readShort(e,n),n+=2,a.xMax=r.readShort(e,n),n+=2,a.yMax=r.readShort(e,n),n+=2,a.macStyle=r.readUshort(e,n),n+=2,a.lowestRecPPEM=r.readUshort(e,n),n+=2,a.fontDirectionHint=r.readShort(e,n),n+=2,a.indexToLocFormat=r.readShort(e,n),n+=2,a.glyphDataFormat=r.readShort(e,n),n+=2,a},t.hhea={},t.hhea.parse=function(e,n,i){var r=t._bin,a={};return r.readFixed(e,n),n+=4,a.ascender=r.readShort(e,n),n+=2,a.descender=r.readShort(e,n),n+=2,a.lineGap=r.readShort(e,n),n+=2,a.advanceWidthMax=r.readUshort(e,n),n+=2,a.minLeftSideBearing=r.readShort(e,n),n+=2,a.minRightSideBearing=r.readShort(e,n),n+=2,a.xMaxExtent=r.readShort(e,n),n+=2,a.caretSlopeRise=r.readShort(e,n),n+=2,a.caretSlopeRun=r.readShort(e,n),n+=2,a.caretOffset=r.readShort(e,n),n+=2,n+=8,a.metricDataFormat=r.readShort(e,n),n+=2,a.numberOfHMetrics=r.readUshort(e,n),n+=2,a},t.hmtx={},t.hmtx.parse=function(e,n,i,r){for(var a=t._bin,o={aWidth:[],lsBearing:[]},s=0,l=0,u=0;u<r.maxp.numGlyphs;u++)u<r.hhea.numberOfHMetrics&&(s=a.readUshort(e,n),n+=2,l=a.readShort(e,n),n+=2),o.aWidth.push(s),o.lsBearing.push(l);return o},t.kern={},t.kern.parse=function(e,n,i,r){var a=t._bin,o=a.readUshort(e,n);if(n+=2,1==o)return t.kern.parseV1(e,n-2,i,r);var s=a.readUshort(e,n);n+=2;for(var l={glyph1:[],rval:[]},u=0;u<s;u++){n+=2,i=a.readUshort(e,n),n+=2;var c=a.readUshort(e,n);n+=2;var h=c>>>8;if(0!=(h&=15))throw"unknown kern table format: "+h;n=t.kern.readFormat0(e,n,l)}return l},t.kern.parseV1=function(e,n,i,r){var a=t._bin;a.readFixed(e,n),n+=4;var o=a.readUint(e,n);n+=4;for(var s={glyph1:[],rval:[]},l=0;l<o;l++){a.readUint(e,n),n+=4;var u=a.readUshort(e,n);n+=2,a.readUshort(e,n),n+=2;var c=u>>>8;if(0!=(c&=15))throw"unknown kern table format: "+c;n=t.kern.readFormat0(e,n,s)}return s},t.kern.readFormat0=function(e,n,i){var r=t._bin,a=-1,o=r.readUshort(e,n);n+=2,r.readUshort(e,n),n+=2,r.readUshort(e,n),n+=2,r.readUshort(e,n),n+=2;for(var s=0;s<o;s++){var l=r.readUshort(e,n);n+=2;var u=r.readUshort(e,n);n+=2;var c=r.readShort(e,n);n+=2,l!=a&&(i.glyph1.push(l),i.rval.push({glyph2:[],vals:[]}));var h=i.rval[i.rval.length-1];h.glyph2.push(u),h.vals.push(c),a=l}return n},t.loca={},t.loca.parse=function(e,n,i,r){var a=t._bin,o=[],s=r.head.indexToLocFormat,l=r.maxp.numGlyphs+1;if(0==s)for(var u=0;u<l;u++)o.push(a.readUshort(e,n+(u<<1))<<1);if(1==s)for(u=0;u<l;u++)o.push(a.readUint(e,n+(u<<2)));return o},t.maxp={},t.maxp.parse=function(e,n,i){var r=t._bin,a={},o=r.readUint(e,n);return n+=4,a.numGlyphs=r.readUshort(e,n),n+=2,65536==o&&(a.maxPoints=r.readUshort(e,n),n+=2,a.maxContours=r.readUshort(e,n),n+=2,a.maxCompositePoints=r.readUshort(e,n),n+=2,a.maxCompositeContours=r.readUshort(e,n),n+=2,a.maxZones=r.readUshort(e,n),n+=2,a.maxTwilightPoints=r.readUshort(e,n),n+=2,a.maxStorage=r.readUshort(e,n),n+=2,a.maxFunctionDefs=r.readUshort(e,n),n+=2,a.maxInstructionDefs=r.readUshort(e,n),n+=2,a.maxStackElements=r.readUshort(e,n),n+=2,a.maxSizeOfInstructions=r.readUshort(e,n),n+=2,a.maxComponentElements=r.readUshort(e,n),n+=2,a.maxComponentDepth=r.readUshort(e,n),n+=2),a},t.name={},t.name.parse=function(e,n,i){var r=t._bin,a={};r.readUshort(e,n),n+=2;var o=r.readUshort(e,n);n+=2,r.readUshort(e,n);for(var s,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],u=n+=2,c=0;c<o;c++){var h=r.readUshort(e,n);n+=2;var d=r.readUshort(e,n);n+=2;var p=r.readUshort(e,n);n+=2;var f=r.readUshort(e,n);n+=2;var v=r.readUshort(e,n);n+=2;var m=r.readUshort(e,n);n+=2;var g,_=l[f],y=u+12*o+m;if(0==h)g=r.readUnicode(e,y,v/2);else if(3==h&&0==d)g=r.readUnicode(e,y,v/2);else if(0==d)g=r.readASCII(e,y,v);else if(1==d)g=r.readUnicode(e,y,v/2);else if(3==d)g=r.readUnicode(e,y,v/2);else{if(1!=h)throw"unknown encoding "+d+", platformID: "+h;g=r.readASCII(e,y,v)}var x="p"+h+","+p.toString(16);null==a[x]&&(a[x]={}),a[x][void 0!==_?_:f]=g,a[x]._lang=p}for(var b in a)if(null!=a[b].postScriptName&&1033==a[b]._lang)return a[b];for(var b in a)if(null!=a[b].postScriptName&&0==a[b]._lang)return a[b];for(var b in a)if(null!=a[b].postScriptName&&3084==a[b]._lang)return a[b];for(var b in a)if(null!=a[b].postScriptName)return a[b];for(var b in a){s=b;break}return a[s]},t["OS/2"]={},t["OS/2"].parse=function(e,n,i){var r=t._bin.readUshort(e,n);n+=2;var a={};if(0==r)t["OS/2"].version0(e,n,a);else if(1==r)t["OS/2"].version1(e,n,a);else if(2==r||3==r||4==r)t["OS/2"].version2(e,n,a);else{if(5!=r)throw"unknown OS/2 table version: "+r;t["OS/2"].version5(e,n,a)}return a},t["OS/2"].version0=function(e,n,i){var r=t._bin;return i.xAvgCharWidth=r.readShort(e,n),n+=2,i.usWeightClass=r.readUshort(e,n),n+=2,i.usWidthClass=r.readUshort(e,n),n+=2,i.fsType=r.readUshort(e,n),n+=2,i.ySubscriptXSize=r.readShort(e,n),n+=2,i.ySubscriptYSize=r.readShort(e,n),n+=2,i.ySubscriptXOffset=r.readShort(e,n),n+=2,i.ySubscriptYOffset=r.readShort(e,n),n+=2,i.ySuperscriptXSize=r.readShort(e,n),n+=2,i.ySuperscriptYSize=r.readShort(e,n),n+=2,i.ySuperscriptXOffset=r.readShort(e,n),n+=2,i.ySuperscriptYOffset=r.readShort(e,n),n+=2,i.yStrikeoutSize=r.readShort(e,n),n+=2,i.yStrikeoutPosition=r.readShort(e,n),n+=2,i.sFamilyClass=r.readShort(e,n),n+=2,i.panose=r.readBytes(e,n,10),n+=10,i.ulUnicodeRange1=r.readUint(e,n),n+=4,i.ulUnicodeRange2=r.readUint(e,n),n+=4,i.ulUnicodeRange3=r.readUint(e,n),n+=4,i.ulUnicodeRange4=r.readUint(e,n),n+=4,i.achVendID=[r.readInt8(e,n),r.readInt8(e,n+1),r.readInt8(e,n+2),r.readInt8(e,n+3)],n+=4,i.fsSelection=r.readUshort(e,n),n+=2,i.usFirstCharIndex=r.readUshort(e,n),n+=2,i.usLastCharIndex=r.readUshort(e,n),n+=2,i.sTypoAscender=r.readShort(e,n),n+=2,i.sTypoDescender=r.readShort(e,n),n+=2,i.sTypoLineGap=r.readShort(e,n),n+=2,i.usWinAscent=r.readUshort(e,n),n+=2,i.usWinDescent=r.readUshort(e,n),n+=2},t["OS/2"].version1=function(e,n,i){var r=t._bin;return n=t["OS/2"].version0(e,n,i),i.ulCodePageRange1=r.readUint(e,n),n+=4,i.ulCodePageRange2=r.readUint(e,n),n+=4},t["OS/2"].version2=function(e,n,i){var r=t._bin;return n=t["OS/2"].version1(e,n,i),i.sxHeight=r.readShort(e,n),n+=2,i.sCapHeight=r.readShort(e,n),n+=2,i.usDefault=r.readUshort(e,n),n+=2,i.usBreak=r.readUshort(e,n),n+=2,i.usMaxContext=r.readUshort(e,n),n+=2},t["OS/2"].version5=function(e,n,i){var r=t._bin;return n=t["OS/2"].version2(e,n,i),i.usLowerOpticalPointSize=r.readUshort(e,n),n+=2,i.usUpperOpticalPointSize=r.readUshort(e,n),n+=2},t.post={},t.post.parse=function(e,n,i){var r=t._bin,a={};return a.version=r.readFixed(e,n),n+=4,a.italicAngle=r.readFixed(e,n),n+=4,a.underlinePosition=r.readShort(e,n),n+=2,a.underlineThickness=r.readShort(e,n),n+=2,a},null==t&&(t={}),null==t.U&&(t.U={}),t.U.codeToGlyph=function(e,t){var n=e.cmap,i=-1;if(null!=n.p0e4?i=n.p0e4:null!=n.p3e1?i=n.p3e1:null!=n.p1e0?i=n.p1e0:null!=n.p0e3&&(i=n.p0e3),-1==i)throw"no familiar platform and encoding!";var r=n.tables[i];if(0==r.format)return t>=r.map.length?0:r.map[t];if(4==r.format){for(var a=-1,o=0;o<r.endCount.length;o++)if(t<=r.endCount[o]){a=o;break}return -1==a||r.startCount[a]>t?0:65535&(0!=r.idRangeOffset[a]?r.glyphIdArray[t-r.startCount[a]+(r.idRangeOffset[a]>>1)-(r.idRangeOffset.length-a)]:t+r.idDelta[a])}if(12==r.format){if(t>r.groups[r.groups.length-1][1])return 0;for(o=0;o<r.groups.length;o++){var s=r.groups[o];if(s[0]<=t&&t<=s[1])return s[2]+(t-s[0])}return 0}throw"unknown cmap table format "+r.format},t.U.glyphToPath=function(e,n){var i={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[n]){var r=e.SVG.entries[n];return null==r?i:("string"==typeof r&&(r=t.SVG.toPath(r),e.SVG.entries[n]=r),r)}if(e.CFF){var a={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},o=e.CFF,s=e.CFF.Private;if(o.ROS){for(var l=0;o.FDSelect[l+2]<=n;)l+=2;s=o.FDArray[o.FDSelect[l+1]].Private}t.U._drawCFF(e.CFF.CharStrings[n],a,o,s,i)}else e.glyf&&t.U._drawGlyf(n,e,i);return i},t.U._drawGlyf=function(e,n,i){var r=n.glyf[e];null==r&&(r=n.glyf[e]=t.glyf._parseGlyf(n,e)),null!=r&&(r.noc>-1?t.U._simpleGlyph(r,i):t.U._compoGlyph(r,n,i))},t.U._simpleGlyph=function(e,n){for(var i=0;i<e.noc;i++){for(var r=0==i?0:e.endPts[i-1]+1,a=e.endPts[i],o=r;o<=a;o++){var s=o==r?a:o-1,l=o==a?r:o+1,u=1&e.flags[o],c=1&e.flags[s],h=1&e.flags[l],d=e.xs[o],p=e.ys[o];if(o==r){if(u){if(!c){t.U.P.moveTo(n,d,p);continue}t.U.P.moveTo(n,e.xs[s],e.ys[s])}else c?t.U.P.moveTo(n,e.xs[s],e.ys[s]):t.U.P.moveTo(n,(e.xs[s]+d)/2,(e.ys[s]+p)/2)}u?c&&t.U.P.lineTo(n,d,p):h?t.U.P.qcurveTo(n,d,p,e.xs[l],e.ys[l]):t.U.P.qcurveTo(n,d,p,(d+e.xs[l])/2,(p+e.ys[l])/2)}t.U.P.closePath(n)}},t.U._compoGlyph=function(e,n,i){for(var r=0;r<e.parts.length;r++){var a={cmds:[],crds:[]},o=e.parts[r];t.U._drawGlyf(o.glyphIndex,n,a);for(var s=o.m,l=0;l<a.crds.length;l+=2){var u=a.crds[l],c=a.crds[l+1];i.crds.push(u*s.a+c*s.b+s.tx),i.crds.push(u*s.c+c*s.d+s.ty)}for(l=0;l<a.cmds.length;l++)i.cmds.push(a.cmds[l])}},t.U._getGlyphClass=function(e,n){var i=t._lctf.getInterval(n,e);return -1==i?0:n[i+2]},t.U.getPairAdjustment=function(e,n,i){var r=!1;if(e.GPOS)for(var a=e.GPOS,o=a.lookupList,s=a.featureList,l=[],u=0;u<s.length;u++){var c=s[u];if("kern"==c.tag){r=!0;for(var h=0;h<c.tab.length;h++)if(!l[c.tab[h]]){l[c.tab[h]]=!0;for(var d=o[c.tab[h]],p=0;p<d.tabs.length;p++)if(null!=d.tabs[p]){var f,v=d.tabs[p];if(!v.coverage||-1!=(f=t._lctf.coverageIndex(v.coverage,n))){if(1==d.ltype);else if(2==d.ltype){var m=null;if(1==v.fmt){var g=v.pairsets[f];for(u=0;u<g.length;u++)g[u].gid2==i&&(m=g[u])}else if(2==v.fmt){var _=t.U._getGlyphClass(n,v.classDef1),y=t.U._getGlyphClass(i,v.classDef2);m=v.matrix[_][y]}if(m){var x=0;return m.val1&&m.val1[2]&&(x+=m.val1[2]),m.val2&&m.val2[0]&&(x+=m.val2[0]),x}}}}}}}if(e.kern&&!r){var b=e.kern.glyph1.indexOf(n);if(-1!=b){var w=e.kern.rval[b].glyph2.indexOf(i);if(-1!=w)return e.kern.rval[b].vals[w]}}return 0},t.U._applySubs=function(e,n,i,r){for(var a=e.length-n-1,o=0;o<i.tabs.length;o++)if(null!=i.tabs[o]){var s,l=i.tabs[o];if(!l.coverage||-1!=(s=t._lctf.coverageIndex(l.coverage,e[n]))){if(1==i.ltype)e[n],1==l.fmt?e[n]=e[n]+l.delta:e[n]=l.newg[s];else if(4==i.ltype)for(var u=l.vals[s],c=0;c<u.length;c++){var h=u[c],d=h.chain.length;if(!(d>a)){for(var p=!0,f=0,v=0;v<d;v++){for(;-1==e[n+f+(1+v)];)f++;h.chain[v]!=e[n+f+(1+v)]&&(p=!1)}if(p){for(v=0,e[n]=h.nglyph;v<d+f;v++)e[n+v+1]=-1;break}}}else if(5==i.ltype&&2==l.fmt)for(var m=t._lctf.getInterval(l.cDef,e[n]),g=l.cDef[m+2],_=l.scset[g],y=0;y<_.length;y++){var x=_[y],b=x.input;if(!(b.length>a)){for(p=!0,v=0;v<b.length;v++){var w=t._lctf.getInterval(l.cDef,e[n+1+v]);if(-1==m&&l.cDef[w+2]!=b[v]){p=!1;break}}if(p){var S=x.substLookupRecords;for(c=0;c<S.length;c+=2)S[c],S[c+1]}}}else if(6==i.ltype&&3==l.fmt){if(!t.U._glsCovered(e,l.backCvg,n-l.backCvg.length)||!t.U._glsCovered(e,l.inptCvg,n)||!t.U._glsCovered(e,l.ahedCvg,n+l.inptCvg.length))continue;var M=l.lookupRec;for(y=0;y<M.length;y+=2){m=M[y];var E=r[M[y+1]];t.U._applySubs(e,n+m,E,r)}}}}},t.U._glsCovered=function(e,n,i){for(var r=0;r<n.length;r++)if(-1==t._lctf.coverageIndex(n[r],e[i+r]))return!1;return!0},t.U.glyphsToPath=function(e,n,i){for(var r={cmds:[],crds:[]},a=0,o=0;o<n.length;o++){var s=n[o];if(-1!=s){for(var l=o<n.length-1&&-1!=n[o+1]?n[o+1]:0,u=t.U.glyphToPath(e,s),c=0;c<u.crds.length;c+=2)r.crds.push(u.crds[c]+a),r.crds.push(u.crds[c+1]);for(i&&r.cmds.push(i),c=0;c<u.cmds.length;c++)r.cmds.push(u.cmds[c]);i&&r.cmds.push("X"),a+=e.hmtx.aWidth[s],o<n.length-1&&(a+=t.U.getPairAdjustment(e,s,l))}}return r},t.U.P={},t.U.P.moveTo=function(e,t,n){e.cmds.push("M"),e.crds.push(t,n)},t.U.P.lineTo=function(e,t,n){e.cmds.push("L"),e.crds.push(t,n)},t.U.P.curveTo=function(e,t,n,i,r,a,o){e.cmds.push("C"),e.crds.push(t,n,i,r,a,o)},t.U.P.qcurveTo=function(e,t,n,i,r){e.cmds.push("Q"),e.crds.push(t,n,i,r)},t.U.P.closePath=function(e){e.cmds.push("Z")},t.U._drawCFF=function(e,n,i,r,a){for(var o=n.stack,s=n.nStems,l=n.haveWidth,u=n.width,c=n.open,h=0,d=n.x,p=n.y,f=0,v=0,m=0,g=0,_=0,y=0,x=0,b=0,w=0,S=0,M={val:0,size:0};h<e.length;){t.CFF.getCharString(e,h,M);var E=M.val;if(h+=M.size,"o1"==E||"o18"==E)o.length%2==0||l||(u=o.shift()+r.nominalWidthX),s+=o.length>>1,o.length=0,l=!0;else if("o3"==E||"o23"==E)o.length%2==0||l||(u=o.shift()+r.nominalWidthX),s+=o.length>>1,o.length=0,l=!0;else if("o4"==E)o.length>1&&!l&&(u=o.shift()+r.nominalWidthX,l=!0),c&&t.U.P.closePath(a),p+=o.pop(),t.U.P.moveTo(a,d,p),c=!0;else if("o5"==E)for(;o.length>0;)d+=o.shift(),p+=o.shift(),t.U.P.lineTo(a,d,p);else if("o6"==E||"o7"==E)for(var T=o.length,C="o6"==E,k=0;k<T;k++){var A=o.shift();C?d+=A:p+=A,C=!C,t.U.P.lineTo(a,d,p)}else if("o8"==E||"o24"==E){T=o.length;for(var P=0;P+6<=T;)f=d+o.shift(),v=p+o.shift(),m=f+o.shift(),g=v+o.shift(),d=m+o.shift(),p=g+o.shift(),t.U.P.curveTo(a,f,v,m,g,d,p),P+=6;"o24"==E&&(d+=o.shift(),p+=o.shift(),t.U.P.lineTo(a,d,p))}else{if("o11"==E)break;if("o1234"==E||"o1235"==E||"o1236"==E||"o1237"==E)"o1234"==E&&(v=p,m=(f=d+o.shift())+o.shift(),S=g=v+o.shift(),y=g,b=p,d=(x=(_=(w=m+o.shift())+o.shift())+o.shift())+o.shift(),t.U.P.curveTo(a,f,v,m,g,w,S),t.U.P.curveTo(a,_,y,x,b,d,p)),"o1235"==E&&(f=d+o.shift(),v=p+o.shift(),m=f+o.shift(),g=v+o.shift(),w=m+o.shift(),S=g+o.shift(),_=w+o.shift(),y=S+o.shift(),x=_+o.shift(),b=y+o.shift(),d=x+o.shift(),p=b+o.shift(),o.shift(),t.U.P.curveTo(a,f,v,m,g,w,S),t.U.P.curveTo(a,_,y,x,b,d,p)),"o1236"==E&&(f=d+o.shift(),v=p+o.shift(),m=f+o.shift(),S=g=v+o.shift(),y=g,x=(_=(w=m+o.shift())+o.shift())+o.shift(),b=y+o.shift(),d=x+o.shift(),t.U.P.curveTo(a,f,v,m,g,w,S),t.U.P.curveTo(a,_,y,x,b,d,p)),"o1237"==E&&(f=d+o.shift(),v=p+o.shift(),m=f+o.shift(),g=v+o.shift(),w=m+o.shift(),S=g+o.shift(),_=w+o.shift(),y=S+o.shift(),Math.abs((x=_+o.shift())-d)>Math.abs((b=y+o.shift())-p)?d=x+o.shift():p=b+o.shift(),t.U.P.curveTo(a,f,v,m,g,w,S),t.U.P.curveTo(a,_,y,x,b,d,p));else if("o14"==E){if(o.length>0&&!l&&(u=o.shift()+i.nominalWidthX,l=!0),4==o.length){var R=o.shift(),U=o.shift(),L=o.shift(),D=o.shift(),I=t.CFF.glyphBySE(i,L),N=t.CFF.glyphBySE(i,D);t.U._drawCFF(i.CharStrings[I],n,i,r,a),n.x=R,n.y=U,t.U._drawCFF(i.CharStrings[N],n,i,r,a)}c&&(t.U.P.closePath(a),c=!1)}else if("o19"==E||"o20"==E)o.length%2==0||l||(u=o.shift()+r.nominalWidthX),s+=o.length>>1,o.length=0,l=!0,h+=s+7>>3;else if("o21"==E)o.length>2&&!l&&(u=o.shift()+r.nominalWidthX,l=!0),p+=o.pop(),d+=o.pop(),c&&t.U.P.closePath(a),t.U.P.moveTo(a,d,p),c=!0;else if("o22"==E)o.length>1&&!l&&(u=o.shift()+r.nominalWidthX,l=!0),d+=o.pop(),c&&t.U.P.closePath(a),t.U.P.moveTo(a,d,p),c=!0;else if("o25"==E){for(;o.length>6;)d+=o.shift(),p+=o.shift(),t.U.P.lineTo(a,d,p);f=d+o.shift(),v=p+o.shift(),m=f+o.shift(),g=v+o.shift(),d=m+o.shift(),p=g+o.shift(),t.U.P.curveTo(a,f,v,m,g,d,p)}else if("o26"==E)for(o.length%2&&(d+=o.shift());o.length>0;)f=d,v=p+o.shift(),d=m=f+o.shift(),p=(g=v+o.shift())+o.shift(),t.U.P.curveTo(a,f,v,m,g,d,p);else if("o27"==E)for(o.length%2&&(p+=o.shift());o.length>0;)v=p,m=(f=d+o.shift())+o.shift(),g=v+o.shift(),d=m+o.shift(),p=g,t.U.P.curveTo(a,f,v,m,g,d,p);else if("o10"==E||"o29"==E){var O="o10"==E?r:i;if(0==o.length);else{var F=o.pop(),B=O.Subrs[F+O.Bias];n.x=d,n.y=p,n.nStems=s,n.haveWidth=l,n.width=u,n.open=c,t.U._drawCFF(B,n,i,r,a),d=n.x,p=n.y,s=n.nStems,l=n.haveWidth,u=n.width,c=n.open}}else if("o30"==E||"o31"==E){var V=o.length,z=(P=0,"o31"==E);for(P+=V-(T=-3&V);P<T;)z?(v=p,m=(f=d+o.shift())+o.shift(),p=(g=v+o.shift())+o.shift(),T-P==5?(d=m+o.shift(),P++):d=m,z=!1):(f=d,v=p+o.shift(),m=f+o.shift(),g=v+o.shift(),d=m+o.shift(),T-P==5?(p=g+o.shift(),P++):p=g,z=!0),t.U.P.curveTo(a,f,v,m,g,d,p),P+=4}else{if("o"==(E+"").charAt(0))throw E;o.push(E)}}}n.x=d,n.y=p,n.nStems=s,n.haveWidth=l,n.width=u,n.open=c},n=t,e.Typr=n,e.default={Typr:n},Object.defineProperty(e,"__esModule",{value:!0}),e).Typr},/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function(){return function(e){var t=Uint8Array,n=Uint16Array,i=Uint32Array,r=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=function(e,t){for(var r=new n(31),a=0;a<31;++a)r[a]=t+=1<<e[a-1];var o=new i(r[30]);for(a=1;a<30;++a)for(var s=r[a];s<r[a+1];++s)o[s]=s-r[a]<<5|a;return[r,o]},l=s(r,2),u=l[0],c=l[1];u[28]=258,c[258]=28;for(var h=s(a,0)[0],d=new n(32768),p=0;p<32768;++p){var f=(43690&p)>>>1|(21845&p)<<1;f=(61680&(f=(52428&f)>>>2|(13107&f)<<2))>>>4|(3855&f)<<4,d[p]=((65280&f)>>>8|(255&f)<<8)>>>1}var v=function(e,t,i){for(var r=e.length,a=0,o=new n(t);a<r;++a)++o[e[a]-1];var s,l=new n(t);for(a=0;a<t;++a)l[a]=l[a-1]+o[a-1]<<1;if(i){s=new n(1<<t);var u=15-t;for(a=0;a<r;++a)if(e[a])for(var c=a<<4|e[a],h=t-e[a],p=l[e[a]-1]++<<h,f=p|(1<<h)-1;p<=f;++p)s[d[p]>>>u]=c}else for(s=new n(r),a=0;a<r;++a)e[a]&&(s[a]=d[l[e[a]-1]++]>>>15-e[a]);return s},m=new t(288);for(p=0;p<144;++p)m[p]=8;for(p=144;p<256;++p)m[p]=9;for(p=256;p<280;++p)m[p]=7;for(p=280;p<288;++p)m[p]=8;var g=new t(32);for(p=0;p<32;++p)g[p]=5;var _=v(m,9,1),y=v(g,5,1),x=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},b=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},w=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},S=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],M=function(e,t,n){var i=Error(t||S[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,M),!n)throw i;return i},E=function(e,s,l){var c,d,p,f,m=e.length;if(!m||l&&!l.l&&m<5)return s||new t(0);var g=!s||l,S=!l||l.i;l||(l={}),s||(s=new t(3*m));var E,T=function(e){var n=s.length;if(e>n){var i=new t(Math.max(2*n,e));i.set(s),s=i}},C=l.f||0,k=l.p||0,A=l.b||0,P=l.l,R=l.d,U=l.m,L=l.n,D=8*m;do{if(!P){l.f=C=b(e,k,1);var I=b(e,k+1,3);if(k+=3,!I){var N=e[(q=((E=k)/8|0)+(7&E&&1)+4)-4]|e[q-3]<<8,O=q+N;if(O>m){S&&M(0);break}g&&T(A+N),s.set(e.subarray(q,O),A),l.b=A+=N,l.p=k=8*O;continue}if(1==I)P=_,R=y,U=9,L=5;else if(2==I){var F=b(e,k,31)+257,B=b(e,k+10,15)+4,V=F+b(e,k+5,31)+1;k+=14;for(var z=new t(V),G=new t(19),H=0;H<B;++H)G[o[H]]=b(e,k+3*H,7);k+=3*B;var W=x(G),j=(1<<W)-1,X=v(G,W,1);for(H=0;H<V;){var q,Y=X[b(e,k,j)];if(k+=15&Y,(q=Y>>>4)<16)z[H++]=q;else{var K=0,Z=0;for(16==q?(Z=3+b(e,k,3),k+=2,K=z[H-1]):17==q?(Z=3+b(e,k,7),k+=3):18==q&&(Z=11+b(e,k,127),k+=7);Z--;)z[H++]=K}}var J=z.subarray(0,F),Q=z.subarray(F);U=x(J),L=x(Q),P=v(J,U,1),R=v(Q,L,1)}else M(1);if(k>D){S&&M(0);break}}g&&T(A+131072);for(var $=(1<<U)-1,ee=(1<<L)-1,et=k;;et=k){var en=(K=P[w(e,k)&$])>>>4;if((k+=15&K)>D){S&&M(0);break}if(K||M(2),en<256)s[A++]=en;else{if(256==en){et=k,P=null;break}var ei=en-254;if(en>264){var er=r[H=en-257];ei=b(e,k,(1<<er)-1)+u[H],k+=er}var ea=R[w(e,k)&ee],eo=ea>>>4;if(ea||M(3),k+=15&ea,Q=h[eo],eo>3&&(er=a[eo],Q+=w(e,k)&(1<<er)-1,k+=er),k>D){S&&M(0);break}g&&T(A+131072);for(var es=A+ei;A<es;A+=4)s[A]=s[A-Q],s[A+1]=s[A+1-Q],s[A+2]=s[A+2-Q],s[A+3]=s[A+3-Q];A=es}}l.l=P,l.p=et,l.b=A,P&&(C=1,l.m=U,l.d=R,l.n=L)}while(!C)return A==s.length?s:(c=s,(d=0)<0&&(d=0),(null==(p=A)||p>c.length)&&(p=c.length),(f=new(c instanceof n?n:c instanceof i?i:t)(p-d)).set(c.subarray(d,p)),f)},T=new t(0),C="undefined"!=typeof TextDecoder&&new TextDecoder;try{C.decode(T,{stream:!0})}catch(e){}return e.convert_streams=function(e){var t=new DataView(e),n=0;function i(){var e=t.getUint16(n);return n+=2,e}function r(){var e=t.getUint32(n);return n+=4,e}function a(e){g.setUint16(_,e),_+=2}function o(e){g.setUint32(_,e),_+=4}for(var s={signature:r(),flavor:r(),length:r(),numTables:i(),reserved:i(),totalSfntSize:r(),majorVersion:i(),minorVersion:i(),metaOffset:r(),metaLength:r(),metaOrigLength:r(),privOffset:r(),privLength:r()},l=0;Math.pow(2,l)<=s.numTables;)l++;l--;for(var u=16*Math.pow(2,l),c=16*s.numTables-u,h=12,d=[],p=0;p<s.numTables;p++)d.push({tag:r(),offset:r(),compLength:r(),origLength:r(),origChecksum:r()}),h+=16;var f,v=new Uint8Array(12+16*d.length+d.reduce(function(e,t){return e+t.origLength+4},0)),m=v.buffer,g=new DataView(m),_=0;return o(s.flavor),a(s.numTables),a(u),a(l),a(c),d.forEach(function(e){o(e.tag),o(e.origChecksum),o(h),o(e.origLength),e.outOffset=h,(h+=e.origLength)%4!=0&&(h+=4-h%4)}),d.forEach(function(t){var n=e.slice(t.offset,t.offset+t.compLength);if(t.compLength!=t.origLength){var i=new Uint8Array(t.origLength);E(new Uint8Array(n,2),i)}else i=new Uint8Array(n);v.set(i,t.outOffset);var r=0;(h=t.outOffset+t.origLength)%4!=0&&(r=4-h%4),v.set(new Uint8Array(r).buffer,t.outOffset+t.origLength),f=h+r}),m.slice(0,f)},Object.defineProperty(e,"__esModule",{value:!0}),e}({}).convert_streams},function(e,t){var n,i={M:2,L:2,Q:4,C:6,Z:0},r={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},a=[null,"isol","init","fina","medi"];function o(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=0;i<t.length;i++)if("number"==typeof t[i])return t[i]}return function(s){var l,u,c,h,d,p,f,v=new Uint8Array(s,0,4),m=e._bin.readASCII(v,0,4);if("wOFF"===m)s=t(s);else if("wOF2"===m)throw Error("woff2 fonts not supported");return l=e.parse(s)[0],u=Object.create(null),c=l["OS/2"],h=l.hhea,d=l.head.unitsPerEm,p=o(c&&c.sTypoAscender,h&&h.ascender,d),f={unitsPerEm:d,ascender:p,descender:o(c&&c.sTypoDescender,h&&h.descender,0),capHeight:o(c&&c.sCapHeight,p),xHeight:o(c&&c.sxHeight,p),lineGap:o(c&&c.sTypoLineGap,h&&h.lineGap),forEachGlyph:function(t,o,s,c){var h=0,d=1/f.unitsPerEm*o,p=function(t,i){for(var o=[],s=0;s<i.length;s++){var l=i.codePointAt(s);l>65535&&s++,o.push(e.U.codeToGlyph(t,l))}var u=t.GSUB;if(u){var c,h=u.lookupList,d=u.featureList,p=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,f=[];d.forEach(function(t){if(p.test(t.tag)){for(var s=0;s<t.tab.length;s++)if(!f[t.tab[s]]){f[t.tab[s]]=!0;var l=h[t.tab[s]],u=/^(isol|init|fina|medi)$/.test(t.tag);u&&!c&&(c=function(e){for(var t=new Uint8Array(e.length),i=32,a=1,o=-1,s=0;s<e.length;s++){var l=e.codePointAt(s),u=0|function(e){if(!n){var t=function(e){var t=0;r[e].split(",").forEach(function(r){var a=eb(r.split("+"),2),o=a[0],s=a[1];o=parseInt(o,36),s=s?parseInt(s,36):0,n.set(t+=o,i[e]);for(var l=s;l--;)n.set(++t,i[e])})},i={R:2,L:1,D:4,C:16,U:32,T:8};for(var a in n=new Map,r)t(a)}return n.get(e)||32}(l),c=1;!(8&u)&&(21&i?22&u?(c=3,(1===a||3===a)&&t[o]++):33&u&&(2===a||4===a)&&t[o]--:34&i&&(2===a||4===a)&&t[o]--,a=t[s]=c,i=u,o=s,l>65535&&s++)}return t}(i));for(var d=0;d<o.length;d++)c&&u&&a[c[d]]!==t.tag||e.U._applySubs(o,d,l,h)}}})}return o}(l,t),v=0,m=-1;return p.forEach(function(n,r){if(-1!==n){var a=u[n];if(!a){for(var p,f,g,_,y=e.U.glyphToPath(l,n),x=y.cmds,b=y.crds,w="",S=0,M=0,E=x.length;M<E;M++){var T=i[x[M]];w+=x[M];for(var C=1;C<=T;C++)w+=(C>1?",":"")+b[S++]}if(b.length){p=f=1/0,g=_=-1/0;for(var k=0,A=b.length;k<A;k+=2){var P=b[k],R=b[k+1];P<p&&(p=P),R<f&&(f=R),P>g&&(g=P),R>_&&(_=R)}}else p=g=f=_=0;a=u[n]={index:n,advanceWidth:l.hmtx.aWidth[n],xMin:p,yMin:f,xMax:g,yMax:_,path:w,pathCommandCount:x.length}}-1!==m&&(h+=e.U.getPairAdjustment(l,m,n)*d),c.call(null,a,h,v),a.advanceWidth&&(h+=a.advanceWidth*d),s&&(h+=s*o),m=n}v+=t.codePointAt(v)>65535?2:1}),h}}}}],init:function(e,t,n){return n(e(),t())}}),lr={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},la=new nf;function lo(){return(self.performance||Date).now()}var ls=Object.create(null);function ll(e,t,n){var i=e.path,r=e.atlasIndex,a=e.sdfViewBox,o=t.sdfGlyphSize,s=t.sdfCanvas;if(t.contextLost)return Promise.resolve({timing:-1});var l=lr.textureWidth,u=lr.sdfExponent,c=Math.max(a[2]-a[0],a[3]-a[1]),h=Math.floor(r/4),d=h%(l/o)*o,p=Math.floor(h/(l/o))*o;return function(e,t,n,i,r,a,o,s,l,u){var c=!(arguments.length>10)||void 0===arguments[10]||arguments[10];return c?s9(e,t,n,i,r,a,o,s,l,u).then(null,function(c){return _||(_=!0),lt(e,t,n,i,r,a,o,s,l,u)}):lt(e,t,n,i,r,a,o,s,l,u)}(o,o,i,a,c,u,s,d,p,r%4,n)}function lu(e){if("function"!=typeof createImageBitmap){var t=e.sdfCanvas,n=e.sdfTexture,i=t.width,r=t.height,a=e.sdfCanvas.getContext("webgl"),o=n.image.data;o&&o.length===i*r*4||(o=new Uint8Array(i*r*4),n.image={width:i,height:r,data:o},n.flipY=!1,n.isDataTexture=!0),a.readPixels(0,0,i,r,a.RGBA,a.UNSIGNED_BYTE,o)}}var lc=sV({name:"Typesetter",dependencies:[lr,li,function(e,t,n){var i=n.defaultFontURL,r=Object.create(null),a=1/0,o=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,s="[^\\S\\u00A0]",l=new RegExp("".concat(s,"|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]"));function u(t,n){t||(t=i);var a,o,s=r[t];s?s.pending?s.pending.push(n):n(s):(r[t]={pending:[n]},a=t,o=function(e){var n=r[t].pending;r[t]=e,n.forEach(function(t){return t(e)})},function t(){var n=function(e){a!==i&&(a=i,t())};try{var r=new XMLHttpRequest;r.open("get",a,!0),r.responseType="arraybuffer",r.onload=function(){if(r.status>=400)n(Error(r.statusText));else if(r.status>0)try{var t=e(r.response);o(t)}catch(e){n(e)}},r.onerror=n,r.send()}catch(e){n(e)}}())}function c(e,n){var r=e.text,c=void 0===r?"":r,v=e.font,m=(e.sdfGlyphSize,e.fontSize),g=void 0===m?1:m,_=e.letterSpacing,y=void 0===_?0:_,x=e.lineHeight,b=void 0===x?"normal":x,w=e.maxWidth,S=void 0===w?a:w,M=e.direction,E=e.textAlign,T=void 0===E?"left":E,C=e.textIndent,k=void 0===C?0:C,A=e.whiteSpace,P=void 0===A?"normal":A,R=e.overflowWrap,U=void 0===R?"normal":R,L=e.anchorX,D=void 0===L?0:L,I=e.anchorY,N=void 0===I?0:I,O=e.includeCaretPositions,F=void 0!==O&&O,B=e.chunkedBoundsSize,V=void 0===B?8192:B,z=e.colorRanges,G=void 0===z?null:z,H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],W=p(),j={fontLoad:0,typesetting:0};c.indexOf("\r")>-1&&(c=c.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),g*=1,y*=1,S*=1,b=b||"normal",k*=1,u(void 0===v?i:v,function(e){var i=isFinite(S),r=null,u=null,v=null,m=null,_=null,x=null,w=null,E=0,C=0,A="nowrap"!==P,R=e.ascender,L=e.descender,I=e.unitsPerEm,O=e.lineGap,B=e.capHeight,z=e.xHeight;j.fontLoad=p()-W;var X=p(),q=g/I;"normal"===b&&(b=(R-L+O)/I);var Y=((b*=g)-(R-L)*q)/2,K=-(R*q+Y),Z=Math.min(b,(R-L)*q),J=(R+L)/2*q-Z/2,Q=k,$=new f,ee=[$];e.forEachGlyph(c,g,y,function(e,t,n){var r,a=c.charAt(n),u=e.advanceWidth*q,h=$.count;if("isEmpty"in e||(e.isWhitespace=!!a&&new RegExp(s).test(a),e.canBreakAfter=!!a&&l.test(a),e.isEmpty=e.xMin===e.xMax||e.yMin===e.yMax||o.test(a)),!e.isWhitespace&&!e.isEmpty&&C++,A&&i&&!e.isWhitespace&&t+u+Q>S&&h){if($.glyphAt(h-1).glyphObj.canBreakAfter)r=new f,Q=-t;else for(var d=h;d--;){if(0===d&&"break-word"===U){r=new f,Q=-t;break}if($.glyphAt(d).glyphObj.canBreakAfter){var p=(r=$.splitAt(d+1)).glyphAt(0).x;Q-=p;for(var v=r.count;v--;)r.glyphAt(v).x-=p;break}}r&&($.isSoftWrapped=!0,$=r,ee.push($),E=S)}var m=$.glyphAt($.count);m.glyphObj=e,m.x=t+Q,m.width=u,m.charIndex=n,"\n"===a&&($=new f,ee.push($),Q=-(t+u+y*g)+k)}),ee.forEach(function(e){for(var t=e.count;t--;){var n=e.glyphAt(t),i=n.glyphObj,r=n.x,a=n.width;if(!i.isWhitespace){e.width=r+a,e.width>E&&(E=e.width);return}}});var et=0,en=0;if(D&&("number"==typeof D?et=-D:"string"==typeof D&&(et=-E*("left"===D?0:"center"===D?.5:"right"===D?1:h(D)))),N){if("number"==typeof N)en=-N;else if("string"==typeof N){var ei=ee.length*b;en="top"===N?0:"top-baseline"===N?-K:"top-cap"===N?-K-B*q:"top-ex"===N?-K-z*q:"middle"===N?ei/2:"bottom"===N?ei:"bottom-baseline"===N?ei-Y+L*q:h(N)*ei}}if(!H){var er,ea,eo=t.getEmbeddingLevels(c,M);r=new Uint16Array(C),u=new Float32Array(2*C),v={},x=[a,a,-a,-a],w=[];var es=K;F&&(_=new Float32Array(3*c.length)),G&&(m=new Uint8Array(3*C));var el=0,eu=-1,ec=-1;if(ee.forEach(function(n,i){var o=n.count,s=n.width;if(o>0){for(var l,h=0,p=o;p--&&n.glyphAt(p).glyphObj.isWhitespace;)h++;var f=0,g=0;if("center"===T)f=(E-s)/2;else if("right"===T)f=E-s;else if("justify"===T&&n.isSoftWrapped){for(var y=0,S=o-h;S--;)n.glyphAt(S).glyphObj.isWhitespace&&y++;g=(E-s)/y}if(g||f)for(var M=0,C=0;C<o;C++){var k=n.glyphAt(C),A=k.glyphObj;k.x+=f+M,0!==g&&A.isWhitespace&&C<o-h&&(M+=g,k.width+=g)}for(var P=t.getReorderSegments(c,eo,n.glyphAt(0).charIndex,n.glyphAt(n.count-1).charIndex),R=0;R<P.length;R++)for(var U=eb(P[R],2),L=U[0],D=U[1],I=1/0,N=-1/0,O=0;O<o;O++)if(n.glyphAt(O).charIndex>=L){for(var B=O,z=O;z<o;z++){var H=n.glyphAt(z);if(H.charIndex>D)break;z<o-h&&(I=Math.min(I,H.x),N=Math.max(N,H.x+H.width))}for(var W=B;W<z;W++){var j=n.glyphAt(W);j.x=N-(j.x+j.width-I)}break}for(var X=function(e){return l=e},Y=0;Y<o;Y++){var K=n.glyphAt(Y),Z=(l=K.glyphObj).index,Q=1&eo.levels[K.charIndex];if(Q){var $=t.getMirroredCharacter(c[K.charIndex]);$&&e.forEachGlyph($,0,0,X)}if(F){var ee=K.charIndex,ei=K.x+et,eh=K.x+K.width+et;_[3*ee]=Q?eh:ei,_[3*ee+1]=Q?ei:eh,_[3*ee+2]=es+J+en;var ed=ee-eu;ed>1&&d(_,eu,ed),eu=ee}if(G)for(var ep=K.charIndex;ep>ec;)ec++,G.hasOwnProperty(ec)&&(ea=G[ec]);if(!l.isWhitespace&&!l.isEmpty){var ef=el++;v[Z]||(v[Z]={path:l.path,pathBounds:[l.xMin,l.yMin,l.xMax,l.yMax]});var ev=K.x+et,em=es+en;u[2*ef]=ev,u[2*ef+1]=em;var eg=ev+l.xMin*q,e_=em+l.yMin*q,ey=ev+l.xMax*q,ex=em+l.yMax*q;eg<x[0]&&(x[0]=eg),e_<x[1]&&(x[1]=e_),ey>x[2]&&(x[2]=ey),ex>x[3]&&(x[3]=ex),ef%V==0&&(er={start:ef,end:ef,rect:[a,a,-a,-a]},w.push(er)),er.end++;var ew=er.rect;if(eg<ew[0]&&(ew[0]=eg),e_<ew[1]&&(ew[1]=e_),ey>ew[2]&&(ew[2]=ey),ex>ew[3]&&(ew[3]=ex),r[ef]=Z,G){var eS=3*ef;m[eS]=ea>>16&255,m[eS+1]=ea>>8&255,m[eS+2]=255&ea}}}}es-=b}),_){var eh=c.length-eu;eh>1&&d(_,eu,eh)}}j.typesetting=p()-X,n({glyphIds:r,glyphPositions:u,glyphData:v,caretPositions:_,caretHeight:Z,glyphColors:m,chunkedBounds:w,fontSize:g,unitsPerEm:I,ascender:R*q,descender:L*q,capHeight:B*q,xHeight:z*q,lineHeight:b,topBaseline:K,blockBounds:[et,en-ee.length*b,et+E,en],visibleBounds:x,timings:j})})}function h(e){var t=e.match(/^([\d.]+)%$/),n=t?parseFloat(t[1]):NaN;return isNaN(n)?0:n/100}function d(e,t,n){for(var i=e[3*t],r=e[3*t+1],a=e[3*t+2],o=(r-i)/n,s=0;s<n;s++){var l=(t+s)*3;e[l]=i+o*s,e[l+1]=i+o*(s+1),e[l+2]=a}}function p(){return(self.performance||Date).now()}function f(){this.data=[]}var v=["glyphObj","x","width","charIndex"];return f.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/v.length)},glyphAt:function(e){var t=f.flyweight;return t.data=this.data,t.index=e,t},splitAt:function(e){var t=new f;return t.data=this.data.splice(e*v.length),t}},f.flyweight=v.reduce(function(e,t,n,i){return Object.defineProperty(e,t,{get:function(){return this.data[this.index*v.length+n]},set:function(e){this.data[this.index*v.length+n]=e}}),e},{data:null,index:0}),{typeset:c,measure:function(e,t){c(e,function(e){var n=eb(e.blockBounds,4),i=n[0],r=n[1];t({width:n[2]-i,height:n[3]-r})},{metricsOnly:!0})},loadFont:u}},function(){return function(e){var t,n,i,r,a={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},o={},s={};o.L=1,s[1]="L",Object.keys(a).forEach(function(e,t){o[e]=1<<t+1,s[o[e]]=e}),Object.freeze(o);var l=o.LRI|o.RLI|o.FSI,u=o.L|o.R|o.AL,c=o.B|o.S|o.WS|o.ON|o.FSI|o.LRI|o.RLI|o.PDI,h=o.BN|o.RLE|o.LRE|o.RLO|o.LRO|o.PDF,d=o.S|o.WS|o.B|l|o.PDI|h,p=null;function f(e){return!function(){if(!p){p=new Map;var e=function(e){if(a.hasOwnProperty(e)){var t=0;a[e].split(",").forEach(function(n){var i=n.split("+"),r=i[0],a=i[1];r=parseInt(r,36),a=a?parseInt(a,36):0,p.set(t+=r,o[e]);for(var s=0;s<a;s++)p.set(++t,o[e])})}};for(var t in a)e(t)}}(),p.get(e.codePointAt(0))||o.L}var v={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function m(e,t){var n,i=0,r=new Map,a=t&&new Map;return e.split(",").forEach(function e(o){if(-1!==o.indexOf("+"))for(var s=+o;s--;)e(n);else{n=o;var l=o.split(">"),u=l[0],c=l[1];u=String.fromCodePoint(i+=parseInt(u,36)),c=String.fromCodePoint(i+=parseInt(c,36)),r.set(u,c),t&&a.set(c,u)}}),{map:r,reverseMap:a}}function g(){if(!t){var e=m(v.pairs,!0),r=e.map,a=e.reverseMap;t=r,n=a,i=m(v.canonical,!1).map}}function _(e){return g(),t.get(e)||null}function y(e){return g(),n.get(e)||null}function x(e){return g(),i.get(e)||null}var b=o.L,w=o.R,S=o.EN,M=o.ES,E=o.ET,T=o.AN,C=o.CS,k=o.B,A=o.S,P=o.ON,R=o.BN,U=o.NSM,L=o.AL,D=o.LRO,I=o.RLO,N=o.LRE,O=o.RLE,F=o.PDF,B=o.LRI,V=o.RLI,z=o.FSI,G=o.PDI;function H(e){return!function(){if(!r){var e=m("14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",!0),t=e.map;e.reverseMap.forEach(function(e,n){t.set(n,e)}),r=t}}(),r.get(e)||null}function W(e,t,n,i){var r=e.length;n=Math.max(0,null==n?0:+n),i=Math.min(r-1,null==i?r-1:+i);var a=[];return t.paragraphs.forEach(function(r){var o=Math.max(n,r.start),s=Math.min(i,r.end);if(o<s){for(var l=t.levels.slice(o,s+1),u=s;u>=o&&f(e[u])&d;u--)l[u]=r.level;for(var c=r.level,h=1/0,p=0;p<l.length;p++){var v=l[p];v>c&&(c=v),v<h&&(h=1|v)}for(var m=c;m>=h;m--)for(var g=0;g<l.length;g++)if(l[g]>=m){for(var _=g;g+1<l.length&&l[g+1]>=m;)g++;g>_&&a.push([_+o,g+o])}}}),a}function j(e,t,n,i){for(var r=W(e,t,n,i),a=[],o=0;o<e.length;o++)a[o]=o;return r.forEach(function(e){for(var t=e[0],n=e[1],i=a.slice(t,n+1),r=i.length;r--;)a[n-r]=i[r]}),a}return e.closingToOpeningBracket=y,e.getBidiCharType=f,e.getBidiCharTypeName=function(e){return s[f(e)]},e.getCanonicalBracket=x,e.getEmbeddingLevels=function(e,t){for(var n=new Uint32Array(e.length),i=0;i<e.length;i++)n[i]=f(e[i]);var r=new Map;function a(e,t){var i=n[e];n[e]=t,r.set(i,r.get(i)-1),i&c&&r.set(c,r.get(c)-1),r.set(t,(r.get(t)||0)+1),t&c&&r.set(c,(r.get(c)||0)+1)}for(var o=new Uint8Array(e.length),s=new Map,p=[],v=null,m=0;m<e.length;m++)v||p.push(v={start:m,end:e.length-1,level:"rtl"===t?1:"ltr"===t?0:tP(m,!1)}),n[m]&k&&(v.end=m,v=null);for(var g=O|N|I|D|l|G|F|k,H=function(e){return e+(1&e?1:2)},W=function(e){return e+(1&e?2:1)},j=0;j<p.length;j++){var X=[{_level:(v=p[j]).level,_override:0,_isolate:0}],q=void 0,Y=0,K=0,Z=0;r.clear();for(var J=v.start;J<=v.end;J++){var Q=n[J];if(q=X[X.length-1],r.set(Q,(r.get(Q)||0)+1),Q&c&&r.set(c,(r.get(c)||0)+1),Q&g){if(Q&(O|N)){o[J]=q._level;var $=(Q===O?W:H)(q._level);!($<=125)||Y||K?!Y&&K++:X.push({_level:$,_override:0,_isolate:0})}else if(Q&(I|D)){o[J]=q._level;var ee=(Q===I?W:H)(q._level);!(ee<=125)||Y||K?!Y&&K++:X.push({_level:ee,_override:Q&I?w:b,_isolate:0})}else if(Q&l){Q&z&&(Q=1===tP(J+1,!0)?V:B),o[J]=q._level,q._override&&a(J,q._override);var et=(Q===V?W:H)(q._level);et<=125&&0===Y&&0===K?(Z++,X.push({_level:et,_override:0,_isolate:1,_isolInitIndex:J})):Y++}else if(Q&G){if(Y>0)Y--;else if(Z>0){for(K=0;!X[X.length-1]._isolate;)X.pop();var en=X[X.length-1]._isolInitIndex;null!=en&&(s.set(en,J),s.set(J,en)),X.pop(),Z--}q=X[X.length-1],o[J]=q._level,q._override&&a(J,q._override)}else Q&F?(0===Y&&(K>0?K--:!q._isolate&&X.length>1&&(X.pop(),q=X[X.length-1])),o[J]=q._level):Q&k&&(o[J]=v.level)}else o[J]=q._level,q._override&&Q!==R&&a(J,q._override)}for(var ei=[],er=null,ea=v.start;ea<=v.end;ea++){var eo=n[ea];if(!(eo&h)){var es=o[ea],el=eo&l,eu=eo===G;er&&es===er._level?(er._end=ea,er._endsWithIsolInit=el):ei.push(er={_start:ea,_end:ea,_level:es,_startsWithPDI:eu,_endsWithIsolInit:el})}}for(var ec=[],eh=0;eh<ei.length;eh++){var ed=ei[eh];if(!ed._startsWithPDI||ed._startsWithPDI&&!s.has(ed._start)){for(var ep=[er=ed],ef=void 0;er&&er._endsWithIsolInit&&null!=(ef=s.get(er._end));)for(var ev=eh+1;ev<ei.length;ev++)if(ei[ev]._start===ef){ep.push(er=ei[ev]);break}for(var em=[],eg=0;eg<ep.length;eg++)for(var e_=ep[eg],ey=e_._start;ey<=e_._end;ey++)em.push(ey);for(var ex=o[em[0]],eb=v.level,ew=em[0]-1;ew>=0;ew--)if(!(n[ew]&h)){eb=o[ew];break}var eS=em[em.length-1],eM=o[eS],eE=v.level;if(!(n[eS]&l)){for(var eT=eS+1;eT<=v.end;eT++)if(!(n[eT]&h)){eE=o[eT];break}}ec.push({_seqIndices:em,_sosType:Math.max(eb,ex)%2?w:b,_eosType:Math.max(eE,eM)%2?w:b})}}for(var eC=0;eC<ec.length;eC++){var ek=ec[eC],eA=ek._seqIndices,eP=ek._sosType,eR=ek._eosType,eU=1&o[eA[0]]?w:b;if(r.get(U))for(var eL=0;eL<eA.length;eL++){var eD=eA[eL];if(n[eD]&U){for(var eI=eP,eN=eL-1;eN>=0;eN--)if(!(n[eA[eN]]&h)){eI=n[eA[eN]];break}a(eD,eI&(l|G)?P:eI)}}if(r.get(S))for(var eO=0;eO<eA.length;eO++){var eF=eA[eO];if(n[eF]&S)for(var eB=eO-1;eB>=-1;eB--){var eV=-1===eB?eP:n[eA[eB]];if(eV&u){eV===L&&a(eF,T);break}}}if(r.get(L))for(var ez=0;ez<eA.length;ez++){var eG=eA[ez];n[eG]&L&&a(eG,w)}if(r.get(M)||r.get(C))for(var eH=1;eH<eA.length-1;eH++){var eW=eA[eH];if(n[eW]&(M|C)){for(var ej=0,eX=0,eq=eH-1;eq>=0&&(ej=n[eA[eq]])&h;eq--);for(var eY=eH+1;eY<eA.length&&(eX=n[eA[eY]])&h;eY++);ej===eX&&(n[eW]===M?ej===S:ej&(S|T))&&a(eW,ej)}}if(r.get(S)){for(var eK=0;eK<eA.length;eK++)if(n[eA[eK]]&S){for(var eZ=eK-1;eZ>=0&&n[eA[eZ]]&(E|h);eZ--)a(eA[eZ],S);for(eK++;eK<eA.length&&n[eA[eK]]&(E|h|S);eK++)n[eA[eK]]!==S&&a(eA[eK],S)}}if(r.get(E)||r.get(M)||r.get(C))for(var eJ=0;eJ<eA.length;eJ++){var eQ=eA[eJ];if(n[eQ]&(E|M|C)){a(eQ,P);for(var e$=eJ-1;e$>=0&&n[eA[e$]]&h;e$--)a(eA[e$],P);for(var e0=eJ+1;e0<eA.length&&n[eA[e0]]&h;e0++)a(eA[e0],P)}}if(r.get(S))for(var e1=0,e2=eP;e1<eA.length;e1++){var e3=eA[e1],e4=n[e3];e4&S?e2===b&&a(e3,b):e4&u&&(e2=e4)}if(r.get(c)){for(var e5=w|S|T,e6=e5|b,e8=[],e9=[],e7=0;e7<eA.length;e7++)if(n[eA[e7]]&c){var te=e[eA[e7]],tt=void 0;if(null!==_(te)){if(e9.length<63)e9.push({char:te,seqIndex:e7});else break}else if(null!==(tt=y(te)))for(var tn=e9.length-1;tn>=0;tn--){var ti=e9[tn].char;if(ti===tt||ti===y(x(te))||_(x(ti))===te){e8.push([e9[tn].seqIndex,e7]),e9.length=tn;break}}}e8.sort(function(e,t){return e[0]-t[0]});for(var tr=0;tr<e8.length;tr++){for(var ta=e8[tr],to=ta[0],ts=ta[1],tl=!1,tu=0,tc=to+1;tc<ts;tc++){var th=eA[tc];if(n[th]&e6){tl=!0;var td=n[th]&e5?w:b;if(td===eU){tu=td;break}}}if(tl&&!tu){tu=eP;for(var tp=to-1;tp>=0;tp--){var tf=eA[tp];if(n[tf]&e6){var tv=n[tf]&e5?w:b;tu=tv!==eU?tv:eU;break}}}if(tu){if(n[eA[to]]=n[eA[ts]]=tu,tu!==eU){for(var tm=to+1;tm<eA.length;tm++)if(!(n[eA[tm]]&h)){f(e[eA[tm]])&U&&(n[eA[tm]]=tu);break}}if(tu!==eU){for(var tg=ts+1;tg<eA.length;tg++)if(!(n[eA[tg]]&h)){f(e[eA[tg]])&U&&(n[eA[tg]]=tu);break}}}}for(var t_=0;t_<eA.length;t_++)if(n[eA[t_]]&c){for(var ty=t_,tx=t_,tb=eP,tw=t_-1;tw>=0;tw--)if(n[eA[tw]]&h)ty=tw;else{tb=n[eA[tw]]&e5?w:b;break}for(var tS=eR,tM=t_+1;tM<eA.length;tM++)if(n[eA[tM]]&(c|h))tx=tM;else{tS=n[eA[tM]]&e5?w:b;break}for(var tE=ty;tE<=tx;tE++)n[eA[tE]]=tb===tS?tb:eU;t_=tx}}}for(var tT=v.start;tT<=v.end;tT++){var tC=o[tT],tk=n[tT];if(1&tC?tk&(b|S|T)&&o[tT]++:tk&w?o[tT]++:tk&(T|S)&&(o[tT]+=2),tk&h&&(o[tT]=0===tT?v.level:o[tT-1]),tT===v.end||f(e[tT])&(A|k))for(var tA=tT;tA>=0&&f(e[tA])&d;tA--)o[tA]=v.level}}return{levels:o,paragraphs:p};function tP(t,i){for(var r=t;r<e.length;r++){var a=n[r];if(a&(w|L))return 1;if(a&(k|b)||i&&a===G)break;if(a&l){var o=function(t){for(var i=1,r=t+1;r<e.length;r++){var a=n[r];if(a&k)break;if(a&G){if(0==--i)return r}else a&l&&i++}return -1}(r);r=-1===o?e.length:o}}return 0}},e.getMirroredCharacter=H,e.getMirroredCharactersMap=function(e,t,n,i){var r=e.length;n=Math.max(0,null==n?0:+n),i=Math.min(r-1,null==i?r-1:+i);for(var a=new Map,o=n;o<=i;o++)if(1&t[o]){var s=H(e[o]);null!==s&&a.set(o,s)}return a},e.getReorderSegments=W,e.getReorderedIndices=j,e.getReorderedString=function(e,t,n,i){var r=j(e,t,n,i),a=[].concat(e);return r.forEach(function(n,i){a[i]=(1&t.levels[n]?H(e[n]):null)||e[n]}),a.join("")},e.openingToClosingBracket=_,Object.defineProperty(e,"__esModule",{value:!0}),e}({})}],init:function(e,t,n,i){var r=e.defaultFontURL;return n(t,i(),{defaultFontURL:r})}}),lh=sV({name:"Typesetter",dependencies:[lc],init:function(e){return function(t){return new Promise(function(n){e.typeset(t,n)})}},getTransferables:function(e){var t=[e.glyphPositions.buffer,e.glyphIds.buffer];return e.caretPositions&&t.push(e.caretPositions.buffer),e.glyphColors&&t.push(e.glyphColors.buffer),t}}),ld={},lp="aTroikaGlyphIndex",lf=function(t){function i(){var t;return e(this,i),(t=ev(this,i)).detail=1,t.curveRadius=0,t.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],t.boundingSphere=new tS,t.boundingBox=new ta,t}return e_(i,t),n(i,[{key:"computeBoundingSphere",value:function(){}},{key:"computeBoundingBox",value:function(){}},{key:"setSide",value:function(e){var t=this.getIndex().count;this.setDrawRange(1===e?t/2:0,2===e?t:t/2)}},{key:"detail",get:function(){return this._detail},set:function(e){var t=this;if(e!==this._detail){this._detail=e,("number"!=typeof e||e<1)&&(e=1);var n=function(e){var t=ld[e];if(!t){for(var n=new rd(1,1,e,e),i=n.clone(),r=n.attributes,a=i.attributes,o=new nL,s=r.uv.count,l=0;l<s;l++)a.position.array[3*l]*=-1,a.normal.array[3*l+2]*=-1;["position","normal","uv"].forEach(function(e){o.setAttribute(e,new nE(ew(r[e].array).concat(ew(a[e].array)),r[e].itemSize))}),o.setIndex(ew(n.index.array).concat(ew(i.index.array.map(function(e){return e+s})))),o.translate(.5,.5,0),t=ld[e]=o}return t}(e);["position","normal","uv"].forEach(function(e){t.attributes[e]=n.attributes[e].clone()}),this.setIndex(n.getIndex().clone())}}},{key:"curveRadius",get:function(){return this._curveRadius},set:function(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}},{key:"updateGlyphs",value:function(e,t,n,i,r){lv(this,"aTroikaGlyphBounds",e,4),lv(this,lp,t,1),lv(this,"aTroikaGlyphColor",r,3),this._blockBounds=n,this._chunkedBounds=i,this.instanceCount=t.length,this._updateBounds()}},{key:"_updateBounds",value:function(){var e=this._blockBounds;if(e){var t=this.curveRadius,n=this.boundingBox;if(t){var i=Math.PI,r=Math.floor,a=Math.min,o=Math.max,s=Math.sin,l=Math.cos,u=i/2,c=2*i,h=Math.abs(t),d=e[0]/h,p=e[2]/h,f=r((d+u)/c)!==r((p+u)/c)?-h:a(s(d)*h,s(p)*h),v=r((d-u)/c)!==r((p-u)/c)?h:o(s(d)*h,s(p)*h),m=r((d+i)/c)!==r((p+i)/c)?2*h:o(h-l(d)*h,h-l(p)*h);n.min.set(f,e[1],t<0?-m:0),n.max.set(v,e[3],t<0?0:m)}else n.min.set(e[0],e[1],0),n.max.set(e[2],e[3],0);n.getBoundingSphere(this.boundingSphere)}}},{key:"applyClipRect",value:function(e){var t=this.getAttribute(lp).count,n=this._chunkedBounds;if(n)for(var i=n.length;i--;){t=n[i].end;var r=n[i].rect;if(r[1]<e.w&&r[3]>e.y&&r[0]<e.z&&r[2]>e.x)break}this.instanceCount=t}}]),i}(rz);function lv(e,t,n,i){var r=e.getAttribute(t);n?r&&r.array.length===n.length?(r.array.set(n),r.needsUpdate=!0):(e.setAttribute(t,new io(n,i)),delete e._maxInstanceCount,e.dispose()):r&&e.deleteAttribute(t)}var lm=new n_({color:0xffffff,side:2,transparent:!0}),lg=new tU,l_=new tn,ly=new tn,lx=[],lb=new tn,lw="+x+y";function lS(e){return Array.isArray(e)?e[0]:e}var lM=function(){var e=new nj(new rd(1,1),lm);return lM=function(){return e},e},lE=function(){var e=new nj(new rd(1,1,32,1),lm);return lE=function(){return e},e},lT={type:"syncstart"},lC={type:"synccomplete"},lk=["font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],lA=lk.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail"),lP=function(t){function i(){var t;return e(this,i),(t=ev(this,i,[new lf,null])).text="",t.anchorX=0,t.anchorY=0,t.curveRadius=0,t.direction="auto",t.font=null,t.fontSize=.1,t.letterSpacing=0,t.lineHeight="normal",t.maxWidth=1/0,t.overflowWrap="normal",t.textAlign="left",t.textIndent=0,t.whiteSpace="normal",t.material=null,t.color=null,t.colorRanges=null,t.outlineWidth=0,t.outlineColor=0,t.outlineOpacity=1,t.outlineBlur=0,t.outlineOffsetX=0,t.outlineOffsetY=0,t.strokeWidth=0,t.strokeColor=8421504,t.strokeOpacity=1,t.fillOpacity=1,t.depthOffset=0,t.clipRect=null,t.orientation=lw,t.glyphGeometryDetail=1,t.sdfGlyphSize=null,t.gpuAccelerateSDF=!0,t.debugSDF=!1,t}return e_(i,t),n(i,[{key:"sync",value:function(e){var t=this;this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(lT),function(e,t){e=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}({},e);var n=lo();if(e.font=(h=e.font||lr.defaultFontURL,y||(y="undefined"==typeof document?{}:document.createElement("a")),y.href=h,y.href),e.text=""+e.text,e.sdfGlyphSize=e.sdfGlyphSize||lr.sdfGlyphSize,null!=e.colorRanges){var i={};for(var r in e.colorRanges)if(e.colorRanges.hasOwnProperty(r)){var a=e.colorRanges[r];"number"!=typeof a&&(a=la.set(a).getHex()),i[r]=a}e.colorRanges=i}Object.freeze(e);var o=lr.textureWidth,s=lr.sdfExponent,l=e.sdfGlyphSize,u=o/l*4,c=ls[l];if(!c){var h,d,p,f=document.createElement("canvas");f.width=o,f.height=256*l/u,(c=ls[l]={glyphCount:0,sdfGlyphSize:l,sdfCanvas:f,sdfTexture:new e6(f,void 0,void 0,void 0,1006,1006),contextLost:!1,glyphsByFont:new Map}).sdfTexture.generateMipmaps=!1,(p=(d=c).sdfCanvas).addEventListener("webglcontextlost",function(e){e.preventDefault(),d.contextLost=!0}),p.addEventListener("webglcontextrestored",function(e){d.contextLost=!1;var t=[];d.glyphsByFont.forEach(function(e){e.forEach(function(e){t.push(ll(e,d,!0))})}),Promise.all(t).then(function(){lu(d),d.sdfTexture.needsUpdate=!0})})}var v=c.sdfTexture,m=c.sdfCanvas,g=c.glyphsByFont.get(e.font);g||c.glyphsByFont.set(e.font,g=new Map),lh(e).then(function(i){var r=i.glyphIds,a=i.glyphPositions,h=i.fontSize,d=i.unitsPerEm,p=i.timings,f=[],_=new Float32Array(4*r.length),y=h/d,x=0,b=0,w=lo();r.forEach(function(e,t){var n=g.get(e);if(!n){var o=i.glyphData[e],s=o.path,u=o.pathBounds,h=Math.max(u[2]-u[0],u[3]-u[1])/l*(lr.sdfMargin*l+.5),d=c.glyphCount++,p=[u[0]-h,u[1]-h,u[2]+h,u[3]+h];g.set(e,n={path:s,atlasIndex:d,sdfViewBox:p}),f.push(n)}var v=n.sdfViewBox,m=a[b++],w=a[b++];_[x++]=m+v[0]*y,_[x++]=w+v[1]*y,_[x++]=m+v[2]*y,_[x++]=w+v[3]*y,r[t]=n.atlasIndex}),p.quads=(p.quads||0)+(lo()-w);var S=lo();p.sdf={};var M=m.height,E=Math.pow(2,Math.ceil(Math.log2(Math.ceil(c.glyphCount/u)*l)));E>M&&(ln(m,o,E),v.dispose()),Promise.all(f.map(function(t){return ll(t,c,e.gpuAccelerateSDF).then(function(e){var n=e.timing;p.sdf[t.atlasIndex]=n})})).then(function(){f.length&&!c.contextLost&&(lu(c),v.needsUpdate=!0),p.sdfTotal=lo()-S,p.total=lo()-n,t(Object.freeze({parameters:e,sdfTexture:v,sdfGlyphSize:l,sdfExponent:s,glyphBounds:_,glyphAtlasIndices:r,glyphColors:i.glyphColors,caretPositions:i.caretPositions,caretHeight:i.caretHeight,chunkedBounds:i.chunkedBounds,ascender:i.ascender,descender:i.descender,lineHeight:i.lineHeight,capHeight:i.capHeight,xHeight:i.xHeight,topBaseline:i.topBaseline,blockBounds:i.blockBounds,visibleBounds:i.visibleBounds,timings:i.timings}))})}),Promise.resolve().then(function(){if(!c.contextLost)m._warm||(s4.webgl.isSupported(m),m._warm=!0)})}({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF},function(n){t._isSyncing=!1,t._textRenderInfo=n,t.geometry.updateGlyphs(n.glyphBounds,n.glyphAtlasIndices,n.blockBounds,n.chunkedBounds,n.glyphColors);var i=t._queuedSyncs;i&&(t._queuedSyncs=null,t._needsSync=!0,t.sync(function(){i.forEach(function(e){return e&&e()})})),t.dispatchEvent(lC),e&&e()})))}},{key:"onBeforeRender",value:function(e,t,n,i,r,a){this.sync(),r.isTroikaTextMaterial&&this._prepareForRender(r),r._hadOwnSide=r.hasOwnProperty("side"),this.geometry.setSide(r._actualSide=r.side),r.side=0}},{key:"onAfterRender",value:function(e,t,n,i,r,a){r._hadOwnSide?r.side=r._actualSide:delete r.side}},{key:"dispose",value:function(){this.geometry.dispose()}},{key:"textRenderInfo",get:function(){return this._textRenderInfo||null}},{key:"material",get:function(){var e,t=this._derivedMaterial,n=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=lm.clone());if((!t||t.baseMaterial!==n)&&(t=this._derivedMaterial=((e=function e(t,n){var i,r,a=(i=JSON.stringify(n,s0),null==(r=s2.get(i))&&s2.set(i,r=++s1),r),o=sZ.get(t);if(o||sZ.set(t,o=Object.create(null)),o[a])return new o[a];var s="_onBeforeCompile".concat(a),l=function(e,i){t.onBeforeCompile.call(this,e,i);var r=this.customProgramCacheKey()+"|"+e.vertexShader+"|"+e.fragmentShader,o=sJ[r];if(!o){var l=function(e,t,n,i){var r=t.vertexShader,a=t.fragmentShader,o=n.vertexDefs,s=n.vertexMainIntro,l=n.vertexMainOutro,u=n.vertexTransform,c=n.fragmentDefs,h=n.fragmentMainIntro,d=n.fragmentMainOutro,p=n.fragmentColorTransform,f=n.customRewriter,v=n.timeUniform;if(o=o||"",s=s||"",l=l||"",c=c||"",h=h||"",d=d||"",(u||f)&&(r=sj(r)),(p||f)&&(a=sj(a=a.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n"))),f){var m=f({vertexShader:r,fragmentShader:a});r=m.vertexShader,a=m.fragmentShader}if(p){var g=[];a=a.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,function(e){return g.push(e),""}),d="".concat(p,"\n").concat(g.join("\n"),"\n").concat(d)}if(v){var _="\nuniform float ".concat(v,";\n");o=_+o,c=_+c}return u&&(r="vec3 troika_position_".concat(i,";\nvec3 troika_normal_").concat(i,";\nvec2 troika_uv_").concat(i,";\n").concat(r,"\n"),o="".concat(o,"\nvoid troikaVertexTransform").concat(i,"(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  ").concat(u,"\n}\n"),s="\ntroika_position_".concat(i," = vec3(position);\ntroika_normal_").concat(i," = vec3(normal);\ntroika_uv_").concat(i," = vec2(uv);\ntroikaVertexTransform").concat(i,"(troika_position_").concat(i,", troika_normal_").concat(i,", troika_uv_").concat(i,");\n").concat(s,"\n"),r=r.replace(/\b(position|normal|uv)\b/g,function(e,t,n,r){return/\battribute\s+vec[23]\s+$/.test(r.substr(0,n))?t:"troika_".concat(t,"_").concat(i)}),e.map&&e.map.channel>0||(r=r.replace(/\bMAP_UV\b/g,"troika_uv_".concat(i)))),{vertexShader:r=s$(r,i,o,s,l),fragmentShader:a=s$(a,i,c,h,d)}}(this,e,n,a);o=sJ[r]=l}e.vertexShader=o.vertexShader,e.fragmentShader=o.fragmentShader,sY(e.uniforms,this.uniforms),n.timeUniform&&(e.uniforms[n.timeUniform]={get value(){return Date.now()-sK}}),this[s]&&this[s](e)},u=function(){return c(n.chained?t:t.clone())},c=function(e){var i,r,o,s,l=Object.create(e,h);return Object.defineProperty(l,"baseMaterial",{value:t}),Object.defineProperty(l,"id",{value:sQ++}),l.uuid=(i=0xffffffff*Math.random()|0,r=0xffffffff*Math.random()|0,o=0xffffffff*Math.random()|0,s=0xffffffff*Math.random()|0,(sX[255&i]+sX[i>>8&255]+sX[i>>16&255]+sX[i>>24&255]+"-"+sX[255&r]+sX[r>>8&255]+"-"+sX[r>>16&15|64]+sX[r>>24&255]+"-"+sX[63&o|128]+sX[o>>8&255]+"-"+sX[o>>16&255]+sX[o>>24&255]+sX[255&s]+sX[s>>8&255]+sX[s>>16&255]+sX[s>>24&255]).toUpperCase()),l.uniforms=sY({},e.uniforms,n.uniforms),l.defines=sY({},e.defines,n.defines),l.defines["TROIKA_DERIVED_MATERIAL_".concat(a)]="",l.extensions=sY({},e.extensions,n.extensions),l._listeners=void 0,l},h={constructor:{value:u},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return t.customProgramCacheKey()+"|"+a}},onBeforeCompile:{get:function(){return l},set:function(e){this[s]=e}},copy:{writable:!0,configurable:!0,value:function(e){return t.copy.call(this,e),t.isShaderMaterial||t.isDerivedMaterial||(sY(this.extensions,e.extensions),sY(this.defines,e.defines),sY(this.uniforms,nJ.clone(e.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){return c(new t.constructor).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){var i=this._depthMaterial;return i||((i=this._depthMaterial=e(t.isDerivedMaterial?t.getDepthMaterial():new rf({depthPacking:3201}),n)).defines.IS_DEPTH_MATERIAL="",i.uniforms=this.uniforms),i}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){var i=this._distanceMaterial;return i||((i=this._distanceMaterial=e(t.isDerivedMaterial?t.getDistanceMaterial():new rv,n)).defines.IS_DISTANCE_MATERIAL="",i.uniforms=this.uniforms),i}},dispose:{writable:!0,configurable:!0,value:function(){var e=this._depthMaterial,n=this._distanceMaterial;e&&e.dispose(),n&&n.dispose(),t.dispose.call(this)}}};return o[a]=u,new u}(n,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new eG},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new e8(0,0,0,0)},uTroikaClipRect:{value:new e8(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new eG},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new nf},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new eH},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaOutlineOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",customRewriter:function(e){var t=e.vertexShader,n=e.fragmentShader,i=/\buniform\s+vec3\s+diffuse\b/;return i.test(n)&&(n=n.replace(i,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),i.test(t)||(t=t.replace(sW,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:t,fragmentShader:n}}})).transparent=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get:function(){return this.side},set:function(){}}}),e),n.addEventListener("dispose",function e(){n.removeEventListener("dispose",e),t.dispose()})),!this.outlineWidth&&!this.outlineBlur&&!this.outlineOffsetX&&!this.outlineOffsetY)return t;var i=t._outlineMtl;return i||((i=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}})).isTextOutlineMaterial=!0,i.depthWrite=!1,i.map=null,t.addEventListener("dispose",function e(){t.removeEventListener("dispose",e),i.dispose()})),[i,t]},set:function(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}},{key:"glyphGeometryDetail",get:function(){return this.geometry.detail},set:function(e){this.geometry.detail=e}},{key:"curveRadius",get:function(){return this.geometry.curveRadius},set:function(e){this.geometry.curveRadius=e}},{key:"customDepthMaterial",get:function(){return lS(this.material).getDepthMaterial()}},{key:"customDistanceMaterial",get:function(){return lS(this.material).getDistanceMaterial()}},{key:"_prepareForRender",value:function(e){var t=e.isTextOutlineMaterial,n=e.uniforms,i=this.textRenderInfo;if(i){var r,a,o,s=i.sdfTexture,l=i.blockBounds;n.uTroikaSDFTexture.value=s,n.uTroikaSDFTextureSize.value.set(s.image.width,s.image.height),n.uTroikaSDFGlyphSize.value=i.sdfGlyphSize,n.uTroikaSDFExponent.value=i.sdfExponent,n.uTroikaTotalBounds.value.fromArray(l),n.uTroikaUseGlyphColors.value=!t&&!!i.glyphColors;var u=0,c=0,h=0,d=0,p=0;if(t){var f=this.outlineWidth,v=this.outlineOffsetX,m=this.outlineOffsetY,g=this.outlineBlur,_=this.outlineOpacity;u=this._parsePercent(f)||0,c=Math.max(0,this._parsePercent(g)||0),r=_,d=this._parsePercent(v)||0,p=this._parsePercent(m)||0}else(h=Math.max(0,this._parsePercent(this.strokeWidth)||0))&&(o=this.strokeColor,n.uTroikaStrokeColor.value.set(null==o?8421504:o),null==(a=this.strokeOpacity)&&(a=1)),r=this.fillOpacity;n.uTroikaDistanceOffset.value=u,n.uTroikaPositionOffset.value.set(d,p),n.uTroikaBlurRadius.value=c,n.uTroikaStrokeWidth.value=h,n.uTroikaStrokeOpacity.value=a,n.uTroikaFillOpacity.value=null==r?1:r,n.uTroikaCurveRadius.value=this.curveRadius||0;var y=this.clipRect;if(y&&Array.isArray(y)&&4===y.length)n.uTroikaClipRect.value.fromArray(y);else{var x=100*(this.fontSize||.1);n.uTroikaClipRect.value.set(l[0]-x,l[1]-x,l[2]+x,l[3]+x)}this.geometry.applyClipRect(n.uTroikaClipRect.value)}n.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;var b=t?this.outlineColor||0:this.color;if(null==b)delete e.color;else{var w=e.hasOwnProperty("color")?e.color:e.color=new nf;(b!==w._input||(void 0===b?"undefined":eu(b))==="object")&&w.set(w._input=b)}var S=this.orientation||lw;if(S!==e._orientation){var M=n.uTroikaOrient.value,E=(S=S.replace(/[^-+xyz]/g,""))!==lw&&S.match(/^([-+])([xyz])([-+])([xyz])$/);if(E){var T=eb(E,5),C=T[1],k=T[2],A=T[3],P=T[4];l_.set(0,0,0)[k]="-"===C?1:-1,ly.set(0,0,0)[P]="-"===A?-1:1,lg.lookAt(lb,l_.cross(ly),ly),M.setFromMatrix4(lg)}else M.identity();e._orientation=S}}},{key:"_parsePercent",value:function(e){if("string"==typeof e){var t=e.match(/^(-?[\d.]+)%$/),n=t?parseFloat(t[1]):NaN;e=(isNaN(n)?0:n/100)*this.fontSize}return e}},{key:"localPositionToTextCoords",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new eG;t.copy(e);var n=this.curveRadius;return n&&(t.x=Math.atan2(e.x,Math.abs(n)-Math.abs(e.z))*Math.abs(n)),t}},{key:"worldPositionToTextCoords",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new eG;return l_.copy(e),this.localPositionToTextCoords(this.worldToLocal(l_),t)}},{key:"raycast",value:function(e,t){var n=this.textRenderInfo,i=this.curveRadius;if(n){for(var r=n.blockBounds,a=i?lE():lM(),o=a.geometry,s=o.attributes,l=s.position,u=s.uv,c=0;c<u.count;c++){var h=r[0]+u.getX(c)*(r[2]-r[0]),d=r[1]+u.getY(c)*(r[3]-r[1]),p=0;i&&(p=i-Math.cos(h/i)*i,h=Math.sin(h/i)*i),l.setXYZ(c,h,d,p)}o.boundingSphere=this.geometry.boundingSphere,o.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,lx.length=0,a.raycast(e,lx);for(var f=0;f<lx.length;f++)lx[f].object=this,t.push(lx[f])}}},{key:"copy",value:function(e){var t=this,n=this.geometry;return em(ep(i.prototype),"copy",this).call(this,e),this.geometry=n,lA.forEach(function(n){t[n]=e[n]}),this}},{key:"clone",value:function(){return new this.constructor().copy(this)}}]),i}(nj);lk.forEach(function(e){var t="_private_"+e;Object.defineProperty(lP.prototype,e,{get:function(){return this[t]},set:function(e){e!==this[t]&&(this[t]=e,this._needsSync=!0)}})}),new WeakMap,new WeakMap;var lR=function(){function t(n){var i;e(this,t),this._charts=new Map,this._width=400,this._height=110,this._backgroundOpacity=.7,this._perf=n.perf,this._backgroundOpacity=null!=(i=n.backgroundOpacity)?i:this._backgroundOpacity,this.wrapper=document.createElement("div"),this.wrapper.id="three-perf-ui",this.wrapper.style.position="fixed",this.wrapper.style.bottom="0",this.wrapper.style.left="0",this.wrapper.style.width=this._width+"px",this.wrapper.style.height=this._height+"px",n.domElement.appendChild(this.wrapper),this.canvas=document.createElement("canvas"),this.canvas.width=this._width,this.canvas.height=this._height,this.canvas.style.position="absolute",this.wrapper.appendChild(this.canvas),this.initCanvas()}return n(t,[{key:"setScale",value:function(e){this.wrapper.style.width=e*this.width+"px",this.wrapper.style.height=e*this.height+"px",this._renderer.setSize(this._width*e,this._height*e,!0)}},{key:"initCanvas",value:function(){this._renderer=new st({canvas:this.canvas,antialias:!0,alpha:!0}),this._renderer.setClearColor(0,this._backgroundOpacity),this._renderer.setPixelRatio(window.devicePixelRatio),this._scene=new ie,this._camera=new rV(0,this._width,0,-this._height,.1,100),this._camera.position.set(0,0,10),this._camera.lookAt(0,0,0),this._camera.updateProjectionMatrix(),this._scene.add(this._camera),this._scene.userData.useStats=!1;var e=new lP;e.anchorX="right",e.position.set(45,-8,0),e.text="0.000",e.fontSize=15,e.color="rgb(253, 151, 31)",e.sync(),this._scene.add(e);var t=new lP;t.anchorX="right",t.position.set(65,-7,0),t.text="ms",t.fontSize=9,t.color="rgb(255, 255, 255)",t.sync(),this._scene.add(t);var n=new lP;n.anchorX="right",n.position.set(65,-22,0),n.text="GPU",n.fontSize=9,n.color="rgb(253, 151, 31)",n.sync(),this._scene.add(n);var i=new lP;i.anchorX="right",i.position.set(115,-8,0),i.text="0.000",i.fontSize=15,i.color="rgb(66, 226, 46)",i.sync(),this._scene.add(i);var r=new lP;r.anchorX="right",r.position.set(135,-7,0),r.text="ms",r.fontSize=9,r.color="rgb(255, 255, 255)",r.sync(),this._scene.add(r);var a=new lP;a.anchorX="right",a.position.set(135,-22,0),a.text="CPU",a.fontSize=9,a.color="rgb(66, 226, 46)",a.sync(),this._scene.add(a);var o=new lP;o.anchorX="center",o.position.set(165,-8,0),o.text="0",o.fontSize=15,o.color="rgb(238, 38, 110)",o.sync(),this._scene.add(o);var s=new lP;s.anchorX="center",s.position.set(175,-22,0),s.text="FPS",s.fontSize=9,s.color="rgb(238, 38, 110)",s.sync(),this._scene.add(s);var l=new lP;l.anchorX="right",l.position.set(235,-8,0),l.text="0",l.fontSize=15,l.color="#ffffff",l.sync(),this._scene.add(l);var u=new lP;u.anchorX="right",u.position.set(235,-22,0),u.text="calls",u.fontSize=9,u.color="rgb(101, 197, 188)",u.sync(),this._scene.add(u);var c=new lP;c.anchorX="right",c.position.set(315,-8,0),c.text="0",c.fontSize=15,c.color="#ffffff",c.sync(),this._scene.add(c);var h=new lP;h.anchorX="right",h.position.set(315,-22,0),h.text="triangles",h.fontSize=9,h.color="rgb(101, 197, 188)",h.sync(),this._scene.add(h);var d=new lP;d.anchorX="right",d.position.set(365,-8,0),d.text="0",d.fontSize=15,d.color="#ffffff",d.sync(),this._scene.add(d);var p=new lP;p.anchorX="right",p.position.set(365,-22,0),p.text="passes",p.fontSize=9,p.color="rgb(101, 197, 188)",p.sync(),this._scene.add(p),this._basicInfoElements={gpuValue:e,cpuValue:i,fpsValue:o,callsValue:l,trianglesValue:c,renderpassesValue:d};var f=new lP;f.anchorX="right",f.position.set(65,-39,0),f.text="0",f.fontSize=15,f.color="#ffffff",f.sync(),this._scene.add(f);var v=new lP;v.anchorX="right",v.position.set(65,-53,0),v.text="geometries",v.fontSize=9,v.color="rgb(101, 197, 188)",v.sync(),this._scene.add(v);var m=new lP;m.anchorX="right",m.position.set(135,-39,0),m.text="0",m.fontSize=15,m.color="#ffffff",m.sync(),this._scene.add(m);var g=new lP;g.anchorX="right",g.position.set(135,-53,0),g.text="textures",g.fontSize=9,g.color="rgb(101, 197, 188)",g.sync(),this._scene.add(g);var _=new lP;_.anchorX="right",_.position.set(205,-39,0),_.text="0",_.fontSize=15,_.color="#ffffff",_.sync(),this._scene.add(_);var y=new lP;y.anchorX="right",y.position.set(205,-53,0),y.text="shaders",y.fontSize=9,y.color="rgb(101, 197, 188)",y.sync(),this._scene.add(y);var x=new lP;x.anchorX="right",x.position.set(275,-39,0),x.text="0",x.fontSize=15,x.color="#ffffff",x.sync(),this._scene.add(x);var b=new lP;b.anchorX="right",b.position.set(275,-53,0),b.text="lines",b.fontSize=9,b.color="rgb(101, 197, 188)",b.sync(),this._scene.add(b);var w=new lP;w.anchorX="right",w.position.set(345,-39,0),w.text="0",w.fontSize=15,w.color="#ffffff",w.sync(),this._scene.add(w);var S=new lP;S.anchorX="right",S.position.set(345,-53,0),S.text="points",S.fontSize=9,S.color="rgb(101, 197, 188)",S.sync(),this._scene.add(S),this._memInfoElements={geometriesValue:f,geometriesLabel:v,texturesValue:m,texturesLabel:g,shadersValue:_,shadersLabel:y,linesValue:x,linesLabel:b,pointsValue:w,pointsLabel:S};for(var M=new nL,E=new Float32Array(180),T=0;T<60;T++)E[3*T+0]=this._width/59*T,E[3*T+1]=-110,E[3*T+2]=0;var C=new nw(E,3);C.usage=35048,M.setAttribute("position",C);var k=new iM(M,new im({color:"rgb(253, 151, 31)"}));this._scene.add(k),this._charts.set("gpu",k);var A=new nL;E=new Float32Array(180);for(var P=0;P<60;P++)E[3*P+0]=this._width/59*P,E[3*P+1]=-110,E[3*P+2]=0;(C=new nw(E,3)).usage=35048,A.setAttribute("position",C);var R=new iM(A,new im({color:"rgb(66, 226, 46)"}));this._scene.add(R),this._charts.set("cpu",R);var U=new nL;E=new Float32Array(180);for(var L=0;L<60;L++)E[3*L+0]=this._width/59*L,E[3*L+1]=-110,E[3*L+2]=0;(C=new nw(E,3)).usage=35048,U.setAttribute("position",C);var D=new iM(U,new im({color:"rgb(238, 38, 110)"}));this._scene.add(D),this._charts.set("fps",D)}},{key:"update",value:function(){var e,t;if(this._perf.chart&&this._perf.showGraph)for(var n in this._perf.chart.data){var i=this._perf.chart.data[n];if(this._charts.get(n)&&i){for(var r=this._charts.get(n).geometry.attributes.position,a=0,o=0;o<i.length;o++)i[o]>a&&(a=i[o]);a=Math.max(a,20);for(var s=0;s<i.length;s++){var l=(this._perf.chart.circularId+s+1)%60;r.setY(s,(i[l]/a*90-110)*this.height/110)}r.needsUpdate=!0}}this._basicInfoElements.gpuValue.text=this._perf.log.gpu.toFixed(3),this._basicInfoElements.cpuValue.text=this._perf.log.cpu.toFixed(3),this._basicInfoElements.fpsValue.text=this._perf.log.fps.toFixed(0),this._basicInfoElements.callsValue.text=this._perf.threeRenderer.info.render.calls.toString(),this._basicInfoElements.trianglesValue.text=this._perf.threeRenderer.info.render.triangles.toString(),this._basicInfoElements.renderpassesValue.text=this._perf.renderPassesNumber.toString(),this._memInfoElements.geometriesValue.text=this._perf.threeRenderer.info.memory.geometries.toString(),this._memInfoElements.texturesValue.text=this._perf.threeRenderer.info.memory.textures.toString(),this._memInfoElements.shadersValue.text=null!=(t=null==(e=this._perf.threeRenderer.info.programs)?void 0:e.length.toString())?t:"",this._memInfoElements.linesValue.text=this._perf.threeRenderer.info.render.lines.toString(),this._memInfoElements.pointsValue.text=this._perf.threeRenderer.info.render.points.toString(),this.render()}},{key:"render",value:function(){this._renderer.render(this._scene,this._camera)}},{key:"dispose",value:function(){this.wrapper.remove()}},{key:"toggleVisibility",value:function(e){this.wrapper.style.display=e?"block":"none"}},{key:"toggleCharts",value:function(e){this._charts.forEach(function(t){t.visible=e}),this._perf.showGraph?this.height=this._perf.memory?110:70:this.height=this._perf.memory?70:40,this.wrapper.style.height=this._perf.scale*this.height+"px"}},{key:"toggleMemoryInfo",value:function(e){for(var t in this._memInfoElements)this._memInfoElements[t].visible=e;this.width=380,this._perf.showGraph?this.height=this._perf.memory?110:70:this.height=this._perf.memory?70:40,this.wrapper.style.width=this._perf.scale*this.width+"px",this.wrapper.style.height=this._perf.scale*this.height+"px"}},{key:"setBackgroundOpacity",value:function(e){this._backgroundOpacity=e,this._renderer.setClearColor(0,this._backgroundOpacity),this.render()}},{key:"width",get:function(){return this._width},set:function(e){this._width=e,this._camera.right=e,this._camera.updateProjectionMatrix(),this._renderer.setSize(this._perf.scale*this._width,this._perf.scale*this._height),this.render()}},{key:"height",get:function(){return this._height},set:function(e){this._height=e,this._camera.bottom=-e,this._camera.updateProjectionMatrix(),this._renderer.setSize(this._perf.scale*this._width,this._perf.scale*this._height),this.render()}}]),t}(),lU={value:0,fpsLimit:60,isOverLimit:0},lL=function(e){return(null==e?void 0:e.reduce(function(e,t){return e+t},0))/e.length},lD=function(){function t(n){var i=this;e(this,t),this.names=[""],this.finished=[],this.paused=!1,this.overClock=!1,this.queryHasResult=!1,this.queryCreated=!1,this.isWebGL2=!0,this.memAccums=[],this.gpuAccums=[],this.activeAccums=[],this.logsAccums={mem:[],gpu:[],cpu:[],fps:[],fpsFixed:[]},this.fpsChart=[],this.gpuChart=[],this.cpuChart=[],this.memChart=[],this.paramLogger=function(){},this.glFinish=function(){},this.chartLogger=function(){},this.chartLen=60,this.logsPerSecond=10,this.maxMemory=1500,this.chartHz=10,this.startCpuProfiling=!1,this.lastCalculateFixed=0,this.chartFrame=0,this.gpuTimeProcess=0,this.chartTime=0,this.activeQueries=0,this.circularId=0,this.detected=0,this.frameId=0,this.rafId=0,this.idleCbId=0,this.checkQueryId=0,this.uuid=void 0,this.currentCpu=0,this.currentMem=0,this.paramFrame=0,this.paramTime=0,this.now=function(){},this.t0=0,this.nextFps=function(e){var t=1e3/60-e.timeRemaining(),n=1e3/60*lU.fpsLimit/10/t;!(n<0)&&(lU.value=n,lU.isOverLimit<25?lU.isOverLimit++:i.perf.overclockingFps=!0)},this.nextFrame=function(e){i.frameId++;var t=e||i.now(),n=t-i.paramTime,r=0;if(i.frameId<=1)i.paramFrame=i.frameId,i.paramTime=t;else if(t>=i.paramTime){i.maxMemory=window.performance.memory?window.performance.memory.jsHeapSizeLimit/1048576:0;var a=i.frameId-i.paramFrame,o=1e3*a/n,s=i.perf.overclockingFps?lU.value:o;if(r=i.isWebGL2?i.gpuAccums[0]:i.gpuAccums[0]/n,i.isWebGL2?i.gpuAccums[0]=0:Promise.all(i.finished).then(function(){i.gpuAccums[0]=0,i.finished=[]}),i.currentMem=Math.round(window.performance&&window.performance.memory?window.performance.memory.usedJSHeapSize/1048576:0),window.performance&&i.startCpuProfiling){window.performance.mark("cpu-finished");var l=performance.measure("cpu-duration","cpu-started","cpu-finished");i.currentCpu=l.duration,i.logsAccums.cpu.push(i.currentCpu),i.startCpuProfiling=!1}i.logsAccums.mem.push(i.currentMem),i.logsAccums.fpsFixed.push(o),i.logsAccums.fps.push(s),i.logsAccums.gpu.push(r),i.overClock&&void 0!==window.requestIdleCallback&&(lU.isOverLimit>0&&s>o?lU.isOverLimit--:i.perf.overclockingFps&&(i.perf.overclockingFps=!1)),t>=i.paramTime+1e3/i.logsPerSecond&&(i.paramLogger({cpu:lL(i.logsAccums.cpu),gpu:lL(i.logsAccums.gpu),mem:lL(i.logsAccums.mem),fps:lL(i.logsAccums.fps),duration:Math.round(n),maxMemory:i.maxMemory,frameCount:a}),i.logsAccums.mem=[],i.logsAccums.fps=[],i.logsAccums.gpu=[],i.logsAccums.cpu=[],i.paramFrame=i.frameId,i.paramTime=t),i.overClock&&t-i.lastCalculateFixed>=2e3&&(i.lastCalculateFixed=e,lU.fpsLimit=100*Math.round(lL(i.logsAccums.fpsFixed)/10),i.perf.fpsLimit=lU.fpsLimit/10,i.logsAccums.fpsFixed=[],i.paramFrame=i.frameId,i.paramTime=t)}if(i.detected&&i.chartFrame)for(var u=t-i.chartTime,c=i.chartHz*u/1e3;--c>0&&i.detected;){var h=(i.frameId-i.chartFrame)/u*1e3,d=i.perf.overclockingFps?lU.value:h;i.fpsChart[i.circularId%i.chartLen]=d;var p=1e3/i.currentMem,f=i.currentCpu,v=(i.isWebGL2?2*i.gpuAccums[1]:Math.round(i.gpuAccums[1]/n*100))+4;v>0&&(i.gpuChart[i.circularId%i.chartLen]=v),f>0&&(i.cpuChart[i.circularId%i.chartLen]=f),p>0&&(i.memChart[i.circularId%i.chartLen]=p);for(var m=0;m<i.names.length;m++)i.chartLogger({i:m,data:{fps:i.fpsChart,gpu:i.gpuChart,cpu:i.cpuChart,mem:i.memChart},circularId:i.circularId});i.circularId++,i.chartFrame=i.frameId,i.chartTime=t}else i.chartFrame=i.frameId,i.chartTime=t,i.circularId=0},this.perf=n.perf,this.trackGPU=n.trackGPU,this.overClock=n.overClock,this.logsPerSecond=n.logsPerSecond,this.gl=n.gl,this.paramLogger=n.paramLogger,this.chartLogger=n.chartLogger,window.GLPerf=window.GLPerf||{},this.fpsChart=Array(this.chartLen).fill(0),this.gpuChart=Array(this.chartLen).fill(0),this.cpuChart=Array(this.chartLen).fill(0),this.memChart=Array(this.chartLen).fill(0),this.now=function(){return window.performance&&window.performance.now?window.performance.now():Date.now()},this.initGpu(),this.is120hz()}return n(t,[{key:"initGpu",value:function(){this.uuid=ez(),this.gl&&(this.isWebGL2=!0,this.extension||(this.extension=this.gl.getExtension("EXT_disjoint_timer_query_webgl2")),null===this.extension&&(this.isWebGL2=!1))}},{key:"is120hz",value:function(){var e=this,t=0,n=function(i){++t<20?e.rafId=window.requestAnimationFrame(n):(e.detected=Math.ceil(1e3*t/(i-e.t0)/70),window.cancelAnimationFrame(e.rafId)),e.t0||(e.t0=i)};this.rafId=window.requestAnimationFrame(n)}},{key:"addUI",value:function(e){-1===this.names.indexOf(e)&&(this.names.push(e),this.gpuAccums.push(0),this.activeAccums.push(!1))}},{key:"startGpu",value:function(){var e=this,t=this.gl,n=this.extension;if(t&&n&&this.isWebGL2){var i,r=!1;if(this.query){this.queryHasResult=!1;var a=this.query;if(r=t.getQueryParameter(a,t.QUERY_RESULT_AVAILABLE),i=t.getParameter(n.GPU_DISJOINT_EXT),r&&!i){var o=1e-6*t.getQueryParameter(this.query,t.QUERY_RESULT);(r||i)&&(t.deleteQuery(this.query),a=null),r&&o>0&&!i&&this.activeAccums.forEach(function(t,n){e.gpuAccums[n]=o})}}(r||!this.query)&&(this.queryCreated=!0,this.query=t.createQuery(),t.beginQuery(n.TIME_ELAPSED_EXT,this.query))}}},{key:"endGpu",value:function(){var e=this.extension,t=this.gl;this.isWebGL2&&this.queryCreated&&t.getQuery(e.TIME_ELAPSED_EXT,t.CURRENT_QUERY)&&t.endQuery(e.TIME_ELAPSED_EXT)}},{key:"begin",value:function(e){this.startGpu(),this.updateAccums(e)}},{key:"end",value:function(e){this.endGpu(),this.updateAccums(e)}},{key:"updateAccums",value:function(e){var t=this.names.indexOf(e);-1===t&&(t=this.names.length,this.addUI(e));var n=this.now();this.activeAccums[t]=!this.activeAccums[t],this.t0=n}}]),t}();t5.prototype.updateMatrixWorld,t5.prototype.updateWorldMatrix,t5.prototype.updateMatrix;var lI=["calls","triangles","points","lines"],lN=["gpu","cpu","mem","fps"],lO=function(){function t(n){var i,r,a,o,s,l,u,c,h,d,p,f,v=this;e(this,t),this.gui=new sy.Pane,this.accumulated={totalFrames:0,log:{i:0,maxMemory:0,gpu:0,mem:0,cpu:0,fps:0,duration:0,frameCount:0},gl:{calls:0,triangles:0,points:0,lines:0,counts:0},max:{log:{i:0,maxMemory:0,gpu:0,mem:0,cpu:0,fps:0,duration:0,frameCount:0},gl:{calls:0,triangles:0,points:0,lines:0,counts:0}}},this.renderPassesNumber=0,this._keypressed="",this._guiVisible=!0,this.actionToCallUI="dev",this.keypressHandler=function(e){if(v.actionToCallUI){v._keypressed+=e.key;for(var t=v._keypressed.split("");t.length>v.actionToCallUI.length;)t.shift();t.join("")===v.actionToCallUI&&(v._keypressed="",v.guiVisible=!v.guiVisible)}},this.afterRender=function(){v._enabled&&(!v.perfEngine.paused&&(v.perfEngine.nextFrame(window.performance.now()),v.perfEngine.overClock&&void 0!==window.requestIdleCallback&&(v.perfEngine.idleCbId=requestIdleCallback(v.perfEngine.nextFps))),v.perfEngine&&v.perfEngine.end("profiler"),window.performance&&(window.performance.mark("cpu-started"),v.perfEngine.startCpuProfiling=!0),v.deepAnalyze)},this.deepAnalyze=null!=(i=n.deepAnalyze)&&i,this.threeRenderer=n.renderer,this.ui=new lR({perf:this,domElement:n.domElement,backgroundOpacity:n.backgroundOpacity}),this._visible=null==(r=n.visible)||r,this._enabled=null==(a=n.enabled)||a,this.scale=null!=(o=n.scale)?o:1,this.anchorX=null!=(s=n.anchorX)?s:"left",this.anchorY=null!=(l=n.anchorY)?l:"top",this.showGraph=null==(u=n.showGraph)||u,this.memory=null==(c=n.memory)||c,this.actionToCallUI=null!=(h=n.actionToCallUI)?h:"",this.guiVisible=null!=(d=n.guiVisible)&&d,this.gui.element.parentElement.style.width="300px",window.addEventListener("keypress",this.keypressHandler);var m=null==(p=n.overClock)||p;this.perfEngine=new lD({perf:this,trackGPU:!0,overClock:m,chartLen:120,chartHz:60,logsPerSecond:null!=(f=n.logsPerSecond)?f:10,gl:n.renderer.getContext(),chartLogger:function(e){v.chart=e},paramLogger:function(e){if(v._enabled){var t={maxMemory:e.maxMemory,gpu:e.gpu,cpu:e.cpu,mem:e.mem,fps:e.fps,totalTime:e.duration,frameCount:e.frameCount};v.log=t;var n=v.accumulated,i=v.threeRenderer.info.render;n.totalFrames++,n.gl.calls+=i.calls,n.gl.triangles+=i.triangles,n.gl.points+=i.points,n.gl.lines+=i.lines,n.log.gpu+=e.gpu,n.log.cpu+=e.cpu,n.log.mem+=e.mem,n.log.fps+=e.fps;for(var r=0;r<lI.length;r++){var a=lI[r],o=i[a];o>n.max.gl[a]&&(n.max.gl[a]=o)}for(var s=0;s<lN.length;s++){var l=lN[s],u=e[l];u>n.max.log[l]&&(n.max.log[l]=u)}v.accumulated=n,v.ui.update()}}});var g=n.renderer.getContext(),_=null,y=null,x=g.getExtension("WEBGL_debug_renderer_info"),b=g.getParameter(g.VERSION);null!=x&&(_=g.getParameter(x.UNMASKED_RENDERER_WEBGL),y=g.getParameter(x.UNMASKED_VENDOR_WEBGL)),y||(y="Unknown vendor"),_||(_=g.getParameter(g.RENDERER)),this.startTime=performance.now(),this.infos={version:b,renderer:_,vendor:y},this.rendererRender=this.threeRenderer.render,this.threeRenderer.info.autoReset=!1,this.threeRenderer.render=function(e,t){v.renderPassesNumber++,v.rendererRender.call(v.threeRenderer,e,t)},this.guiFolder=this.gui.addFolder({title:"Settings"});var w=this.guiFolder.addFolder({title:"ThreePerf"});w.addInput(this,"visible",{label:"Visible"}),w.addInput(this,"enabled",{label:"Enabled"}),w.addInput(this,"anchorX",{label:"xAnchor",options:{left:"left",right:"right"}}),w.addInput(this,"anchorY",{label:"yAnchor",options:{top:"top",bottom:"bottom"}}),w.addInput(this,"backgroundOpacity",{label:"Background opacity",min:0,max:1,step:.1}),w.addInput(this,"memory",{label:"Memory"}),w.addInput(this,"showGraph",{label:"Charts"}),w.addInput(this,"scale",{label:"Scale",min:.1,max:2,step:.1}),w.addInput(this,"logsPerSecond",{label:"LogsPerSecond",min:1,max:60,step:1})}return n(t,[{key:"begin",value:function(){this.perfEngine.begin("profiler")}},{key:"end",value:function(){this.afterRender(),this.renderPassesNumber=0,this.threeRenderer.info.reset()}},{key:"dispose",value:function(){var e;this.ui.dispose(),null==(e=this.gui.element.parentElement)||e.remove(),window.removeEventListener("keypress",this.keypressHandler)}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible=e,this.ui.toggleVisibility(e)}},{key:"guiVisible",get:function(){return this._guiVisible},set:function(e){this._guiVisible=e,this.gui.element.parentElement.style.display=e?"block":"none"}},{key:"anchorX",get:function(){return this._anchorX},set:function(e){this._anchorX=e,"left"===this._anchorX?(this.ui.wrapper.style.left="0",this.ui.wrapper.style.right=""):(this.ui.wrapper.style.left="",this.ui.wrapper.style.right="0")}},{key:"anchorY",get:function(){return this._anchorY},set:function(e){this._anchorY=e,"top"===this._anchorY?(this.ui.wrapper.style.top="0",this.ui.wrapper.style.bottom=""):(this.ui.wrapper.style.top="",this.ui.wrapper.style.bottom="0")}},{key:"showGraph",get:function(){return this._showGraph},set:function(e){this._showGraph=e,this.ui.toggleCharts(e)}},{key:"memory",get:function(){return this._memory},set:function(e){this._memory=e,this.ui.toggleMemoryInfo(e)}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale=e,this.ui.setScale(e)}},{key:"logsPerSecond",get:function(){return this.perfEngine.logsPerSecond},set:function(e){this.perfEngine.logsPerSecond=e}},{key:"backgroundOpacity",get:function(){return this.ui._backgroundOpacity},set:function(e){this.ui.setBackgroundOpacity(e)}}]),t}(),lF=new nQ({depthWrite:!1,transparent:!0,side:2,uniforms:{time:{value:1},opacity:{value:0},displacementScale:{value:1},combinedTexture:{value:new e6},isVertical:{value:0}},vertexShader:"\nuniform float displacementScale;\nuniform sampler2D combinedTexture;    \nuniform int isVertical;    \nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    \n    float displacement;\n\n    if( isVertical == 1 ) {\n        displacement = texture2D(combinedTexture, vec2( vUv.x / 2.0, vUv.y) ).x;\n    } else {\n        displacement = texture2D(combinedTexture, vec2( vUv.x, vUv.y / 2.0) ).x;\n\n    }\n\n    vec3 displacedPosition = vec3(position.x, position.y, position.z + displacement * displacementScale);\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(displacedPosition, 1.0);\n}\n    ",fragmentShader:"\nuniform float opacity;\nuniform float time;\nuniform sampler2D combinedTexture;\nuniform int isVertical;    \nvarying vec2 vUv;\n    \nvoid main() {\n    vec4 textureColor = vec4(0.0,0.0,0.0,0.0);\n\n    if( isVertical == 1 ) {\n        textureColor = texture2D(combinedTexture, vec2( vUv.x / 2.0, vUv.y));  \n    } else {\n        textureColor = texture2D(combinedTexture, vec2( vUv.x,  0.5 + vUv.y / 2.0));  \n    }\n    \n    gl_FragColor = vec4(textureColor.rgb, opacity );\n}\n    "});function lB(){return(lB=el(function(e){return ec(this,function(t){switch(t.label){case 0:if(!e)return[2,null];return[4,fetch(e,{method:"HEAD"})];case 1:return[2,t.sent().url]}})})).apply(this,arguments)}var lV=function(){function t(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,t),n&&(this.url=n,this.videoAttributes=i,this.videoElement=null)}return n(t,[{key:"build",value:function(){var e=this;return el(function(){return ec(this,function(t){var n;return[2,new Promise((n=el(function(t){return ec(this,function(n){switch(n.label){case 0:return[4,function(e){return lB.apply(this,arguments)}(e.url)];case 1:return e.url=n.sent(),e.videoElement=Object.assign(document.createElement("video"),r({crossOrigin:"anonymous",loop:!0,muted:!0,playsInline:!0},e.videoAttributes)),e.videoElement.addEventListener("canplay",function(){e.videoElement.play().then(function(){t()}).catch(function(e){t()})}),e.videoElement.src=e.url,[2]}})}),function(e){return n.apply(this,arguments)}))]})})()}},{key:"unbuild",value:function(){this.videoElement&&(this.videoElement.src=null,this.videoElement.load(),this.videoElement.remove(),this.videoElement=null)}},{key:"getVideoElement",value:function(){return null===this||void 0===this?void 0:this.videoElement}},{key:"destroy",value:function(){this.unbuild()}}]),t}(),lz=["alphaMap","map","aoMap","bumpMap","clearcoatMap","clearCoarNormalMap","clearcoatRoughnessMap","displacementMap","emissiveMap","envMap","iridescenceMap","iridescenceThicknessMap","lightMap","metalnessMap","normalMap","roughnessMap","sheenColorMap","sheenRoughnessMap","specularCOlorMap","specularIntensityMap","thicknessMap","transmissionMap"],lG={portrait:5,landscape:9},lH={x:0,y:0,z:0,scale:{x:3,y:3,z:3},opacity:0},lW={inputRotation:.005,transition:{position:.06,scale:.06,opacity:.06}},lj=function(){function t(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e(this,t),n&&(this.data=n,this.onLoaded=i,this.pointerPosition={x:0,y:0},this.video=null,this.texture=null,this.previewTexture=null,this.object=null,this.screen=null,this.seed=Math.random(),this.is={active:!1,loadingTexture:!1,loadingPreviewTexture:!1},this.groups={})}return n(t,[{key:"build",value:function(){var e,t=null===(e=this.data)||void 0===e?void 0:e.video,n=t.width,i=t.height;this.groups.object=new n8,this.groups.object.visible=!1,this.groups.transition=new n8,this.groups.transition.position.set(lH.x,lH.y,lH.z),this.groups.inputRotation=new n8,this.groups.autoRotation=new n8,this.groups.scale=new n8,this.groups.scale.scale.set(i>n?lG.portrait:lG.landscape,i>n?lG.portrait:lG.landscape,i>n?lG.portrait:lG.landscape);var r=lF.clone();r.uniforms.isVertical.value=i>n,r.uniforms.displacementScale.value=-.5,this.screen=new nj(new rd(1,1/(n/i),128,128),r),this.groups.object.add(this.groups.transition),this.groups.transition.add(this.groups.inputRotation),this.groups.inputRotation.add(this.groups.autoRotation),this.groups.autoRotation.add(this.groups.scale),this.groups.scale.add(this.screen)}},{key:"unbuild",value:function(){if(this.groups.object){var e;this.groups.object.removeFromParent(),(e=this.groups.object)&&(null==e?void 0:e.traverse)&&"function"==typeof e.traverse&&e.traverse(function(e){e instanceof nj&&((null==e?void 0:e.geometry)&&e.geometry.dispose(),(null==e?void 0:e.material)&&(lz.forEach(function(t){var n;(null===(n=e.material)||void 0===n?void 0:n[t])&&e.material[t].dispose()}),e.material.dispose()))}),this.unload(),this.groups.object=null,this.groups.transition=null,this.groups.inputRotation=null,this.groups.autoRotation=null,this.groups.scale=null,this.screen=null}}},{key:"load",value:function(){var e=this;return el(function(){var t,n,i,r;return ec(this,function(a){return e.texture||(i=(n=null===(t=e.data)||void 0===t?void 0:t.video).combined,(r=n.thumbnail)&&e.initPreviewTexture(r).then(function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).texture;if(e.texture||e.previewTexture){t&&t.dispose();return}e.previewTexture=t,e.applyTexture(e.previewTexture)}),i&&e.initTexture(i).then(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.video,i=t.texture;e.video?n&&n.destroy():e.video=n,e.texture?i&&i.dispose():e.texture=i,e.applyTexture(e.texture)})),[2]})})()}},{key:"unload",value:function(){this.texture&&this.texture.dispose(),this.previewTexture&&this.previewTexture.dispose(),this.video&&this.video.destroy(),this.texture=null,this.previewTexture=null,this.video=null}},{key:"show",value:function(){this.is.active=!0}},{key:"hide",value:function(){this.is.active=!1}},{key:"activate",value:function(){this.groups.object&&(this.groups.object.visible=!0)}},{key:"deactivate",value:function(){this.groups.object&&(this.groups.object.visible=!1)}},{key:"destroy",value:function(){this.unbuild()}},{key:"initTexture",value:function(e){var t=this;return el(function(){var n,i;return ec(this,function(r){switch(r.label){case 0:if(!e||t.video||t.texture||t.is.loadingTexture)return[2];return t.is.loadingTexture=!0,[4,(n=new lV(e)).build()];case 1:return r.sent(),(i=new iC(n.getVideoElement())).colorSpace=eE,i.minFilter=1006,i.magFilter=1006,t.is.loadingTexture=!1,[2,{video:n,texture:i}]}})})()}},{key:"initPreviewTexture",value:function(e){var t=this;return el(function(){var n;return ec(this,function(i){switch(i.label){case 0:if(!e||t.previewTexture||t.is.loadingPreviewTexture)return[2];return t.is.loadingPreviewTexture=!0,[4,new rU().loadAsync(e)];case 1:return n=i.sent(),t.is.loadingPreviewTexture=!1,[2,{texture:n}]}})})()}},{key:"applyTexture",value:function(e){e&&this.screen&&(this.screen.material.uniforms.combinedTexture.value.dispose(),this.screen.material.uniforms.combinedTexture.value=e,this.screen.material.needsUpdate=!0,this.is.loaded=!0,this.onLoaded())}},{key:"onFrame",value:function(e,t){if(this.groups.autoRotation&&(this.groups.autoRotation.rotation.x=.2*Math.sin(e),this.groups.autoRotation.rotation.y=.2*Math.sin(e+10*this.seed+12),this.groups.autoRotation.rotation.z=.2*Math.sin(e+10*this.seed+3)),this.groups.inputRotation&&(this.groups.inputRotation.rotation.y=ed(this.groups.inputRotation.rotation.y,.6*this.pointerPosition.x,lW.inputRotation/t),this.groups.inputRotation.rotation.x=ed(this.groups.inputRotation.rotation.x,-.6*this.pointerPosition.y,lW.inputRotation/t)),this.groups.transition&&(this.groups.transition.position.x=ed(this.groups.transition.position.x,this.is.active&&(this.is.loaded,1)?0:lH.x,lW.transition.scale/t),this.groups.transition.position.y=ed(this.groups.transition.position.y,this.is.active&&(this.is.loaded,1)?0:lH.y,lW.transition.scale/t),this.groups.transition.position.z=ed(this.groups.transition.position.z,this.is.active&&(this.is.loaded,1)?0:lH.z,lW.transition.scale/t),this.groups.transition.scale.set(ed(this.groups.transition.scale.x,this.is.active&&(this.is.loaded,1)?1:lH.scale.x,lW.transition.scale/t),ed(this.groups.transition.scale.y,this.is.active&&(this.is.loaded,1)?1:lH.scale.y,lW.transition.scale/t),ed(this.groups.transition.scale.z,this.is.active&&(this.is.loaded,1)?1:lH.scale.z,lW.transition.scale/t))),this.screen.material){var n,i;(null===(i=this.screen.material)||void 0===i?void 0:null===(n=i.uniforms)||void 0===n?void 0:n.opacity)?this.screen.material.uniforms.opacity.value=ed(this.screen.material.uniforms.opacity.value,this.is.active&&(this.is.loaded,1)?1:lH.opacity,lW.transition.opacity/t):this.screen.material.opacity=ed(this.screen.material.opacity,this.is.active&&(this.is.loaded,1)?1:lH.opacity,lW.transition.opacity/t)}}},{key:"getObject",value:function(){var e;return null===this||void 0===this?void 0:null===(e=this.groups)||void 0===e?void 0:e.object}},{key:"getTexture",value:function(){return null===this||void 0===this?void 0:this.texture}},{key:"setPointerPosition",value:function(e){e&&(this.pointerPosition.x=e.x,this.pointerPosition.y=e.y)}}]),t}(),lX=function(){function t(n,i){var r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};e(this,t),n&&(this.data=n,this.currentIndex=i,this.onLoaded=a,this.items=[],this.pointerPosition={x:0,y:0},this.is={debug:window.location.href.includes("?debug")},this.build(),this.resize(),this.currentIndex.on(function(){r.onCurrentIndexChange()}),this.onCurrentIndexChange())}return n(t,[{key:"build",value:function(){var e=this;return el(function(){return ec(this,function(t){if(e.clock=new rH,e.renderer=new st({antialias:!0,alpha:!0,precision:"highp"}),e.renderer.outputColorSpace=eE,e.renderer.domElement.setAttribute("data-STHVisual-role","canvas"),e.scene=new ie,e.camera=new n3(50,16/9,.1,1e3),e.camera.position.z=10,e.data.items){var n;e.data.items.forEach((n=el(function(t){var n;return ec(this,function(i){return(n=new lj(t,e.onLoaded)).build(),e.scene.add(n.getObject()),e.items.push(n),[2]})}),function(e){return n.apply(this,arguments)}))}return e.composer={},e.composer.composer=new sc(e.renderer),e.composer.renderPass=new sh(e.scene,e.camera),e.composer.composer.addPass(e.composer.renderPass),e.composer.afterimagePass=new sp,e.composer.composer.addPass(e.composer.afterimagePass),e.composer.outputPass=new s_,e.is.debug&&(e.monitor=new lO({anchorX:"left",anchorY:"top",domElement:document.body,renderer:e.renderer,scale:.6})),[2]})})()}},{key:"unbuild",value:function(){var e,t,n,i;this.items&&(this.items.forEach(function(e){return e.destroy()}),this.items=[]),this.renderer&&this.renderer.dispose(),(null===this||void 0===this?void 0:this.monitor)&&this.monitor.dispose(),(null===this||void 0===this?void 0:null===(e=this.composer)||void 0===e?void 0:e.composer)&&this.composer.composer.dispose(),(null===this||void 0===this?void 0:null===(t=this.composer)||void 0===t?void 0:t.afterimagePass)&&this.composer.afterimagePass.dispose(),(null===this||void 0===this?void 0:null===(n=this.composer)||void 0===n?void 0:n.renderPass)&&this.composer.renderPass.dispose(),(null===this||void 0===this?void 0:null===(i=this.composer)||void 0===i?void 0:i.outputPass)&&this.composer.outputPass.dispose()}},{key:"resize",value:function(e){if(e&&this.renderer){var t,n=eh(window.devicePixelRatio,1,2)*e.width,i=eh(window.devicePixelRatio,1,2)*e.height;this.renderer.setSize(n,i,!1),(null===this||void 0===this?void 0:null===(t=this.composer)||void 0===t?void 0:t.composer)&&this.composer.composer.setSize(n,n),this.camera.aspect=e.width/e.height,this.camera.updateProjectionMatrix()}}},{key:"start",value:function(){this.renderer&&(this.render=this.render.bind(this),this.renderer.setAnimationLoop(this.render),this.clock.start())}},{key:"stop",value:function(){this.renderer&&(this.renderer.setAnimationLoop(null),this.clock.stop())}},{key:"render",value:function(e){var t,n=this,i=1/60/this.clock.getDelta();this.items&&this.items.forEach(function(e){e.setPointerPosition(n.pointerPosition),e.onFrame(n.clock.getElapsedTime(),i)}),(null===this||void 0===this?void 0:this.monitor)&&this.monitor.begin(),(null===this||void 0===this?void 0:null===(t=this.composer)||void 0===t?void 0:t.composer)?(this.composer.afterimagePass.uniforms.damp.value=.98,this.composer.composer.render(i)):this.renderer.render(this.scene,this.camera),(null===this||void 0===this?void 0:this.monitor)&&this.monitor.end()}},{key:"destroy",value:function(){this.stop(),this.unbuild()}},{key:"setPointerPosition",value:function(e){e&&(this.pointerPosition.x=e.x,this.pointerPosition.y=e.y)}},{key:"getRendererElement",value:function(){if(this.renderer)return this.renderer.domElement}},{key:"onCurrentIndexChange",value:function(){if(null===(t=this.items)||void 0===t?void 0:t.length){var e,t,n=this;this.items.forEach((e=el(function(e,t){return ec(this,function(i){switch(i.label){case 0:if(!(1>=Math.abs(n.currentIndex.get()-t)||1>=Math.abs(n.currentIndex.get()+n.items.length-t)))return[3,2];return n.currentIndex.get()===t?e.show():e.hide(),[4,e.load()];case 1:return i.sent(),e.activate(),[3,3];case 2:e.hide(),e.unload(),e.deactivate(),i.label=3;case 3:return[2]}})}),function(t,n){return e.apply(this,arguments)}))}}}]),t}(),lq=function(){function t(n){e(this,t),this._value=void 0,this._subscriptions=[],this._onChangeDelay=null,void 0!==n&&(this._value=n)}return n(t,[{key:"set",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(i||e!==this._value)&&(this._value=e,this._onChangeDelay&&clearTimeout(this._onChangeDelay),n?this._onChange():this._onChangeDelay=setTimeout(function(){t._onChange()},1))}},{key:"get",value:function(){return this._value}},{key:"toggle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.set(!this.get(),e,t)}},{key:"on",value:function(e,t){if(!e||"function"!=typeof e)throw Error("No callback provided.");this._subscriptions.push({callback:e,context:t})}},{key:"off",value:function(e){e?"string"==typeof e?this._subscriptions=this._subscriptions.filter(function(t){return e!==t.context}):this._subscriptions=this._subscriptions.filter(function(t){return e!==t.callback}):this._subscriptions=[]}},{key:"destroy",value:function(){this._value=void 0,this._subscriptions=[],this._onChangeDelay&&clearTimeout(this._onChangeDelay)}},{key:"_onChange",value:function(){this._subscriptions.length<1||this._subscriptions.forEach(function(e){e.callback.call()})}}]),t}(),lY=["prev","next","go"],lK=function(){function t(n){return e(this,t),!!n&&"true"!=n.getAttribute("data-STHVisual-isInitiated")&&(this.wrapperElement=n,this.data=this.wrapperElement.getAttribute("data-STHVisual-data")?JSON.parse(this.wrapperElement.getAttribute("data-STHVisual-data")):null,!!this.data&&void(this.dimensions={width:1,height:1},this.resizeObserver=null,this.intersectionObserver=null,this.visual=null,this.currentIndex=new lq(0),this.is={initiated:!1,loaded:!1},this.build()))}return n(t,[{key:"build",value:function(){var e,t,n=this;this.visual=new lX(this.data,this.currentIndex,function(){n.onLoaded()}),(null===(e=this.visual)||void 0===e?void 0:e.monitor)&&this.wrapperElement.appendChild(null===(t=this.visual)||void 0===t?void 0:t.monitor.ui.wrapper),this.wrapperElement.appendChild(this.visual.getRendererElement()),this.observeResize(),this.observeIntersection(),this.bindEvents(),this.onInitiated()}},{key:"unbuild",value:function(){this.visual&&this.visual.destroy();var e=this.wrapperElement.querySelector('[data-STHVisual-role~="canvas"]');e&&e.remove(),this.unobserveResize(),this.unobserveIntersection(),this.unbindEvents(),this.wrapperElement.removeAttribute("data-STHVisual-isInitiated"),this.wrapperElement.removeAttribute("data-STHVisual-isLoaded")}},{key:"bindEvents",value:function(){this.onMouseMove=this.onMouseMove.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onApi=this.onApi.bind(this),this.wrapperElement.addEventListener("mousemove",this.onMouseMove),this.wrapperElement.addEventListener("mouseleave",this.onMouseLeave),this.wrapperElement.addEventListener("STHVisual/api",this.onApi)}},{key:"unbindEvents",value:function(){this.wrapperElement.removeEventListener("mousemove",this.onMouseMove),this.wrapperElement.removeEventListener("mouseleave",this.onMouseLeave),this.wrapperElement.removeEventListener("STHVisual/api",this.onApi)}},{key:"observeResize",value:function(){var e=this;this.resizeObserver=new eo(function(){e.resize()}).observe(this.wrapperElement)}},{key:"unobserveResize",value:function(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}},{key:"observeIntersection",value:function(){var e=this;this.intersectionObserver=new IntersectionObserver(function(t){t[0]&&(t[0].isIntersecting?e.onEnter():e.onLeave())},{threshold:0}),this.intersectionObserver.observe(this.wrapperElement)}},{key:"unobserveIntersection",value:function(){this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null)}},{key:"resize",value:function(){this.dimensions={width:this.wrapperElement.offsetWidth,height:this.wrapperElement.offsetHeight},this.visual&&this.visual.resize(this.dimensions)}},{key:"go",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.data.items.length&&this.currentIndex.set((t%(e=this.data.items.length)+e)%e)}},{key:"dispatchEvent",value:function(e,t){var n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(e&&this.wrapperElement){var i=new CustomEvent("STHVisual/".concat(e),{detail:t,bubbles:n});this.wrapperElement.dispatchEvent(i)}}},{key:"destroy",value:function(){this.unbuild()}},{key:"onEnter",value:function(){this.visual&&this.visual.start()}},{key:"onLeave",value:function(){this.visual&&this.visual.stop()}},{key:"onMouseMove",value:function(e){this.visual&&this.visual.setPointerPosition({x:(-.5+e.offsetX/this.dimensions.width)*2,y:(-.5+e.offsetY/this.dimensions.height)*2})}},{key:"onMouseLeave",value:function(e){this.visual&&this.visual.setPointerPosition({x:0,y:0})}},{key:"onInitiated",value:function(){!this.is.initiated&&this.wrapperElement&&(this.is.initiated=!0,this.wrapperElement.setAttribute("data-STHVisual-isInitiated","true"),this.dispatchEvent("initiated"))}},{key:"onLoaded",value:function(){!this.is.loaded&&this.wrapperElement&&(this.is.loaded=!0,this.wrapperElement.setAttribute("data-STHVisual-isLoaded","true"),this.dispatchEvent("loaded"))}},{key:"onApi",value:function(e){var t=null==e?void 0:e.detail,n=t.action,i=t.index;if(n&&lY.includes(n))switch(n){case"prev":this.go(this.currentIndex.get()-1);break;case"next":this.go(this.currentIndex.get()+1);break;case"go":this.go(i);case"destroy":this.destroy}}}]),t}(),lZ=["init","destroy"],lJ=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e(this,t),this.options=r({},{selectorInstance:'[data-STHVisual-role~="instance"]'},n),this.instances=[],window.matchMedia("(prefers-reduced-motion)").matches||(this.init(),this.bindEvents())}return n(t,[{key:"init",value:function(){var e=this;this.instances.length&&this.destroy();var t=document.querySelectorAll(this.options.selectorInstance);(null==t?void 0:t.length)&&t.forEach(function(t){var n=new lK(t);n&&e.instances.push(n)})}},{key:"destroy",value:function(){this.instances&&this.instances.forEach(function(e){return e.destroy()}),this.instances=[]}},{key:"bindEvents",value:function(){this.onApi=this.onApi.bind(this),document.addEventListener("STHVisual/api",this.onApi)}},{key:"unbindEvents",value:function(){document.removeEventListener("STHVisual/api",this.onApi)}},{key:"onApi",value:function(e){var t=null==e?void 0:e.detail,n=t.action;if(t.index,n&&lZ.includes(n))switch(n){case"init":this.init();break;case"destroy":this.destroy()}}}]),t}();window.STHVisual=new lJ({})}();
//# sourceMappingURL=sth-visual.legacy.min.js.map
